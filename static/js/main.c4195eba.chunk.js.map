{"version":3,"sources":["LogicModel/ControllerMapping/GlobalControllerHandling.js","ObserverPattern/Observer.js","Camera/Camera.js","Camera/CarOffsetCamera.js","Camera/OribtalCamera.js","3DModels/VisualEntity.js","3DModels/Models.js","3DModels/CarModel.js","LogicModel/ControllerMapping/LogitechG29Controller.js","LogicModel/ControllerMapping/XboxController.js","ObserverPattern/Observable.js","LogicModel/Physics/AmmoInstance.js","LogicModel/Physics/PhysicsTypes/CarPhysics.js","LogicModel/CarLogic/CarEngineStates/AbstractEngineState.js","LogicModel/CarLogic/CarEngineStates/TurnedOffEngine.js","LogicModel/CarLogic/CarEngineStates/TurnedOnEngine.js","LogicModel/CarLogic/CarEngine.js","LogicModel/CarLogic/ShiftBox.js","LogicModel/CarLogic/ShiftBoxTypes/ManualBox.js","LogicModel/CarLogic/ShiftBoxTypes/SemiAutomaticBox.js","LogicModel/CarLogic/Car.js","LogicModel/Physics/PhysicsTypes/GeneralPhysics.js","LogicModel/Physics/PhysicsTypes/BoxPhysics.js","3DModels/TrafficCone.js","LogicModel/Physics/PhysicsTypes/CylinderPhysics.js","3DModels/StraightStreet.js","Levels/LevelsFactory.js","addons/VRbutton.js","Scene/ThreeScene.jsx","Menus/MainMenu.jsx","Menus/Components/ConfigDrawer.jsx","Menus/LevelEditorContext/ItemsContext.jsx","Menus/Components/ItemsDrawer.jsx","Menus/Components/InputsGrid.jsx","Menus/Resources/Street/AbstractStreet.js","Menus/Resources/Street/Curve.js","Menus/Resources/Street/Intersection.js","Menus/Resources/Street/StraightStreet.js","Menus/Resources/Street/TStreet.js","Menus/Resources/Street/StraightStreetLinker.js","Menus/Resources/StreetFactory.js","Menus/Resources/LevelEditor.js","Menus/Components/LevelGrid.jsx","Menus/LevelEditor.jsx","Menus/Constants/Constants.js","Menus/Sessions/SessionContext.jsx","Menus/Resources/Hasher.js","Menus/Components/LoginForm.jsx","Menus/Sessions/SessionHooks.jsx","Menus/Components/SignUpForm.jsx","Menus/Sessions/SessionProvider.jsx","App.jsx","index.jsx"],"names":["GlobalControllerHandling","car","this","valueClutch","valueAccelerator","accelerate","valueBrake","brake","valueShift","changeShift","wheelAxesValue","turnDirection","turnOnCar","update","mode","changeShiftBox","Observer","observedState","newState","Camera","renderer","camera","THREE","window","innerWidth","innerHeight","group","group180Rot","add","aspect","updateProjectionMatrix","cameraOffset","Vector3","applyQuaternion","rotation","position","copy","localStorage","getItem","offsetVectorCamera","setRotationFromQuaternion","setRotationFromAxisAngle","Math","PI","lookAt","rotationQuat","x","y","z","w","normalize","quaternion","scene","CarOffsetCamera","positionCamera","cameraOffsetRotated","positionToLookAt","OrbitalCamera","controls","OrbitControls","domElement","enableDamping","dampingFactor","enableZoom","set","VisualEntity","pathToTexture","fbxLoader","FBXLoader","gltfLoader","GLTFLoader","threeDModel","loadAsync","threeDObject","result","objectName","scale","loadFBX","modelVariable","loadGLTF","name","ModelsSingleton","carModel","building_1","building_2","building_3","building_4","pathToTextureRcvd","Models","loadModels","Error","SCALE","POSITION","MAX_TIRE_TURN_IN_RADS","FACTOR_KMH_TO_MS","CarModel","carLogic","lastValueRotation","currentSpeedRotation","currentWheelRotation","lastSteeringRotation","lastVelocityRotation","lastRPMRotation","path","absellipse","ellipseGeometry","retrovisor","Reflector","textureWidth","devicePixelRatio","textureHeight","clipBias","multisample","rotateX","rotateY","leftMirrorGeometry","leftMirror","container","Object3D","rightMirrorGeometry","rightMirror","generateRetrovisor","generateLeftMirror","generateRightMirror","getInstance","models","generateMirrors","moveCar","physicsShape","Geometry","texture","color","PHYSICSSQUARE","GeometryRueda","rotateZ","textureRueda","wheelMesh1","wheelMesh2","wheelMesh3","wheelMesh4","wheelsData","userData","physicsBody","rotateWheels","rotateSteeringWheel","rotateVelocityAndRPM","steeringWheel","children","find","o","vectorRotation","applyAxisAngle","rotateOnAxis","velocityIndicator","rpmIndicator","newVelRotation","abs","newRPMRotation","wheelFrontRight","wheelFrontLeft","wheelBackRight","wheelBackLeft","rotationYVectorTwo","rotationYVectorOne","require","default","LogitechG29Controller","gamepads","navigator","getGamepads","webkitGetGamepads","gamepad","i","length","id","startsWith","buttonX","buttonSquare","buttonCircle","buttonTriangle","bumperRight","bumperLeft","buttonR2","buttonL2","shareButton","optionsButton","buttonR3","buttonL3","firstShift","secondShift","thirdShift","fourthShift","fifthShift","sixthShift","reverseShift","buttonPlus","buttonMinus","wheelInEnterRight","wheelInEnterLeft","enter","psButton","buttonsPressed","push","wheelAxes","clutch","accelerator","DPad","valueDpadUP","valueDpadDOWN","valueDpadLEFT","valueDpadRIGHT","dpadPressed","globalControllerHandler","checkGamepadChanges","doActionByMapping","updateCar","axes","handleAccelerate","handleBrake","buttons","pressed","doActionsPedals","doActionsWheel","doActionsDPad","doActionsButtons","doActionsShifter","LogitechG29ControllerSingleton","instance","STICK_LIMIT","XboxController","auto","buttonA","buttonB","buttonY","buttonL1","buttonR1","optionButton","padUp","padDown","padLeft","padRight","buttomHome","buttonPressed","actualShift","xLeftAxe","yLeftAxe","xRightAxe","yRightAxe","axe","value","doActionHotKeys","doActionsAxes","doActionsTriggers","XboxControllerSingleton","Observable","observers","observer","index","indexOf","splice","stateToSend","AmmoInstance","AmmoInstanceToReturn","Ammo","CarPhysics","inertia","mass","shape","physicsWorld","friction","btVector3","transform","btTransform","setIdentity","setOrigin","setRotation","btQuaternion","tempTransform","motionState","btDefaultMotionState","btBoxShape","calculateLocalInertia","rigidBodyInfo","btRigidBodyConstructionInfo","rigidBody","btRigidBody","setFriction","setRollingFriction","addRigidBody","tuning","btVehicleTuning","rayCaster","btDefaultVehicleRaycaster","vehicle","btRaycastVehicle","setCoordinateSystem","addAction","addWheel","setActivationState","isFront","pos","radius","width","side","wheelDirectionCS0","wheelAxleCS","wheelInfo","set_m_suspensionStiffness","set_m_wheelsDampingRelaxation","set_m_wheelsDampingCompression","set_m_frictionSlip","set_m_rollInfluence","returnValue","getNumWheels","updateWheelTransform","transfMatrix","getWheelTransformWS","getOrigin","getRotation","wheels","Vector4","worldTransformChassis","getChassisWorldTransform","chassis","engineForce","applyEngineForce","speedKMH","getCurrentSpeedKmHour","frictionBrake","setBrake","setSteeringValue","MAX_RPM","EXPONENTIAL_COEF_TO_RPM","AbstractEngineState","valuePedal","accelerating","currentRPM","currentXInRPMCurve","sumToValueInCurve","exp","TurnedOffEngine","changeValueInRPMCurve","TurnedOnEngine","CarEngine","engineState","shiftBox","shutDownEngine","clutchIsPressed","rpmReturn","handleEngineShutdown","RPMModification","log","ShiftBox","carEngine","NEUTRAL","REVERSE","FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH","validShifts","currentShift","minimumVelocityOnShift","maximumVelocityOnShift","shift","newShift","oldVelocity","getCurrentRPM","normalFactorRPM","calculateNormalFactorRPM","XValue","currentVelocity","valueClutchNormalized","minVelocityBasedOnClutch","normalFactorToDecrement","normalFactor","ManualBox","isValidShift","changeRPM","getValueForNewRPM","SemiAutomaticBox","Car","currentDirectionTurn","currentTireRotation","rotationQuaternion","carPhysics","buildAmmoPhysics","engineCanApplyForce","setEngineForce","getEngineForce","getVelocity","turnOn","setSteeringRotation","positionAndRotation","updatePhysics","getDataToAnimate","getCurrentShift","GeneralPhysics","generateShape","setMargin","getMotionState","getWorldTransform","notifyObservers","velocityVector","velVectorBT","applyForce","BoxPhysics","TrafficCone","RADIUS_TOP","RADIUS_BOTTOM","HEIGHT","geometry","undefined","load","material","map","materialBox","geometryPlane","box","cone","CylinderPhysics","btCylinderShape","StraightStreet","pathToNormalMap","SIZE","SIDEWALK_HEIGHT","wrapS","wrapT","repeat","normalTexture","materialSidewalk","normalMap","geometrySidewalk","modelBuilding","clone","iter","loadBuildingBlock","parseInt","random","model3D","LONG","secondModel3D","baseStreet","createStreetMesh","leftSidewalk","createSidewalkMesh","rightSidewalk","createBuildings","LevelFactory","physicsToUpdate","objectsToAnimate","forEach","phys","object","animate","height","pathTexture","normalMapPath","floorMaterial","normalScale","rampa","quaternionRamp","setFromAxisAngle","rampPhysics","ramp","addToScene","conePhysics","attachObserver","street","streetPhysics","leftSidewalkPhysics","rightSidewalkPhysics","segmentsQuantity","buildStreetPhysics","createRectangle","createCone","createStreet","VRButton","button","document","createElement","disableButton","style","display","cursor","left","onmouseenter","onmouseleave","onclick","stylizeElement","element","bottom","padding","border","borderRadius","background","font","textAlign","opacity","outline","zIndex","xr","isSessionSupported","then","supported","currentSession","onSessionStarted","session","addEventListener","onSessionEnded","setSession","textContent","removeEventListener","requestSession","optionalFeatures","setItem","end","showEnterVR","xrSessionIsGranted","click","catch","exception","console","warn","message","isSecureContext","href","location","replace","innerHTML","textDecoration","test","userAgent","registerSessionGrantedListener","ThreeScene","state","gotAnyEvent","bench","alpha","setSize","setClearColor","GLBench","getContext","addContainerToScene","clock","createAmmo","ambientLight","sunLight","level","createLevelCustom","animation","bind","handleWindowResize","generateEvents","mount","appendChild","setAnimationLoop","now","body","createButton","enabled","e","removeInstance","event","numCamera","key","removeObserver","collisionConfiguratation","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","overlappingPairCache","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","setGravity","handleResize","render","getCameraInstance","deltaTime","getDelta","begin","stepSimulation","setPositionRelativeToObject","checkEvents","setState","getSpeed","info","calls","nextFrame","top","right","fontWeight","ref","Component","styleMenu","backgroundImage","backgroundSize","backgroundRepeat","MainMenu","navigate","useNavigate","className","fontSize","onClick","ConfigDrawer","openConfigs","handleDrawerClose","React","useState","open","setOpen","useEffect","DrawerHeader","styled","theme","alignItems","spacing","mixins","toolbar","justifyContent","Grid","Drawer","sx","flexShrink","boxSizing","variant","anchor","paddingRight","Divider","ItemsContext","createContext","allUnselected","ItemsDrawer","openItems","useContext","setLastSelectedItem","lastSelectedItem","itemSelected","setItemSelected","paddingLeft","flexDirection","Object","entries","nameItem","isSelected","alt","src","item","dictSelection","selectedItem","positionX","positionY","handleSelection","InputsGrid","setGridDimensions","gridDimensions","InputWidth","setInputWidth","InputHeight","setInputHeight","direction","marginLeft","xs","type","step","onChange","target","replaceAll","Button","STANDARD_BOX_LONG","AbstractStreet","ninePerNineGrid","rowIndex","columnIndex","rightFilled","filled","topFilled","botFilled","leftFilled","determineStreetRotation","long","cell","rowCount","columnCount","sumValueForCell","POSSIBLE_ROTATIONS","Curve","bot","dict","calculateNeighboursFilled","Intersection","TStreet","StraightStreetLinker","arrayOfStreets","sections","segregateSections","sectionsAsJSON","linkSections","rows","cols","sectionsArray","getPositionAsRowAndColumn","streetRow","streetCol","isHorizontal","generateArraySubsections","array","finalArray","sectionsJSON","jsonForStreet","reduce","acum","elem","getPositionX","getPositionY","getLongX","getLongY","TYPES_OF_STREETS","StreetFactory","levelGrid","isInfiniteLevel","getNinePerNineGrid","getNinePerNineGridInfinite","getNinePerNineGridFinite","straightStreetsArray","curvedStreetsArray","j","streetObject","defineTypeOfStreet","isStraight","conjunctedStraightStreets","linkStraightStreets","getAsJSON","indexRow","indexColumn","matrix","rowArray","realRow","realColumn","celda_vacia","row","column","typeDefined","typeResult","isValidNinePerNineGrid","getSectionsAsJSON","getCountSidesPainted","aux","validateGrid","isInfinite","validateGridInfinite","valid","wrongCells","validateGridNotInfinite","COLORS","LevelGrid","setLevelGrid","setClick","rightClick","setRightClick","finalGrid","currentRow","newCell","preventDefault","arrayContains","insiderArray","equals","exc","marginTop","marginRight","onMouseDown","idx_row","idx_col","backgroundColor","onMouseMove","col","levelGridCopy","div_color","onEnterHoverWithClickCell","onMouseUp","btn_click","onClickCell","vec_aux","exportObj","exportName","dataStr","encodeURIComponent","JSON","stringify","downloadAnchorNode","setAttribute","remove","downloadObjectAsJson","constructStreets","generateJSONFromGrid","LevelEditor","setOpenItems","setOpenConfigs","itemsInGrid","setItemsInGrid","currentItems","Provider","IconButton","margin","idx","API_URL","VALID_REGEX_EMAIL","SessionContext","createHash","hash","string","digest","LoginForm","email","setEmail","password","setPassword","showPassword","setShowPassword","error","setError","setSessionWithResponse","loginResponse","user","jwt","getUser","getJWT","SessionHooks","postLogin","fetch","method","headers","APIResponse","status","json","endMSG","detail","msg","error_msg","statusText","validateFields","errors","match","submitLogin","toString","postLoginGoogle","token","submitGoogleLogin","responseAPI","onSubmit","alignContent","maxWidth","Alert","severity","onClose","listerror","TextField","label","InputProps","endAdornment","InputAdornment","Visibility","VisibilityOff","to","onSuccess","credentialResponse","OAuthToken","credential","onError","SignUpForm","passwordConfirmation","setPasswordConfirmation","nameToShow","setNameToShow","errorArray","postSignUp","fetchUrl","submitSignUp","res","SessionProvider","childElement","clientId","App","title","exact","ReactDOM","createRoot","getElementById"],"mappings":"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","file":"static/js/main.c4195eba.chunk.js","sourcesContent":["export default class GlobalControllerHandling{\r\n\r\n    \r\n    constructor(car){\r\n        this.car = car;\r\n    }\r\n\r\n\r\n    handleAccelerate(valueClutch, valueAccelerator){\r\n        this.car.accelerate(valueClutch, valueAccelerator);\r\n    }\r\n\r\n\r\n    handleBrake(valueClutch, valueBrake){\r\n        this.car.brake(valueClutch, valueBrake);\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, valueShift){\r\n        this.car.changeShift(valueClutch, valueShift);\r\n    }\r\n\r\n\r\n    turnDirection(wheelAxesValue){\r\n        this.car.turnDirection(wheelAxesValue);\r\n    }\r\n\r\n\r\n    turnOnCar(){\r\n        this.car.turnOnCar();\r\n    }\r\n\r\n\r\n    updateCar(){\r\n        this.car.update();\r\n    }\r\n\r\n\r\n    changeShiftBox(mode){\r\n        this.car.changeShiftBox(mode);\r\n    }\r\n}","//Methods to override. This is an interface but can not be declared as interface in JS.\r\nexport default class Observer{\r\n\r\n    constructor(){\r\n        this.observedState = null;\r\n    }\r\n\r\n    update(newState){\r\n        this.observedState = newState;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\nconst Y_DISTANCE = 0.6;\r\nconst Z_DISTANCE = -0.1;\r\nconst X_DISTANCE = 0.35;\r\nexport default class Camera extends Observer{\r\n\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 85, window.innerWidth / window.innerHeight, 0.1, 100 );\r\n        this.group =  new THREE.Object3D();\r\n        this.group180Rot = new THREE.Object3D().add(this.camera);\r\n        this.group.add(this.group180Rot);\r\n        this.renderer = renderer;\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(X_DISTANCE, Y_DISTANCE, Z_DISTANCE);\r\n        if(this.observedState != null){\r\n            cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.group.position.copy(this.observedState.position).add(cameraOffset);\r\n            \r\n            if (localStorage.getItem(\"VR\") === \"true\"){\r\n                let offsetVectorCamera = new Vector3(0,-1.25,0); //Offset to be in place for driver's seat\r\n                offsetVectorCamera.applyQuaternion(this.observedState.rotation);\r\n                this.group.position.add(offsetVectorCamera);\r\n                this.group.setRotationFromQuaternion(this.observedState.rotation);\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), Math.PI);\r\n                this.camera.lookAt(new Vector3(0,0,5));\r\n            }else{\r\n                const rotationQuat = new THREE.Quaternion(this.observedState.rotation.x, this.observedState.rotation.y, this.observedState.rotation.z, this.observedState.rotation.w).normalize();\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), -5*Math.PI/180);\r\n                this.group.quaternion.copy(rotationQuat);\r\n            }\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,5));\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    \r\n    addContainerToScene(scene){\r\n        scene.add(this.group);\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\n\r\nexport default class CarOffsetCamera extends Observer{\r\n\r\n\r\n    constructor(positionCamera){\r\n        super();\r\n        this.positionCamera = positionCamera;\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100 );\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(this.positionCamera.x, this.positionCamera.y, this.positionCamera.z);\r\n        if(this.observedState != null){\r\n            let cameraOffsetRotated = cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.camera.position.copy(this.observedState.position).add(cameraOffsetRotated);\r\n            let positionToLookAt = new Vector3(this.observedState.position.x, this.observedState.position.y, this.observedState.position.z);\r\n            this.camera.lookAt(positionToLookAt);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n            this.camera.position.copy(cameraOffset);\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\"\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\nexport default class OrbitalCamera extends Observer{\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );\r\n        this.renderer = renderer;\r\n        this.controls = new OrbitControls(this.camera, this.renderer.domElement);\r\n        this.controls.enableDamping = true;\r\n        this.controls.dampingFactor = 0.25;\r\n        this.controls.enableZoom = true;\r\n        this.camera.position.set(0,5.5,0);\r\n    }\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    setPositionRelativeToObject(){\r\n        this.controls.update();\r\n        if(this.observedState != null){\r\n            this.camera.lookAt(this.observedState[\"position\"]);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n        }\r\n    }\r\n}","import { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\nimport Observer from \"../ObserverPattern/Observer\"\r\n\r\nexport default class VisualEntity extends Observer{\r\n\r\n    constructor(pathToTexture){\r\n        super();\r\n        this.fbxLoader = new FBXLoader();\r\n        this.gltfLoader = new GLTFLoader();\r\n        this.threeDModel = null;\r\n        this.pathToTexture = pathToTexture;\r\n    }\r\n\r\n    async loadFBX(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.fbxLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n        \r\n    }\r\n\r\n    async loadGLTF(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.gltfLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n\r\n    }\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            let modelVariable;\r\n            try{\r\n                modelVariable =  await this.loadFBX();\r\n                this.threeDModel = modelVariable;\r\n            }catch(e){\r\n                modelVariable =  await this.loadGLTF();\r\n                this.threeDModel = modelVariable.scene;\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.x = position[0];\r\n            this.threeDModel.position.y = position[1];\r\n            this.threeDModel.position.z = position[2];\r\n            this.threeDModel.scale.x = scale[0];\r\n            this.threeDModel.scale.y = scale[1];\r\n            this.threeDModel.scale.z = scale[2];\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getModel(){\r\n        return this.threeDModel;\r\n    }\r\n\r\n    //Abstract Method\r\n    animate(){\r\n        return null;\r\n    }\r\n\r\n\r\n}","import { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\n\r\nclass ModelsSingleton{\r\n\r\n    constructor(){\r\n        this.gltfLoader = new GLTFLoader();\r\n        this.carModel = null;\r\n        this.building_1 = null;\r\n        this.building_2 = null;\r\n        this.building_3 = null;\r\n        this.building_4 = null;\r\n    }\r\n\r\n    async loadGLTF(pathToTextureRcvd){\r\n        let pathToTexture = pathToTextureRcvd;\r\n        const result = await this.gltfLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result.scene;\r\n    }\r\n\r\n    async loadModels(){\r\n        this.carModel = this.loadGLTF('res/models/source/AutoConInterior.glb');\r\n        this.building_1 = this.loadGLTF('res/models/source/buildings/Building_1.glb');\r\n        this.building_2 = this.loadGLTF('res/models/source/buildings/Building_2.glb');\r\n        this.building_3 = this.loadGLTF('res/models/source/buildings/Building_3.glb');\r\n        this.building_4 = this.loadGLTF('res/models/source/buildings/Building_4.glb');\r\n        return \"OK\";\r\n    }\r\n\r\n    \r\n}\r\n\r\nexport default class Models{\r\n\r\n    static ModelsSingleton\r\n\r\n    static async getInstance(){\r\n        if (!Models.ModelsSingleton){\r\n            Models.ModelsSingleton = new ModelsSingleton();\r\n            let res = await Models.ModelsSingleton.loadModels();\r\n            if (res === \"OK\"){\r\n                return Models.ModelsSingleton;\r\n            }else{\r\n                throw new Error(\"Error al cargar los modelos.\");\r\n            }\r\n        }else{\r\n            return Models.ModelsSingleton;\r\n        }\r\n        \r\n    }\r\n}","import { Vector3 } from 'three';\r\nimport * as THREE from 'three';\r\nimport VisualEntity from './VisualEntity';\r\n//import { Reflector } from '../addons/Reflector';\r\nimport { Reflector } from 'three/examples/jsm/objects/Reflector';\r\nimport { Object3D } from 'three';\r\nimport Models from './Models';\r\n\r\nconst SCALE = [1.0, 1.0, 1.0];\r\nconst POSITION = [0,0,0];\r\nconst MAX_TIRE_TURN_IN_RADS = 0.75;\r\nconst FACTOR_KMH_TO_MS = 1/3600;\r\nconst VELOCITY_TO_ANGULAR_VEL = 1/0.25; //Velocity/Radius\r\nconst STEERING_WHEEL_INITIAL_ROTATION_ON_X = -0.35;\r\nconst MAX_VELOCITY_SHOWN = 240;\r\nconst MAX_RPM_SHOWN = 6000;\r\n\r\nexport default class CarModel extends VisualEntity{\r\n    \r\n    \r\n    constructor(){\r\n        super('res/models/source/AutoConInterior.glb');\r\n        this.carModel = null;\r\n        this.carLogic = null;\r\n        this.lastValueRotation = 0;\r\n        this.currentSpeedRotation = 0;\r\n        this.currentWheelRotation = 0;\r\n        this.lastSteeringRotation = 0;\r\n        this.lastVelocityRotation = 0;\r\n        this.lastRPMRotation = 0;\r\n    }\r\n\r\n\r\n    generateRetrovisor(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.15,0.075,0, Math.PI*2, false,0);\r\n        const ellipseGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const retrovisor = new Reflector(\r\n            ellipseGeometry,\r\n            {\r\n                textureWidth: window.innerWidth * window.devicePixelRatio/2,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: window.innerHeight * window.devicePixelRatio/2,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0.35,\r\n                multisample: 2\r\n            }\r\n        );\r\n        retrovisor.rotateX( -Math.PI );\r\n        retrovisor.rotateY( 0.3 );\r\n        retrovisor.position.set(0,0.625,0.375);\r\n        this.threeDModel.add(retrovisor);\r\n    }\r\n\r\n\r\n    generateLeftMirror(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.105,0.075,0, Math.PI*2, false,0);\r\n        const leftMirrorGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const leftMirror = new Reflector(\r\n            leftMirrorGeometry, \r\n            {\r\n                textureWidth: window.innerWidth * window.devicePixelRatio/2,//512\r\n                textureHeight: window.innerHeight * window.devicePixelRatio/2 ,//512\r\n                clipBias: 0,\r\n                multisample: 2\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(leftMirror);\r\n        container.position.set(1.148, 0.394, 0.538);\r\n        container.rotateX(-Math.PI+0.03);\r\n        leftMirror.rotateY(-26*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateRightMirror(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.105,0.075,0, Math.PI*2, false,0);\r\n        const rightMirrorGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const rightMirror = new Reflector(\r\n            rightMirrorGeometry, \r\n            {\r\n                textureWidth: 512,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: 512,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0,\r\n                multisample: 2\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(rightMirror);\r\n        container.position.set(-1.138, 0.394, 0.53);\r\n        container.rotateX(-Math.PI+2.9*Math.PI/180);\r\n        rightMirror.rotateY(28.2*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateMirrors(){\r\n        this.generateRetrovisor();\r\n        this.generateLeftMirror();\r\n        this.generateRightMirror();\r\n    }\r\n\r\n    async addToScene(scene){\r\n        const models = await Models.getInstance();\r\n        this.threeDModel = await models.carModel;\r\n        this.threeDModel.name = \"driverCar\";\r\n        this.threeDModel.position.x = POSITION[0];\r\n        this.threeDModel.position.y = POSITION[1];\r\n        this.threeDModel.position.z = POSITION[2];\r\n        this.threeDModel.scale.x = SCALE[0];\r\n        this.threeDModel.scale.y = SCALE[1];\r\n        this.threeDModel.scale.z = SCALE[2];\r\n        scene.add(this.threeDModel);\r\n        this.generateMirrors();\r\n        return this;\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.moveCar();\r\n        //this.watchPhysicsColliders();\r\n    }\r\n\r\n\r\n    addPhysicsView(scene){\r\n        this.physicsShape = new Vector3(2,1.35,5);\r\n        \r\n        const Geometry = new THREE.BoxGeometry( this.physicsShape.x, this.physicsShape.y, this.physicsShape.z);\r\n        const texture = new THREE.MeshBasicMaterial( {color: 0x0000ff} );\r\n        this.PHYSICSSQUARE = new THREE.Mesh( Geometry, texture );\r\n        this.PHYSICSSQUARE.position.set (0,0,0);\r\n        scene.add(this.PHYSICSSQUARE);\r\n\r\n        const GeometryRueda = new THREE.CylinderGeometry( 0.35, 0.35, 0.35, 32, 32);\r\n        GeometryRueda.rotateZ(Math.PI / 2);\r\n        const textureRueda = new THREE.MeshBasicMaterial( {color: 0xff0000} );\r\n        this.wheelMesh1 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh1.position.set (0,4,0);\r\n        scene.add(this.wheelMesh1);\r\n\r\n        this.wheelMesh2 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh2.position.set (0,4,0);\r\n        scene.add(this.wheelMesh2);\r\n\r\n        this.wheelMesh3 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh3.position.set (0,4,0);\r\n        scene.add(this.wheelMesh3);\r\n\r\n        this.wheelMesh4 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh4.position.set (0,4,0);\r\n        scene.add(this.wheelMesh4);\r\n    }\r\n\r\n    //Only for debug purpose2\r\n    watchPhysicsColliders(){\r\n        \r\n        if(this.observedState != null){\r\n            this.PHYSICSSQUARE.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            this.PHYSICSSQUARE.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh1.position.set(\r\n                this.observedState.wheelsData[0][\"position\"].x, \r\n                this.observedState.wheelsData[0][\"position\"].y, \r\n                this.observedState.wheelsData[0][\"position\"].z\r\n            );\r\n            this.wheelMesh1.quaternion.set(\r\n                this.observedState.wheelsData[0][\"rotation\"].x, \r\n                this.observedState.wheelsData[0][\"rotation\"].y, \r\n                this.observedState.wheelsData[0][\"rotation\"].z, \r\n                this.observedState.wheelsData[0][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh2.position.set(\r\n                this.observedState.wheelsData[1][\"position\"].x, \r\n                this.observedState.wheelsData[1][\"position\"].y, \r\n                this.observedState.wheelsData[1][\"position\"].z\r\n            );\r\n            this.wheelMesh2.quaternion.set(\r\n                this.observedState.wheelsData[1][\"rotation\"].x, \r\n                this.observedState.wheelsData[1][\"rotation\"].y, \r\n                this.observedState.wheelsData[1][\"rotation\"].z, \r\n                this.observedState.wheelsData[1][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh3.position.set(\r\n                this.observedState.wheelsData[2][\"position\"].x, \r\n                this.observedState.wheelsData[2][\"position\"].y, \r\n                this.observedState.wheelsData[2][\"position\"].z\r\n            );\r\n            this.wheelMesh3.quaternion.set(\r\n                this.observedState.wheelsData[2][\"rotation\"].x, \r\n                this.observedState.wheelsData[2][\"rotation\"].y, \r\n                this.observedState.wheelsData[2][\"rotation\"].z, \r\n                this.observedState.wheelsData[2][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh4.position.set(\r\n                this.observedState.wheelsData[3][\"position\"].x, \r\n                this.observedState.wheelsData[3][\"position\"].y, \r\n                this.observedState.wheelsData[3][\"position\"].z\r\n            );\r\n            this.wheelMesh4.quaternion.set(\r\n                this.observedState.wheelsData[3][\"rotation\"].x, \r\n                this.observedState.wheelsData[3][\"rotation\"].y, \r\n                this.observedState.wheelsData[3][\"rotation\"].z, \r\n                this.observedState.wheelsData[3][\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    moveCar(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.userData.physicsBody = this.observedState[\"physicsBody\"];\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n            this.lastValueRotation = this.observedState[\"direction\"];\r\n            this.rotateWheels();\r\n            this.rotateSteeringWheel();\r\n            this.rotateVelocityAndRPM();\r\n        }\r\n    }\r\n\r\n\r\n    rotateSteeringWheel(){\r\n        let steeringWheel = this.threeDModel.children.find(o => o.name === 'Steering_Wheel');\r\n        let vectorRotation = new Vector3(0,0,1).applyAxisAngle(new Vector3(1,0,0), STEERING_WHEEL_INITIAL_ROTATION_ON_X);\r\n        steeringWheel.rotateOnAxis(vectorRotation, -this.lastSteeringRotation);\r\n        steeringWheel.rotateOnAxis(vectorRotation, -this.observedState['lastRotationWheel']*540/360*Math.PI*2);\r\n        this.lastSteeringRotation = -this.observedState['lastRotationWheel']*540/360*Math.PI*2;\r\n    }\r\n\r\n\r\n    rotateVelocityAndRPM(){\r\n        let velocityIndicator = this.threeDModel.children.find(o => o.name === 'Cubo');\r\n        let rpmIndicator = this.threeDModel.children.find(o => o.name === 'Cubo001');\r\n        const newVelRotation = -Math.abs(this.observedState[\"velocity\"])*(240*Math.PI/180)/MAX_VELOCITY_SHOWN;\r\n        const newRPMRotation = -this.observedState[\"rpm\"]*(260*Math.PI/180)/MAX_RPM_SHOWN; //Can surpass a little bit the rpm meter\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastVelocityRotation);\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), newVelRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastRPMRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), newRPMRotation);\r\n        this.lastVelocityRotation = newVelRotation;\r\n        this.lastRPMRotation = newRPMRotation;\r\n    }\r\n\r\n\r\n    rotateWheels(){\r\n        let wheelFrontRight = this.threeDModel.children.find(o => o.name === 'wheel002');\r\n        let wheelFrontLeft = this.threeDModel.children.find(o => o.name === 'wheel');\r\n        let wheelBackRight = this.threeDModel.children.find(o => o.name === 'wheel003');\r\n        let wheelBackLeft = this.threeDModel.children.find(o => o.name === 'wheel001');\r\n\r\n        let rotationYVectorTwo = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            this.currentSpeedRotation\r\n        );\r\n        let rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation\r\n        );\r\n\r\n        //Resetting position in direction\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, this.currentWheelRotation);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorTwo, this.currentWheelRotation);\r\n        \r\n        //Moving by rotation caused by speed.\r\n        wheelFrontLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelFrontRight.rotateX(-this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackRight.rotateX(-this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n\r\n        rotationYVectorTwo = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            this.currentSpeedRotation + this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL\r\n        );\r\n        rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation - this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL\r\n        );\r\n\r\n        //Moving to the sides based on steering wheel value\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorTwo, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        this.currentWheelRotation = this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS;\r\n\r\n        this.currentSpeedRotation += this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL;\r\n        if(this.currentSpeedRotation >= Math.PI*2){\r\n            this.currentSpeedRotation -= Math.PI*2;\r\n        }\r\n    }\r\n}","const { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst DPAD_NOT_PRESSED = 1.2857143878936768;\r\nconst DPAD_UP = -1;\r\nconst DPAD_UP_PRESSED = 0;\r\nconst DPAD_DOWN = 0.14285719394683838;\r\nconst DPAD_DOWN_PRESSED = 1;\r\nconst DPAD_LEFT = 0.7142857313156128;\r\nconst DPAD_LEFT_PRESSED = 2;\r\nconst DPAD_RIGHT = -0.4285714030265808;\r\nconst DPAD_RIGHT_PRESSED = 3;\r\n\r\n\r\nclass LogitechG29Controller{\r\n    constructor(carLogic){\r\n        this.carLogic = carLogic;\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonX = 0;\r\n        this.buttonSquare = 1;\r\n        this.buttonCircle = 2;\r\n        this.buttonTriangle = 3;\r\n        this.bumperRight = 4;\r\n        this.bumperLeft = 5;\r\n        this.buttonR2 = 6;\r\n        this.buttonL2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionsButton = 9;\r\n        this.buttonR3 = 10;\r\n        this.buttonL3 = 11;\r\n        this.firstShift = 12;\r\n        this.secondShift = 13;\r\n        this.thirdShift = 14;\r\n        this.fourthShift = 15;\r\n        this.fifthShift = 16;\r\n        this.sixthShift = 17;\r\n        this.reverseShift = 18;\r\n        this.buttonPlus = 19;\r\n        this.buttonMinus = 20;\r\n        this.wheelInEnterRight = 21;\r\n        this.wheelInEnterLeft = 22;\r\n        this.enter = 23;\r\n        this.psButton = 24;\r\n\r\n        this.buttonsPressed = [];\r\n        for(let i=0; i <= 24; i++){\r\n            this.buttonsPressed.push(false);\r\n        }\r\n\r\n        this.wheelAxes = 0;\r\n        this.clutch = 1;\r\n        this.accelerator = 2;\r\n        this.brake = 5;\r\n        this.DPad = 9;\r\n\r\n        //This is conveniently defined by using distances if needed, it is not exact.\r\n        this.valueDpadUP = DPAD_UP;\r\n        this.valueDpadDOWN = DPAD_DOWN;\r\n        this.valueDpadLEFT = DPAD_LEFT;\r\n        this.valueDpadRIGHT = DPAD_RIGHT;\r\n\r\n        this.dpadPressed = [];\r\n        for(let i=0; i <= 3; i++){\r\n            this.dpadPressed.push(false);\r\n        }\r\n        \r\n        this.globalControllerHandler = new GlobalControllerHandling(carLogic);\r\n    }\r\n\r\n    \r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n\r\n    doActionsPedals(){\r\n        let clutch = ((this.gamepad.axes[this.clutch] )**3);\r\n        let brake = ((this.gamepad.axes[this.brake] )**3);\r\n        brake = (1 - (brake + 1) / 2);\r\n        let accelerator = ((this.gamepad.axes[this.accelerator] )**3);\r\n        accelerator = (1 - (accelerator + 1) / 2);\r\n        this.globalControllerHandler.handleAccelerate(clutch, accelerator);\r\n        this.globalControllerHandler.handleBrake(clutch, brake);\r\n    }\r\n\r\n\r\n    doActionsWheel(){\r\n        this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes]);\r\n    }\r\n\r\n\r\n    doActionsDPad(){\r\n        if(this.gamepad.axes[this.DPad] !== DPAD_NOT_PRESSED){\r\n            \r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadDOWN && !this.dpadPressed[DPAD_DOWN_PRESSED]){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadDOWN){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadLEFT && !this.dpadPressed[DPAD_LEFT_PRESSED]){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadLEFT){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadRIGHT && !this.dpadPressed[DPAD_RIGHT_PRESSED]){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadRIGHT){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadUP && !this.dpadPressed[DPAD_UP_PRESSED]){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadUP){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = false;\r\n            }\r\n        }else{\r\n            for(let i = 0; i < this.dpadPressed.length; i++){\r\n                this.dpadPressed[i] = false;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    doActionsButtons(){\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonsPressed[this.buttonX]) {\r\n            this.buttonsPressed[this.buttonX] = true\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonsPressed[this.buttonX] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonTriangle].pressed && !this.buttonsPressed[this.buttonTriangle]) {\r\n            this.buttonsPressed[this.buttonTriangle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonTriangle].pressed){\r\n            this.buttonsPressed[this.buttonTriangle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonCircle].pressed && !this.buttonsPressed[this.buttonCircle]) {\r\n            this.buttonsPressed[this.buttonCircle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonCircle].pressed){\r\n            this.buttonsPressed[this.buttonCircle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonSquare].pressed && !this.buttonsPressed[this.buttonSquare]) {\r\n            this.buttonsPressed[this.buttonSquare] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonSquare].pressed){\r\n            this.buttonsPressed[this.buttonSquare] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.psButton].pressed && !this.buttonsPressed[this.psButton]) {\r\n            this.buttonsPressed[this.psButton] = true;\r\n        }else if(!this.gamepad.buttons[this.psButton].pressed){\r\n            this.buttonsPressed[this.psButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonPlus].pressed && !this.buttonsPressed[this.buttonPlus]) {\r\n            this.buttonsPressed[this.buttonPlus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonPlus].pressed){\r\n            this.buttonsPressed[this.buttonPlus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonMinus].pressed && !this.buttonsPressed[this.buttonMinus]) {\r\n            this.buttonsPressed[this.buttonMinus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonMinus].pressed){\r\n            this.buttonsPressed[this.buttonMinus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed && !this.buttonsPressed[this.buttonL2]) {\r\n            this.buttonsPressed[this.buttonL2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL2].pressed){\r\n            this.buttonsPressed[this.buttonL2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonsPressed[this.buttonL3]) {\r\n            this.buttonsPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonsPressed[this.buttonL3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR2].pressed && !this.buttonsPressed[this.buttonR2]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonsPressed[this.buttonR2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR2].pressed){\r\n            this.buttonsPressed[this.buttonR2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonsPressed[this.buttonR3]) {\r\n        this.buttonsPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonsPressed[this.buttonR3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.enter].pressed && !this.buttonsPressed[this.enter]) {\r\n            this.buttonsPressed[this.enter] = true;\r\n        }else if(!this.gamepad.buttons[this.enter].pressed){\r\n            this.buttonsPressed[this.enter] = false;\r\n        }\r\n        \r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonsPressed[this.shareButton]) {\r\n            this.buttonsPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonsPressed[this.shareButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.optionsButton].pressed && !this.buttonsPressed[this.optionsButton]) {\r\n            this.buttonsPressed[this.optionsButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionsButton].pressed){\r\n            this.buttonsPressed[this.optionsButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperLeft].pressed && !this.buttonsPressed[this.bumperLeft]) {\r\n            this.buttonsPressed[this.bumperLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperLeft].pressed){\r\n            this.buttonsPressed[this.bumperLeft] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperRight].pressed && !this.buttonsPressed[this.bumperRight]) {\r\n            this.buttonsPressed[this.bumperRight] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperRight].pressed){\r\n            this.buttonsPressed[this.bumperRight] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.wheelInEnterLeft].pressed && !this.buttonsPressed[this.wheelInEnterLeft]) {\r\n            this.buttonsPressed[this.wheelInEnterLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterLeft].pressed){\r\n            this.buttonsPressed[this.wheelInEnterLeft] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.wheelInEnterRight].pressed && !this.buttonsPressed[this.wheelInEnterRight]) {\r\n            this.buttonsPressed[this.wheelInEnterRight] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterRight].pressed){\r\n            this.buttonsPressed[this.wheelInEnterRight] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionsShifter(){\r\n        if (this.gamepad.buttons[this.firstShift].pressed && !this.buttonsPressed[this.firstShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 1);\r\n            this.buttonsPressed[this.firstShift] = true;\r\n        }else if(!this.gamepad.buttons[this.firstShift].pressed && this.buttonsPressed[this.firstShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.firstShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.secondShift].pressed && !this.buttonsPressed[this.secondShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 2);\r\n            this.buttonsPressed[this.secondShift] = true;\r\n        }else if(!this.gamepad.buttons[this.secondShift].pressed && this.buttonsPressed[this.secondShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.secondShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.thirdShift].pressed && !this.buttonsPressed[this.thirdShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 3);\r\n            this.buttonsPressed[this.thirdShift] = true;\r\n        }else if(!this.gamepad.buttons[this.thirdShift].pressed && this.buttonsPressed[this.thirdShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.thirdShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fourthShift].pressed && !this.buttonsPressed[this.fourthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 4);\r\n            this.buttonsPressed[this.fourthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fourthShift].pressed && this.buttonsPressed[this.fourthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fourthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fifthShift].pressed && !this.buttonsPressed[this.fifthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 5);\r\n            this.buttonsPressed[this.fifthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fifthShift].pressed && this.buttonsPressed[this.fifthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fifthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.sixthShift].pressed && !this.buttonsPressed[this.sixthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 6);\r\n            this.buttonsPressed[this.sixthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.sixthShift].pressed && this.buttonsPressed[this.sixthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.sixthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.reverseShift].pressed && !this.buttonsPressed[this.reverseShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], -1);\r\n            this.buttonsPressed[this.reverseShift] = true;\r\n        }else if(!this.gamepad.buttons[this.reverseShift].pressed && this.buttonsPressed[this.reverseShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.reverseShift] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionByMapping(){\r\n        this.doActionsPedals();\r\n        this.doActionsWheel();\r\n        this.doActionsDPad();\r\n        this.doActionsButtons();\r\n        this.doActionsShifter();\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport default class LogitechG29ControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(carLogic) {\r\n        if (!LogitechG29ControllerSingleton.instance) {\r\n            LogitechG29ControllerSingleton.instance = new LogitechG29Controller(carLogic);\r\n        }\r\n        return LogitechG29ControllerSingleton.instance;\r\n    }\r\n}\r\n\r\n\r\n//module.exports = LogitechG29ControllerSingleton;","\r\nconst { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst STICK_LIMIT = 0.1;\r\nconst CLUTCH_PRESED = 0;\r\nconst CLUTCH_NOT_PRESED = 1;\r\n\r\nclass XboxController{\r\n    constructor(auto){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('Xbox') || gamepads[i].id.startsWith('xinput')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonA = 0;\r\n        this.buttonB = 1;\r\n        this.buttonX = 2;\r\n        this.buttonY = 3;\r\n        this.buttonL1 = 4;\r\n        this.buttonR1 = 5;\r\n        this.buttonL2 = 6;\r\n        this.buttonR2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionButton = 9;\r\n        this.buttonL3 = 10;\r\n        this.buttonR3 = 11;\r\n        this.padUp = 12;\r\n        this.padDown = 13;\r\n        this.padLeft = 14;\r\n        this.padRight = 15;\r\n        this.buttomHome = 16;\r\n        this.buttonPressed = [];\r\n        this.actualShift = 0;\r\n        for(let i = 0; i <= 16; i++){\r\n            this.buttonPressed.push(false);\r\n        }\r\n        \r\n        this.xLeftAxe = 0;\r\n        this.yLeftAxe = 1;\r\n        this.xRightAxe = 2;\r\n        this.yRightAxe = 3;\r\n        this.globalControllerHandler = new GlobalControllerHandling(auto);\r\n    }\r\n\r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('Xbox')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n    doActionsAxes(){\r\n        if(Math.abs(this.gamepad.axes[this.yLeftAxe]) >= STICK_LIMIT){    \r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.xLeftAxe]) >= STICK_LIMIT){\r\n            let axe = ((this.gamepad.axes[this.xLeftAxe] )**3)\r\n            this.globalControllerHandler.turnDirection(axe);\r\n        }else{\r\n            this.globalControllerHandler.turnDirection(0);\r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.yRightAxe]) >= STICK_LIMIT){\r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.xRightAxe]) >= STICK_LIMIT){\r\n        }\r\n    }\r\n\r\n    doActionHotKeys(){\r\n        this.globalControllerHandler.handleAccelerate(CLUTCH_NOT_PRESED, this.gamepad.buttons[this.buttonR2].value);\r\n        this.globalControllerHandler.handleBrake(CLUTCH_PRESED, this.gamepad.buttons[this.buttonL2].value);\r\n    }\r\n\r\n    doActionsTriggers(){\r\n        if (this.gamepad.buttons[this.buttonR2].pressed) {\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed) {\r\n        }\r\n    }\r\n\r\n\r\n\r\n    doActionsButtons(){\r\n        \r\n        if (this.gamepad.buttons[this.buttonR1].pressed && !this.buttonPressed[this.buttonR1]) {\r\n            if(this.actualShift <= 5){\r\n                this.actualShift += 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonR1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR1].pressed){\r\n            \r\n            this.buttonPressed[this.buttonR1] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL1].pressed && !this.buttonPressed[this.buttonL1]) {\r\n            if(this.actualShift >= 0){\r\n                this.actualShift -= 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonL1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL1].pressed){\r\n            this.buttonPressed[this.buttonL1] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonPressed[this.shareButton]) {\r\n            this.buttonPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonPressed[this.shareButton] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padUp].pressed && !this.buttonPressed[this.padUp]) {\r\n            this.buttonPressed[this.padUp] = true;\r\n        }else if(!this.gamepad.buttons[this.padUp].pressed){\r\n            this.buttonPressed[this.padUp] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padDown].pressed && !this.buttonPressed[this.padDown]) {\r\n            this.buttonPressed[this.padDown] = true;\r\n        }else if(!this.gamepad.buttons[this.padDown].pressed){\r\n            this.buttonPressed[this.padDown] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padLeft].pressed && !this.buttonPressed[this.padLeft]) {\r\n            this.buttonPressed[this.padLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.padLeft].pressed){\r\n            this.buttonPressed[this.padLeft] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padRight].pressed && !this.buttonPressed[this.padRight]) {\r\n            this.buttonPressed[this.padRight] = true;\r\n        }else if(!this.gamepad.buttons[this.padRight].pressed){\r\n            this.buttonPressed[this.padRight] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonA].pressed && !this.buttonPressed[this.buttonA]) {\r\n            this.buttonPressed[this.buttonA] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonA].pressed){\r\n            this.buttonPressed[this.buttonA] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonB].pressed && !this.buttonPressed[this.buttonB]) {\r\n            this.buttonPressed[this.buttonB] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonB].pressed){\r\n            this.buttonPressed[this.buttonB] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonY].pressed && !this.buttonPressed[this.buttonY]) {\r\n            this.buttonPressed[this.buttonY] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonY].pressed){\r\n            this.buttonPressed[this.buttonY] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonPressed[this.buttonX]) {\r\n            this.buttonPressed[this.buttonX] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonPressed[this.buttonX] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonPressed[this.buttonR3]) {\r\n            this.buttonPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonPressed[this.buttonR3] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonPressed[this.buttonL3]) {\r\n            this.buttonPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonPressed[this.buttonL3] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padUp].pressed && !this.buttonPressed[this.padUp]) {\r\n            this.buttonPressed[this.padUp] = true;\r\n        }else if(!this.gamepad.buttons[this.padUp].pressed){\r\n            this.buttonPressed[this.padUp] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padDown].pressed && !this.buttonPressed[this.padDown]) {\r\n            this.buttonPressed[this.padDown] = true;\r\n        }else if(!this.gamepad.buttons[this.padDown].pressed){\r\n            this.buttonPressed[this.padDown] = false;\r\n        }\r\n\r\n        \r\n        if (this.gamepad.buttons[this.padLeft].pressed && !this.buttonPressed[this.padLeft]) {\r\n            this.buttonPressed[this.padLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.padLeft].pressed){\r\n            this.buttonPressed[this.padLeft] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.padRight].pressed && !this.buttonPressed[this.padRight]) {\r\n            this.buttonPressed[this.padRight] = true;\r\n        }else if(!this.gamepad.buttons[this.padRight].pressed){\r\n            this.buttonPressed[this.padRight] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.buttomHome].pressed && !this.buttonPressed[this.buttomHome]) {\r\n            this.globalControllerHandler.changeShiftBox(\"semi-auto\");\r\n            this.buttonPressed[this.buttomHome] = true;\r\n        }else if(!this.gamepad.buttons[this.buttomHome].pressed){\r\n            this.buttonPressed[this.buttomHome] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.optionButton].pressed && !this.buttonPressed[this.optionButton]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonPressed[this.optionButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionButton].pressed){\r\n            this.buttonPressed[this.optionButton] = false;\r\n        }\r\n    }\r\n\r\n    doActionByMapping(){\r\n        this.doActionHotKeys();\r\n        this.doActionsAxes();\r\n        this.doActionsTriggers();\r\n        this.doActionsButtons();\r\n    }\r\n}\r\n\r\nexport default class XboxControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(auto) {\r\n        if (!XboxControllerSingleton.instance) {\r\n            XboxControllerSingleton.instance = new XboxController(auto);\r\n        }\r\n        return XboxControllerSingleton.instance;\r\n    }\r\n}","export default class Observable{\r\n\r\n    constructor(){\r\n        this.observers = [];\r\n    }\r\n\r\n    attachObserver(observer){\r\n        this.observers.push(observer);\r\n    }\r\n\r\n    removeObserver(observer){\r\n        let index = this.observers.indexOf(observer);\r\n        if(index > -1){\r\n            this.observers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    notifyObservers(stateToSend){\r\n        for (let i = 0; i < this.observers.length; i++){\r\n            this.observers[i].update(stateToSend);\r\n        }\r\n    }\r\n}","import Ammo from 'ammo.js'\r\n\r\nexport default class AmmoInstance{\r\n\r\n    static AmmoInstanceToReturn = null;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static async getInstance(){\r\n        if(!AmmoInstance.AmmoInstanceToReturn){\r\n            AmmoInstance.AmmoInstanceToReturn = await Ammo();\r\n        }\r\n        return AmmoInstance.AmmoInstanceToReturn;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst FRONT_LEFT = 0;\r\nconst FRONT_RIGHT = 1;\r\nconst BACK_LEFT = 2;\r\nconst BACK_RIGHT = 3;\r\n\r\nconst SIDE_RIGHT =-1;\r\nconst SIDE_LEFT = 1;\r\nconst MAX_STEER = -0.5;\r\n\r\nconst MAX_FRICTION_FORCE = 100;\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\nexport default class CarPhysics{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction *10);\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        this.tuning = new this.Ammo.btVehicleTuning();\r\n        var rayCaster = new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld);\r\n        this.vehicle = new this.Ammo.btRaycastVehicle(this.tuning, this.rigidBody, rayCaster);\r\n        this.vehicle.setCoordinateSystem(0, 1, 2);\r\n        this.physicsWorld.addAction(this.vehicle);\r\n\r\n        let radio_rueda = 0.35;\r\n        let disti_center = 0.85;\r\n        var wheelAxisPositionBack = -1.45;\r\n        var wheelRadiusBack = radio_rueda;\r\n        var wheelWidthBack = 0.35;\r\n        var wheelHalfTrackBack = -disti_center;\r\n        var wheelAxisHeightBack = 0.2;\r\n\r\n        var wheelAxisFrontPosition = 1.65;\r\n        var wheelHalfTrackFront = disti_center;\r\n        var wheelAxisHeightFront = 0.2;\r\n        var wheelRadiusFront = radio_rueda;\r\n        var wheelWidthFront = 0.35;\r\n\r\n\r\n        this.addWheel(true, new this.Ammo.btVector3(wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_LEFT,SIDE_LEFT);\r\n        this.addWheel(true, new this.Ammo.btVector3(-wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_RIGHT,SIDE_RIGHT);\r\n        this.addWheel(false, new this.Ammo.btVector3(-wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_LEFT,SIDE_LEFT);\r\n        this.addWheel(false, new this.Ammo.btVector3(wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_RIGHT,SIDE_RIGHT);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    addWheel(isFront, pos, radius, width, index, side) {\r\n        var wheelDirectionCS0 = new this.Ammo.btVector3(0, -1, 0);\r\n        var wheelAxleCS = new this.Ammo.btVector3(-1, 0, 0);\r\n        var suspensionStiffness = 2.0;\r\n        var suspensionRestLength = 0.6;\r\n        var rollInfluence = 0.2;\r\n        var friction = 1000;\r\n        var suspensionDamping = 3.3;\r\n        var suspensionCompression = 4.4;\r\n        var wheelInfo = this.vehicle.addWheel(\r\n            pos,\r\n            wheelDirectionCS0,\r\n            wheelAxleCS,\r\n            suspensionRestLength,\r\n            radius,\r\n            this.tuning,\r\n            isFront\r\n        );\r\n\r\n        wheelInfo.set_m_suspensionStiffness(suspensionStiffness);\r\n        wheelInfo.set_m_wheelsDampingRelaxation(suspensionDamping);\r\n        wheelInfo.set_m_wheelsDampingCompression(suspensionCompression);\r\n        wheelInfo.set_m_frictionSlip(friction);\r\n        wheelInfo.set_m_rollInfluence(rollInfluence);\r\n\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let returnValue = {\r\n            \"chassis\": {\r\n                \"position\": null,\r\n                \"rotation\": null,\r\n            },\r\n            \"wheels\": []\r\n        }\r\n        for (let i=0; i < this.vehicle.getNumWheels(); i++){\r\n            this.vehicle.updateWheelTransform(i, true);\r\n            let transfMatrix = this.vehicle.getWheelTransformWS(i);\r\n            let position = transfMatrix.getOrigin();\r\n            let rotation = transfMatrix.getRotation();\r\n            returnValue.wheels.push({\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            });\r\n        }\r\n        let worldTransformChassis = this.vehicle.getChassisWorldTransform();\r\n            \r\n        let position = worldTransformChassis.getOrigin();\r\n        let rotation = worldTransformChassis.getRotation();\r\n        returnValue.chassis = {\r\n            \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n            \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n        };\r\n        return returnValue;\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n\r\n    \r\n    setEngineForce( engineForce ){\r\n        this.vehicle.applyEngineForce( engineForce, BACK_LEFT );\r\n        this.vehicle.applyEngineForce( engineForce, BACK_RIGHT );\r\n    }\r\n\r\n\r\n    brake(valueBrake){\r\n        let speedKMH = Math.abs(this.vehicle.getCurrentSpeedKmHour());\r\n        let frictionBrake = MAX_FRICTION_FORCE / ( speedKMH );\r\n        if( speedKMH === 0 ){\r\n            frictionBrake = 0;\r\n        }\r\n        valueBrake += frictionBrake;\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_LEFT);\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_RIGHT);\r\n        this.vehicle.setBrake(valueBrake, BACK_LEFT);\r\n        this.vehicle.setBrake(valueBrake, BACK_RIGHT);\r\n    }\r\n\r\n\r\n    setSteeringRotation( rotation ){\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_LEFT);\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_RIGHT);\r\n    }\r\n\r\n\r\n    getVelocity(){\r\n        return this.vehicle.getCurrentSpeedKmHour();\r\n    }\r\n}","export const MAX_RPM = 8000;\r\nconst ACCEL_COEF = 2;\r\nconst BRAKE_COEF = 1.5;\r\nexport const EXPONENTIAL_COEF_TO_RPM = 200;\r\n\r\nexport class AbstractEngineState{\r\n    changeValueInRPMCurve(valuePedal, accelerating, currentRPM, currentXInRPMCurve){\r\n\r\n        let sumToValueInCurve;\r\n        let previousRPM = currentRPM;\r\n        if(accelerating){\r\n            let normalizedAccelerator = valuePedal;\r\n            //let normalizedAccelerator = (1 - (valuePedal + 1) / 2);\r\n            let normalizedRPM = previousRPM/MAX_RPM;\r\n            sumToValueInCurve = (normalizedAccelerator - normalizedRPM) * ACCEL_COEF;\r\n        }else{\r\n            sumToValueInCurve = -valuePedal * BRAKE_COEF;\r\n        }\r\n        currentXInRPMCurve = currentXInRPMCurve + sumToValueInCurve;\r\n        if (currentXInRPMCurve > 3 * EXPONENTIAL_COEF_TO_RPM){\r\n            currentXInRPMCurve = 3 * EXPONENTIAL_COEF_TO_RPM;\r\n        }\r\n        else if(currentXInRPMCurve < 0){ //X's value is not able to have negative value in our calculation.\r\n            currentXInRPMCurve = 0;\r\n        }\r\n\r\n        //We'll simulate the RPM's in an equation similar to capacitors in order to not make it linear and make it independent of everything.\r\n        currentRPM = MAX_RPM * (1 - Math.exp(-currentXInRPMCurve/EXPONENTIAL_COEF_TO_RPM));\r\n\r\n        return [currentRPM, currentXInRPMCurve];\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nconst ACCEL_NOT_PRESSED = 0;\r\n\r\nexport default class TurnedOffEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(ACCEL_NOT_PRESSED, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nexport default class TurnedOnEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueAccelerator, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from './CarEngineStates/AbstractEngineState';\r\nimport TurnedOffEngine from './CarEngineStates/TurnedOffEngine';\r\nimport TurnedOnEngine from './CarEngineStates/TurnedOnEngine';\r\n\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 0;//1000\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = 0.25;\r\n\r\nexport default class CarEngine{\r\n\r\n\r\n    constructor(){\r\n        this.engineState = new TurnedOffEngine();\r\n        this.currentRPM = 0;\r\n        this.currentXInRPMCurve = 0;\r\n    }\r\n\r\n\r\n    turnOn(){\r\n        this.engineState = new TurnedOnEngine();\r\n    }\r\n\r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    handleEngineShutdown(valueClutch,shiftBox){\r\n        //!this.clutchIsPressed(valueClutch) && this.currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN\r\n        if(shiftBox.shutDownEngine(valueClutch,this.currentRPM)){\r\n            if(this.engineState instanceof TurnedOnEngine){\r\n                this.engineState = new TurnedOffEngine();\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n\r\n    isInConditionToAccelerate(valueClutch){\r\n        return ((this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch)) || this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    engineCanApplyForce(valueClutch){\r\n        return (this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator, shiftBox){\r\n        let rpmReturn = this.engineState.accelerate(valueAccelerator, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake,shiftBox){\r\n        let rpmReturn = this.engineState.brake(valueBrake, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    changeRPM(RPMModification){\r\n        this.currentRPM = RPMModification;\r\n        if( (-this.currentRPM/MAX_RPM + 1) > 0 ){\r\n            this.currentXInRPMCurve = -Math.log( -this.currentRPM/MAX_RPM + 1) * EXPONENTIAL_COEF_TO_RPM;\r\n            if(this.currentXInRPMCurve < 0){\r\n                this.currentXInRPMCurve = 0;\r\n            }\r\n        }else if(this.currentRPM === MAX_RPM){\r\n            this.currentXInRPMCurve = EXPONENTIAL_COEF_TO_RPM * 3;\r\n        }\r\n    }\r\n\r\n\r\n    getCurrentRPM(){\r\n        return this.currentRPM;\r\n    }\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from \"./CarEngineStates/AbstractEngineState\";\r\n\r\n\r\nconst QUANTITY_SHIFTS = 6;\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = -0.75;\r\n\r\nexport default class ShiftBox{\r\n\r\n    constructor(carEngine){\r\n        this.NEUTRAL = 0;\r\n        this.REVERSE = -1;\r\n        this.FIRST = 1;\r\n        this.SECOND = 2;\r\n        this.THIRD = 3;\r\n        this.FOURTH = 4;\r\n        this.FIFTH = 5;\r\n        this.SIXTH = 6;\r\n        this.validShifts = [this.REVERSE, this.NEUTRAL, this.FIRST, this.SECOND, this.THIRD, this.FOURTH, this.FIFTH, this.SIXTH];\r\n\r\n        this.currentShift = this.NEUTRAL;\r\n        this.carEngine = carEngine;\r\n\r\n        this.minimumVelocityOnShift = [0, 10, 20, 35, 60, 90];\r\n        this.maximumVelocityOnShift = [40, 60, 80, 110, 140, 200];\r\n\r\n    }\r\n\r\n    isValidShift(shift){\r\n        if (this.validShifts.indexOf(shift) >= 0){\r\n            return true;\r\n        }else{\r\n            throw new Error(\"Shift \" + shift + \" is not valid.\");\r\n        }\r\n    }\r\n    \r\n\r\n    calculateNormalFactorRPM(newShift,oldVelocity){\r\n        return ((oldVelocity - this.minimumVelocityOnShift[Math.abs(newShift) - 1]) / \r\n            (this.maximumVelocityOnShift[Math.abs(newShift) - 1] - this.minimumVelocityOnShift[Math.abs(newShift) - 1]));\r\n    }\r\n    \r\n\r\n    getValueForNewRPM(newShift, oldVelocity){\r\n        if(newShift === this.NEUTRAL || (Math.abs(newShift) === this.FIRST && Math.abs(oldVelocity) < 5)){\r\n            return this.carEngine.getCurrentRPM();\r\n        }\r\n        if(newShift === this.REVERSE && oldVelocity > 0){\r\n            return 0;\r\n        }\r\n        if(newShift > 0 && oldVelocity < 0){\r\n            return 0;\r\n        }\r\n        let normalFactorRPM = this.calculateNormalFactorRPM(newShift, oldVelocity);\r\n        if ( normalFactorRPM > 1 ){\r\n            return MAX_RPM;\r\n        }else{\r\n            let XValue = normalFactorRPM * EXPONENTIAL_COEF_TO_RPM;\r\n            return (MAX_RPM * (1 - Math.exp(-XValue/EXPONENTIAL_COEF_TO_RPM)));\r\n        }\r\n    }\r\n    \r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    shutDownEngine(){\r\n        return false;\r\n    }\r\n\r\n    //CONSIDERAR EL VALUE DEL ACCELERATOR DE FORMA SIMILAR A COMO SE CONSIDERA EN ABSTRACT ENGINE STATE PARA QUE SI ES NEGATIVO DECREMENTE LA VELOCIDAD Y NO AUMENTE\r\n    getEngineForce(currentVelocity, valueClutch){\r\n        currentVelocity = Math.abs(currentVelocity);\r\n        let currentRPM = this.carEngine.getCurrentRPM();\r\n\r\n        if(this.currentShift === this.NEUTRAL){\r\n            return 0;\r\n        }\r\n\r\n        let valueClutchNormalized = (valueClutch + 1)/2;\r\n        let minVelocityBasedOnClutch = this.minimumVelocityOnShift[Math.abs(this.currentShift) - 1] * (1 - Math.exp(-valueClutchNormalized*3));\r\n        //If there is a next shift and it has ideal velocity we can calculate the Normalized Engine Force based on velocity range\r\n\r\n        let rangeOfVelocities = this.maximumVelocityOnShift[Math.abs(this.currentShift) - 1] - minVelocityBasedOnClutch;\r\n        let normalFactorToDecrement = (currentVelocity - minVelocityBasedOnClutch) / rangeOfVelocities;\r\n        if(currentVelocity < minVelocityBasedOnClutch){\r\n            //Debería dar trompicones\r\n        }\r\n        let normalFactor = (1 - normalFactorToDecrement)**2;\r\n\r\n        if(normalFactor > 1){\r\n            normalFactor = 0;\r\n        }\r\n\r\n        let powerFactor = (QUANTITY_SHIFTS / this.currentShift);\r\n        let finalEngineForce =  powerFactor * currentRPM * normalFactor;\r\n        return finalEngineForce\r\n\r\n    }\r\n\r\n    changeShift(){\r\n        //METHOD TO OVERRIDE\r\n    }\r\n\r\n\r\n    getCurrentShift(){\r\n        return this.currentShift;\r\n    }\r\n\r\n}","import ShiftBox from '../ShiftBox';\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 1000;\r\nexport default class ManualBox extends ShiftBox{\r\n\r\n    \r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift) && this.clutchIsPressed(valueClutch)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }else{\r\n            throw new Error(\"Can't change shift if clutch is not pressed\");\r\n        }\r\n    }\r\n\r\n\r\n    shutDownEngine(valueClutch, currentRPM){\r\n        return !this.clutchIsPressed(valueClutch) && currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN;\r\n    }\r\n}","import ShiftBox from '../ShiftBox';\r\n\r\nexport default class SemiAutomaticBox extends ShiftBox{\r\n\r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }\r\n    }\r\n}","import { Vector3, Vector4 } from 'three';\r\nimport Observable from '../../ObserverPattern/Observable';\r\nimport CarPhysics from '../Physics/PhysicsTypes/CarPhysics';\r\nimport CarEngine from './CarEngine';\r\nimport ManualBox from './ShiftBoxTypes/ManualBox';\r\nimport SemiAutomaticBox from './ShiftBoxTypes/SemiAutomaticBox';\r\n\r\n\r\nconst POSITION = [0,1,0];\r\nconst FACTOR_BRAKE_TO_FORCE = 300;\r\nexport default class Car extends Observable{\r\n\r\n    constructor(physicsWorld){\r\n        super();\r\n        this.carEngine = new CarEngine();\r\n        this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        this.currentDirectionTurn = 0; //in rads\r\n        this.currentTireRotation = 0;\r\n        this.position = new Vector3(POSITION[0], POSITION[1], POSITION[2]);\r\n        this.rotationQuaternion = new Vector4(0,0,0,1);\r\n        this.mass = 1000;\r\n        this.physicsShape = new Vector3(2,1.3,5);\r\n        this.rotation = new Vector4(0,0,0,1);\r\n        this.inertia = new Vector3(1,0,1);\r\n\r\n        this.carPhysics = new CarPhysics(this.position, this.rotationQuaternion, this.inertia, this.mass, this.physicsShape, physicsWorld, 0);\r\n        this.carPhysics.buildAmmoPhysics();\r\n        \r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator){\r\n        this.carEngine.accelerate(valueClutch, valueAccelerator,this.shiftBox);\r\n        if(valueAccelerator > 0.1 && this.carEngine.engineCanApplyForce(valueClutch)){\r\n            this.carPhysics.setEngineForce( this.shiftBox.getEngineForce(this.carPhysics.getVelocity(), valueClutch) );\r\n        }else{\r\n            this.carPhysics.setEngineForce( 0 );\r\n        }\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake){\r\n        this.carEngine.brake(valueClutch, valueBrake,this.shiftBox);\r\n        //Mapping [-1;1] to [0;1]\r\n        this.carPhysics.brake(valueBrake*FACTOR_BRAKE_TO_FORCE);\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, newShift){\r\n        this.shiftBox.changeShift(valueClutch, newShift, this.carPhysics.getVelocity());\r\n    }\r\n\r\n\r\n    turnOnRightLight(){\r\n        //PRENDER EL INTERMITENTE DERECHO\r\n    }\r\n\r\n\r\n    turnOnLeftLight(){\r\n        //PRENDER EL INTERMITENTE DERECHO\r\n    }\r\n\r\n    \r\n    turnOnCar(){\r\n        this.carEngine.turnOn();\r\n    }\r\n\r\n    \r\n    turnDirection(wheelAxesValue){\r\n        this.currentTireRotation = wheelAxesValue;\r\n        this.carPhysics.setSteeringRotation( wheelAxesValue );\r\n    }\r\n\r\n\r\n    update(){\r\n        let positionAndRotation = this.carPhysics.updatePhysics();\r\n        this.position = positionAndRotation[\"chassis\"][\"position\"];\r\n        this.rotation = positionAndRotation[\"chassis\"][\"rotation\"];\r\n        this.wheelsData = positionAndRotation[\"wheels\"];\r\n        super.notifyObservers(this.getDataToAnimate());\r\n    }\r\n\r\n\r\n    getLastRotation(){\r\n        return this.currentTireRotation;\r\n    }\r\n\r\n    \r\n    getDataToAnimate(){\r\n        return {\r\n            \"direction\": this.currentDirectionTurn, \r\n            \"velocity\": this.carPhysics.getVelocity(), \r\n            \"lastRotationWheel\": this.currentTireRotation,\r\n            \"position\": this.position,\r\n            \"rotation\": this.rotation,\r\n            \"physicsBody\": this.carPhysics,\r\n            \"wheelsData\": this.wheelsData,\r\n            \"rpm\": this.getCurrentRPM()\r\n        };\r\n    }\r\n\r\n    getSpeed(){\r\n        return this.carPhysics.getVelocity();\r\n    }\r\n\r\n    getCurrentRPM(){\r\n        return this.carEngine.getCurrentRPM();\r\n    }\r\n\r\n    changeShiftBox(mode){\r\n        if(mode ===  \"semi-auto\"){\r\n            this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        }else if(mode === \"manual\"){\r\n            //TODO: asignar boton en volante\r\n            this.shiftBox = new ManualBox(this.carEngine);\r\n        }\r\n    }\r\n\r\n    getCurrentShift(){\r\n        return this.shiftBox.getCurrentShift();\r\n    }\r\n}","import Observable from \"../../../ObserverPattern/Observable\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\n\r\nexport default class GeneralPhysics extends Observable{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        super();\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        if(!friction) friction = 1;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async generateShape(){\r\n        return null;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = await this.generateShape();\r\n        shape.setMargin(0.05);\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction * 2)\r\n\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let motionState = this.rigidBody.getMotionState();\r\n        if(motionState){\r\n            motionState.getWorldTransform(this.tempTransform);\r\n            \r\n            let position = this.tempTransform.getOrigin();\r\n            let rotation = this.tempTransform.getRotation();\r\n            const newState = {\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            }\r\n            this.notifyObservers(newState);\r\n            return newState;\r\n        }else{\r\n            throw new Error(\"No motion state found in rigid body\");\r\n        }\r\n    }\r\n\r\n\r\n    setLinearVelocity(velocityVector){\r\n        let velVectorBT = new this.Ammo.btVector3(this.mass*velocityVector.x, this.mass*velocityVector.y, this.mass*velocityVector.z);\r\n        this.rigidBody.applyForce(velVectorBT);\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n}","import GeneralPhysics from \"./GeneralPhysics\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nexport default class BoxPhysics extends GeneralPhysics{\r\n\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        return new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n    }\r\n}","import VisualEntity from \"./VisualEntity\";\r\nimport * as THREE from 'three';\r\n\r\nexport default class TrafficCone extends VisualEntity{\r\n\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.RADIUS_TOP = 0.1;\r\n        this.RADIUS_BOTTOM = 0.8;\r\n        this.HEIGHT = 1.25;\r\n        this.observedState = null;\r\n    }\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            const geometry = new THREE.CylinderGeometry( this.RADIUS_TOP, this.RADIUS_BOTTOM, this.HEIGHT, 32, undefined, true );\r\n            const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n            const material = new THREE.MeshBasicMaterial( { map: texture });\r\n            const materialBox = new THREE.MeshBasicMaterial( { color: 0xd56324 } );\r\n            const geometryPlane = new THREE.BoxGeometry(this.RADIUS_BOTTOM*2, 0.1, this.RADIUS_BOTTOM*2);\r\n            const box = new THREE.Mesh( geometryPlane, materialBox );\r\n            box.position.set(0,-this.HEIGHT/2,0);\r\n            const cone = new THREE.Mesh( geometry, material );\r\n            cone.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(cone).add(box);\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.scale.set(scale[0], scale[1], scale[2]);\r\n\r\n            this.RADIUS_TOP *= scale[0];\r\n            this.RADIUS_BOTTOM *= scale[0];\r\n            this.HEIGHT *= scale[1];\r\n\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport GeneralPhysics from \"./GeneralPhysics\";\r\n\r\nexport default class CylinderPhysics extends GeneralPhysics{\r\n    \r\n    // Shape is a Vector3(Radius, HeightCylinder/2, Radius). \r\n    // See: https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=5889\r\n    // It's origin is in the center of the cylinder so calculate position by using height/2.\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        return new Ammo.btCylinderShape(new Ammo.btVector3(this.shape.x, this.shape.y, this.shape.z));\r\n    }\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from \"./VisualEntity\";\r\nimport Models from './Models';\r\n\r\nconst SEPARATION_BETWEEN_BUILDINGS = 7;\r\n\r\nexport default class StraightStreet extends VisualEntity{\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.pathToNormalMap = \"textures/pavimento_map.png\"\r\n        this.SIZE = 30;\r\n        this.SIDEWALK_HEIGHT = .4;\r\n        this.observedState = null;\r\n    }\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n    createSidewalkMesh(scale){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        texture.repeat.set( 3, 2*scale );\r\n        let normalTexture = new THREE.TextureLoader().load(\r\n            this.pathToNormalMap\r\n        );\r\n        normalTexture.repeat.set( 3, 2*scale );\r\n        normalTexture.wrapS = THREE.RepeatWrapping;\r\n        normalTexture.wrapT = THREE.RepeatWrapping;\r\n        const materialSidewalk = new THREE.MeshStandardMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        materialSidewalk.normalMap = normalTexture;\r\n        const geometrySidewalk = new THREE.BoxGeometry(7*this.SIZE/24, this.SIDEWALK_HEIGHT, this.SIZE);\r\n        return new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n    }\r\n\r\n    createStreetMesh(scale){\r\n        const geometry = new THREE.BoxGeometry( 10*this.SIZE/24, 0.1, this.SIZE );\r\n        const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n        \r\n        texture.repeat.set( 1, 2*scale );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        let normalTexture = new THREE.TextureLoader().load(\r\n            this.pathToNormalMap\r\n        );\r\n        normalTexture.repeat.set( 1, 2*scale );\r\n        normalTexture.wrapS = THREE.RepeatWrapping;\r\n        normalTexture.wrapT = THREE.RepeatWrapping;\r\n        const material = new THREE.MeshStandardMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        material.normalMap = normalTexture;\r\n        return new THREE.Mesh( geometry, material );\r\n    }\r\n\r\n    async loadBuildingBlock(id){\r\n        const models = await Models.getInstance();\r\n        const modelBuilding = await models[`building_${id}`];\r\n        return modelBuilding.clone();\r\n    }\r\n\r\n    async createBuildings(scale, position, iter){\r\n        let model3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        model3D.name = \"buildingsRight_\"+iter;\r\n        model3D.position.x = position[0]+10*this.SIZE/24;\r\n        model3D.position.y = position[1]+this.SIDEWALK_HEIGHT+0.05;\r\n        model3D.position.z = position[2]-this.LONG/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        model3D.scale.x = 0.8;\r\n        model3D.scale.y = 1;\r\n        model3D.scale.z = 0.6;\r\n        model3D.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n        let secondModel3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        secondModel3D.name = \"buildingsLeft_\"+iter;\r\n        secondModel3D.position.x = position[0]-10*this.SIZE/24;\r\n        secondModel3D.position.y = position[1]+this.SIDEWALK_HEIGHT+0.05;\r\n        secondModel3D.position.z = position[2]-this.LONG/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        secondModel3D.scale.x = 0.8;\r\n        secondModel3D.scale.y = 1;\r\n        secondModel3D.scale.z = 0.6;\r\n        secondModel3D.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI/2);\r\n        this.threeDModel.add(model3D, secondModel3D);\r\n        return [model3D.scene, secondModel3D.scene];\r\n    }\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            const baseStreet = this.createStreetMesh(scale);\r\n            const leftSidewalk = this.createSidewalkMesh(scale);\r\n            const rightSidewalk = this.createSidewalkMesh(scale);\r\n            baseStreet.position.set(0,0,0);\r\n            leftSidewalk.position.set(-8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0);\r\n            rightSidewalk.position.set(8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(baseStreet).add(leftSidewalk).add(rightSidewalk)\r\n            for (let i=0; i<4*scale; i++){\r\n                this.createBuildings(scale, position, i);\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            baseStreet.scale.set(1.0, 1.0, scale);\r\n            leftSidewalk.scale.set(1.0, 1.0, scale);\r\n            rightSidewalk.scale.set(1.0, 1.0, scale);\r\n            this.LONG = this.SIZE*scale;\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport BoxPhysics from '../LogicModel/Physics/PhysicsTypes/BoxPhysics';\r\nimport AmmoInstance from '../LogicModel/Physics/AmmoInstance';\r\nimport TrafficCone from '../3DModels/TrafficCone';\r\nimport CylinderPhysics from '../LogicModel/Physics/PhysicsTypes/CylinderPhysics';\r\nimport StraightStreet from '../3DModels/StraightStreet';\r\n\r\nexport default class LevelFactory {\r\n\r\n\r\n    constructor(scene,physicsWorld){\r\n        this.scene = scene;\r\n        this.physicsWorld = physicsWorld\r\n        this.physicsToUpdate = [];\r\n        this.objectsToAnimate = [];\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        this.physicsToUpdate.forEach(function(phys){\r\n            phys.updatePhysics();\r\n        })\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.objectsToAnimate.forEach(function(object){\r\n            object.animate();\r\n        });\r\n    }\r\n\r\n\r\n    async createRectangle(position,length, width, height ,rotation, pathTexture, Ammo, normalMapPath = null){\r\n        \r\n        const texture = new THREE.TextureLoader().load( pathTexture );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        texture.repeat.set( length, height );\r\n        const floorMaterial = new THREE.MeshStandardMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        if( normalMapPath ){\r\n            let normalTexture = new THREE.TextureLoader().load(\r\n                normalMapPath\r\n            );\r\n            normalTexture.repeat.set( length, height );\r\n            normalTexture.wrapS = THREE.RepeatWrapping;\r\n            normalTexture.wrapT = THREE.RepeatWrapping;\r\n            floorMaterial.normalMap = normalTexture;\r\n            floorMaterial.normalScale.set(10, 10);\r\n        }\r\n        const rampa = new THREE.BoxGeometry( length, width, height);\r\n        rampa.rotateX(rotation);\r\n        const quaternionRamp = new THREE.Quaternion();\r\n        quaternionRamp.setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), rotation);\r\n\r\n        let rampPhysics = new BoxPhysics(\r\n            new THREE.Vector3(position[0],position[1],position[2]), //Position\r\n            quaternionRamp ,  //Quaternion2\r\n            new Ammo.btVector3(0,0,0), //Inertia\r\n            0, //Mass\r\n            new THREE.Vector3(length, width, height), //Shape\r\n            this.physicsWorld, //Physics World\r\n            1000 // friction\r\n        ); \r\n        \r\n        await rampPhysics.buildAmmoPhysics();\r\n        this.physicsToUpdate.push(rampPhysics);\r\n        let ramp = new THREE.Mesh( rampa, floorMaterial );\r\n        ramp.position.set(position[0],position[1],position[2]);\r\n        this.scene.add(ramp);\r\n    }\r\n\r\n\r\n    async createCone(position , Ammo){\r\n        let cone = new TrafficCone(\"textures/coneTexture.jpg\");\r\n        cone.addToScene(this.scene, \"trafficCone\", position, [ 0.5, 0.5, 0.5]);\r\n        let conePhysics = new CylinderPhysics(\r\n            new THREE.Vector3(position[0],position[1],position[2]), //Position\r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            10, \r\n            new THREE.Vector3(cone.RADIUS_BOTTOM, cone.HEIGHT/2, cone.RADIUS_BOTTOM), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await conePhysics.buildAmmoPhysics();\r\n        this.physicsToUpdate.push(conePhysics);\r\n        conePhysics.attachObserver(cone);\r\n        this.objectsToAnimate.push(cone);\r\n    }\r\n\r\n    async buildStreetPhysics(position, street, Ammo){\r\n        let streetPhysics = new BoxPhysics(\r\n            new THREE.Vector3(position[0], position[1], position[2]),\r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            0, \r\n            new THREE.Vector3(street.SIZE, 0.1, street.LONG), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await streetPhysics.buildAmmoPhysics();\r\n        let leftSidewalkPhysics = new BoxPhysics(\r\n            new THREE.Vector3(position[0]-8.4*street.SIZE/24, position[1]+street.SIDEWALK_HEIGHT/2, position[2]),\r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            0, \r\n            new THREE.Vector3(7*street.SIZE/24, street.SIDEWALK_HEIGHT, street.LONG), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await leftSidewalkPhysics.buildAmmoPhysics();\r\n        let rightSidewalkPhysics = new BoxPhysics(\r\n            new THREE.Vector3(position[0]+8.4*street.SIZE/24, position[1]+street.SIDEWALK_HEIGHT/2, position[2]),\r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            0, \r\n            new THREE.Vector3(7*street.SIZE/24, street.SIDEWALK_HEIGHT, street.LONG), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await rightSidewalkPhysics.buildAmmoPhysics();\r\n        streetPhysics.attachObserver(street);\r\n        this.physicsToUpdate.push(streetPhysics);\r\n        this.physicsToUpdate.push(leftSidewalkPhysics);\r\n        this.physicsToUpdate.push(rightSidewalkPhysics);\r\n    }\r\n\r\n\r\n    async createStreet(position, rotation, Ammo, segmentsQuantity){\r\n        let street = new StraightStreet(\"textures/road.jpg\");\r\n        await street.addToScene(this.scene, \"street\", position, segmentsQuantity);\r\n        await this.buildStreetPhysics(position, street, Ammo);\r\n        this.objectsToAnimate.push(street);\r\n    }\r\n\r\n\r\n    async createLevel0(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.createRectangle( [ 10, 0, 10 ], 10, 2, 10, -Math.PI/8, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createRectangle( [ -10, 0, 10 ], 10, 2, 10, -Math.PI/4, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createRectangle( [ 0, 0, 0 ], 100, 0.1, 100, 0, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createCone( [ 0, 0.5, 10 ], Ammo );\r\n        this.createCone( [ 0, 0.5, 30 ], Ammo );\r\n        this.createCone( [ 0, 0.5, 20 ], Ammo );\r\n    }\r\n\r\n    async createLevelCustom(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.createStreet([0,0,0], 0, Ammo, 20);\r\n    }\r\n\r\n}\r\n\r\n","class VRButton {\r\n\r\n\tstatic createButton( renderer ) {\r\n\t\t\r\n\t\tconst button = document.createElement( 'button' );\r\n\r\n\t\tfunction showEnterVR( /*device*/ ) {\r\n\r\n\t\t\tlet currentSession = null;\r\n\r\n\t\t\tasync function onSessionStarted( session ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tawait renderer.xr.setSession( session );\r\n\t\t\t\tbutton.textContent = 'EXIT VR';\r\n\r\n\t\t\t\tcurrentSession = session;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onSessionEnded( /*event*/ ) {\r\n\r\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\t\tcurrentSession = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'pointer';\r\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\r\n\t\t\tbutton.style.width = '100px';\r\n\r\n\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\tbutton.onmouseenter = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '1.0';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onmouseleave = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '0.5';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onclick = function () {\r\n\r\n\t\t\t\tif ( currentSession === null ) {\r\n\r\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\r\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\r\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\r\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\r\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\r\n\t\t\t\t\t// be requested separately.)\r\n\r\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking', 'layers' ] };\r\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\r\n\t\t\t\t\tlocalStorage.setItem(\"VR\", true);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction disableButton() {\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'auto';\r\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\r\n\t\t\tbutton.style.width = '150px';\r\n\r\n\t\t\tbutton.onmouseenter = null;\r\n\t\t\tbutton.onmouseleave = null;\r\n\r\n\t\t\tbutton.onclick = null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction showWebXRNotFound() {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction showVRNotAllowed( exception ) {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tconsole.warn( 'Exception when trying to call xr.isSessionSupported', exception );\r\n\r\n\t\t\tbutton.textContent = 'VR NOT ALLOWED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction stylizeElement( element ) {\r\n\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.bottom = '20px';\r\n\t\t\telement.style.padding = '12px 6px';\r\n\t\t\telement.style.border = '1px solid #fff';\r\n\t\t\telement.style.borderRadius = '4px';\r\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\r\n\t\t\telement.style.color = '#fff';\r\n\t\t\telement.style.font = 'normal 13px sans-serif';\r\n\t\t\telement.style.textAlign = 'center';\r\n\t\t\telement.style.opacity = '0.5';\r\n\t\t\telement.style.outline = 'none';\r\n\t\t\telement.style.zIndex = '999';\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tbutton.id = 'VRButton';\r\n\t\t\tbutton.style.display = 'none';\r\n\r\n\t\t\tstylizeElement( button );\r\n\r\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\r\n\r\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\r\n\r\n\t\t\t\tif ( supported && VRButton.xrSessionIsGranted ) {\r\n\r\n\t\t\t\t\tbutton.click();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( showVRNotAllowed );\r\n\r\n\t\t\treturn button;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst message = document.createElement( 'a' );\r\n\r\n\t\t\tif ( window.isSecureContext === false ) {\r\n\r\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\r\n\t\t\tmessage.style.width = '180px';\r\n\t\t\tmessage.style.textDecoration = 'none';\r\n\r\n\t\t\tstylizeElement( message );\r\n\r\n\t\t\treturn message;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstatic xrSessionIsGranted = false;\r\n\r\n\tstatic registerSessionGrantedListener() {\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\t// WebXRViewer (based on Firefox) has a bug where addEventListener\r\n\t\t\t// throws a silent exception and aborts execution entirely.\r\n\t\t\tif ( /WebXRViewer\\//i.test( navigator.userAgent ) ) return;\r\n\r\n\t\t\tnavigator.xr.addEventListener( 'sessiongranted', () => {\r\n\r\n\t\t\t\tVRButton.xrSessionIsGranted = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nVRButton.registerSessionGrantedListener();\r\n\r\nexport { VRButton };","import React, {Component} from 'react';\r\nimport * as THREE from 'three';\r\nimport Camera from '../Camera/Camera';\r\nimport CarOffsetCamera from '../Camera/CarOffsetCamera';\r\nimport OrbitalCamera from '../Camera/OribtalCamera';\r\nimport CarModel from '../3DModels/CarModel';\r\nimport LogitechG29ControllerSingleton from '../LogicModel/ControllerMapping/LogitechG29Controller';\r\nimport XboxControllerSingleton from '../LogicModel/ControllerMapping/XboxController';\r\nimport Car from '../LogicModel/CarLogic/Car';\r\nimport AmmoInstance from '../LogicModel/Physics/AmmoInstance';\r\nimport { Vector3 } from 'three';\r\nimport LevelFactory from '../Levels/LevelsFactory';\r\nimport  {VRButton}  from '../addons/VRbutton';\r\nimport GLBench from 'gl-bench/dist/gl-bench';\r\n\r\n\r\n\r\nexport default class ThreeScene extends Component{\r\n    \r\n    \r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            \"currentRPM\": 0,\r\n            \"velocity\": 0,\r\n            \"currentShift\": 0,\r\n        };\r\n        this.physicsToUpdate = [];\r\n        localStorage.setItem(\"VR\", false);\r\n        this.gotAnyEvent = false;\r\n        this.bench = null;\r\n    }\r\n\r\n\r\n    async componentDidMount(){\r\n        //Generate elements needed to render the scene\r\n        this.objectsToAnimate = [];\r\n        this.scene = new THREE.Scene();\r\n        this.renderer = new THREE.WebGLRenderer({ alpha: true });\r\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\r\n        this.renderer.setClearColor( 0x87cefa, 1 );\r\n        this.bench = new GLBench(this.renderer.getContext());\r\n        //this.renderer.outputEncoding = THREE.sRGBEncoding;\r\n        this.camera = new Camera(this.renderer);\r\n        this.camera.addContainerToScene(this.scene);\r\n        \r\n        this.clock = new THREE.Clock();\r\n\r\n        //Ammo.js\r\n        await this.createAmmo();\r\n\r\n        //Add elements to the scene\r\n        this.ambientLight = new THREE.AmbientLight(0xffffff, 1.0);\r\n        this.scene.add(this.ambientLight);\r\n        this.sunLight = new THREE.DirectionalLight( 0xffffff, 1.0 );\r\n        this.sunLight.position.set( 0, 100, 0 );\r\n        this.scene.add( this.sunLight );\r\n\r\n        this.level = new LevelFactory(this.scene, this.physicsWorld);\r\n        await this.level.createLevelCustom();\r\n        this.physicsToUpdate.push(this.level);\r\n        this.objectsToAnimate.push(this.level);\r\n\r\n        //Add driver's car to scene\r\n        this.carLogic = new Car(this.physicsWorld);\r\n        let carModel = new CarModel();\r\n        this.carLogic.attachObserver(carModel);\r\n        this.carLogic.attachObserver(this.camera);\r\n        this.objectsToAnimate.push(await carModel.addToScene(this.scene));\r\n        this.carLogic.notifyObservers();\r\n        \r\n        //Bind this to methods of the class\r\n        this.animation = this.animation.bind(this);\r\n        this.handleWindowResize = this.handleWindowResize.bind(this);\r\n        this.generateEvents = this.generateEvents.bind(this);\r\n        \r\n        //Handle resize and gamepad connection on window.\r\n        this.generateEvents();\r\n\r\n        //Append canvas to DOM in HTML and start animating\r\n        this.mount.appendChild(this.renderer.domElement);\r\n        this.renderer.setAnimationLoop((now) => this.animation(now));\r\n        //this.animation(null);\r\n\r\n        document.body.appendChild( VRButton.createButton( this.renderer ) );\r\n        this.renderer.xr.enabled = true;\r\n        \r\n    }\r\n\r\n\r\n    generateEvents(){\r\n        window.addEventListener(\"resize\", this.handleWindowResize);\r\n        window.addEventListener(\"gamepaddisconnected\", function(e){\r\n            LogitechG29ControllerSingleton.removeInstance();  \r\n        });\r\n\r\n        document.addEventListener('keydown', (event) => {\r\n            var numCamera = event.key;\r\n            this.carLogic.removeObserver(this.camera);\r\n            switch(numCamera){\r\n                case \"1\":\r\n                    this.camera = new Camera(this.renderer);\r\n                    this.camera.addContainerToScene(this.scene);\r\n                    break;\r\n                case \"2\":\r\n                    this.camera = new OrbitalCamera(this.renderer);\r\n                    break;\r\n                case \"3\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(-4.35, 0.6, -0.1));\r\n                    break;\r\n                case \"4\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(4.35, 0.6, -0.1));\r\n                    break;\r\n                case \"5\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(0.0, 3.0, -5.0));\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this.carLogic.attachObserver(this.camera);\r\n            this.carLogic.notifyObservers();\r\n\r\n          }, false);\r\n    }\r\n\r\n\r\n    async createAmmo(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.tempTransform = new Ammo.btTransform();\r\n        let collisionConfiguratation = new Ammo.btDefaultCollisionConfiguration();\r\n        let dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguratation);\r\n        let overlappingPairCache = new Ammo.btDbvtBroadphase();\r\n        let solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n\r\n        this.physicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguratation);\r\n        this.physicsWorld.setGravity(new Ammo.btVector3(0,-9.8,0));\r\n    }\r\n\r\n\r\n    handleWindowResize(){\r\n        this.camera.handleResize();\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        this.renderer.render( this.scene, this.camera.getCameraInstance() );\r\n    }\r\n\r\n\r\n    animation(now){\r\n        let deltaTime = this.clock.getDelta();\r\n        this.bench.begin();\r\n        this.physicsWorld.stepSimulation(deltaTime, 10);\r\n        this.objectsToAnimate.forEach(function(object){\r\n            object.animate();\r\n        });\r\n        this.physicsToUpdate.forEach(function(phys){\r\n            phys.updatePhysics();\r\n        });\r\n        this.camera.setPositionRelativeToObject();\r\n        XboxControllerSingleton.getInstance(this.carLogic).checkEvents();\r\n        this.setState({\"velocity\": this.carLogic.getSpeed(), \"currentRPM\": this.carLogic.getCurrentRPM(), \"currentShift\": this.carLogic.getCurrentShift()});\r\n        this.renderer.render( this.scene, this.camera.getCameraInstance());\r\n        console.log(\"drawCalls:\",this.renderer.info.render.calls);\r\n        this.bench.end();\r\n        this.bench.nextFrame(now);\r\n        \r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div style={{width:\"100vw\"}}>\r\n                <div style={{position:\"absolute\", top:\"10px\", right:\"10px\", color:\"red\", width:\"175px\"}} id=\"Acelerador\">\r\n                    <p style={{ zIndex: 20, display: 'float', fontWeight: \"bold\"}} >\r\n                        Cambio Actual: {parseInt(this.state.currentShift)}\r\n                    </p>\r\n                </div>\r\n                <div ref={mount => {this.mount = mount;}}></div>\r\n            </div>\r\n            \r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\n\r\nconst styleMenu = {\r\n  width:\"100vw\", \r\n  height:\"100vh\", \r\n  backgroundImage:`url(\"DrivingSimMenuNoTitle.png\")`, \r\n  backgroundSize:\"cover\", \r\n  backgroundRepeat: \"no-repeat\"\r\n}\r\n\r\n\r\nexport const MainMenu = () => {\r\n\r\n  const navigate = useNavigate()\r\n\r\n  return (\r\n    <>\r\n      <div style={styleMenu}>\r\n        <div id=\"button-box\" style={{position:\"absolute\", top:\"5%\", right:\"5%\"}}>\r\n          <div className={\"MainMenuTitle\"}>\r\n            <h1 style={{textAlign:\"center\", fontSize:\"7rem\"}}>\r\n              Driving<br/>Simulator\r\n            </h1>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/scene\")}\r\n            >\r\n              Iniciar\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n          <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/level-editor\")}\r\n            >\r\n              Editor de Niveles\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/configs\")}\r\n            >\r\n              Configuración\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\n\r\n\r\nexport const ConfigDrawer = ( {openConfigs, handleDrawerClose} ) => {\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openConfigs);\r\n    }, [openConfigs]);\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        width:'100%',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-start',\r\n    }));\r\n\r\n    return (\r\n        <>  \r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"right\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader className='drawer-header' onClick={handleDrawerClose}>\r\n                        <ChevronRightIcon />\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"right\", paddingRight:30}}>Configurations</h3>\r\n                        </div>\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                </Drawer>\r\n            </Grid>\r\n        </>\r\n    );\r\n}","import { createContext } from 'react';\r\n\r\nexport const ItemsContext = createContext();\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport { ItemsContext } from '../LevelEditorContext/ItemsContext';\r\n\r\n\r\nconst allUnselected = {\r\n    \"cone\": null,\r\n    \"trapecio\": null,\r\n    \"street\": null\r\n};\r\n\r\n\r\nexport const ItemsDrawer = ( {openItems, handleDrawerClose} ) => {\r\n    \r\n    const [open, setOpen] = React.useState(false);\r\n    const {setLastSelectedItem, lastSelectedItem} = React.useContext(ItemsContext);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openItems);\r\n    }, [openItems]);\r\n\r\n    //const theme = useTheme();\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-end',\r\n    }));\r\n\r\n    const [itemSelected, setItemSelected] = React.useState(allUnselected);\r\n\r\n\r\n    const handleSelection = (item) => {\r\n        const dictSelection = {...allUnselected};\r\n        dictSelection[item] = \"selected\";\r\n        setItemSelected(dictSelection);\r\n        setLastSelectedItem({\r\n            selectedItem: item,\r\n            scale: 1.0,\r\n            positionX: 0.0,\r\n            positionY: 0.0,\r\n            zIndex: lastSelectedItem ? lastSelectedItem.zIndex + 1 : 1\r\n        });\r\n    }\r\n\r\n    return (\r\n\r\n        <>\r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"left\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader onClick={handleDrawerClose} className='drawer-header'>\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"left\", paddingLeft:10}}>Items</h3>\r\n                        </div>\r\n                        <ChevronLeftIcon />\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                    <Grid style={{justifyContent: \"center\", display: \"flex\", alignItems:\"center\", flexDirection:\"column\"}}>\r\n                        {\r\n                            Object.entries(itemSelected).map(([nameItem, isSelected]) => {\r\n                                return (\r\n                                    <img \r\n                                        alt={`${nameItem}`}\r\n                                        key={nameItem}\r\n                                        src={`${nameItem}.png`} \r\n                                        width={75}\r\n                                        height={75} \r\n                                        className={`imageLevelEditor ${isSelected}`} \r\n                                        onClick={() => handleSelection(nameItem)}\r\n                                    />\r\n                                );\r\n                            })\r\n                        }\r\n                    </Grid>\r\n                </Drawer>\r\n            </Grid>\r\n            \r\n        </>\r\n\r\n    );\r\n}","import React from 'react'\r\nimport {useState} from 'react';\r\nimport Button from '@mui/material/Button';\r\nimport Grid from '@mui/material/Grid';\r\n\r\nconst MAX_WIDTH_INPUT = 40;\r\nconst MAX_HEIGHT_INPUT = 40;\r\n\r\nexport const InputsGrid = ({setGridDimensions, gridDimensions}) => {\r\n    const [InputWidth, setInputWidth] = useState(gridDimensions.width);\r\n    const [InputHeight, setInputHeight] = useState(gridDimensions.height);\r\n\r\n    const onSubmit = () =>{\r\n      setGridDimensions(\r\n        {\r\n          width: InputWidth, \r\n          height: InputHeight\r\n        }\r\n      );\r\n    }\r\n  return (\r\n    <Grid container  direction=\"row\" width={\"80%\"} marginLeft={'10%'}\r\n    justifyContent=\"space-evenly\"\r\n    alignItems=\"center\" spacing={2}>\r\n        <Grid item xs={2}>\r\n        <p>Ancho:</p>\r\n          <input \r\n            value={InputWidth} \r\n            type=\"number\" \r\n            step=\"1\" \r\n          onChange={\r\n              (event) => {\r\n                let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                setInputWidth(value > MAX_WIDTH_INPUT ? MAX_WIDTH_INPUT : value);\r\n              }\r\n        } \r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={2}>\r\n          <div>\r\n            <p>Alto:</p>\r\n            <input \r\n              value={InputHeight} \r\n              type=\"number\" \r\n              step=\"1\" \r\n              onChange={\r\n                (event) => {\r\n                  let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                  setInputHeight(value > MAX_HEIGHT_INPUT ? MAX_HEIGHT_INPUT : value);\r\n                  \r\n                }\r\n              }\r\n            />\r\n          </div>\r\n        </Grid>\r\n        <Grid item xs={2}>\r\n          <Button variant=\"contained\" onClick={onSubmit}>Actualizar</Button>\r\n        </Grid>\r\n    </Grid>\r\n    \r\n  )\r\n}\r\n","\r\nconst STANDARD_BOX_LONG = 30;\r\n\r\nexport class AbstractStreet{\r\n\r\n    constructor(ninePerNineGrid, rowIndex, columnIndex){\r\n        const rightFilled = ninePerNineGrid[1][2].filled;\r\n        const topFilled = ninePerNineGrid[0][1].filled;\r\n        const botFilled = ninePerNineGrid[2][1].filled;\r\n        const leftFilled = ninePerNineGrid[1][0].filled;\r\n        this.rotation = this.determineStreetRotation(topFilled, leftFilled, botFilled, rightFilled);\r\n        this.long = [\r\n            STANDARD_BOX_LONG, \r\n            STANDARD_BOX_LONG\r\n        ];\r\n        this.position = [\r\n            rowIndex*STANDARD_BOX_LONG + STANDARD_BOX_LONG/2, \r\n            columnIndex*STANDARD_BOX_LONG + STANDARD_BOX_LONG/2\r\n        ];\r\n    }\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        //To implement by each son\r\n    }\r\n\r\n    static sumValueForCell(cell){\r\n        return cell.filled ? 1 : 0\r\n    }\r\n\r\n    static calculateNeighboursFilled(ninePerNineGrid){\r\n        let rowCount = 0;\r\n        let columnCount = 0;\r\n        rowCount += AbstractStreet.sumValueForCell(ninePerNineGrid[1][0]) + AbstractStreet.sumValueForCell(ninePerNineGrid[1][2]);\r\n        columnCount += AbstractStreet.sumValueForCell(ninePerNineGrid[0][1]) + AbstractStreet.sumValueForCell(ninePerNineGrid[2][1]);\r\n        return [rowCount, columnCount];\r\n    }\r\n\r\n    isStraight(){\r\n        return false;\r\n    }\r\n\r\n\r\n    determineStreetRotation(){\r\n        //To be defined by sons\r\n    }\r\n\r\n    getAsJSON(){\r\n        return {\r\n            \"position_x\": this.position[0],\r\n            \"position_y\": this.position[1],\r\n            \"rotation\": this.rotation,\r\n            \"long_x\": this.long[0],\r\n            \"long_y\": this.long[1]\r\n        }\r\n    }\r\n\r\n    getPositionAsRowAndColumn(){\r\n        const row = (this.position[0] - STANDARD_BOX_LONG/2) / STANDARD_BOX_LONG;\r\n        const col = (this.position[1] - STANDARD_BOX_LONG/2) / STANDARD_BOX_LONG;\r\n        return [row, col];\r\n    }\r\n\r\n\r\n    getPositionX(){\r\n        return this.position[0];\r\n    }\r\n\r\n    getPositionY(){\r\n        return this.position[1];\r\n    }\r\n\r\n    getLongX(){\r\n        return this.long[0];\r\n    }\r\n\r\n    getLongY(){\r\n        return this.long[1];\r\n    }\r\n   \r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"TOP_TO_LEFT\": 0,\r\n    \"LEFT_TO_BOT\": Math.PI/2,\r\n    \"BOT_TO_RIGHT\": Math.PI,\r\n    \"RIGHT_TO_TOP\": Math.PI*3/2\r\n}\r\n\r\nexport class Curve extends AbstractStreet{\r\n    \r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        //Tiene que tener solo 2 lindantes, y no ser en misma direccion.\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return (rowCount === 1 && columnCount === 1);\r\n    }\r\n\r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && left){\r\n            return POSSIBLE_ROTATIONS[\"TOP_TO_LEFT\"];\r\n        }\r\n        if(left && bot){\r\n            return POSSIBLE_ROTATIONS[\"LEFT_TO_BOT\"];\r\n        }\r\n        if(bot && right){\r\n            return POSSIBLE_ROTATIONS[\"BOT_TO_RIGHT\"];\r\n        }\r\n        if(right && top){\r\n            return POSSIBLE_ROTATIONS[\"RIGHT_TO_TOP\"];\r\n        }\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"CURVE\";\r\n        return dict;\r\n    }\r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\n\r\nexport class Intersection extends AbstractStreet{\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return(columnCount === 2 && rowCount === 2 )\r\n    }\r\n\r\n    determineStreetRotation(){\r\n        //No sense to rotate it\r\n        return 0;\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"INTERSECTION\";\r\n        return dict;\r\n    }\r\n}\r\n","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"HORIZONTAL\": 0,\r\n    \"VERTICAL\": Math.PI/2\r\n}\r\n\r\nexport class StraightStreet extends AbstractStreet {\r\n    \r\n    \r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        \r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);\r\n        return(columnCount === 2 && rowCount === 0 )|| (columnCount === 0 && rowCount === 2 )\r\n\r\n    }\r\n\r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && bot){\r\n            return POSSIBLE_ROTATIONS[\"VERTICAL\"];\r\n        }\r\n        if(left && right){\r\n            return POSSIBLE_ROTATIONS[\"HORIZONTAL\"];\r\n        }\r\n    }\r\n\r\n    isStraight(){\r\n        return true;\r\n    }\r\n\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"STRAIGHT\";\r\n        return dict;\r\n    }\r\n\r\n\r\n    isHorizontal(){\r\n        return this.rotation === POSSIBLE_ROTATIONS[\"HORIZONTAL\"];\r\n    }\r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"TOP_SINGLE\": 0,\r\n    \"LEFT_SINGLE\": Math.PI/2,\r\n    \"BOT_SINGLE\": Math.PI,\r\n    \"RIGHT_SINGLE\": Math.PI*3/2\r\n}\r\nexport class TStreet extends AbstractStreet {\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return(columnCount === 2 && rowCount === 1 )|| (columnCount === 1 && rowCount === 2 );\r\n    }\r\n    \r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && left && right){\r\n            return POSSIBLE_ROTATIONS[\"TOP_SINGLE\"];\r\n        }\r\n        if(left && bot && top){\r\n            return POSSIBLE_ROTATIONS[\"LEFT_SINGLE\"];\r\n        }\r\n        if(bot && right && left){\r\n            return POSSIBLE_ROTATIONS[\"BOT_SINGLE\"];\r\n        }\r\n        if(right && top && bot){\r\n            return POSSIBLE_ROTATIONS[\"RIGHT_SINGLE\"];\r\n        }\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"T_STREET\";\r\n        return dict;\r\n    }\r\n\r\n}","export class StraightStreetLinker{\r\n\r\n    constructor(arrayOfStreets){\r\n        this.sections = this.segregateSections(arrayOfStreets);\r\n        this.sectionsAsJSON = this.linkSections();\r\n    }\r\n\r\n    //Genero un array para cada tramo recto, que contenga todas las StraightStreets de ese tramo\r\n    //Cada array de seccion va dentro de un array general y eso retornamos\r\n    segregateSections(arrayOfStreets){\r\n        // Recorro array de streets --> Armo un hashMap de filas, y otro de columnas.\r\n        // Para cada fila o columna, separar las subsecciones correspondientes.\r\n        const rows = {};\r\n        const cols = {};\r\n        let sectionsArray = [];\r\n\r\n        for(let i = 0; i < arrayOfStreets.length; i++){\r\n            let [streetRow, streetCol] = arrayOfStreets[i].getPositionAsRowAndColumn();\r\n            if( arrayOfStreets[i].isHorizontal() ){\r\n                if( !(streetRow in rows) ){\r\n                    rows[streetRow] = [];\r\n                }\r\n                rows[streetRow].push({\"idx\":streetCol, \"street\":arrayOfStreets[i]});\r\n            }\r\n            else{\r\n                if( !(streetCol in cols) ){\r\n                    cols[streetCol] = [];\r\n                }\r\n                cols[streetCol].push({\"idx\":streetRow, \"street\":arrayOfStreets[i]});\r\n            }\r\n        }\r\n        for(const [, value] of Object.entries(rows)){\r\n            sectionsArray = [...sectionsArray, ...this.generateArraySubsections(value)];\r\n        }\r\n        for(const [, value] of Object.entries(cols)){\r\n            sectionsArray = [...sectionsArray, ...this.generateArraySubsections(value)];\r\n        }\r\n        return sectionsArray;\r\n        \r\n    }\r\n\r\n\r\n    generateArraySubsections(array){\r\n        const finalArray = [];\r\n        //Sort de array por idx creciente... CREEMOS que ya viene sorteado - VERIFICAR.\r\n        for ( let i=0; i<array.length; i++){\r\n            //Primer elemento, o no son lindantes\r\n            if( i === 0 || (array[i][\"idx\"] - array[i-1][\"idx\"] > 1)){\r\n                finalArray.push([array[i][\"street\"]]);\r\n            }else{\r\n                finalArray[finalArray.length - 1].push(array[i][\"street\"]);\r\n            }\r\n        }\r\n        return finalArray;\r\n    }\r\n\r\n\r\n    linkSections(){\r\n        const sectionsJSON = [];\r\n        for(let i = 0; i < this.sections.length; i++){\r\n            //Rotation is the same for all of them\r\n            console.log(this.sections[i]);\r\n            const jsonForStreet = {\r\n                \"position_x\": this.sections[i].reduce((acum, elem) => acum + elem.getPositionX(), 0)/this.sections[i].length,\r\n                \"position_y\": this.sections[i].reduce((acum, elem) => acum + elem.getPositionY(), 0)/this.sections[i].length,\r\n                \"rotation\": this.sections[i][0].rotation,\r\n                \"long_x\": this.sections[i][0].isHorizontal() ? this.sections[i].reduce((acum, elem) => acum + elem.getLongX(), 0) : this.sections[i][0].getLongX(),\r\n                \"long_y\": !this.sections[i][0].isHorizontal() ? this.sections[i].reduce((acum, elem) => acum + elem.getLongY(), 0) : this.sections[i][0].getLongY(),\r\n                \"type\": \"STRAIGHT\"\r\n            }\r\n            sectionsJSON.push(jsonForStreet);\r\n        }\r\n        return sectionsJSON;\r\n    }\r\n\r\n    getSectionsAsJSON(){\r\n        return this.sectionsAsJSON;\r\n    }\r\n}","import { StraightStreet, TStreet, Intersection, Curve, StraightStreetLinker } from \"./Street\";\r\n\r\nconst TYPES_OF_STREETS = [\r\n    StraightStreet,\r\n    Curve,\r\n    TStreet,\r\n    Intersection\r\n];\r\n\r\nexport class StreetFactory{\r\n    \r\n    constructor(levelGrid, isInfiniteLevel){\r\n        this.levelGrid = levelGrid;\r\n        this.getNinePerNineGrid = isInfiniteLevel ? this.getNinePerNineGridInfinite : this.getNinePerNineGridFinite;\r\n    }\r\n\r\n    constructStreets(){\r\n        const straightStreetsArray = [];\r\n        const curvedStreetsArray = [];\r\n        //ararco desde la parte superior izq\r\n        for ( let i = 0; i < this.levelGrid.length ; i++ ){\r\n            for ( let j = 0; j < this.levelGrid[i].length ; j++ ){\r\n                const myCell = this.levelGrid[i][j];\r\n                if (myCell.filled){\r\n                    const streetObject = this.defineTypeOfStreet(i, j);\r\n                    if (streetObject.isStraight()){\r\n                        straightStreetsArray.push(streetObject);\r\n                    }\r\n                    else{\r\n                        curvedStreetsArray.push(streetObject);\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }\r\n        const conjunctedStraightStreets = this.linkStraightStreets(straightStreetsArray);\r\n        let finalArray = curvedStreetsArray.map(street => street.getAsJSON());\r\n        return [...finalArray, ...conjunctedStraightStreets];\r\n        //const finalArray = [...conjunctedStraightStreets, ...curvedStreetsArray];\r\n        //return finalArray.map(street => street.getAsJSON());\r\n    }\r\n\r\n    getNinePerNineGridInfinite(indexRow, indexColumn){\r\n        const matrix = [];\r\n        for (let i = indexRow - 1; i <= indexRow + 1; i++){\r\n            const rowArray = [];\r\n            //Si es negativo es la ultima, y sino es el modulo entre el index y la cant de filas.\r\n            const realRow = i < 0 ? this.levelGrid.length-1 : i % this.levelGrid.length;\r\n            for (let y = indexColumn - 1; y <= indexColumn + 1; y++ ){\r\n                //Simil row pero para columna\r\n                const realColumn = y < 0 ? this.levelGrid[realRow].length-1 : y % this.levelGrid[realRow].length;\r\n                rowArray.push(this.levelGrid[realRow][realColumn]);\r\n            }\r\n            matrix.push(rowArray);\r\n        }\r\n        return matrix;\r\n    }\r\n\r\n    getNinePerNineGridFinite(indexRow, indexColumn){\r\n        const matrix = [];\r\n        const celda_vacia = {\r\n            \"filled\": false,\r\n        }\r\n        for (let i = indexRow - 1; i <= indexRow + 1; i++){\r\n            //Casos Filas Imaginarias vacías\r\n            if (i < 0 || i === this.levelGrid.length){\r\n                matrix.push([celda_vacia, celda_vacia, celda_vacia]);\r\n            }else{\r\n                const rowArray = [];\r\n                for (let y = indexColumn - 1; y <= indexColumn + 1; y++ ){\r\n                    if (y < 0 || y === this.levelGrid[i].length){\r\n                        rowArray.push(celda_vacia);\r\n                    }else{\r\n                        rowArray.push(this.levelGrid[i][y]);\r\n                    }\r\n                }\r\n                matrix.push(rowArray);\r\n            }\r\n        }\r\n        return matrix;\r\n    }\r\n\r\n    /* Example:\r\n        | | | | | | | |\r\n        | | | x x x | |\r\n        | | | x Y x | |\r\n        | | | x x x | |\r\n        | | | | | | | |\r\n    */\r\n    defineTypeOfStreet(row, column){\r\n        const ninePerNineGrid = this.getNinePerNineGrid(row, column);\r\n        let typeDefined = false;\r\n        let typeResult = undefined;\r\n        for ( let i = 0; i < TYPES_OF_STREETS.length && !typeDefined; i++){\r\n            typeDefined = TYPES_OF_STREETS[i].isValidNinePerNineGrid(ninePerNineGrid);\r\n            typeResult = TYPES_OF_STREETS[i];\r\n        }\r\n        if (!typeDefined){\r\n            throw new Error(\"No se pudo definir el tipo de calle dentro de los tipos validos.\");\r\n        }\r\n        //Row 0 es la de abajo del todo. Invertimos la row.\r\n        return new typeResult(ninePerNineGrid, this.levelGrid.length - 1 - row, column);\r\n    }\r\n\r\n\r\n    linkStraightStreets(straightStreetsArray){\r\n        const linker = new StraightStreetLinker(straightStreetsArray);\r\n        return linker.getSectionsAsJSON();\r\n    }\r\n    \r\n}","import { StreetFactory } from \"./StreetFactory\";\r\n\r\n\r\nexport function downloadObjectAsJson(exportObj, exportName){\r\n    var dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(exportObj));\r\n    var downloadAnchorNode = document.createElement('a');\r\n    downloadAnchorNode.setAttribute(\"href\",     dataStr);\r\n    downloadAnchorNode.setAttribute(\"download\", exportName + \".json\");\r\n    document.body.appendChild(downloadAnchorNode); // required for firefox\r\n    downloadAnchorNode.click();\r\n    downloadAnchorNode.remove();\r\n};\r\n\r\n\r\n\r\n\r\nfunction getCountSidesPainted(levelGrid, i, j){\r\n    let aux = 0;\r\n    for (let x = i-1; x <= i+1 && x < levelGrid.length; x++){\r\n        if (x >= 0 && x !== i){\r\n            aux += levelGrid[x][j].filled ? 1 : 0;\r\n        }\r\n    }\r\n    for(let y = j-1; y <= j+1 && y < levelGrid[i].length; y++){\r\n        if(y >= 0 && y !== j){\r\n            aux += levelGrid[i][y].filled ? 1 : 0;\r\n        }\r\n    }\r\n    return aux;\r\n}\r\n\r\nfunction validateGridNotInfinite(levelGrid){\r\n    let valid = true;\r\n    let wrongCells = [];\r\n    for (let i=0; i<levelGrid.length; i++){\r\n        for (let j=0; j<levelGrid[i].length; j++){\r\n            if (levelGrid[i][j].filled && getCountSidesPainted(levelGrid, i,j) <= 1){\r\n                valid = false;\r\n                wrongCells.push([i,j]);\r\n            }\r\n        }\r\n    }\r\n    \r\n    return {\r\n        \"valid\": valid,\r\n        \"wrongCells\": wrongCells\r\n    }\r\n}\r\n\r\nfunction validateGridInfinite(){\r\n\r\n}\r\n\r\nexport function validateGrid(levelGrid, isInfinite){\r\n    \r\n    return (isInfinite ? validateGridInfinite(levelGrid) : validateGridNotInfinite(levelGrid));\r\n    \r\n}\r\n\r\nexport function generateJSONFromGrid(levelGrid){\r\n    \r\n    const streetFactory = new StreetFactory(levelGrid);\r\n    const streetsArray = streetFactory.constructStreets();\r\n    const objectsAndStreets = {\r\n        \"streets\": streetsArray\r\n    };\r\n    return objectsAndStreets;\r\n\r\n    \r\n}","import { useEffect, useState } from 'react';\r\nimport { Button } from '@mui/material';\r\nimport MemoryIcon from '@mui/icons-material/Memory';\r\nimport { downloadObjectAsJson, validateGrid, generateJSONFromGrid } from '../Resources/LevelEditor';\r\n\r\nconst COLORS = {\r\n  \"FILLED\": \"darkgray\",\r\n  \"EMPTY\": \"white\",\r\n  \"WARNING\": 'orange',\r\n};\r\n\r\nconst WIDTH_GRID_VIEW = 600;\r\nconst HEIGHT_GRID_VIEW = 600;\r\nconst LEFT_CLICK = 0;\r\nconst RIGHT_CLICK = 2;\r\n\r\n\r\nexport const LevelGrid = ({gridDimensions}) => {\r\n\r\n  const [levelGrid, setLevelGrid] = useState([]);\r\n  const [click, setClick] = useState(false);\r\n  const [rightClick, setRightClick] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let finalGrid = [];\r\n    for(let i=0; i<gridDimensions.height; i++){\r\n      let currentRow = [];\r\n      for(let j=0; j<gridDimensions.width; j++){\r\n        let newCell = {\r\n          \"filled\": false,\r\n          \"div_color\": COLORS[\"EMPTY\"]\r\n        }\r\n        currentRow.push(newCell);\r\n      }\r\n      finalGrid.push(currentRow);\r\n    }\r\n    setLevelGrid(finalGrid);\r\n  }, [gridDimensions.width, gridDimensions.height]);\r\n\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mouseup\", (event) => {\r\n      event.preventDefault();\r\n      if(event.button === LEFT_CLICK){\r\n        setClick(false);\r\n      }else if (event.button === RIGHT_CLICK){\r\n        setRightClick(false);\r\n      }\r\n    });\r\n    window.addEventListener(\"contextmenu\", (event) => { event.preventDefault(); });\r\n  }, []);\r\n\r\n\r\n  const arrayContains = (array, insiderArray) => {\r\n    if (!insiderArray || !array){\r\n      return false;\r\n    }\r\n    for (let i=0; i<array.length; i++){\r\n      let equals = true;\r\n      for (let j=0; j<array[i].length; j++){\r\n        try{\r\n          if(array[i][j] !== insiderArray[j]){\r\n            equals = false;\r\n          }\r\n        }catch(exc){j=array[i].length; equals=false;}\r\n      }\r\n      if(equals) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  const onSubmitLevel = () =>{\r\n    let result = validateGrid(levelGrid);\r\n    let vec_aux = [...levelGrid];\r\n    for( let i=0; i< levelGrid.length; i++ ){\r\n      for( let j=0; j < levelGrid[i].length; j++){\r\n        if (vec_aux[i][j].filled){\r\n          vec_aux[i][j].div_color = arrayContains(result.wrongCells, [i,j]) ? COLORS[\"WARNING\"] : COLORS[\"FILLED\"];\r\n        }\r\n        \r\n      }\r\n    }\r\n    setLevelGrid(vec_aux);\r\n    if (result.valid) {\r\n      downloadObjectAsJson(generateJSONFromGrid(levelGrid), \"Driving_Simulator_Custom_Level.json\");\r\n    }\r\n    \r\n  }\r\n\r\n\r\n  const onEnterHoverWithClickCell = (row, col) => {\r\n    if(click){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(rightClick){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n  \r\n  const onClickCell = (row, col, btn_click) => {\r\n    if(btn_click === LEFT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(btn_click === RIGHT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div \r\n      style={{\r\n        width: WIDTH_GRID_VIEW,\r\n        height: HEIGHT_GRID_VIEW,\r\n        marginTop: 25,\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n      }}\r\n      onMouseDown = {(event) => {\r\n        event.preventDefault();\r\n        if(event.button === LEFT_CLICK){\r\n          setClick(true);\r\n        }else if (event.button === RIGHT_CLICK){\r\n          setRightClick(true);\r\n        }\r\n      }}\r\n    >\r\n      {levelGrid.map((row, idx_row) => {\r\n        return(\r\n          <div \r\n            className=\"row-level-grid\" \r\n            id={`row_${idx_row}`}\r\n            key={`row_${idx_row}`}\r\n            style={{\r\n              width: \"100%\",\r\n              height: HEIGHT_GRID_VIEW/gridDimensions.height,\r\n              display: \"flex\",\r\n              flexDirection: \"row\"\r\n            }}\r\n          >\r\n            {row.map((cell, idx_col) => {\r\n              return (\r\n                <div \r\n                  className=\"cell-level-grid\" \r\n                  key={`cell_${idx_row}_${idx_col}`}\r\n                  id={`cell_${idx_row}_${idx_col}`} \r\n                  style={{\r\n                    backgroundColor: cell[\"div_color\"],\r\n                    width: `${100/gridDimensions.width}%`,\r\n                    height: \"100%\",\r\n                    border: \"1px solid black\"\r\n                  }} \r\n                  //onMouseEnter = {() => onEnterHoverWithClickCell(idx_row, idx_col)}\r\n                  onMouseMove = {(event) => {\r\n                    event.preventDefault();\r\n                    onEnterHoverWithClickCell(idx_row, idx_col);\r\n                  }}\r\n                  onMouseUp = {(event) => {\r\n                    onClickCell(idx_row, idx_col, event.button);\r\n                  }}\r\n                  \r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n        );\r\n      })}\r\n      <div style={{display:\"flex\", justifyContent:\"center\", marginTop:40}}>\r\n        <Button variant=\"contained\" onClick={onSubmitLevel}  color=\"success\">\r\n          <MemoryIcon/> Procesar nivel...\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}","import React from 'react'\r\nimport { IconButton } from '@mui/material'\r\nimport { ConfigDrawer } from './Components/ConfigDrawer';\r\nimport { ItemsDrawer } from './Components/ItemsDrawer';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport { ItemsContext } from './LevelEditorContext/ItemsContext';\r\nimport { useState } from 'react';\r\nimport { InputsGrid } from './Components/InputsGrid';\r\n\r\nimport { LevelGrid } from './Components/LevelGrid';\r\n\r\nexport const LevelEditor = () => {\r\n\r\n  const [openItems, setOpenItems] = useState(false);\r\n  const [openConfigs, setOpenConfigs] = useState(false);\r\n\r\n  const [itemsInGrid, setItemsInGrid] = useState([]);\r\n\r\n  const [lastSelectedItem, setLastSelectedItem] = useState(null);\r\n\r\n  const [gridDimensions, setGridDimensions] = useState({width:20, height:20});\r\n\r\n  React.useEffect(() => {\r\n    if (lastSelectedItem !== null){\r\n      setItemsInGrid(currentItems => [...currentItems, lastSelectedItem]);\r\n    }\r\n  }, [lastSelectedItem]);\r\n\r\n  return (\r\n    <>\r\n      <ItemsContext.Provider value={{lastSelectedItem, setLastSelectedItem}}>\r\n        <div>\r\n          <div style={{flexDirection:'row',justifyContent:'space-between', display:\"flex\"}}>\r\n            <IconButton onClick={() => setOpenItems(true)} style={{height:40, margin:10}} className='header'>\r\n              <AddIcon/>\r\n            </IconButton>\r\n            <h1>Driving Simulator - Level Editor</h1>\r\n            <IconButton onClick={() => setOpenConfigs(true)} style={{height:40, margin:10}} className='header' >\r\n              <SettingsIcon/>\r\n            </IconButton>\r\n          </div>\r\n          <div>\r\n              <InputsGrid setGridDimensions={setGridDimensions} gridDimensions={gridDimensions}></InputsGrid>\r\n              <LevelGrid gridDimensions = {gridDimensions}/>\r\n              {itemsInGrid.map((item, idx) => {\r\n                return(\r\n                  <span key={idx}></span>\r\n                  /*<img \r\n                    key={idx} \r\n                    src={`${item.selectedItem}.png`} \r\n                    width={item.scale*75} \r\n                    height={item.scale*75} \r\n                    style={{\r\n                      top:item.positionY, \r\n                      left:item.positionX,\r\n                      position: \"absolute\",\r\n                      zIndex: item.zIndex.toString()\r\n                    }}\r\n                    onClick={() => {console.log(`OPEN CONFIGS OF idx: ${idx}, obj: ${JSON.stringify(itemsInGrid[idx])}`)}}\r\n                  />*/\r\n                );\r\n              })}\r\n          </div>\r\n          \r\n        </div>\r\n        <ItemsDrawer openItems={openItems} handleDrawerClose={() => {setOpenItems(false)}}/>\r\n        <ConfigDrawer openConfigs={openConfigs} handleDrawerClose={() => {setOpenConfigs(false)}}/>\r\n      </ItemsContext.Provider>\r\n    </>\r\n  );\r\n}\r\n","//export const API_URL = \"https://backend-bata340.cloud.okteto.net\";\r\nexport const API_URL = \"http://localhost:8001\";\r\nexport const VALID_REGEX_EMAIL = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;","import { createContext } from \"react\";\r\n\r\nexport const SessionContext  = createContext(undefined);","\r\nconst { createHash } = require('crypto');\r\n\r\nexport const hash = (string) => {\r\n  return createHash('sha256').update(string).digest('hex');\r\n}","import React from 'react'\r\nimport {API_URL} from '../Constants/Constants'\r\nimport { SessionHooks } from '../Sessions/SessionHooks';\r\nimport { Alert, Button, TextField, InputAdornment, IconButton } from \"@mui/material\"\r\nimport { Link } from 'react-router-dom';\r\nimport { GoogleLogin } from '@react-oauth/google';\r\nimport { Visibility, VisibilityOff } from '@mui/icons-material';\r\nimport { VALID_REGEX_EMAIL } from '../Constants/Constants';\r\nimport { hash } from '../Resources/Hasher';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nexport const LoginForm = () => {\r\n\r\n  const navigate = useNavigate();\r\n  const [email, setEmail] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const [showPassword, setShowPassword] = React.useState(false);\r\n  const [error, setError] = React.useState(undefined);\r\n  const handleClickShowPassword = () => setShowPassword(!showPassword);\r\n  const { setSessionWithResponse } = SessionHooks();\r\n\r\n  const postLogin = async () => {\r\n    try{\r\n        const APIResponse = await fetch(\r\n            `${API_URL}/users/login`,\r\n            {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({\r\n                    \"email\": email,\r\n                    \"password\": hash(password)\r\n                })\r\n            }\r\n        );\r\n        if (APIResponse.status !== 200){\r\n            const json = await APIResponse.json();\r\n            const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n            let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n            throw new Error(error_msg);\r\n        }\r\n        return APIResponse.json();\r\n    }catch(e){\r\n        throw new Error(e);\r\n    }\r\n  }\r\n\r\n\r\n  const validateFields = () => {\r\n    const errors = []\r\n    if (password === \"\"){\r\n        errors.push(\"El campo contraseña se encuentra vacío.\");\r\n    }\r\n    if (email === \"\"){\r\n        errors.push(\"El campo email se encuentra vacío\");\r\n    }\r\n    if (!email.match(VALID_REGEX_EMAIL)){\r\n        errors.push(\"El email establecido es inválido.\");\r\n      }\r\n    if(errors.length > 0){\r\n        setError(errors);\r\n        return false;\r\n    }else{\r\n        return true;\r\n    }\r\n  }\r\n\r\n\r\n  const submitLogin = async (event) => {\r\n    event.preventDefault();\r\n    if(!validateFields()){\r\n        return;\r\n    }\r\n    try{\r\n        const loginResponse = await postLogin();\r\n        setSessionWithResponse(loginResponse);\r\n        /*TODO: DAR UN FEEDBACK DE SESION INICIADA CORRECTAMENTE ANTES DE REDIR*/\r\n        navigate(\"/\");\r\n    }catch(e){\r\n        setError([e.toString().replaceAll(\"Error: \", \"\")]);\r\n    }\r\n  }\r\n\r\n\r\n  const postLoginGoogle = async (token) => {\r\n    const APIResponse = await fetch(\r\n        `${API_URL}/users/login_google`,\r\n        {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({\r\n                \"token\": token\r\n            })\r\n        }\r\n    );\r\n    if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n        let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n        throw new Error(error_msg);\r\n    }\r\n    return APIResponse.json();\r\n  }\r\n\r\n  const submitGoogleLogin = async (token) => {\r\n    try{\r\n        const responseAPI = await postLoginGoogle(token);\r\n        setSessionWithResponse(responseAPI);\r\n    }catch(e){\r\n        setError([e.toString().replaceAll(\"Error: \", \"\")]);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={submitLogin}>\r\n        <div style={{\r\n            display:\"flex\", \r\n            justifyContent:\"center\", \r\n            alignContent:\"center\", \r\n            flexDirection:\"column\", \r\n            textAlign:\"center\",\r\n            margin: \"auto\",\r\n            marginTop:40,\r\n            padding: 30,\r\n            border: \"2px solid black\",\r\n            borderRadius: 20,\r\n            maxWidth:400\r\n        }}>\r\n            {error && \r\n                <Alert severity=\"error\" style={{textAlign:\"justify\"}} onClose={() => setError(undefined)}>\r\n                    Han ocurrido los siguientes errores:\r\n                    <ul>\r\n                        {error.map((listerror, idx) => <li key={idx}>{listerror}</li>)}\r\n                    </ul>\r\n                </Alert>\r\n            }\r\n            <h1>Iniciar Sesión</h1>\r\n            <div style={{display:\"flex\", justifyContent:\"center\"}}>\r\n                <img src=\"logo_transp.png\" width=\"25%\" alt=\"Driving Simulator Logo\"/>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type=\"text\" \r\n                    onChange={(event) => setEmail(event.target.value)} \r\n                    value={email} \r\n                    name=\"email\"\r\n                    label=\"E-Mail\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    onChange={(event) => setPassword(event.target.value)} \r\n                    value={password} \r\n                    name=\"password\"\r\n                    label=\"Contraseña\"\r\n                    InputProps={{ // <-- This is where the toggle button is added.\r\n                        endAdornment: (\r\n                          <InputAdornment position=\"end\">\r\n                            <IconButton\r\n                              aria-label=\"toggle password visibility\"\r\n                              onClick={handleClickShowPassword}\r\n                            >\r\n                              {showPassword ? <Visibility /> : <VisibilityOff />}\r\n                            </IconButton>\r\n                          </InputAdornment>\r\n                        )\r\n                    }}\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                {/*TODO: CONSIDERAR EL SPINNER CUANDO ESTA CARGANDO*/}\r\n                <Button variant=\"contained\" type=\"submit\">Iniciar Sesión</Button>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Link to={\"/signup\"}>¿No posees una cuenta? Registrate aquí...</Link>\r\n            </div>\r\n            <div style={{marginTop:20, display:\"flex\", justifyContent:\"center\", textAlign:\"center\", alignContent:\"center\"}}>\r\n                <GoogleLogin\r\n                    onSuccess={credentialResponse => {\r\n                        const OAuthToken = credentialResponse.credential;\r\n                        submitGoogleLogin(OAuthToken);\r\n                    }}\r\n                    onError={() => {\r\n                        setError(['El inicio de sesión con Google ha fallado.']);\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    </form>\r\n  )\r\n}\r\n\r\n","import { useContext } from 'react';\r\nimport { SessionContext } from './SessionContext';\r\n\r\nexport const SessionHooks = () => {\r\n  \r\n    const { session, setSession } = useContext(SessionContext);\r\n\r\n\r\n    const setSessionWithResponse = (loginResponse) => {\r\n        setSession({\r\n            user: loginResponse.user,\r\n            jwt: loginResponse.jwt\r\n        });\r\n    }\r\n\r\n    const getUser = () => {\r\n        return session.user ? session.user : undefined;\r\n    }\r\n\r\n    const getJWT = () => {\r\n        return session.jwt ? session.jwt : undefined;\r\n    }\r\n\r\n    return({\r\n        setSessionWithResponse,\r\n        getUser,\r\n        getJWT\r\n    })\r\n}\r\n","import React from 'react'\r\nimport {API_URL} from '../Constants/Constants';\r\nimport { Alert, Button, TextField, InputAdornment, IconButton } from \"@mui/material\"\r\nimport { Link } from 'react-router-dom';\r\nimport { Visibility, VisibilityOff } from '@mui/icons-material';\r\nimport { VALID_REGEX_EMAIL } from '../Constants/Constants';\r\nimport { hash } from '../Resources/Hasher';\r\n\r\n\r\nexport const SignUpForm = () => {\r\n\r\n  const [email, setEmail] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const [passwordConfirmation, setPasswordConfirmation] = React.useState(\"\");\r\n  const [nameToShow, setNameToShow] = React.useState(\"\");\r\n  const [showPassword, setShowPassword] = React.useState(false);\r\n  const [error, setError] = React.useState(undefined);\r\n  const handleClickShowPassword = () => setShowPassword(!showPassword);\r\n\r\n  const validateFields = () => {\r\n    const errorArray = [];\r\n    if (email === \"\" || password === \"\" || passwordConfirmation === \"\" || nameToShow === \"\"){\r\n      errorArray.push(\"Aún existen campos sin completar.\")\r\n    }\r\n    if (password !== passwordConfirmation){\r\n      errorArray.push(\"Las contraseñas establecidas no coinciden.\");\r\n    }\r\n    if (password.length < 8){\r\n      errorArray.push(\"La contraseña debe tener una longitud mínima de 8 caracteres.\");\r\n    }\r\n    if (!email.match(VALID_REGEX_EMAIL)){\r\n      errorArray.push(\"El email establecido es inválido.\");\r\n    }\r\n    if(errorArray.length > 0){\r\n      setError(errorArray);\r\n      return false;\r\n    }else{\r\n      setError(undefined);\r\n      return true;\r\n    }\r\n  }\r\n\r\n\r\n  const postSignUp = async () => {\r\n    const fetchUrl = `${API_URL}/users/register`;\r\n    try{\r\n      const APIResponse = await fetch(\r\n        fetchUrl,\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n              \"Content-Type\": \"application/json\"\r\n          },\r\n          body: JSON.stringify({\r\n              \"email\": email,\r\n              \"password\": hash(password),\r\n              \"name_to_show\": nameToShow\r\n          })\r\n        }\r\n      );\r\n      if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n        let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n        throw new Error(error_msg);\r\n      }\r\n      return APIResponse.json();\r\n  }catch(e){\r\n      throw new Error(e);\r\n  }\r\n  }\r\n\r\n\r\n  const submitSignUp = async (event) => {\r\n    event.preventDefault();\r\n    if (!validateFields()){\r\n      return;\r\n    }\r\n    const res = await postSignUp();\r\n    console.log(res);\r\n    /*TODO: Mostrar dialog de creado exitoso, y despues mandarlo al login...*/\r\n  }\r\n\r\n\r\n  return (\r\n    <form onSubmit={submitSignUp}>\r\n        <div style={{\r\n            display:\"flex\", \r\n            justifyContent:\"center\", \r\n            alignContent:\"center\", \r\n            flexDirection:\"column\", \r\n            textAlign:\"center\",\r\n            margin: \"auto\",\r\n            marginTop:40,\r\n            padding: 30,\r\n            border: \"2px solid black\",\r\n            borderRadius: 20,\r\n            maxWidth:400\r\n        }}>\r\n            {error && \r\n                <Alert severity=\"error\" style={{textAlign:\"justify\"}} onClose={() => setError(undefined)}>\r\n                    Han ocurrido los siguientes errores:\r\n                    <ul>\r\n                        {error.map((listerror, idx) => <li key={idx}>{listerror}</li>)}\r\n                    </ul>\r\n                </Alert>\r\n            }\r\n            <h1>Crea tu cuenta</h1>\r\n            <div style={{display:\"flex\", justifyContent:\"center\"}}>\r\n                <img src=\"logo_transp.png\" width=\"25%\" alt=\"Driving Simulator Logo\"/>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type=\"text\" \r\n                  onChange={(event) => setEmail(event.target.value)} \r\n                  value={email} \r\n                  name=\"email\"\r\n                  label=\"E-Mail\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type=\"text\" \r\n                  onChange={(event) => setNameToShow(event.target.value)} \r\n                  value={nameToShow} \r\n                  name=\"username\"\r\n                  label=\"Nombre para mostrar\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type={showPassword ? \"text\" : \"password\"}\r\n                  onChange={(event) => setPassword(event.target.value)} \r\n                  value={password} \r\n                  name=\"password\"\r\n                  label=\"Contraseña\"\r\n                  InputProps={{ // <-- This is where the toggle button is added.\r\n                    endAdornment: (\r\n                      <InputAdornment position=\"end\">\r\n                        <IconButton\r\n                          aria-label=\"toggle password visibility\"\r\n                          onClick={handleClickShowPassword}\r\n                        >\r\n                          {showPassword ? <Visibility /> : <VisibilityOff />}\r\n                        </IconButton>\r\n                      </InputAdornment>\r\n                    )\r\n                  }}\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    onChange={(event) => setPasswordConfirmation(event.target.value)} \r\n                    value={passwordConfirmation} \r\n                    name=\"passwordConfirmation\"\r\n                    label=\"Repetir Contraseña\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                {/*TODO: CONSIDERAR EL SPINNER CUANDO ESTA CARGANDO*/}\r\n                <Button variant=\"contained\" type=\"submit\">CREAR CUENTA</Button>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Link to={\"/login\"}>¿Ya poses una cuenta? Inicia sesión...</Link>\r\n            </div>\r\n        </div>\r\n    </form>\r\n  )\r\n}\r\n","import { SessionContext } from \"./SessionContext\";\r\nimport { useState } from 'react'\r\nimport { GoogleOAuthProvider } from '@react-oauth/google';\r\n\r\nexport const SessionProvider = ( {childElement} ) => {\r\n  \r\n    const [session, setSession] = useState({\r\n        user: undefined,\r\n        jwt: undefined\r\n    });\r\n\r\n    return (\r\n        <GoogleOAuthProvider clientId=\"18785041157-s9ga39r0i6up45radtj3soo6je1pneon.apps.googleusercontent.com\">\r\n            <SessionContext.Provider value={{session, setSession}}>\r\n                {childElement}\r\n            </SessionContext.Provider>\r\n        </GoogleOAuthProvider>\r\n    )\r\n}\r\n","import ThreeScene from './Scene/ThreeScene';\r\nimport { useEffect } from 'react';\r\nimport { MainMenu } from './Menus/MainMenu';\r\nimport { LevelEditor } from './Menus/LevelEditor';\r\nimport { HashRouter as Router, Routes as Switch, Route } from 'react-router-dom';\r\nimport { LoginForm } from './Menus/Components/LoginForm';\r\nimport { SignUpForm } from './Menus/Components/SignUpForm';\r\nimport { SessionProvider } from './Menus/Sessions/SessionProvider';\r\n\r\n\r\nfunction App() {\r\n\r\n  useEffect(() => {\r\n    document.title = 'Driving Simulator';\r\n  }, []);\r\n\r\n  return (\r\n    <SessionProvider childElement = \r\n      {\r\n        <Router>\r\n          <Switch>\r\n            <Route exact path=\"/scene\" element = {<ThreeScene/>} />\r\n            <Route exact path=\"/\" element = {<MainMenu/>} />\r\n            <Route exact path=\"/level-editor\" element = {<LevelEditor/>} />\r\n            <Route exact path=\"/login\" element = {<LoginForm/>}/>\r\n            <Route exact path=\"/signup\" element = {<SignUpForm/>}/>\r\n          </Switch>\r\n        </Router>\r\n      }\r\n    />\r\n    \r\n  );\r\n\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <App />\n);\n\n"],"sourceRoot":""}