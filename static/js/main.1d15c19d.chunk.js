/*! For license information please see main.1d15c19d.chunk.js.LICENSE.txt */
(this["webpackJsonptpp-driving-simulator"]=this["webpackJsonptpp-driving-simulator"]||[]).push([[0],{145:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r}));var s=n(3),i=n(4),r=function(){function t(e){Object(s.a)(this,t),this.car=e}return Object(i.a)(t,[{key:"handleAccelerate",value:function(t,e){this.car.accelerate(t,e)}},{key:"handleBrake",value:function(t,e){this.car.brake(t,e)}},{key:"changeShift",value:function(t,e){this.car.changeShift(t,e)}},{key:"turnDirection",value:function(t){this.car.turnDirection(t)}},{key:"turnOnCar",value:function(){this.car.turnOnCar()}},{key:"updateCar",value:function(){this.car.update()}},{key:"changeShiftBox",value:function(t){this.car.changeShiftBox(t)}}]),t}()},233:function(t,e,n){},242:function(t,e){},244:function(t,e){},254:function(t,e){},256:function(t,e){},281:function(t,e){},283:function(t,e){},284:function(t,e){},289:function(t,e){},291:function(t,e){},297:function(t,e){},299:function(t,e){},318:function(t,e){},330:function(t,e){},333:function(t,e){},337:function(t,e,n){"use strict";n.r(e);var s=n(0),i=n.n(s),r=n(202),a=n.n(r),o=(n(233),n(8)),h=n(18),c=n(3),u=n(4),l=n(6),d=n(7),b=n(1),p=function(){function t(){Object(c.a)(this,t),this.observedState=null}return Object(u.a)(t,[{key:"update",value:function(t){this.observedState=t}}]),t}(),f=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this)).camera=new b.cb(85,window.innerWidth/window.innerHeight,.1,100),s.group=new b.ab,s.group180Rot=(new b.ab).add(s.camera),s.group.add(s.group180Rot),s.renderer=t,s}return Object(u.a)(n,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"setPositionRelativeToObject",value:function(){var t=new b.Db(.35,.6,-.1);if(null!=this.observedState)if(t.applyQuaternion(this.observedState.rotation),this.group.position.copy(this.observedState.position).add(t),"true"===localStorage.getItem("VR")){var e=new b.Db(0,-1.25,0);e.applyQuaternion(this.observedState.rotation),this.group.position.add(e),this.group.setRotationFromQuaternion(this.observedState.rotation),this.group180Rot.setRotationFromAxisAngle(new b.Db(0,1,0),Math.PI),this.camera.lookAt(new b.Db(0,0,5))}else{var n=new b.ib(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w).normalize();this.group180Rot.setRotationFromAxisAngle(new b.Db(0,1,0),-5*Math.PI/180),this.group.quaternion.copy(n)}else this.camera.lookAt(new b.Db(0,0,5))}},{key:"getCameraInstance",value:function(){return this.camera}},{key:"addContainerToScene",value:function(t){t.add(this.group)}}]),n}(p),v=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this)).positionCamera=t,s.camera=new b.cb(75,window.innerWidth/window.innerHeight,.1,100),s}return Object(u.a)(n,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"setPositionRelativeToObject",value:function(){var t=new b.Db(this.positionCamera.x,this.positionCamera.y,this.positionCamera.z);if(null!=this.observedState){var e=t.applyQuaternion(this.observedState.rotation);this.camera.position.copy(this.observedState.position).add(e);var n=new b.Db(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z);this.camera.lookAt(n)}else this.camera.lookAt(new b.Db(0,0,0)),this.camera.position.copy(t)}},{key:"getCameraInstance",value:function(){return this.camera}}]),n}(p),g=n(203),m=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this)).camera=new b.cb(75,window.innerWidth/window.innerHeight,.1,1e3),s.renderer=t,s.controls=new g.a(s.camera,s.renderer.domElement),s.controls.enableDamping=!0,s.controls.dampingFactor=.25,s.controls.enableZoom=!0,s.camera.position.set(0,5.5,0),s}return Object(u.a)(n,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"getCameraInstance",value:function(){return this.camera}},{key:"setPositionRelativeToObject",value:function(){this.controls.update(),null!=this.observedState?this.camera.lookAt(this.observedState.position):this.camera.lookAt(new b.Db(0,0,0))}}]),n}(p),j=n(214),w=n(103),y=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this)).fbxLoader=new j.a,s.gltfLoader=new w.a,s.threeDModel=null,s.pathToTexture=t,s}return Object(u.a)(n,[{key:"loadFBX",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.pathToTexture,t.next=3,this.fbxLoader.loadAsync(e,(function(t){return t}));case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadGLTF",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.pathToTexture,t.next=3,this.gltfLoader.loadAsync(e,(function(t){return t}));case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addToScene",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s,i){var r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.threeDModel){t.next=22;break}return t.prev=1,t.next=4,this.loadFBX();case 4:r=t.sent,this.threeDModel=r,t.next=14;break;case 8:return t.prev=8,t.t0=t.catch(1),t.next=12,this.loadGLTF();case 12:r=t.sent,this.threeDModel=r.scene;case 14:this.threeDModel.name=n,this.threeDModel.position.x=s[0],this.threeDModel.position.y=s[1],this.threeDModel.position.z=s[2],this.threeDModel.scale.x=i[0],this.threeDModel.scale.y=i[1],this.threeDModel.scale.z=i[2],e.add(this.threeDModel);case 22:return t.abrupt("return",this);case 23:case"end":return t.stop()}}),t,this,[[1,8]])})));return function(e,n,s,i){return t.apply(this,arguments)}}()},{key:"getModel",value:function(){return this.threeDModel}},{key:"animate",value:function(){return null}}]),n}(p),x=n(30),O=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(c.a)(this,n),(s=e.call(this,t)).isReflector=!0,s.type="Reflector",s.camera=new b.cb;var r=Object(x.a)(s),a=void 0!==i.color?new b.j(i.color):new b.j(8355711),o=i.textureWidth||512,h=i.textureHeight||512,u=i.clipBias||0,l=i.shader||n.ReflectorShader,d=void 0!==i.multisample?i.multisample:4,p=new b.db,f=new b.Db,v=new b.Db,g=new b.Db,m=new b.O,j=new b.Db(0,0,-1),w=new b.Eb,y=new b.Db,O=new b.Db,S=new b.Eb,P=new b.O,k=s.camera,R=new b.Gb(o,h,{samples:d}),M=new b.mb({uniforms:b.Bb.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});return M.uniforms.tDiffuse.value=R.texture,M.uniforms.color.value=a,M.uniforms.textureMatrix.value=P,s.material=M,s.onBeforeRender=function(t,e,n){if(v.setFromMatrixPosition(r.matrixWorld),g.setFromMatrixPosition(n.matrixWorld),m.extractRotation(r.matrixWorld),f.set(0,0,1),f.applyMatrix4(m),y.subVectors(v,g),!(y.dot(f)>-.5)){y.reflect(f).negate(),y.add(v),m.extractRotation(n.matrixWorld),j.set(0,0,-1),j.applyMatrix4(m),j.add(g),O.subVectors(v,j),O.reflect(f).negate(),O.add(v),k.position.copy(y),k.up.set(0,1,0),k.up.applyMatrix4(m),k.up.reflect(f),k.lookAt(O),k.far=n.far,k.updateMatrixWorld(),k.projectionMatrix.copy(n.projectionMatrix),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(k.projectionMatrix),P.multiply(k.matrixWorldInverse),P.multiply(r.matrixWorld),p.setFromNormalAndCoplanarPoint(f,v),p.applyMatrix4(k.matrixWorldInverse),w.set(p.normal.x,p.normal.y,p.normal.z,p.constant);var s=k.projectionMatrix;S.x=(Math.sign(w.x)+s.elements[8])/s.elements[0],S.y=(Math.sign(w.y)+s.elements[9])/s.elements[5],S.z=-1,S.w=(1+s.elements[10])/s.elements[14],w.multiplyScalar(2/w.dot(S)),s.elements[2]=w.x,s.elements[6]=w.y,s.elements[10]=w.z+1-u,s.elements[14]=w.w,R.texture.encoding=t.outputEncoding,r.visible=!1;var i=t.getRenderTarget(),a=t.xr.enabled,o=t.shadowMap.autoUpdate;t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(R),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,k),t.xr.enabled=a,t.shadowMap.autoUpdate=o,t.setRenderTarget(i);var h=n.viewport;void 0!==h&&t.state.viewport(h),r.visible=!0}},s.getRenderTarget=function(){return R},s.dispose=function(){R.dispose(),r.material.dispose()},s}return Object(u.a)(n)}(b.P);O.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};var S=function(){function t(){Object(c.a)(this,t),this.gltfLoader=new w.a,this.carModel=null,this.building_1=null,this.building_2=null,this.building_3=null,this.building_4=null}return Object(u.a)(t,[{key:"loadGLTF",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n,s;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e,t.next=3,this.gltfLoader.loadAsync(n,(function(t){return t}));case 3:return s=t.sent,t.abrupt("return",s.scene);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadModels",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.carModel=this.loadGLTF("res/models/source/AutoConInterior.glb"),this.building_1=this.loadGLTF("res/models/source/buildings/Building_1.glb"),this.building_2=this.loadGLTF("res/models/source/buildings/Building_2.glb"),this.building_3=this.loadGLTF("res/models/source/buildings/Building_3.glb"),this.building_4=this.loadGLTF("res/models/source/buildings/Building_4.glb"),t.abrupt("return","OK");case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),P=function(){function t(){Object(c.a)(this,t)}return Object(u.a)(t,null,[{key:"getInstance",value:function(){var e=Object(h.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ModelsSingleton){e.next=12;break}return t.ModelsSingleton=new S,e.next=4,t.ModelsSingleton.loadModels();case 4:if("OK"!==e.sent){e.next=9;break}return e.abrupt("return",t.ModelsSingleton);case 9:throw new Error("Error al cargar los modelos.");case 10:e.next=13;break;case 12:return e.abrupt("return",t.ModelsSingleton);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}(),k=[1,1,1],R=[0,0,0],M=.75,D=1/3600,T=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){var t;return Object(c.a)(this,n),(t=e.call(this,"res/models/source/AutoConInterior.glb")).carModel=null,t.carLogic=null,t.lastValueRotation=0,t.currentSpeedRotation=0,t.currentWheelRotation=0,t.lastSteeringRotation=0,t.lastVelocityRotation=0,t.lastRPMRotation=0,t}return Object(u.a)(n,[{key:"generateRetrovisor",value:function(){var t=new b.nb;t.absellipse(0,0,.15,.075,0,2*Math.PI,!1,0);var e=new b.ob(t),n=new O(e,{textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,clipBias:.35,multisample:2});n.rotateX(-Math.PI),n.rotateY(.3),n.position.set(0,.625,.375),this.threeDModel.add(n)}},{key:"generateLeftMirror",value:function(){var t=new b.nb;t.absellipse(0,0,.105,.075,0,2*Math.PI,!1,0);var e=new b.ob(t),n=new O(e,{textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,clipBias:0,multisample:2}),s=new b.ab;s.add(n),s.position.set(1.148,.394,.538),s.rotateX(.03-Math.PI),n.rotateY(-26*Math.PI/180),this.threeDModel.add(s)}},{key:"generateRightMirror",value:function(){var t=new b.nb;t.absellipse(0,0,.105,.075,0,2*Math.PI,!1,0);var e=new b.ob(t),n=new O(e,{textureWidth:window.innerWidth*window.devicePixelRatio,textureHeight:window.innerHeight*window.devicePixelRatio,clipBias:0,multisample:2}),s=new b.ab;s.add(n),s.position.set(-1.138,.394,.53),s.rotateX(-Math.PI+2.9*Math.PI/180),n.rotateY(28.2*Math.PI/180),this.threeDModel.add(s)}},{key:"generateMirrors",value:function(){this.generateRetrovisor(),this.generateLeftMirror(),this.generateRightMirror()}},{key:"addToScene",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P.getInstance();case 2:return n=t.sent,t.next=5,n.carModel;case 5:return this.threeDModel=t.sent,this.threeDModel.name="driverCar",this.threeDModel.position.x=R[0],this.threeDModel.position.y=R[1],this.threeDModel.position.z=R[2],this.threeDModel.scale.x=k[0],this.threeDModel.scale.y=k[1],this.threeDModel.scale.z=k[2],e.add(this.threeDModel),this.generateMirrors(),t.abrupt("return",this);case 16:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"animate",value:function(){this.moveCar()}},{key:"addPhysicsView",value:function(t){this.physicsShape=new b.Db(2,1.35,5);var e=new b.e(this.physicsShape.x,this.physicsShape.y,this.physicsShape.z),n=new b.Q({color:255});this.PHYSICSSQUARE=new b.P(e,n),this.PHYSICSSQUARE.position.set(0,0,0),t.add(this.PHYSICSSQUARE);var s=new b.l(.35,.35,.35,32,32);s.rotateZ(Math.PI/2);var i=new b.Q({color:16711680});this.wheelMesh1=new b.P(s,i),this.wheelMesh1.position.set(0,4,0),t.add(this.wheelMesh1),this.wheelMesh2=new b.P(s,i),this.wheelMesh2.position.set(0,4,0),t.add(this.wheelMesh2),this.wheelMesh3=new b.P(s,i),this.wheelMesh3.position.set(0,4,0),t.add(this.wheelMesh3),this.wheelMesh4=new b.P(s,i),this.wheelMesh4.position.set(0,4,0),t.add(this.wheelMesh4)}},{key:"watchPhysicsColliders",value:function(){null!=this.observedState&&(this.PHYSICSSQUARE.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.PHYSICSSQUARE.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.wheelMesh1.position.set(this.observedState.wheelsData[0].position.x,this.observedState.wheelsData[0].position.y,this.observedState.wheelsData[0].position.z),this.wheelMesh1.quaternion.set(this.observedState.wheelsData[0].rotation.x,this.observedState.wheelsData[0].rotation.y,this.observedState.wheelsData[0].rotation.z,this.observedState.wheelsData[0].rotation.w),this.wheelMesh2.position.set(this.observedState.wheelsData[1].position.x,this.observedState.wheelsData[1].position.y,this.observedState.wheelsData[1].position.z),this.wheelMesh2.quaternion.set(this.observedState.wheelsData[1].rotation.x,this.observedState.wheelsData[1].rotation.y,this.observedState.wheelsData[1].rotation.z,this.observedState.wheelsData[1].rotation.w),this.wheelMesh3.position.set(this.observedState.wheelsData[2].position.x,this.observedState.wheelsData[2].position.y,this.observedState.wheelsData[2].position.z),this.wheelMesh3.quaternion.set(this.observedState.wheelsData[2].rotation.x,this.observedState.wheelsData[2].rotation.y,this.observedState.wheelsData[2].rotation.z,this.observedState.wheelsData[2].rotation.w),this.wheelMesh4.position.set(this.observedState.wheelsData[3].position.x,this.observedState.wheelsData[3].position.y,this.observedState.wheelsData[3].position.z),this.wheelMesh4.quaternion.set(this.observedState.wheelsData[3].rotation.x,this.observedState.wheelsData[3].rotation.y,this.observedState.wheelsData[3].rotation.z,this.observedState.wheelsData[3].rotation.w))}},{key:"moveCar",value:function(){null!=this.observedState&&(this.threeDModel.userData.physicsBody=this.observedState.physicsBody,this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.lastValueRotation=this.observedState.direction,this.rotateWheels(),this.rotateSteeringWheel(),this.rotateVelocityAndRPM())}},{key:"rotateSteeringWheel",value:function(){var t=this.threeDModel.children.find((function(t){return"Steering_Wheel"===t.name})),e=new b.Db(0,0,1).applyAxisAngle(new b.Db(1,0,0),-.35);t.rotateOnAxis(e,-this.lastSteeringRotation),t.rotateOnAxis(e,540*-this.observedState.lastRotationWheel/360*Math.PI*2),this.lastSteeringRotation=540*-this.observedState.lastRotationWheel/360*Math.PI*2}},{key:"rotateVelocityAndRPM",value:function(){var t=this.threeDModel.children.find((function(t){return"Cubo"===t.name})),e=this.threeDModel.children.find((function(t){return"Cubo001"===t.name})),n=-Math.abs(this.observedState.velocity)*(240*Math.PI/180)/240,s=-this.observedState.rpm*(260*Math.PI/180)/6e3;t.rotateOnAxis(new b.Db(0,1,0),-this.lastVelocityRotation),t.rotateOnAxis(new b.Db(0,1,0),n),e.rotateOnAxis(new b.Db(0,1,0),-this.lastRPMRotation),e.rotateOnAxis(new b.Db(0,1,0),s),this.lastVelocityRotation=n,this.lastRPMRotation=s}},{key:"rotateWheels",value:function(){var t=this.threeDModel.children.find((function(t){return"wheel002"===t.name})),e=this.threeDModel.children.find((function(t){return"wheel"===t.name})),n=this.threeDModel.children.find((function(t){return"wheel003"===t.name})),s=this.threeDModel.children.find((function(t){return"wheel001"===t.name})),i=new b.Db(0,1,0).applyAxisAngle(new b.Db(1,0,0),this.currentSpeedRotation),r=new b.Db(0,1,0).applyAxisAngle(new b.Db(1,0,0),-this.currentSpeedRotation);e.rotateOnAxis(r,this.currentWheelRotation),t.rotateOnAxis(i,this.currentWheelRotation),e.rotateX(this.observedState.velocity*D*4),t.rotateX(-this.observedState.velocity*D*4),n.rotateX(-this.observedState.velocity*D*4),s.rotateX(this.observedState.velocity*D*4),i=new b.Db(0,1,0).applyAxisAngle(new b.Db(1,0,0),this.currentSpeedRotation+this.observedState.velocity*D*4),r=new b.Db(0,1,0).applyAxisAngle(new b.Db(1,0,0),-this.currentSpeedRotation-this.observedState.velocity*D*4),e.rotateOnAxis(r,-this.observedState.lastRotationWheel*M),t.rotateOnAxis(i,-this.observedState.lastRotationWheel*M),this.currentWheelRotation=this.observedState.lastRotationWheel*M,this.currentSpeedRotation+=this.observedState.velocity*D*4,this.currentSpeedRotation>=2*Math.PI&&(this.currentSpeedRotation-=2*Math.PI)}}]),n}(y),A=n(145).default,I=function(){function t(e){Object(c.a)(this,t),this.carLogic=e;var n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(var s=0;s<n.length;s++)n[s]&&n[s].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=n[s]);this.buttonX=0,this.buttonSquare=1,this.buttonCircle=2,this.buttonTriangle=3,this.bumperRight=4,this.bumperLeft=5,this.buttonR2=6,this.buttonL2=7,this.shareButton=8,this.optionsButton=9,this.buttonR3=10,this.buttonL3=11,this.firstShift=12,this.secondShift=13,this.thirdShift=14,this.fourthShift=15,this.fifthShift=16,this.sixthShift=17,this.reverseShift=18,this.buttonPlus=19,this.buttonMinus=20,this.wheelInEnterRight=21,this.wheelInEnterLeft=22,this.enter=23,this.psButton=24,this.buttonsPressed=[];for(var i=0;i<=24;i++)this.buttonsPressed.push(!1);this.wheelAxes=0,this.clutch=1,this.accelerator=2,this.brake=5,this.DPad=9,this.valueDpadUP=-1,this.valueDpadDOWN=.14285719394683838,this.valueDpadLEFT=.7142857313156128,this.valueDpadRIGHT=-.4285714030265808,this.dpadPressed=[];for(var r=0;r<=3;r++)this.dpadPressed.push(!1);this.globalControllerHandler=new A(e)}return Object(u.a)(t,[{key:"checkGamepadChanges",value:function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=t[e])}},{key:"checkEvents",value:function(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}},{key:"doActionsPedals",value:function(){var t=Math.pow(this.gamepad.axes[this.clutch],3),e=Math.pow(this.gamepad.axes[this.brake],3);e=1-(e+1)/2;var n=Math.pow(this.gamepad.axes[this.accelerator],3);n=1-(n+1)/2,this.globalControllerHandler.handleAccelerate(t,n),this.globalControllerHandler.handleBrake(t,e)}},{key:"doActionsWheel",value:function(){this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes])}},{key:"doActionsDPad",value:function(){if(1.2857143878936768!==this.gamepad.axes[this.DPad])this.gamepad.axes[this.DPad]!==this.valueDpadDOWN||this.dpadPressed[1]?this.gamepad.axes[this.DPad]!==this.valueDpadDOWN&&(this.dpadPressed[1]=!1):this.dpadPressed[1]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadLEFT||this.dpadPressed[2]?this.gamepad.axes[this.DPad]!==this.valueDpadLEFT&&(this.dpadPressed[2]=!1):this.dpadPressed[2]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT||this.dpadPressed[3]?this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT&&(this.dpadPressed[3]=!1):this.dpadPressed[3]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadUP||this.dpadPressed[0]?this.gamepad.axes[this.DPad]!==this.valueDpadUP&&(this.dpadPressed[0]=!1):this.dpadPressed[0]=!0;else for(var t=0;t<this.dpadPressed.length;t++)this.dpadPressed[t]=!1}},{key:"doActionsButtons",value:function(){this.gamepad.buttons[this.buttonX].pressed&&!this.buttonsPressed[this.buttonX]?this.buttonsPressed[this.buttonX]=!0:this.gamepad.buttons[this.buttonX].pressed||(this.buttonsPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonTriangle].pressed&&!this.buttonsPressed[this.buttonTriangle]?this.buttonsPressed[this.buttonTriangle]=!0:this.gamepad.buttons[this.buttonTriangle].pressed||(this.buttonsPressed[this.buttonTriangle]=!1),this.gamepad.buttons[this.buttonCircle].pressed&&!this.buttonsPressed[this.buttonCircle]?this.buttonsPressed[this.buttonCircle]=!0:this.gamepad.buttons[this.buttonCircle].pressed||(this.buttonsPressed[this.buttonCircle]=!1),this.gamepad.buttons[this.buttonSquare].pressed&&!this.buttonsPressed[this.buttonSquare]?this.buttonsPressed[this.buttonSquare]=!0:this.gamepad.buttons[this.buttonSquare].pressed||(this.buttonsPressed[this.buttonSquare]=!1),this.gamepad.buttons[this.psButton].pressed&&!this.buttonsPressed[this.psButton]?this.buttonsPressed[this.psButton]=!0:this.gamepad.buttons[this.psButton].pressed||(this.buttonsPressed[this.psButton]=!1),this.gamepad.buttons[this.buttonPlus].pressed&&!this.buttonsPressed[this.buttonPlus]?this.buttonsPressed[this.buttonPlus]=!0:this.gamepad.buttons[this.buttonPlus].pressed||(this.buttonsPressed[this.buttonPlus]=!1),this.gamepad.buttons[this.buttonMinus].pressed&&!this.buttonsPressed[this.buttonMinus]?this.buttonsPressed[this.buttonMinus]=!0:this.gamepad.buttons[this.buttonMinus].pressed||(this.buttonsPressed[this.buttonMinus]=!1),this.gamepad.buttons[this.buttonL2].pressed&&!this.buttonsPressed[this.buttonL2]?this.buttonsPressed[this.buttonL2]=!0:this.gamepad.buttons[this.buttonL2].pressed||(this.buttonsPressed[this.buttonL2]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonsPressed[this.buttonL3]?this.buttonsPressed[this.buttonL3]=!0:this.gamepad.buttons[this.buttonL3].pressed||(this.buttonsPressed[this.buttonL3]=!1),this.gamepad.buttons[this.buttonR2].pressed&&!this.buttonsPressed[this.buttonR2]?(this.globalControllerHandler.turnOnCar(),this.buttonsPressed[this.buttonR2]=!0):this.gamepad.buttons[this.buttonR2].pressed||(this.buttonsPressed[this.buttonR2]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonsPressed[this.buttonR3]?this.buttonsPressed[this.buttonR3]=!0:this.gamepad.buttons[this.buttonR3].pressed||(this.buttonsPressed[this.buttonR3]=!1),this.gamepad.buttons[this.enter].pressed&&!this.buttonsPressed[this.enter]?this.buttonsPressed[this.enter]=!0:this.gamepad.buttons[this.enter].pressed||(this.buttonsPressed[this.enter]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonsPressed[this.shareButton]?this.buttonsPressed[this.shareButton]=!0:this.gamepad.buttons[this.shareButton].pressed||(this.buttonsPressed[this.shareButton]=!1),this.gamepad.buttons[this.optionsButton].pressed&&!this.buttonsPressed[this.optionsButton]?this.buttonsPressed[this.optionsButton]=!0:this.gamepad.buttons[this.optionsButton].pressed||(this.buttonsPressed[this.optionsButton]=!1),this.gamepad.buttons[this.bumperLeft].pressed&&!this.buttonsPressed[this.bumperLeft]?this.buttonsPressed[this.bumperLeft]=!0:this.gamepad.buttons[this.bumperLeft].pressed||(this.buttonsPressed[this.bumperLeft]=!1),this.gamepad.buttons[this.bumperRight].pressed&&!this.buttonsPressed[this.bumperRight]?this.buttonsPressed[this.bumperRight]=!0:this.gamepad.buttons[this.bumperRight].pressed||(this.buttonsPressed[this.bumperRight]=!1),this.gamepad.buttons[this.wheelInEnterLeft].pressed&&!this.buttonsPressed[this.wheelInEnterLeft]?this.buttonsPressed[this.wheelInEnterLeft]=!0:this.gamepad.buttons[this.wheelInEnterLeft].pressed||(this.buttonsPressed[this.wheelInEnterLeft]=!1),this.gamepad.buttons[this.wheelInEnterRight].pressed&&!this.buttonsPressed[this.wheelInEnterRight]?this.buttonsPressed[this.wheelInEnterRight]=!0:this.gamepad.buttons[this.wheelInEnterRight].pressed||(this.buttonsPressed[this.wheelInEnterRight]=!1)}},{key:"doActionsShifter",value:function(){this.gamepad.buttons[this.firstShift].pressed&&!this.buttonsPressed[this.firstShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],1),this.buttonsPressed[this.firstShift]=!0):!this.gamepad.buttons[this.firstShift].pressed&&this.buttonsPressed[this.firstShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.firstShift]=!1),this.gamepad.buttons[this.secondShift].pressed&&!this.buttonsPressed[this.secondShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],2),this.buttonsPressed[this.secondShift]=!0):!this.gamepad.buttons[this.secondShift].pressed&&this.buttonsPressed[this.secondShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.secondShift]=!1),this.gamepad.buttons[this.thirdShift].pressed&&!this.buttonsPressed[this.thirdShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],3),this.buttonsPressed[this.thirdShift]=!0):!this.gamepad.buttons[this.thirdShift].pressed&&this.buttonsPressed[this.thirdShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.thirdShift]=!1),this.gamepad.buttons[this.fourthShift].pressed&&!this.buttonsPressed[this.fourthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],4),this.buttonsPressed[this.fourthShift]=!0):!this.gamepad.buttons[this.fourthShift].pressed&&this.buttonsPressed[this.fourthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fourthShift]=!1),this.gamepad.buttons[this.fifthShift].pressed&&!this.buttonsPressed[this.fifthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],5),this.buttonsPressed[this.fifthShift]=!0):!this.gamepad.buttons[this.fifthShift].pressed&&this.buttonsPressed[this.fifthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fifthShift]=!1),this.gamepad.buttons[this.sixthShift].pressed&&!this.buttonsPressed[this.sixthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],6),this.buttonsPressed[this.sixthShift]=!0):!this.gamepad.buttons[this.sixthShift].pressed&&this.buttonsPressed[this.sixthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.sixthShift]=!1),this.gamepad.buttons[this.reverseShift].pressed&&!this.buttonsPressed[this.reverseShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],-1),this.buttonsPressed[this.reverseShift]=!0):!this.gamepad.buttons[this.reverseShift].pressed&&this.buttonsPressed[this.reverseShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.reverseShift]=!1)}},{key:"doActionByMapping",value:function(){this.doActionsPedals(),this.doActionsWheel(),this.doActionsDPad(),this.doActionsButtons(),this.doActionsShifter()}}]),t}(),C=function(){function t(){throw Object(c.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(e){return t.instance||(t.instance=new I(e)),t.instance}}]),t}(),E=n(145).default,L=.1,B=function(){function t(e){Object(c.a)(this,t);var n=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(var s=0;s<n.length;s++)n[s]&&(n[s].id.startsWith("Xbox")||n[s].id.startsWith("xinput"))&&(this.gamepad=n[s]);this.buttonA=0,this.buttonB=1,this.buttonX=2,this.buttonY=3,this.buttonL1=4,this.buttonR1=5,this.buttonL2=6,this.buttonR2=7,this.shareButton=8,this.optionButton=9,this.buttonL3=10,this.buttonR3=11,this.padUp=12,this.padDown=13,this.padLeft=14,this.padRight=15,this.buttomHome=16,this.buttonPressed=[],this.actualShift=0;for(var i=0;i<=16;i++)this.buttonPressed.push(!1);this.xLeftAxe=0,this.yLeftAxe=1,this.xRightAxe=2,this.yRightAxe=3,this.globalControllerHandler=new E(e)}return Object(u.a)(t,[{key:"checkGamepadChanges",value:function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("Xbox")&&(this.gamepad=t[e])}},{key:"checkEvents",value:function(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}},{key:"doActionsAxes",value:function(){if(Math.abs(this.gamepad.axes[this.yLeftAxe]),Math.abs(this.gamepad.axes[this.xLeftAxe])>=L){var t=Math.pow(this.gamepad.axes[this.xLeftAxe],3);this.globalControllerHandler.turnDirection(t)}else this.globalControllerHandler.turnDirection(0);Math.abs(this.gamepad.axes[this.yRightAxe]),Math.abs(this.gamepad.axes[this.xRightAxe])}},{key:"doActionHotKeys",value:function(){this.globalControllerHandler.handleAccelerate(1,this.gamepad.buttons[this.buttonR2].value),this.globalControllerHandler.handleBrake(0,this.gamepad.buttons[this.buttonL2].value)}},{key:"doActionsTriggers",value:function(){this.gamepad.buttons[this.buttonR2].pressed,this.gamepad.buttons[this.buttonL2].pressed}},{key:"doActionsButtons",value:function(){this.gamepad.buttons[this.buttonR1].pressed&&!this.buttonPressed[this.buttonR1]?(this.actualShift<=5&&(this.actualShift+=1,this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonR1]=!0):this.gamepad.buttons[this.buttonR1].pressed||(this.buttonPressed[this.buttonR1]=!1),this.gamepad.buttons[this.buttonL1].pressed&&!this.buttonPressed[this.buttonL1]?(this.actualShift>=0&&(this.actualShift-=1,this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonL1]=!0):this.gamepad.buttons[this.buttonL1].pressed||(this.buttonPressed[this.buttonL1]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonPressed[this.shareButton]?this.buttonPressed[this.shareButton]=!0:this.gamepad.buttons[this.shareButton].pressed||(this.buttonPressed[this.shareButton]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?this.buttonPressed[this.padUp]=!0:this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?this.buttonPressed[this.padDown]=!0:this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?this.buttonPressed[this.padLeft]=!0:this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?this.buttonPressed[this.padRight]=!0:this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttonA].pressed&&!this.buttonPressed[this.buttonA]?this.buttonPressed[this.buttonA]=!0:this.gamepad.buttons[this.buttonA].pressed||(this.buttonPressed[this.buttonA]=!1),this.gamepad.buttons[this.buttonB].pressed&&!this.buttonPressed[this.buttonB]?this.buttonPressed[this.buttonB]=!0:this.gamepad.buttons[this.buttonB].pressed||(this.buttonPressed[this.buttonB]=!1),this.gamepad.buttons[this.buttonY].pressed&&!this.buttonPressed[this.buttonY]?this.buttonPressed[this.buttonY]=!0:this.gamepad.buttons[this.buttonY].pressed||(this.buttonPressed[this.buttonY]=!1),this.gamepad.buttons[this.buttonX].pressed&&!this.buttonPressed[this.buttonX]?this.buttonPressed[this.buttonX]=!0:this.gamepad.buttons[this.buttonX].pressed||(this.buttonPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonPressed[this.buttonR3]?this.buttonPressed[this.buttonR3]=!0:this.gamepad.buttons[this.buttonR3].pressed||(this.buttonPressed[this.buttonR3]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonPressed[this.buttonL3]?this.buttonPressed[this.buttonL3]=!0:this.gamepad.buttons[this.buttonL3].pressed||(this.buttonPressed[this.buttonL3]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?this.buttonPressed[this.padUp]=!0:this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?this.buttonPressed[this.padDown]=!0:this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?this.buttonPressed[this.padLeft]=!0:this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?this.buttonPressed[this.padRight]=!0:this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttomHome].pressed&&!this.buttonPressed[this.buttomHome]?(this.globalControllerHandler.changeShiftBox("semi-auto"),this.buttonPressed[this.buttomHome]=!0):this.gamepad.buttons[this.buttomHome].pressed||(this.buttonPressed[this.buttomHome]=!1),this.gamepad.buttons[this.optionButton].pressed&&!this.buttonPressed[this.optionButton]?(this.globalControllerHandler.turnOnCar(),this.buttonPressed[this.optionButton]=!0):this.gamepad.buttons[this.optionButton].pressed||(this.buttonPressed[this.optionButton]=!1)}},{key:"doActionByMapping",value:function(){this.doActionHotKeys(),this.doActionsAxes(),this.doActionsTriggers(),this.doActionsButtons()}}]),t}(),H=function(){function t(){throw Object(c.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(e){return t.instance||(t.instance=new B(e)),t.instance}}]),t}(),W=n(11),_=n(10),G=function(){function t(){Object(c.a)(this,t),this.observers=[]}return Object(u.a)(t,[{key:"attachObserver",value:function(t){this.observers.push(t)}},{key:"removeObserver",value:function(t){var e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)}},{key:"notifyObservers",value:function(t){for(var e=0;e<this.observers.length;e++)this.observers[e].update(t)}}]),t}(),N=n(204),V=n.n(N),F=function(){function t(){throw Object(c.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(){var e=Object(h.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.AmmoInstanceToReturn){e.next=4;break}return e.next=3,V()();case 3:t.AmmoInstanceToReturn=e.sent;case 4:return e.abrupt("return",t.AmmoInstanceToReturn);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}();F.AmmoInstanceToReturn=null;var z=function(){function t(e,n,s,i,r,a,o){Object(c.a)(this,t),this.position=e,this.quaternion=n,this.inertia=s,this.mass=i,this.shape=r,this.physicsWorld=a,this.friction=o}return Object(u.a)(t,[{key:"buildAmmoPhysics",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n,s,i,r,a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:e=t.sent,this.inertia=new e.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=e,(n=new e.btTransform).setIdentity(),n.setOrigin(new e.btVector3(this.position.x,this.position.y,this.position.z)),n.setRotation(new e.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new e.btTransform,s=new e.btDefaultMotionState(n),(i=new e.btBoxShape(new e.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2))).calculateLocalInertia(this.mass,this.inertia),r=new e.btRigidBodyConstructionInfo(this.mass,s,i,this.inertia),this.rigidBody=new e.btRigidBody(r),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(10*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.tuning=new this.Ammo.btVehicleTuning,a=new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld),this.vehicle=new this.Ammo.btRaycastVehicle(this.tuning,this.rigidBody,a),this.vehicle.setCoordinateSystem(0,1,2),this.physicsWorld.addAction(this.vehicle),.35,.85,-1.45,.35,.35,-.85,.2,1.65,.85,.2,.35,.35,this.addWheel(!0,new this.Ammo.btVector3(.85,.2,1.65),.35,.35,0,1),this.addWheel(!0,new this.Ammo.btVector3(-.85,.2,1.65),.35,.35,1,-1),this.addWheel(!1,new this.Ammo.btVector3(.85,.2,-1.45),.35,.35,2,1),this.addWheel(!1,new this.Ammo.btVector3(-.85,.2,-1.45),.35,.35,3,-1),this.mass>0&&this.rigidBody.setActivationState(4);case 40:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addWheel",value:function(t,e,n,s,i,r){var a=new this.Ammo.btVector3(0,-1,0),o=new this.Ammo.btVector3(-1,0,0),h=this.vehicle.addWheel(e,a,o,.6,n,this.tuning,t);h.set_m_suspensionStiffness(2),h.set_m_wheelsDampingRelaxation(3.3),h.set_m_wheelsDampingCompression(4.4),h.set_m_frictionSlip(1e3),h.set_m_rollInfluence(.2)}},{key:"updatePhysics",value:function(){for(var t={chassis:{position:null,rotation:null},wheels:[]},e=0;e<this.vehicle.getNumWheels();e++){this.vehicle.updateWheelTransform(e,!0);var n=this.vehicle.getWheelTransformWS(e),s=n.getOrigin(),i=n.getRotation();t.wheels.push({position:new b.Db(s.x(),s.y(),s.z()),rotation:new b.Eb(i.x(),i.y(),i.z(),i.w())})}var r=this.vehicle.getChassisWorldTransform(),a=r.getOrigin(),o=r.getRotation();return t.chassis={position:new b.Db(a.x(),a.y(),a.z()),rotation:new b.Eb(o.x(),o.y(),o.z(),o.w())},t}},{key:"getRigidBody",value:function(){return this.rigidBody}},{key:"setEngineForce",value:function(t){this.vehicle.applyEngineForce(t,2),this.vehicle.applyEngineForce(t,3)}},{key:"brake",value:function(t){var e=Math.abs(this.vehicle.getCurrentSpeedKmHour()),n=100/e;0===e&&(n=0),t+=n,this.vehicle.setBrake(t/2,0),this.vehicle.setBrake(t/2,1),this.vehicle.setBrake(t,2),this.vehicle.setBrake(t,3)}},{key:"setSteeringRotation",value:function(t){this.vehicle.setSteeringValue(-.5*t,0),this.vehicle.setSteeringValue(-.5*t,1)}},{key:"getVelocity",value:function(){return this.vehicle.getCurrentSpeedKmHour()}}]),t}(),U=8e3,X=200,q=function(){function t(){Object(c.a)(this,t)}return Object(u.a)(t,[{key:"changeValueInRPMCurve",value:function(t,e,n,s){var i;e?i=2*(t-n/U):i=1.5*-t;return(s+=i)>600?s=600:s<0&&(s=0),[n=U*(1-Math.exp(-s/X)),s]}}]),t}(),Z=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"accelerate",value:function(t,e,n){return this.changeValueInRPMCurve(0,!0,e,n)}},{key:"brake",value:function(t,e,n){return this.changeValueInRPMCurve(t,!1,e,n)}}]),n}(q),J=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"accelerate",value:function(t,e,n){return this.changeValueInRPMCurve(t,!0,e,n)}},{key:"brake",value:function(t,e,n){return this.changeValueInRPMCurve(t,!1,e,n)}}]),n}(q),Y=function(){function t(){Object(c.a)(this,t),this.engineState=new Z,this.currentRPM=0,this.currentXInRPMCurve=0}return Object(u.a)(t,[{key:"turnOn",value:function(){this.engineState=new J}},{key:"clutchIsPressed",value:function(t){return t<=.25}},{key:"handleEngineShutdown",value:function(t,e){e.shutDownEngine(t,this.currentRPM)&&this.engineState instanceof J&&(this.engineState=new Z)}},{key:"isInConditionToAccelerate",value:function(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)||this.clutchIsPressed(t)}},{key:"engineCanApplyForce",value:function(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)}},{key:"accelerate",value:function(t,e,n){var s=this.engineState.accelerate(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=s[0],this.currentXInRPMCurve=s[1],this.handleEngineShutdown(t,n)}},{key:"brake",value:function(t,e,n){var s=this.engineState.brake(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=s[0],this.currentXInRPMCurve=s[1],this.handleEngineShutdown(t,n)}},{key:"changeRPM",value:function(t){this.currentRPM=t,-this.currentRPM/U+1>0?(this.currentXInRPMCurve=-Math.log(-this.currentRPM/U+1)*X,this.currentXInRPMCurve<0&&(this.currentXInRPMCurve=0)):this.currentRPM===U&&(this.currentXInRPMCurve=600)}},{key:"getCurrentRPM",value:function(){return this.currentRPM}}]),t}(),Q=function(){function t(e){Object(c.a)(this,t),this.NEUTRAL=0,this.REVERSE=-1,this.FIRST=1,this.SECOND=2,this.THIRD=3,this.FOURTH=4,this.FIFTH=5,this.SIXTH=6,this.validShifts=[this.REVERSE,this.NEUTRAL,this.FIRST,this.SECOND,this.THIRD,this.FOURTH,this.FIFTH,this.SIXTH],this.currentShift=this.NEUTRAL,this.carEngine=e,this.minimumVelocityOnShift=[0,10,20,35,60,90],this.maximumVelocityOnShift=[40,60,80,110,140,200]}return Object(u.a)(t,[{key:"isValidShift",value:function(t){if(this.validShifts.indexOf(t)>=0)return!0;throw new Error("Shift "+t+" is not valid.")}},{key:"calculateNormalFactorRPM",value:function(t,e){return(e-this.minimumVelocityOnShift[Math.abs(t)-1])/(this.maximumVelocityOnShift[Math.abs(t)-1]-this.minimumVelocityOnShift[Math.abs(t)-1])}},{key:"getValueForNewRPM",value:function(t,e){if(t===this.NEUTRAL||Math.abs(t)===this.FIRST&&Math.abs(e)<5)return this.carEngine.getCurrentRPM();if(t===this.REVERSE&&e>0)return 0;if(t>0&&e<0)return 0;var n=this.calculateNormalFactorRPM(t,e);if(n>1)return U;var s=n*X;return U*(1-Math.exp(-s/X))}},{key:"clutchIsPressed",value:function(t){return t<=-.75}},{key:"shutDownEngine",value:function(){return!1}},{key:"getEngineForce",value:function(t,e){t=Math.abs(t);var n=this.carEngine.getCurrentRPM();if(this.currentShift===this.NEUTRAL)return 0;var s=(e+1)/2,i=this.minimumVelocityOnShift[Math.abs(this.currentShift)-1]*(1-Math.exp(3*-s)),r=(t-i)/(this.maximumVelocityOnShift[Math.abs(this.currentShift)-1]-i),a=Math.pow(1-r,2);return a>1&&(a=0),6/this.currentShift*n*a}},{key:"changeShift",value:function(){}},{key:"getCurrentShift",value:function(){return this.currentShift}}]),t}(),K=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"changeShift",value:function(t,e,n){if(!this.isValidShift(e)||!this.clutchIsPressed(t))throw new Error("Can't change shift if clutch is not pressed");this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,n,t))}},{key:"shutDownEngine",value:function(t,e){return!this.clutchIsPressed(t)&&e<1e3}}]),n}(Q),$=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"changeShift",value:function(t,e,n){this.isValidShift(e)&&(this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,n,t)))}}]),n}(Q),tt=[0,1,0],et=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this)).carEngine=new Y,s.shiftBox=new $(s.carEngine),s.currentDirectionTurn=0,s.currentTireRotation=0,s.position=new b.Db(tt[0],tt[1],tt[2]),s.rotationQuaternion=new b.Eb(0,0,0,1),s.mass=1e3,s.physicsShape=new b.Db(2,1.3,5),s.rotation=new b.Eb(0,0,0,1),s.inertia=new b.Db(1,0,1),s.carPhysics=new z(s.position,s.rotationQuaternion,s.inertia,s.mass,s.physicsShape,t,0),s.carPhysics.buildAmmoPhysics(),s}return Object(u.a)(n,[{key:"accelerate",value:function(t,e){this.carEngine.accelerate(t,e,this.shiftBox),e>.1&&this.carEngine.engineCanApplyForce(t)?this.carPhysics.setEngineForce(this.shiftBox.getEngineForce(this.carPhysics.getVelocity(),t)):this.carPhysics.setEngineForce(0)}},{key:"brake",value:function(t,e){this.carEngine.brake(t,e,this.shiftBox),this.carPhysics.brake(300*e)}},{key:"changeShift",value:function(t,e){this.shiftBox.changeShift(t,e,this.carPhysics.getVelocity())}},{key:"turnOnRightLight",value:function(){}},{key:"turnOnLeftLight",value:function(){}},{key:"turnOnCar",value:function(){this.carEngine.turnOn()}},{key:"turnDirection",value:function(t){this.currentTireRotation=t,this.carPhysics.setSteeringRotation(t)}},{key:"update",value:function(){var t=this.carPhysics.updatePhysics();this.position=t.chassis.position,this.rotation=t.chassis.rotation,this.wheelsData=t.wheels,Object(W.a)(Object(_.a)(n.prototype),"notifyObservers",this).call(this,this.getDataToAnimate())}},{key:"getLastRotation",value:function(){return this.currentTireRotation}},{key:"getDataToAnimate",value:function(){return{direction:this.currentDirectionTurn,velocity:this.carPhysics.getVelocity(),lastRotationWheel:this.currentTireRotation,position:this.position,rotation:this.rotation,physicsBody:this.carPhysics,wheelsData:this.wheelsData,rpm:this.getCurrentRPM()}}},{key:"getSpeed",value:function(){return this.carPhysics.getVelocity()}},{key:"getCurrentRPM",value:function(){return this.carEngine.getCurrentRPM()}},{key:"changeShiftBox",value:function(t){"semi-auto"===t?this.shiftBox=new $(this.carEngine):"manual"===t&&(this.shiftBox=new K(this.carEngine))}},{key:"getCurrentShift",value:function(){return this.shiftBox.getCurrentShift()}}]),n}(G),nt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t,s,i,r,a,o,h){var u;return Object(c.a)(this,n),(u=e.call(this)).position=t,u.quaternion=s,u.inertia=i,u.mass=r,u.shape=a,u.physicsWorld=o,h||(h=1),u.friction=h,u}return Object(u.a)(n,[{key:"generateShape",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"buildAmmoPhysics",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n,s,i,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:return e=t.sent,this.inertia=new e.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=e,(n=new e.btTransform).setIdentity(),n.setOrigin(new e.btVector3(this.position.x,this.position.y,this.position.z)),n.setRotation(new e.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new e.btTransform,s=new e.btDefaultMotionState(n),t.next=13,this.generateShape();case 13:(i=t.sent).setMargin(.05),i.calculateLocalInertia(this.mass,this.inertia),r=new e.btRigidBodyConstructionInfo(this.mass,s,i,this.inertia),this.rigidBody=new e.btRigidBody(r),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(2*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.mass>0&&this.rigidBody.setActivationState(4);case 22:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updatePhysics",value:function(){var t=this.rigidBody.getMotionState();if(t){t.getWorldTransform(this.tempTransform);var e=this.tempTransform.getOrigin(),n=this.tempTransform.getRotation(),s={position:new b.Db(e.x(),e.y(),e.z()),rotation:new b.Eb(n.x(),n.y(),n.z(),n.w())};return this.notifyObservers(s),s}throw new Error("No motion state found in rigid body")}},{key:"setLinearVelocity",value:function(t){var e=new this.Ammo.btVector3(this.mass*t.x,this.mass*t.y,this.mass*t.z);this.rigidBody.applyForce(e)}},{key:"getRigidBody",value:function(){return this.rigidBody}}]),n}(G),st=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"generateShape",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:return e=t.sent,t.abrupt("return",new e.btBoxShape(new e.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2)));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),n}(nt),it=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this,t)).pathToTexture=t,s.RADIUS_TOP=.1,s.RADIUS_BOTTOM=.8,s.HEIGHT=1.25,s.observedState=null,s}return Object(u.a)(n,[{key:"animate",value:function(){null!=this.observedState&&(this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w))}},{key:"addToScene",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s,i){var r,a,h,c,u,l,d;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.threeDModel||(r=new b.l(this.RADIUS_TOP,this.RADIUS_BOTTOM,this.HEIGHT,32,void 0,!0),a=(new b.xb).load(this.pathToTexture),h=new b.Q({map:a}),c=new b.Q({color:13984548}),u=new b.e(2*this.RADIUS_BOTTOM,.1,2*this.RADIUS_BOTTOM),(l=new b.P(u,c)).position.set(0,-this.HEIGHT/2,0),(d=new b.P(r,h)).position.set(0,0,0),this.threeDModel=new b.u,this.threeDModel.add(d).add(l),this.threeDModel.name=n,this.threeDModel.position.set(s[0],s[1],s[2]),this.threeDModel.scale.set(i[0],i[1],i[2]),this.RADIUS_TOP*=i[0],this.RADIUS_BOTTOM*=i[0],this.HEIGHT*=i[1],e.add(this.threeDModel)),t.abrupt("return",this);case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,s,i){return t.apply(this,arguments)}}()}]),n}(y),rt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"generateShape",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:return e=t.sent,t.abrupt("return",new e.btCylinderShape(new e.btVector3(this.shape.x,this.shape.y,this.shape.z)));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),n}(nt),at=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(t){var s;return Object(c.a)(this,n),(s=e.call(this,t)).pathToTexture=t,s.pathToNormalMap="textures/pavimento_map.png",s.SIZE=30,s.SIDEWALK_HEIGHT=.4,s.observedState=null,s}return Object(u.a)(n,[{key:"animate",value:function(){null!=this.observedState&&(this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w))}},{key:"createSidewalkMesh",value:function(t){var e=(new b.xb).load("textures/pavimento.jpg");e.wrapS=b.kb,e.wrapT=b.kb,e.repeat.set(3,2*t);var n=(new b.xb).load(this.pathToNormalMap);n.repeat.set(3,2*t),n.wrapS=b.kb,n.wrapT=b.kb;var s=new b.U({map:e,side:b.n});s.normalMap=n;var i=new b.e(7*this.SIZE/24,this.SIDEWALK_HEIGHT,this.SIZE);return new b.P(i,s)}},{key:"createStreetMesh",value:function(t){var e=new b.e(10*this.SIZE/24,.1,this.SIZE),n=(new b.xb).load(this.pathToTexture);n.repeat.set(1,2*t),n.wrapS=b.kb,n.wrapT=b.kb;var s=(new b.xb).load(this.pathToNormalMap);s.repeat.set(1,2*t),s.wrapS=b.kb,s.wrapT=b.kb;var i=new b.U({map:n,side:b.n});return i.normalMap=s,new b.P(e,i)}},{key:"loadBuildingBlock",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n,s;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P.getInstance();case 2:return n=t.sent,t.next=5,n["building_".concat(e)];case 5:return s=t.sent,t.abrupt("return",s.clone());case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"createBuildings",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n){var s,i;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadBuildingBlock(1+parseInt(4*Math.random()));case 2:return(s=t.sent).name="buildingsRight_"+n,s.position.x=e[0]+10*this.SIZE/24,s.position.y=e[1]+this.SIDEWALK_HEIGHT+.05,s.position.z=e[2]-this.LONG/2+4+7*n,s.scale.x=.8,s.scale.y=1,s.scale.z=.6,s.rotateOnAxis(new b.Db(0,1,0),-Math.PI/2),s.updateMatrix(),s.updateMatrixWorld(),s.matrixAutoUpdate=!1,t.next=16,this.loadBuildingBlock(1+parseInt(4*Math.random()));case 16:(i=t.sent).name="buildingsLeft_"+n,i.position.x=e[0]-10*this.SIZE/24,i.position.y=e[1]+this.SIDEWALK_HEIGHT+.05,i.position.z=e[2]-this.LONG/2+4+7*n,i.scale.x=.8,i.scale.y=1,i.scale.z=.6,i.rotateOnAxis(new b.Db(0,1,0),Math.PI/2),i.updateMatrix(),i.updateMatrixWorld(),i.matrixAutoUpdate=!1,this.threeDModel.add(s,i);case 29:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"addToScene",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s,i){var r,a,h,c;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.threeDModel){for(r=this.createStreetMesh(i),a=this.createSidewalkMesh(i),h=this.createSidewalkMesh(i),r.position.set(0,0,0),a.position.set(-8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0),h.position.set(8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0),this.threeDModel=new b.u,this.threeDModel.add(r).add(a).add(h),c=0;c<4*i;c++)this.createBuildings(s,c);this.threeDModel.name=n,this.threeDModel.position.set(s[0],s[1],s[2]),r.scale.set(1,1,i),a.scale.set(1,1,i),h.scale.set(1,1,i),r.updateMatrix(),r.updateMatrixWorld(),r.matrixAutoUpdate=!1,a.updateMatrix(),a.updateMatrixWorld(),a.matrixAutoUpdate=!1,h.updateMatrix(),h.updateMatrixWorld(),h.matrixAutoUpdate=!1,this.threeDModel.matrixAutoUpdate=!1,this.LONG=this.SIZE*i,e.add(this.threeDModel)}return t.abrupt("return",this);case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,s,i){return t.apply(this,arguments)}}()}]),n}(y),ot=function(){function t(e,n){Object(c.a)(this,t),this.scene=e,this.physicsWorld=n,this.physicsToUpdate=[],this.objectsToAnimate=[]}return Object(u.a)(t,[{key:"updatePhysics",value:function(){this.physicsToUpdate.forEach((function(t){t.updatePhysics()}))}},{key:"animate",value:function(){this.objectsToAnimate.forEach((function(t){t.animate()}))}},{key:"createRectangle",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s,i,r,a,h){var c,u,l,d,p,f,v,g,m=arguments;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=m.length>7&&void 0!==m[7]?m[7]:null,(u=(new b.xb).load(a)).wrapS=b.kb,u.wrapT=b.kb,u.repeat.set(n,i),l=new b.U({map:u,side:b.n}),c&&((d=(new b.xb).load(c)).repeat.set(n,i),d.wrapS=b.kb,d.wrapT=b.kb,l.normalMap=d,l.normalScale.set(10,10)),(p=new b.e(n,s,i)).rotateX(r),(f=new b.ib).setFromAxisAngle(new b.Db(1,0,0),r),v=new st(new b.Db(e[0],e[1],e[2]),f,new h.btVector3(0,0,0),0,new b.Db(n,s,i),this.physicsWorld,1e3),t.next=14,v.buildAmmoPhysics();case 14:this.physicsToUpdate.push(v),(g=new b.P(p,l)).position.set(e[0],e[1],e[2]),this.scene.add(g);case 18:case"end":return t.stop()}}),t,this)})));return function(e,n,s,i,r,a,o){return t.apply(this,arguments)}}()},{key:"createCone",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n){var s,i;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(s=new it("textures/coneTexture.jpg")).addToScene(this.scene,"trafficCone",e,[.5,.5,.5]),i=new rt(new b.Db(e[0],e[1],e[2]),(new b.ib).setFromAxisAngle(new b.Db(1,0,0),0),new n.btVector3(0,0,0),10,new b.Db(s.RADIUS_BOTTOM,s.HEIGHT/2,s.RADIUS_BOTTOM),this.physicsWorld,1e3),t.next=5,i.buildAmmoPhysics();case 5:this.physicsToUpdate.push(i),i.attachObserver(s),this.objectsToAnimate.push(s);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"buildStreetPhysics",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s){var i,r,a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new st(new b.Db(e[0],e[1],e[2]),(new b.ib).setFromAxisAngle(new b.Db(1,0,0),0),new s.btVector3(0,0,0),0,new b.Db(n.SIZE,.1,n.LONG),this.physicsWorld,1e3),t.next=3,i.buildAmmoPhysics();case 3:return r=new st(new b.Db(e[0]-8.4*n.SIZE/24,e[1]+n.SIDEWALK_HEIGHT/2,e[2]),(new b.ib).setFromAxisAngle(new b.Db(1,0,0),0),new s.btVector3(0,0,0),0,new b.Db(7*n.SIZE/24,n.SIDEWALK_HEIGHT,n.LONG),this.physicsWorld,1e3),t.next=6,r.buildAmmoPhysics();case 6:return a=new st(new b.Db(e[0]+8.4*n.SIZE/24,e[1]+n.SIDEWALK_HEIGHT/2,e[2]),(new b.ib).setFromAxisAngle(new b.Db(1,0,0),0),new s.btVector3(0,0,0),0,new b.Db(7*n.SIZE/24,n.SIDEWALK_HEIGHT,n.LONG),this.physicsWorld,1e3),t.next=9,a.buildAmmoPhysics();case 9:i.attachObserver(n),this.physicsToUpdate.push(i),this.physicsToUpdate.push(r),this.physicsToUpdate.push(a);case 13:case"end":return t.stop()}}),t,this)})));return function(e,n,s){return t.apply(this,arguments)}}()},{key:"createStreet",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(e,n,s,i){var r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new at("textures/road.jpg"),t.next=3,r.addToScene(this.scene,"street",e,i);case 3:return t.next=5,this.buildStreetPhysics(e,r,s);case 5:this.objectsToAnimate.push(r);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n,s,i){return t.apply(this,arguments)}}()},{key:"createLevel0",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:e=t.sent,this.createRectangle([10,0,10],10,2,10,-Math.PI/8,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createRectangle([-10,0,10],10,2,10,-Math.PI/4,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createRectangle([0,0,0],100,.1,100,0,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createCone([0,.5,10],e),this.createCone([0,.5,30],e),this.createCone([0,.5,20],e);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"createLevelCustom",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:e=t.sent,this.createStreet([0,0,0],0,e,20);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),ht=function(){function t(){Object(c.a)(this,t)}return Object(u.a)(t,null,[{key:"createButton",value:function(e){var n=document.createElement("button");function s(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function i(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(i){i?function(){var t=null;function s(t){return i.apply(this,arguments)}function i(){return(i=Object(h.a)(Object(o.a)().mark((function s(i){return Object(o.a)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i.addEventListener("end",r),s.next=3,e.xr.setSession(i);case 3:n.textContent="EXIT VR",t=i;case 5:case"end":return s.stop()}}),s)})))).apply(this,arguments)}function r(){t.removeEventListener("end",r),n.textContent="ENTER VR",t=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=function(){null===t?(navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(s),localStorage.setItem("VR",!0)):t.end()}}():(s(),n.textContent="VR NOT SUPPORTED"),i&&t.xrSessionIsGranted&&n.click()})).catch((function(t){s(),console.warn("Exception when trying to call xr.isSessionSupported",t),n.textContent="VR NOT ALLOWED"})),n;var r=document.createElement("a");return!1===window.isSecureContext?(r.href=document.location.href.replace(/^http:/,"https:"),r.innerHTML="WEBXR NEEDS HTTPS"):(r.href="https://immersiveweb.dev/",r.innerHTML="WEBXR NOT AVAILABLE"),r.style.left="calc(50% - 90px)",r.style.width="180px",r.style.textDecoration="none",i(r),r}},{key:"registerSessionGrantedListener",value:function(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(function(){t.xrSessionIsGranted=!0}))}}}]),t}();ht.xrSessionIsGranted=!1,ht.registerSessionGrantedListener();var ct=n(205),ut=n.n(ct),lt=n(2),dt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){var t;return Object(c.a)(this,n),(t=e.call(this)).state={currentRPM:0,velocity:0,currentShift:0},t.physicsToUpdate=[],localStorage.setItem("VR",!1),t.gotAnyEvent=!1,t.stats=new ut.a,t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.objectsToAnimate=[],this.scene=new b.lb,this.renderer=new b.Hb({alpha:!0,powerPreference:"high-performance",antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(8900346,1),this.camera=new f(this.renderer),this.camera.addContainerToScene(this.scene),this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.clock=new b.i,t.next=12,this.createAmmo();case 12:return this.ambientLight=new b.a(16777215,1),this.scene.add(this.ambientLight),this.sunLight=new b.m(16777215,1),this.sunLight.position.set(0,100,0),this.scene.add(this.sunLight),this.level=new ot(this.scene,this.physicsWorld),t.next=20,this.level.createLevelCustom();case 20:return this.physicsToUpdate.push(this.level),this.objectsToAnimate.push(this.level),this.carLogic=new et(this.physicsWorld),e=new T,this.carLogic.attachObserver(e),this.carLogic.attachObserver(this.camera),t.t0=this.objectsToAnimate,t.next=29,e.addToScene(this.scene);case 29:t.t1=t.sent,t.t0.push.call(t.t0,t.t1),this.carLogic.notifyObservers(),this.animation=this.animation.bind(this),this.handleWindowResize=this.handleWindowResize.bind(this),this.generateEvents=this.generateEvents.bind(this),this.generateEvents(),this.mount.appendChild(this.renderer.domElement),this.renderer.setAnimationLoop(this.animation),document.body.appendChild(ht.createButton(this.renderer)),this.renderer.xr.enabled=!0;case 40:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"generateEvents",value:function(){var t=this;window.addEventListener("resize",this.handleWindowResize),window.addEventListener("gamepaddisconnected",(function(t){C.removeInstance()})),document.addEventListener("keydown",(function(e){var n=e.key;switch(t.carLogic.removeObserver(t.camera),n){case"1":t.camera=new f(t.renderer),t.camera.addContainerToScene(t.scene);break;case"2":t.camera=new m(t.renderer);break;case"3":t.camera=new v(new b.Db(-4.35,.6,-.1));break;case"4":t.camera=new v(new b.Db(4.35,.6,-.1));break;case"5":t.camera=new v(new b.Db(0,3,-5))}t.carLogic.attachObserver(t.camera),t.carLogic.notifyObservers()}),!1)}},{key:"createAmmo",value:function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n,s,i,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.getInstance();case 2:e=t.sent,this.tempTransform=new e.btTransform,n=new e.btDefaultCollisionConfiguration,s=new e.btCollisionDispatcher(n),i=new e.btDbvtBroadphase,r=new e.btSequentialImpulseConstraintSolver,this.physicsWorld=new e.btDiscreteDynamicsWorld(s,i,r,n),this.physicsWorld.setGravity(new e.btVector3(0,-9.8,0));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleWindowResize",value:function(){this.camera.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera.getCameraInstance())}},{key:"animation",value:function(){this.stats.begin();var t=this.clock.getDelta();this.physicsWorld.stepSimulation(t,10),this.objectsToAnimate.forEach((function(t){t.animate()})),this.physicsToUpdate.forEach((function(t){t.updatePhysics()})),this.camera.setPositionRelativeToObject(),H.getInstance(this.carLogic).checkEvents(),this.setState({velocity:this.carLogic.getSpeed(),currentRPM:this.carLogic.getCurrentRPM(),currentShift:this.carLogic.getCurrentShift()}),this.renderer.render(this.scene,this.camera.getCameraInstance()),console.log("drawCalls:",this.renderer.info.render.calls),this.stats.end()}},{key:"render",value:function(){var t=this;return Object(lt.jsxs)("div",{style:{width:"100vw"},children:[Object(lt.jsx)("div",{style:{position:"absolute",top:"10px",right:"10px",color:"red",width:"175px"},id:"Acelerador",children:Object(lt.jsxs)("p",{style:{zIndex:20,display:"float",fontWeight:"bold"},children:["Cambio Actual: ",parseInt(this.state.currentShift)]})}),Object(lt.jsx)("div",{ref:function(e){t.mount=e}})]})}}]),n}(s.Component),bt=n(19),pt={width:"100vw",height:"100vh",backgroundImage:'url("DrivingSimMenuNoTitle.png")',backgroundSize:"cover",backgroundRepeat:"no-repeat"},ft=function(){var t=Object(bt.m)();return Object(lt.jsx)(lt.Fragment,{children:Object(lt.jsx)("div",{style:pt,children:Object(lt.jsxs)("div",{id:"button-box",style:{position:"absolute",top:"5%",right:"5%"},children:[Object(lt.jsx)("div",{className:"MainMenuTitle",children:Object(lt.jsxs)("h1",{style:{textAlign:"center",fontSize:"7rem"},children:["Driving",Object(lt.jsx)("br",{}),"Simulator"]})}),Object(lt.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(lt.jsx)("button",{className:"buttonMainMenu",onClick:function(){return t("/scene")},children:"Iniciar"})}),Object(lt.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(lt.jsx)("button",{className:"buttonMainMenu",onClick:function(){return t("/level-editor")},children:"Editor de Niveles"})}),Object(lt.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(lt.jsx)("button",{className:"buttonMainMenu",onClick:function(){return t("/configs")},children:"Configuraci\xf3n"})})]})})})},vt=n(20),gt=n(12),mt=n(398),jt=n(43),wt=n(392),yt=n(14),xt=n(393),Ot=n(397),St=n(209),Pt=n.n(St),kt=function(t){var e=t.openConfigs,n=t.handleDrawerClose,s=i.a.useState(!1),r=Object(gt.a)(s,2),a=r[0],o=r[1];i.a.useEffect((function(){o(e)}),[e]);var h=Object(yt.a)("div")((function(t){var e=t.theme;return Object(jt.a)(Object(jt.a)({display:"flex",alignItems:"center",width:"100%",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-start"})}));return Object(lt.jsx)(lt.Fragment,{children:Object(lt.jsx)(wt.a,{children:Object(lt.jsxs)(xt.a,{sx:{width:window.innerWidth/6,flexShrink:0,"& .MuiDrawer-paper":{width:window.innerWidth/6,boxSizing:"border-box"}},variant:"persistent",anchor:"right",open:a,children:[Object(lt.jsxs)(h,{className:"drawer-header",onClick:n,children:[Object(lt.jsx)(Pt.a,{}),Object(lt.jsx)("div",{style:{width:"100%"},children:Object(lt.jsx)("h3",{style:{textAlign:"right",paddingRight:30},children:"Configurations"})})]}),Object(lt.jsx)(Ot.a,{})]})})})},Rt=n(210),Mt=n.n(Rt),Dt=Object(s.createContext)(),Tt={cone:null,trapecio:null,street:null},At=function(t){var e=t.openItems,n=t.handleDrawerClose,s=i.a.useState(!1),r=Object(gt.a)(s,2),a=r[0],o=r[1],h=i.a.useContext(Dt),c=h.setLastSelectedItem,u=h.lastSelectedItem;i.a.useEffect((function(){o(e)}),[e]);var l=Object(yt.a)("div")((function(t){var e=t.theme;return Object(jt.a)(Object(jt.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"})})),d=i.a.useState(Tt),b=Object(gt.a)(d,2),p=b[0],f=b[1];return Object(lt.jsx)(lt.Fragment,{children:Object(lt.jsx)(wt.a,{children:Object(lt.jsxs)(xt.a,{sx:{width:window.innerWidth/6,flexShrink:0,"& .MuiDrawer-paper":{width:window.innerWidth/6,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:a,children:[Object(lt.jsxs)(l,{onClick:n,className:"drawer-header",children:[Object(lt.jsx)("div",{style:{width:"100%"},children:Object(lt.jsx)("h3",{style:{textAlign:"left",paddingLeft:10},children:"Items"})}),Object(lt.jsx)(Mt.a,{})]}),Object(lt.jsx)(Ot.a,{}),Object(lt.jsx)(wt.a,{style:{justifyContent:"center",display:"flex",alignItems:"center",flexDirection:"column"},children:Object.entries(p).map((function(t){var e=Object(gt.a)(t,2),n=e[0],s=e[1];return Object(lt.jsx)("img",{alt:"".concat(n),src:"".concat(n,".png"),width:75,height:75,className:"imageLevelEditor ".concat(s),onClick:function(){return function(t){var e=Object(jt.a)({},Tt);e[t]="selected",f(e),c({selectedItem:t,scale:1,positionX:0,positionY:0,zIndex:u?u.zIndex+1:1})}(n)}},n)}))})]})})})},It=n(213),Ct=n.n(It),Et=n(212),Lt=n.n(Et),Bt=n(395),Ht=function(t){var e=t.setGridDimensions,n=t.gridDimensions,i=Object(s.useState)(n.width),r=Object(gt.a)(i,2),a=r[0],o=r[1],h=Object(s.useState)(n.height),c=Object(gt.a)(h,2),u=c[0],l=c[1];return Object(lt.jsxs)(wt.a,{container:!0,direction:"row",width:"80%",marginLeft:"10%",justifyContent:"space-evenly",alignItems:"center",spacing:2,children:[Object(lt.jsxs)(wt.a,{item:!0,xs:2,children:[Object(lt.jsx)("p",{children:"Ancho:"}),Object(lt.jsx)("input",{value:a,type:"number",step:"1",onChange:function(t){var e=parseInt(t.target.value.replaceAll(",","").replaceAll(".",""));o(e>40?40:e)}})]}),Object(lt.jsx)(wt.a,{item:!0,xs:2,children:Object(lt.jsxs)("div",{children:[Object(lt.jsx)("p",{children:"Alto:"}),Object(lt.jsx)("input",{value:u,type:"number",step:"1",onChange:function(t){var e=parseInt(t.target.value.replaceAll(",","").replaceAll(".",""));l(e>40?40:e)}})]})}),Object(lt.jsx)(wt.a,{item:!0,xs:2,children:Object(lt.jsx)(Bt.a,{variant:"contained",onClick:function(){e({width:a,height:u})},children:"Actualizar"})})]})},Wt=n(211),_t=n.n(Wt),Gt=30,Nt=function(){function t(e,n,s){Object(c.a)(this,t);var i=e[1][2].filled,r=e[0][1].filled,a=e[2][1].filled,o=e[1][0].filled;this.rotation=this.determineStreetRotation(r,o,a,i),this.long=[Gt,Gt],this.position=[n*Gt+15,s*Gt+15]}return Object(u.a)(t,[{key:"isStraight",value:function(){return!1}},{key:"determineStreetRotation",value:function(){}},{key:"getAsJSON",value:function(){return{position_x:this.position[0],position_y:this.position[1],rotation:this.rotation,long_x:this.long[0],long_y:this.long[1]}}},{key:"getPositionAsRowAndColumn",value:function(){return[(this.position[0]-15)/Gt,(this.position[1]-15)/Gt]}},{key:"getPositionX",value:function(){return this.position[0]}},{key:"getPositionY",value:function(){return this.position[1]}},{key:"getLongX",value:function(){return this.long[0]}},{key:"getLongY",value:function(){return this.long[1]}}],[{key:"isValidNinePerNineGrid",value:function(t){}},{key:"sumValueForCell",value:function(t){return t.filled?1:0}},{key:"calculateNeighboursFilled",value:function(e){var n=0,s=0;return[n+=t.sumValueForCell(e[1][0])+t.sumValueForCell(e[1][2]),s+=t.sumValueForCell(e[0][1])+t.sumValueForCell(e[2][1])]}}]),t}(),Vt={TOP_TO_LEFT:0,LEFT_TO_BOT:Math.PI/2,BOT_TO_RIGHT:Math.PI,RIGHT_TO_TOP:3*Math.PI/2},Ft=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"determineStreetRotation",value:function(t,e,n,s){return t&&e?Vt.TOP_TO_LEFT:e&&n?Vt.LEFT_TO_BOT:n&&s?Vt.BOT_TO_RIGHT:s&&t?Vt.RIGHT_TO_TOP:void 0}},{key:"getAsJSON",value:function(){var t=Object(W.a)(Object(_.a)(n.prototype),"getAsJSON",this).call(this);return t.type="CURVE",t}}],[{key:"isValidNinePerNineGrid",value:function(t){var e=Nt.calculateNeighboursFilled(t),n=Object(gt.a)(e,2),s=n[0],i=n[1];return 1===s&&1===i}}]),n}(Nt),zt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"determineStreetRotation",value:function(){return 0}},{key:"getAsJSON",value:function(){var t=Object(W.a)(Object(_.a)(n.prototype),"getAsJSON",this).call(this);return t.type="INTERSECTION",t}}],[{key:"isValidNinePerNineGrid",value:function(t){var e=Nt.calculateNeighboursFilled(t),n=Object(gt.a)(e,2),s=n[0];return 2===n[1]&&2===s}}]),n}(Nt),Ut={HORIZONTAL:0,VERTICAL:Math.PI/2},Xt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"determineStreetRotation",value:function(t,e,n,s){return t&&n?Ut.VERTICAL:e&&s?Ut.HORIZONTAL:void 0}},{key:"isStraight",value:function(){return!0}},{key:"getAsJSON",value:function(){var t=Object(W.a)(Object(_.a)(n.prototype),"getAsJSON",this).call(this);return t.type="STRAIGHT",t}},{key:"isHorizontal",value:function(){return this.rotation===Ut.HORIZONTAL}}],[{key:"isValidNinePerNineGrid",value:function(t){var e=Nt.calculateNeighboursFilled(t),n=Object(gt.a)(e,2),s=n[0],i=n[1];return 2===i&&0===s||0===i&&2===s}}]),n}(Nt),qt={TOP_SINGLE:0,LEFT_SINGLE:Math.PI/2,BOT_SINGLE:Math.PI,RIGHT_SINGLE:3*Math.PI/2},Zt=function(t){Object(l.a)(n,t);var e=Object(d.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"determineStreetRotation",value:function(t,e,n,s){return t&&e&&s?qt.TOP_SINGLE:e&&n&&t?qt.LEFT_SINGLE:n&&s&&e?qt.BOT_SINGLE:s&&t&&n?qt.RIGHT_SINGLE:void 0}},{key:"getAsJSON",value:function(){var t=Object(W.a)(Object(_.a)(n.prototype),"getAsJSON",this).call(this);return t.type="T_STREET",t}}],[{key:"isValidNinePerNineGrid",value:function(t){var e=Nt.calculateNeighboursFilled(t),n=Object(gt.a)(e,2),s=n[0],i=n[1];return 2===i&&1===s||1===i&&2===s}}]),n}(Nt),Jt=function(){function t(e){Object(c.a)(this,t),this.sections=this.segregateSections(e),this.sectionsAsJSON=this.linkSections()}return Object(u.a)(t,[{key:"segregateSections",value:function(t){for(var e={},n={},s=[],i=0;i<t.length;i++){var r=t[i].getPositionAsRowAndColumn(),a=Object(gt.a)(r,2),o=a[0],h=a[1];t[i].isHorizontal()?(o in e||(e[o]=[]),e[o].push({idx:h,street:t[i]})):(h in n||(n[h]=[]),n[h].push({idx:o,street:t[i]}))}for(var c=0,u=Object.entries(e);c<u.length;c++){var l=Object(gt.a)(u[c],2)[1];s=[].concat(Object(vt.a)(s),Object(vt.a)(this.generateArraySubsections(l)))}for(var d=0,b=Object.entries(n);d<b.length;d++){var p=Object(gt.a)(b[d],2)[1];s=[].concat(Object(vt.a)(s),Object(vt.a)(this.generateArraySubsections(p)))}return s}},{key:"generateArraySubsections",value:function(t){for(var e=[],n=0;n<t.length;n++)0===n||t[n].idx-t[n-1].idx>1?e.push([t[n].street]):e[e.length-1].push(t[n].street);return e}},{key:"linkSections",value:function(){for(var t=[],e=0;e<this.sections.length;e++){console.log(this.sections[e]);var n={position_x:this.sections[e].reduce((function(t,e){return t+e.getPositionX()}),0)/this.sections[e].length,position_y:this.sections[e].reduce((function(t,e){return t+e.getPositionY()}),0)/this.sections[e].length,rotation:this.sections[e][0].rotation,long_x:this.sections[e][0].isHorizontal()?this.sections[e].reduce((function(t,e){return t+e.getLongX()}),0):this.sections[e][0].getLongX(),long_y:this.sections[e][0].isHorizontal()?this.sections[e][0].getLongY():this.sections[e].reduce((function(t,e){return t+e.getLongY()}),0),type:"STRAIGHT"};t.push(n)}return t}},{key:"getSectionsAsJSON",value:function(){return this.sectionsAsJSON}}]),t}(),Yt=[Xt,Ft,Zt,zt],Qt=function(){function t(e,n){Object(c.a)(this,t),this.levelGrid=e,this.getNinePerNineGrid=n?this.getNinePerNineGridInfinite:this.getNinePerNineGridFinite}return Object(u.a)(t,[{key:"constructStreets",value:function(){for(var t=[],e=[],n=0;n<this.levelGrid.length;n++)for(var s=0;s<this.levelGrid[n].length;s++){if(this.levelGrid[n][s].filled){var i=this.defineTypeOfStreet(n,s);i.isStraight()?t.push(i):e.push(i)}}var r=this.linkStraightStreets(t),a=e.map((function(t){return t.getAsJSON()}));return[].concat(Object(vt.a)(a),Object(vt.a)(r))}},{key:"getNinePerNineGridInfinite",value:function(t,e){for(var n=[],s=t-1;s<=t+1;s++){for(var i=[],r=s<0?this.levelGrid.length-1:s%this.levelGrid.length,a=e-1;a<=e+1;a++){var o=a<0?this.levelGrid[r].length-1:a%this.levelGrid[r].length;i.push(this.levelGrid[r][o])}n.push(i)}return n}},{key:"getNinePerNineGridFinite",value:function(t,e){for(var n=[],s={filled:!1},i=t-1;i<=t+1;i++)if(i<0||i===this.levelGrid.length)n.push([s,s,s]);else{for(var r=[],a=e-1;a<=e+1;a++)a<0||a===this.levelGrid[i].length?r.push(s):r.push(this.levelGrid[i][a]);n.push(r)}return n}},{key:"defineTypeOfStreet",value:function(t,e){for(var n=this.getNinePerNineGrid(t,e),s=!1,i=void 0,r=0;r<Yt.length&&!s;r++)s=Yt[r].isValidNinePerNineGrid(n),i=Yt[r];if(!s)throw new Error("No se pudo definir el tipo de calle dentro de los tipos validos.");return new i(n,this.levelGrid.length-1-t,e)}},{key:"linkStraightStreets",value:function(t){return new Jt(t).getSectionsAsJSON()}}]),t}();function Kt(t,e,n){for(var s=0,i=e-1;i<=e+1&&i<t.length;i++)i>=0&&i!==e&&(s+=t[i][n].filled?1:0);for(var r=n-1;r<=n+1&&r<t[e].length;r++)r>=0&&r!==n&&(s+=t[e][r].filled?1:0);return s}function $t(t,e){return e?void 0:function(t){for(var e=!0,n=[],s=0;s<t.length;s++)for(var i=0;i<t[s].length;i++)t[s][i].filled&&Kt(t,s,i)<=1&&(e=!1,n.push([s,i]));return{valid:e,wrongCells:n}}(t)}var te="darkgray",ee="white",ne="orange",se=function(t){var e=t.gridDimensions,n=Object(s.useState)([]),i=Object(gt.a)(n,2),r=i[0],a=i[1],o=Object(s.useState)(!1),h=Object(gt.a)(o,2),c=h[0],u=h[1],l=Object(s.useState)(!1),d=Object(gt.a)(l,2),b=d[0],p=d[1];Object(s.useEffect)((function(){for(var t=[],n=0;n<e.height;n++){for(var s=[],i=0;i<e.width;i++){var r={filled:!1,div_color:ee};s.push(r)}t.push(s)}a(t)}),[e.width,e.height]),Object(s.useEffect)((function(){window.addEventListener("mouseup",(function(t){t.preventDefault(),0===t.button?u(!1):2===t.button&&p(!1)})),window.addEventListener("contextmenu",(function(t){t.preventDefault()}))}),[]);var f=function(t,e){if(!e||!t)return!1;for(var n=0;n<t.length;n++){for(var s=!0,i=0;i<t[n].length;i++)try{t[n][i]!==e[i]&&(s=!1)}catch(r){i=t[n].length,s=!1}if(s)return!0}return!1};return Object(lt.jsxs)("div",{style:{width:600,height:600,marginTop:25,marginLeft:"auto",marginRight:"auto"},onMouseDown:function(t){t.preventDefault(),0===t.button?u(!0):2===t.button&&p(!0)},children:[r.map((function(t,n){return Object(lt.jsx)("div",{className:"row-level-grid",id:"row_".concat(n),style:{width:"100%",height:600/e.height,display:"flex",flexDirection:"row"},children:t.map((function(t,s){return Object(lt.jsx)("div",{className:"cell-level-grid",id:"cell_".concat(n,"_").concat(s),style:{backgroundColor:t.div_color,width:"".concat(100/e.width,"%"),height:"100%",border:"1px solid black"},onMouseMove:function(t){t.preventDefault(),function(t,e){if(c){var n=Object(vt.a)(r);n[t][e].filled=!0,n[t][e].div_color=te,a(n)}else if(b){var s=Object(vt.a)(r);s[t][e].filled=!1,s[t][e].div_color=ee,a(s)}}(n,s)},onMouseUp:function(t){!function(t,e,n){if(0===n){var s=Object(vt.a)(r);s[t][e].filled=!0,s[t][e].div_color=te,a(s)}else if(2===n){var i=Object(vt.a)(r);i[t][e].filled=!1,i[t][e].div_color=ee,a(i)}}(n,s,t.button)}},"cell_".concat(n,"_").concat(s))}))},"row_".concat(n))})),Object(lt.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:40},children:Object(lt.jsxs)(Bt.a,{variant:"contained",onClick:function(){for(var t=$t(r),e=Object(vt.a)(r),n=0;n<r.length;n++)for(var s=0;s<r[n].length;s++)e[n][s].filled&&(e[n][s].div_color=f(t.wrongCells,[n,s])?ne:te);a(e),t.valid&&function(t,e){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",e+".json"),document.body.appendChild(s),s.click(),s.remove()}(function(t){return{streets:new Qt(t).constructStreets()}}(r),"Driving_Simulator_Custom_Level.json")},color:"success",children:[Object(lt.jsx)(_t.a,{})," Procesar nivel..."]})})]})},ie=function(){var t=Object(s.useState)(!1),e=Object(gt.a)(t,2),n=e[0],r=e[1],a=Object(s.useState)(!1),o=Object(gt.a)(a,2),h=o[0],c=o[1],u=Object(s.useState)([]),l=Object(gt.a)(u,2),d=l[0],b=l[1],p=Object(s.useState)(null),f=Object(gt.a)(p,2),v=f[0],g=f[1],m=Object(s.useState)({width:20,height:20}),j=Object(gt.a)(m,2),w=j[0],y=j[1];return i.a.useEffect((function(){null!==v&&b((function(t){return[].concat(Object(vt.a)(t),[v])}))}),[v]),Object(lt.jsx)(lt.Fragment,{children:Object(lt.jsxs)(Dt.Provider,{value:{lastSelectedItem:v,setLastSelectedItem:g},children:[Object(lt.jsxs)("div",{children:[Object(lt.jsxs)("div",{style:{flexDirection:"row",justifyContent:"space-between",display:"flex"},children:[Object(lt.jsx)(mt.a,{onClick:function(){return r(!0)},style:{height:40,margin:10},className:"header",children:Object(lt.jsx)(Lt.a,{})}),Object(lt.jsx)("h1",{children:"Driving Simulator - Level Editor"}),Object(lt.jsx)(mt.a,{onClick:function(){return c(!0)},style:{height:40,margin:10},className:"header",children:Object(lt.jsx)(Ct.a,{})})]}),Object(lt.jsxs)("div",{children:[Object(lt.jsx)(Ht,{setGridDimensions:y,gridDimensions:w}),Object(lt.jsx)(se,{gridDimensions:w}),d.map((function(t,e){return Object(lt.jsx)("span",{},e)}))]})]}),Object(lt.jsx)(At,{openItems:n,handleDrawerClose:function(){r(!1)}}),Object(lt.jsx)(kt,{openConfigs:h,handleDrawerClose:function(){c(!1)}})]})})},re=n(56),ae="http://localhost:8001",oe=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,he=Object(s.createContext)(void 0),ce=n(389),ue=n(386),le=n(390),de=n(105),be=n(384),pe=n(385),fe=n(240).createHash,ve=function(t){return fe("sha256").update(t).digest("hex")},ge=function(){var t=Object(bt.m)(),e=i.a.useState(""),n=Object(gt.a)(e,2),r=n[0],a=n[1],c=i.a.useState(""),u=Object(gt.a)(c,2),l=u[0],d=u[1],b=i.a.useState(!1),p=Object(gt.a)(b,2),f=p[0],v=p[1],g=i.a.useState(void 0),m=Object(gt.a)(g,2),j=m[0],w=m[1],y=function(){var t=Object(s.useContext)(he),e=t.session,n=t.setSession;return{setSessionWithResponse:function(t){n({user:t.user,jwt:t.jwt})},getUser:function(){return e.user?e.user:void 0},getJWT:function(){return e.jwt?e.jwt:void 0}}}().setSessionWithResponse,x=function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,n,s,i;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("".concat(ae,"/users/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,password:ve(l)})});case 3:if(200===(e=t.sent).status){t.next=11;break}return t.next=7,e.json();case 7:throw n=t.sent,s=n.detail[0].msg?n.detail[0].msg:n.detail,i=e.status+" - "+e.statusText+" - "+s,new Error(i);case 11:return t.abrupt("return",e.json());case 14:throw t.prev=14,t.t0=t.catch(0),new Error(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),O=function(){var t=[];return""===l&&t.push("El campo contrase\xf1a se encuentra vac\xedo."),""===r&&t.push("El campo email se encuentra vac\xedo"),r.match(oe)||t.push("El email establecido es inv\xe1lido."),!(t.length>0)||(w(t),!1)},S=function(){var e=Object(h.a)(Object(o.a)().mark((function e(n){var s;return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),O()){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,x();case 6:s=e.sent,y(s),t("/"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),w([e.t0.toString().replaceAll("Error: ","")]);case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),P=function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n,s,i,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(ae,"/users/login_google"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});case 2:if(200===(n=t.sent).status){t.next=10;break}return t.next=6,n.json();case 6:throw s=t.sent,i=s.detail[0].msg?s.detail[0].msg:s.detail,r=n.status+" - "+n.statusText+" - "+i,new Error(r);case 10:return t.abrupt("return",n.json());case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,P(e);case 3:n=t.sent,y(n),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),w([t.t0.toString().replaceAll("Error: ","")]);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();return Object(lt.jsx)("form",{onSubmit:S,children:Object(lt.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column",textAlign:"center",margin:"auto",marginTop:40,padding:30,border:"2px solid black",borderRadius:20,maxWidth:400},children:[j&&Object(lt.jsxs)(ce.a,{severity:"error",style:{textAlign:"justify"},onClose:function(){return w(void 0)},children:["Han ocurrido los siguientes errores:",Object(lt.jsx)("ul",{children:j.map((function(t,e){return Object(lt.jsx)("li",{children:t},e)}))})]}),Object(lt.jsx)("h1",{children:"Iniciar Sesi\xf3n"}),Object(lt.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(lt.jsx)("img",{src:"logo_transp.png",width:"25%",alt:"Driving Simulator Logo"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:"text",onChange:function(t){return a(t.target.value)},value:r,name:"email",label:"E-Mail"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:f?"text":"password",onChange:function(t){return d(t.target.value)},value:l,name:"password",label:"Contrase\xf1a",InputProps:{endAdornment:Object(lt.jsx)(le.a,{position:"end",children:Object(lt.jsx)(mt.a,{"aria-label":"toggle password visibility",onClick:function(){return v(!f)},children:f?Object(lt.jsx)(be.a,{}):Object(lt.jsx)(pe.a,{})})})}})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(Bt.a,{variant:"contained",type:"submit",children:"Iniciar Sesi\xf3n"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(re.b,{to:"/signup",children:"\xbfNo posees una cuenta? Registrate aqu\xed..."})}),Object(lt.jsx)("div",{style:{marginTop:20,display:"flex",justifyContent:"center",textAlign:"center",alignContent:"center"},children:Object(lt.jsx)(de.a,{onSuccess:function(t){var e=t.credential;k(e)},onError:function(){w(["El inicio de sesi\xf3n con Google ha fallado."])}})})]})})},me=function(){var t=i.a.useState(""),e=Object(gt.a)(t,2),n=e[0],s=e[1],r=i.a.useState(""),a=Object(gt.a)(r,2),c=a[0],u=a[1],l=i.a.useState(""),d=Object(gt.a)(l,2),b=d[0],p=d[1],f=i.a.useState(""),v=Object(gt.a)(f,2),g=v[0],m=v[1],j=i.a.useState(!1),w=Object(gt.a)(j,2),y=w[0],x=w[1],O=i.a.useState(void 0),S=Object(gt.a)(O,2),P=S[0],k=S[1],R=function(){var t=[];return""!==n&&""!==c&&""!==b&&""!==g||t.push("A\xfan existen campos sin completar."),c!==b&&t.push("Las contrase\xf1as establecidas no coinciden."),c.length<8&&t.push("La contrase\xf1a debe tener una longitud m\xednima de 8 caracteres."),n.match(oe)||t.push("El email establecido es inv\xe1lido."),t.length>0?(k(t),!1):(k(void 0),!0)},M=function(){var t=Object(h.a)(Object(o.a)().mark((function t(){var e,s,i,r,a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="".concat(ae,"/users/register"),t.prev=1,t.next=4,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:ve(c),name_to_show:g})});case 4:if(200===(s=t.sent).status){t.next=12;break}return t.next=8,s.json();case 8:throw i=t.sent,r=i.detail[0].msg?i.detail[0].msg:i.detail,a=s.status+" - "+s.statusText+" - "+r,new Error(a);case 12:return t.abrupt("return",s.json());case 15:throw t.prev=15,t.t0=t.catch(1),new Error(t.t0);case 18:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(){return t.apply(this,arguments)}}(),D=function(){var t=Object(h.a)(Object(o.a)().mark((function t(e){var n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),R()){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,M();case 5:n=t.sent,console.log(n);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(lt.jsx)("form",{onSubmit:D,children:Object(lt.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column",textAlign:"center",margin:"auto",marginTop:40,padding:30,border:"2px solid black",borderRadius:20,maxWidth:400},children:[P&&Object(lt.jsxs)(ce.a,{severity:"error",style:{textAlign:"justify"},onClose:function(){return k(void 0)},children:["Han ocurrido los siguientes errores:",Object(lt.jsx)("ul",{children:P.map((function(t,e){return Object(lt.jsx)("li",{children:t},e)}))})]}),Object(lt.jsx)("h1",{children:"Crea tu cuenta"}),Object(lt.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(lt.jsx)("img",{src:"logo_transp.png",width:"25%",alt:"Driving Simulator Logo"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:"text",onChange:function(t){return s(t.target.value)},value:n,name:"email",label:"E-Mail"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:"text",onChange:function(t){return m(t.target.value)},value:g,name:"username",label:"Nombre para mostrar"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:y?"text":"password",onChange:function(t){return u(t.target.value)},value:c,name:"password",label:"Contrase\xf1a",InputProps:{endAdornment:Object(lt.jsx)(le.a,{position:"end",children:Object(lt.jsx)(mt.a,{"aria-label":"toggle password visibility",onClick:function(){return x(!y)},children:y?Object(lt.jsx)(be.a,{}):Object(lt.jsx)(pe.a,{})})})}})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(ue.a,{style:{width:"80%"},type:y?"text":"password",onChange:function(t){return p(t.target.value)},value:b,name:"passwordConfirmation",label:"Repetir Contrase\xf1a"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(Bt.a,{variant:"contained",type:"submit",children:"CREAR CUENTA"})}),Object(lt.jsx)("div",{style:{marginTop:20},children:Object(lt.jsx)(re.b,{to:"/login",children:"\xbfYa poses una cuenta? Inicia sesi\xf3n..."})})]})})},je=function(t){var e=t.childElement,n=Object(s.useState)({user:void 0,jwt:void 0}),i=Object(gt.a)(n,2),r=i[0],a=i[1];return Object(lt.jsx)(de.b,{clientId:"18785041157-s9ga39r0i6up45radtj3soo6je1pneon.apps.googleusercontent.com",children:Object(lt.jsx)(he.Provider,{value:{session:r,setSession:a},children:e})})};var we=function(){return Object(s.useEffect)((function(){document.title="Driving Simulator"}),[]),Object(lt.jsx)(je,{childElement:Object(lt.jsx)(re.a,{children:Object(lt.jsxs)(bt.c,{children:[Object(lt.jsx)(bt.a,{exact:!0,path:"/scene",element:Object(lt.jsx)(dt,{})}),Object(lt.jsx)(bt.a,{exact:!0,path:"/",element:Object(lt.jsx)(ft,{})}),Object(lt.jsx)(bt.a,{exact:!0,path:"/level-editor",element:Object(lt.jsx)(ie,{})}),Object(lt.jsx)(bt.a,{exact:!0,path:"/login",element:Object(lt.jsx)(ge,{})}),Object(lt.jsx)(bt.a,{exact:!0,path:"/signup",element:Object(lt.jsx)(me,{})})]})})})};a.a.createRoot(document.getElementById("root")).render(Object(lt.jsx)(we,{}))}},[[337,1,2]]]);
//# sourceMappingURL=main.1d15c19d.chunk.js.map