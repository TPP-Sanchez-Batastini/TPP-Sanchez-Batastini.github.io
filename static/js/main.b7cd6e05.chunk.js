/*! For license information please see main.b7cd6e05.chunk.js.LICENSE.txt */
(this["webpackJsonptpp-driving-simulator"]=this["webpackJsonptpp-driving-simulator"]||[]).push([[0],{122:function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return i}));class i{constructor(t){this.car=t}handleAccelerate(t,e){this.car.accelerate(t,e)}handleBrake(t,e){this.car.brake(t,e)}changeShift(t,e){this.car.changeShift(t,e)}turnDirection(t){this.car.turnDirection(t)}turnOnCar(){this.car.turnOnCar()}updateCar(){this.car.update()}changeShiftBox(t){this.car.changeShiftBox(t)}}},211:function(t,e,s){},222:function(t,e){},224:function(t,e){},235:function(t,e){},237:function(t,e){},262:function(t,e){},264:function(t,e){},265:function(t,e){},270:function(t,e){},272:function(t,e){},278:function(t,e){},280:function(t,e){},299:function(t,e){},311:function(t,e){},314:function(t,e){},318:function(t,e,s){"use strict";s.r(e);var i=s(0),n=s.n(i),o=s(177),a=s.n(o),r=(s(211),s(1));class h{constructor(){this.observedState=null}update(t){this.observedState=t}}class d extends h{constructor(t){super(),this.camera=new r.hb(85,window.innerWidth/window.innerHeight,.1,1e3),this.group=new r.fb,this.group180Rot=(new r.fb).add(this.camera),this.group.add(this.group180Rot),this.renderer=t}handleResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}setPositionRelativeToObject(){const t=new r.Ib(.4,.6,-.1);if(null!=this.observedState)if(t.applyQuaternion(this.observedState.rotation),this.group.position.copy(this.observedState.position).add(t),"true"===localStorage.getItem("VR")){let t=new r.Ib(0,-1.25,0);t.applyQuaternion(this.observedState.rotation),this.group.position.add(t),this.group.setRotationFromQuaternion(this.observedState.rotation),this.group180Rot.setRotationFromAxisAngle(new r.Ib(0,1,0),Math.PI),this.camera.lookAt(new r.Ib(0,0,5))}else{const t=new r.ob(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w).normalize();this.group180Rot.setRotationFromAxisAngle(new r.Ib(0,1,0),-5*Math.PI/180),this.group.quaternion.copy(t)}else this.camera.lookAt(new r.Ib(0,0,5))}getCameraInstance(){return this.camera}addContainerToScene(t){t.add(this.group)}}class l extends h{constructor(t){super(),this.positionCamera=t,this.camera=new r.hb(75,window.innerWidth/window.innerHeight,.1,100)}handleResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}setPositionRelativeToObject(){const t=new r.Ib(this.positionCamera.x,this.positionCamera.y,this.positionCamera.z);if(null!=this.observedState){let e=t.applyQuaternion(this.observedState.rotation);this.camera.position.copy(this.observedState.position).add(e);let s=new r.Ib(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z);this.camera.lookAt(s)}else this.camera.lookAt(new r.Ib(0,0,0)),this.camera.position.copy(t)}getCameraInstance(){return this.camera}}var c=s(178);class u extends h{constructor(t){super(),this.camera=new r.hb(75,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=t,this.controls=new c.a(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.enableZoom=!0,this.camera.position.set(0,5.5,0)}handleResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}getCameraInstance(){return this.camera}setPositionRelativeToObject(){this.controls.update(),null!=this.observedState?this.camera.lookAt(this.observedState.position):this.camera.lookAt(new r.Ib(0,0,0))}}var p=s(190),b=s(85);class g extends h{constructor(t){super(),this.fbxLoader=new p.a,this.gltfLoader=new b.a,this.threeDModel=null,this.pathToTexture=t}async loadFBX(){let t=this.pathToTexture;return await this.fbxLoader.loadAsync(t,(function(t){return t}))}async loadGLTF(){let t=this.pathToTexture;return await this.gltfLoader.loadAsync(t,(function(t){return t}))}async addToScene(t,e,s,i){if(!this.threeDModel){let o;try{o=await this.loadFBX(),this.threeDModel=o}catch(n){o=await this.loadGLTF(),this.threeDModel=o.scene}this.threeDModel.name=e,this.threeDModel.position.x=s[0],this.threeDModel.position.y=s[1],this.threeDModel.position.z=s[2],this.threeDModel.scale.x=i[0],this.threeDModel.scale.y=i[1],this.threeDModel.scale.z=i[2],t.add(this.threeDModel)}return this}getModel(){return this.threeDModel}animate(){return null}}var m=s(87);class w{constructor(){this.gltfLoader=new b.a,this.carModel=null,this.building_1=null,this.building_2=null,this.building_3=null,this.building_4=null}changeMaterialsToBasic(t){for(let e=0;e<t.length;e++){const s=t[e];s.isGroup?("W222Body"===s.name&&console.log(s.children),this.changeMaterialsToBasic(s.children)):s.isMesh&&(s.material=(new r.U).copy(s.material))}}async loadGLTF(t){let e=t;const s=await this.gltfLoader.loadAsync(e,(function(t){return t}));return this.changeMaterialsToBasic(s.scene.children),s.scene}async loadModels(){return this.carModel=this.loadGLTF("res/models/source/Mercedes.glb"),this.building_1=this.loadGLTF("res/models/source/buildings/Building_1.glb"),this.building_2=this.loadGLTF("res/models/source/buildings/Building_2.glb"),this.building_3=this.loadGLTF("res/models/source/buildings/Building_3.glb"),this.building_4=this.loadGLTF("res/models/source/buildings/Building_4.glb"),"OK"}}class S{static async getInstance(){if(S.ModelsSingleton)return S.ModelsSingleton;if(S.ModelsSingleton=new w,"OK"===await S.ModelsSingleton.loadModels())return S.ModelsSingleton;throw new Error("Error al cargar los modelos.")}}const f=[1,1,1],x=[0,0,0],v=.75,y=1/3600;class P extends g{constructor(){super("res/models/source/Mercedes.glb"),this.carModel=null,this.carLogic=null,this.lastValueRotation=0,this.currentSpeedRotation=0,this.currentWheelRotation=0,this.lastSteeringRotation=0,this.lastVelocityRotation=0,this.lastRPMRotation=0}generateRetrovisor(){const t=new r.jb(.145,.085),e=new m.a(t,{textureWidth:window.innerWidth,textureHeight:window.innerHeight,clipBias:.35,multisample:2});e.rotateX(Math.PI-.04),e.rotateY(.35),e.position.set(.075,.625,.31),this.threeDModel.add(e)}generateLeftMirror(){const t=new r.jb(.19,.1),e=new m.a(t,{textureWidth:window.innerWidth,textureHeight:window.innerHeight,clipBias:0,multisample:2});let s=new r.fb;s.add(e),s.position.set(.96,.345,.62),s.rotateX(.13-Math.PI),e.rotateY(-18*Math.PI/180),this.threeDModel.add(s)}generateRightMirror(){const t=new r.jb(.19,.1),e=new m.a(t,{textureWidth:window.innerWidth,textureHeight:window.innerHeight,clipBias:0,multisample:2});let s=new r.fb;s.add(e),s.position.set(-.96,.345,.62),s.rotateX(.1-Math.PI),e.rotateY(18*Math.PI/180),this.threeDModel.add(s)}generateMirrors(){this.generateRetrovisor(),this.generateLeftMirror(),this.generateRightMirror()}async addToScene(t){const e=await S.getInstance();return this.threeDModel=await e.carModel,this.threeDModel.name="driverCar",this.threeDModel.position.x=x[0],this.threeDModel.position.y=x[1],this.threeDModel.position.z=x[2],this.threeDModel.scale.x=f[0],this.threeDModel.scale.y=f[1],this.threeDModel.scale.z=f[2],t.add(this.threeDModel),this.generateMirrors(),this}animate(){this.moveCar()}addPhysicsView(t){this.physicsShape=new r.Ib(2,1.35,5);const e=new r.e(this.physicsShape.x,this.physicsShape.y,this.physicsShape.z),s=new r.U({color:255});this.PHYSICSSQUARE=new r.T(e,s),this.PHYSICSSQUARE.position.set(0,0,0),t.add(this.PHYSICSSQUARE);const i=new r.l(.35,.35,.35,32,32);i.rotateZ(Math.PI/2);const n=new r.U({color:16711680});this.wheelMesh1=new r.T(i,n),this.wheelMesh1.position.set(0,4,0),t.add(this.wheelMesh1),this.wheelMesh2=new r.T(i,n),this.wheelMesh2.position.set(0,4,0),t.add(this.wheelMesh2),this.wheelMesh3=new r.T(i,n),this.wheelMesh3.position.set(0,4,0),t.add(this.wheelMesh3),this.wheelMesh4=new r.T(i,n),this.wheelMesh4.position.set(0,4,0),t.add(this.wheelMesh4)}watchPhysicsColliders(){null!=this.observedState&&(this.PHYSICSSQUARE.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.PHYSICSSQUARE.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.wheelMesh1.position.set(this.observedState.wheelsData[0].position.x,this.observedState.wheelsData[0].position.y,this.observedState.wheelsData[0].position.z),this.wheelMesh1.quaternion.set(this.observedState.wheelsData[0].rotation.x,this.observedState.wheelsData[0].rotation.y,this.observedState.wheelsData[0].rotation.z,this.observedState.wheelsData[0].rotation.w),this.wheelMesh2.position.set(this.observedState.wheelsData[1].position.x,this.observedState.wheelsData[1].position.y,this.observedState.wheelsData[1].position.z),this.wheelMesh2.quaternion.set(this.observedState.wheelsData[1].rotation.x,this.observedState.wheelsData[1].rotation.y,this.observedState.wheelsData[1].rotation.z,this.observedState.wheelsData[1].rotation.w),this.wheelMesh3.position.set(this.observedState.wheelsData[2].position.x,this.observedState.wheelsData[2].position.y,this.observedState.wheelsData[2].position.z),this.wheelMesh3.quaternion.set(this.observedState.wheelsData[2].rotation.x,this.observedState.wheelsData[2].rotation.y,this.observedState.wheelsData[2].rotation.z,this.observedState.wheelsData[2].rotation.w),this.wheelMesh4.position.set(this.observedState.wheelsData[3].position.x,this.observedState.wheelsData[3].position.y,this.observedState.wheelsData[3].position.z),this.wheelMesh4.quaternion.set(this.observedState.wheelsData[3].rotation.x,this.observedState.wheelsData[3].rotation.y,this.observedState.wheelsData[3].rotation.z,this.observedState.wheelsData[3].rotation.w))}moveCar(){null!=this.observedState&&(this.threeDModel.userData.physicsBody=this.observedState.physicsBody,this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.lastValueRotation=this.observedState.direction,this.rotateWheels(),this.rotateSteeringWheel(),this.rotateVelocityAndRPM())}rotateSteeringWheel(){let t=this.threeDModel.children.find((t=>"Steering_Wheel"===t.name)),e=new r.Ib(0,0,1).applyAxisAngle(new r.Ib(1,0,0),.13);t.rotateOnAxis(e,this.lastSteeringRotation),t.rotateOnAxis(e,540*this.observedState.lastRotationWheel/360*Math.PI*2),this.lastSteeringRotation=540*-this.observedState.lastRotationWheel/360*Math.PI*2}rotateVelocityAndRPM(){let t=this.threeDModel.children.find((t=>"Cubo001"===t.name)),e=this.threeDModel.children.find((t=>"Cubo"===t.name));const s=-Math.abs(this.observedState.velocity)*(240*Math.PI/180)/240,i=-this.observedState.rpm*(260*Math.PI/180)/6e3;t.rotateOnAxis(new r.Ib(0,1,0),-this.lastVelocityRotation),t.rotateOnAxis(new r.Ib(0,1,0),s),e.rotateOnAxis(new r.Ib(0,1,0),-this.lastRPMRotation),e.rotateOnAxis(new r.Ib(0,1,0),i),this.lastVelocityRotation=s,this.lastRPMRotation=i}rotateWheels(){let t=this.threeDModel.children.find((t=>"W222WheelFtR"===t.name)),e=this.threeDModel.children.find((t=>"W222WheelFtL"===t.name)),s=this.threeDModel.children.find((t=>"W222WheelBkR"===t.name)),i=this.threeDModel.children.find((t=>"W222WheelBkL"===t.name)),n=new r.Ib(0,1,0).applyAxisAngle(new r.Ib(1,0,0),this.currentSpeedRotation),o=new r.Ib(0,1,0).applyAxisAngle(new r.Ib(1,0,0),-this.currentSpeedRotation);e.rotateOnAxis(o,this.currentWheelRotation),t.rotateOnAxis(n,this.currentWheelRotation),e.rotateX(this.observedState.velocity*y*4),t.rotateX(this.observedState.velocity*y*4),s.rotateX(this.observedState.velocity*y*4),i.rotateX(this.observedState.velocity*y*4),n=new r.Ib(0,1,0).applyAxisAngle(new r.Ib(1,0,0),this.currentSpeedRotation+this.observedState.velocity*y*4),o=new r.Ib(0,1,0).applyAxisAngle(new r.Ib(1,0,0),-this.currentSpeedRotation-this.observedState.velocity*y*4),e.rotateOnAxis(o,-this.observedState.lastRotationWheel*v),t.rotateOnAxis(n,-this.observedState.lastRotationWheel*v),this.currentWheelRotation=this.observedState.lastRotationWheel*v,this.currentSpeedRotation+=this.observedState.velocity*y*4,this.currentSpeedRotation>=2*Math.PI&&(this.currentSpeedRotation-=2*Math.PI)}}const{default:j}=s(122);class O{constructor(t){this.carLogic=t;const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(let s=0;s<e.length;s++)e[s]&&e[s].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=e[s]);this.buttonX=0,this.buttonSquare=1,this.buttonCircle=2,this.buttonTriangle=3,this.bumperRight=4,this.bumperLeft=5,this.buttonR2=6,this.buttonL2=7,this.shareButton=8,this.optionsButton=9,this.buttonR3=10,this.buttonL3=11,this.firstShift=12,this.secondShift=13,this.thirdShift=14,this.fourthShift=15,this.fifthShift=16,this.sixthShift=17,this.reverseShift=18,this.buttonPlus=19,this.buttonMinus=20,this.wheelInEnterRight=21,this.wheelInEnterLeft=22,this.enter=23,this.psButton=24,this.buttonsPressed=[];for(let s=0;s<=24;s++)this.buttonsPressed.push(!1);this.wheelAxes=0,this.clutch=1,this.accelerator=2,this.brake=5,this.DPad=9,this.valueDpadUP=-1,this.valueDpadDOWN=.14285719394683838,this.valueDpadLEFT=.7142857313156128,this.valueDpadRIGHT=-.4285714030265808,this.dpadPressed=[];for(let s=0;s<=3;s++)this.dpadPressed.push(!1);this.globalControllerHandler=new j(t)}checkGamepadChanges(){const t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=t[e])}checkEvents(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}doActionsPedals(){let t=this.gamepad.axes[this.clutch]**3,e=this.gamepad.axes[this.brake]**3;e=1-(e+1)/2;let s=this.gamepad.axes[this.accelerator]**3;s=1-(s+1)/2,this.globalControllerHandler.handleAccelerate(t,s),this.globalControllerHandler.handleBrake(t,e)}doActionsWheel(){this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes])}doActionsDPad(){if(1.2857143878936768!==this.gamepad.axes[this.DPad])this.gamepad.axes[this.DPad]!==this.valueDpadDOWN||this.dpadPressed[1]?this.gamepad.axes[this.DPad]!==this.valueDpadDOWN&&(this.dpadPressed[1]=!1):this.dpadPressed[1]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadLEFT||this.dpadPressed[2]?this.gamepad.axes[this.DPad]!==this.valueDpadLEFT&&(this.dpadPressed[2]=!1):this.dpadPressed[2]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT||this.dpadPressed[3]?this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT&&(this.dpadPressed[3]=!1):this.dpadPressed[3]=!0,this.gamepad.axes[this.DPad]!==this.valueDpadUP||this.dpadPressed[0]?this.gamepad.axes[this.DPad]!==this.valueDpadUP&&(this.dpadPressed[0]=!1):this.dpadPressed[0]=!0;else for(let t=0;t<this.dpadPressed.length;t++)this.dpadPressed[t]=!1}doActionsButtons(){this.gamepad.buttons[this.buttonX].pressed&&!this.buttonsPressed[this.buttonX]?this.buttonsPressed[this.buttonX]=!0:this.gamepad.buttons[this.buttonX].pressed||(this.buttonsPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonTriangle].pressed&&!this.buttonsPressed[this.buttonTriangle]?this.buttonsPressed[this.buttonTriangle]=!0:this.gamepad.buttons[this.buttonTriangle].pressed||(this.buttonsPressed[this.buttonTriangle]=!1),this.gamepad.buttons[this.buttonCircle].pressed&&!this.buttonsPressed[this.buttonCircle]?this.buttonsPressed[this.buttonCircle]=!0:this.gamepad.buttons[this.buttonCircle].pressed||(this.buttonsPressed[this.buttonCircle]=!1),this.gamepad.buttons[this.buttonSquare].pressed&&!this.buttonsPressed[this.buttonSquare]?this.buttonsPressed[this.buttonSquare]=!0:this.gamepad.buttons[this.buttonSquare].pressed||(this.buttonsPressed[this.buttonSquare]=!1),this.gamepad.buttons[this.psButton].pressed&&!this.buttonsPressed[this.psButton]?this.buttonsPressed[this.psButton]=!0:this.gamepad.buttons[this.psButton].pressed||(this.buttonsPressed[this.psButton]=!1),this.gamepad.buttons[this.buttonPlus].pressed&&!this.buttonsPressed[this.buttonPlus]?this.buttonsPressed[this.buttonPlus]=!0:this.gamepad.buttons[this.buttonPlus].pressed||(this.buttonsPressed[this.buttonPlus]=!1),this.gamepad.buttons[this.buttonMinus].pressed&&!this.buttonsPressed[this.buttonMinus]?this.buttonsPressed[this.buttonMinus]=!0:this.gamepad.buttons[this.buttonMinus].pressed||(this.buttonsPressed[this.buttonMinus]=!1),this.gamepad.buttons[this.buttonL2].pressed&&!this.buttonsPressed[this.buttonL2]?this.buttonsPressed[this.buttonL2]=!0:this.gamepad.buttons[this.buttonL2].pressed||(this.buttonsPressed[this.buttonL2]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonsPressed[this.buttonL3]?this.buttonsPressed[this.buttonL3]=!0:this.gamepad.buttons[this.buttonL3].pressed||(this.buttonsPressed[this.buttonL3]=!1),this.gamepad.buttons[this.buttonR2].pressed&&!this.buttonsPressed[this.buttonR2]?(this.globalControllerHandler.turnOnCar(),this.buttonsPressed[this.buttonR2]=!0):this.gamepad.buttons[this.buttonR2].pressed||(this.buttonsPressed[this.buttonR2]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonsPressed[this.buttonR3]?this.buttonsPressed[this.buttonR3]=!0:this.gamepad.buttons[this.buttonR3].pressed||(this.buttonsPressed[this.buttonR3]=!1),this.gamepad.buttons[this.enter].pressed&&!this.buttonsPressed[this.enter]?this.buttonsPressed[this.enter]=!0:this.gamepad.buttons[this.enter].pressed||(this.buttonsPressed[this.enter]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonsPressed[this.shareButton]?this.buttonsPressed[this.shareButton]=!0:this.gamepad.buttons[this.shareButton].pressed||(this.buttonsPressed[this.shareButton]=!1),this.gamepad.buttons[this.optionsButton].pressed&&!this.buttonsPressed[this.optionsButton]?this.buttonsPressed[this.optionsButton]=!0:this.gamepad.buttons[this.optionsButton].pressed||(this.buttonsPressed[this.optionsButton]=!1),this.gamepad.buttons[this.bumperLeft].pressed&&!this.buttonsPressed[this.bumperLeft]?this.buttonsPressed[this.bumperLeft]=!0:this.gamepad.buttons[this.bumperLeft].pressed||(this.buttonsPressed[this.bumperLeft]=!1),this.gamepad.buttons[this.bumperRight].pressed&&!this.buttonsPressed[this.bumperRight]?this.buttonsPressed[this.bumperRight]=!0:this.gamepad.buttons[this.bumperRight].pressed||(this.buttonsPressed[this.bumperRight]=!1),this.gamepad.buttons[this.wheelInEnterLeft].pressed&&!this.buttonsPressed[this.wheelInEnterLeft]?this.buttonsPressed[this.wheelInEnterLeft]=!0:this.gamepad.buttons[this.wheelInEnterLeft].pressed||(this.buttonsPressed[this.wheelInEnterLeft]=!1),this.gamepad.buttons[this.wheelInEnterRight].pressed&&!this.buttonsPressed[this.wheelInEnterRight]?this.buttonsPressed[this.wheelInEnterRight]=!0:this.gamepad.buttons[this.wheelInEnterRight].pressed||(this.buttonsPressed[this.wheelInEnterRight]=!1)}doActionsShifter(){this.gamepad.buttons[this.firstShift].pressed&&!this.buttonsPressed[this.firstShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],1),this.buttonsPressed[this.firstShift]=!0):!this.gamepad.buttons[this.firstShift].pressed&&this.buttonsPressed[this.firstShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.firstShift]=!1),this.gamepad.buttons[this.secondShift].pressed&&!this.buttonsPressed[this.secondShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],2),this.buttonsPressed[this.secondShift]=!0):!this.gamepad.buttons[this.secondShift].pressed&&this.buttonsPressed[this.secondShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.secondShift]=!1),this.gamepad.buttons[this.thirdShift].pressed&&!this.buttonsPressed[this.thirdShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],3),this.buttonsPressed[this.thirdShift]=!0):!this.gamepad.buttons[this.thirdShift].pressed&&this.buttonsPressed[this.thirdShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.thirdShift]=!1),this.gamepad.buttons[this.fourthShift].pressed&&!this.buttonsPressed[this.fourthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],4),this.buttonsPressed[this.fourthShift]=!0):!this.gamepad.buttons[this.fourthShift].pressed&&this.buttonsPressed[this.fourthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fourthShift]=!1),this.gamepad.buttons[this.fifthShift].pressed&&!this.buttonsPressed[this.fifthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],5),this.buttonsPressed[this.fifthShift]=!0):!this.gamepad.buttons[this.fifthShift].pressed&&this.buttonsPressed[this.fifthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fifthShift]=!1),this.gamepad.buttons[this.sixthShift].pressed&&!this.buttonsPressed[this.sixthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],6),this.buttonsPressed[this.sixthShift]=!0):!this.gamepad.buttons[this.sixthShift].pressed&&this.buttonsPressed[this.sixthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.sixthShift]=!1),this.gamepad.buttons[this.reverseShift].pressed&&!this.buttonsPressed[this.reverseShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],-1),this.buttonsPressed[this.reverseShift]=!0):!this.gamepad.buttons[this.reverseShift].pressed&&this.buttonsPressed[this.reverseShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.reverseShift]=!1)}doActionByMapping(){this.doActionsPedals(),this.doActionsWheel(),this.doActionsDPad(),this.doActionsButtons(),this.doActionsShifter()}}class R{constructor(){throw new Error("Can not construct singleton. Call get instance instead.")}static getInstance(t){return R.instance||(R.instance=new O(t)),R.instance}}const{default:I}=s(122),M=.1;class T{constructor(t){const e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(let s=0;s<e.length;s++)e[s]&&(e[s].id.startsWith("Xbox")||e[s].id.startsWith("xinput"))&&(this.gamepad=e[s]);this.buttonA=0,this.buttonB=1,this.buttonX=2,this.buttonY=3,this.buttonL1=4,this.buttonR1=5,this.buttonL2=6,this.buttonR2=7,this.shareButton=8,this.optionButton=9,this.buttonL3=10,this.buttonR3=11,this.padUp=12,this.padDown=13,this.padLeft=14,this.padRight=15,this.buttomHome=16,this.buttonPressed=[],this.actualShift=0;for(let s=0;s<=16;s++)this.buttonPressed.push(!1);this.xLeftAxe=0,this.yLeftAxe=1,this.xRightAxe=2,this.yRightAxe=3,this.globalControllerHandler=new I(t)}checkGamepadChanges(){const t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("Xbox")&&(this.gamepad=t[e])}checkEvents(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}doActionsAxes(){if(Math.abs(this.gamepad.axes[this.yLeftAxe]),Math.abs(this.gamepad.axes[this.xLeftAxe])>=M){let t=this.gamepad.axes[this.xLeftAxe]**3;this.globalControllerHandler.turnDirection(t)}else this.globalControllerHandler.turnDirection(0);Math.abs(this.gamepad.axes[this.yRightAxe]),Math.abs(this.gamepad.axes[this.xRightAxe])}doActionHotKeys(){this.globalControllerHandler.handleAccelerate(1,this.gamepad.buttons[this.buttonR2].value),this.globalControllerHandler.handleBrake(0,this.gamepad.buttons[this.buttonL2].value)}doActionsTriggers(){this.gamepad.buttons[this.buttonR2].pressed,this.gamepad.buttons[this.buttonL2].pressed}doActionsButtons(){this.gamepad.buttons[this.buttonR1].pressed&&!this.buttonPressed[this.buttonR1]?(this.actualShift<=5&&(this.actualShift+=1,this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonR1]=!0):this.gamepad.buttons[this.buttonR1].pressed||(this.buttonPressed[this.buttonR1]=!1),this.gamepad.buttons[this.buttonL1].pressed&&!this.buttonPressed[this.buttonL1]?(this.actualShift>=0&&(this.actualShift-=1,this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonL1]=!0):this.gamepad.buttons[this.buttonL1].pressed||(this.buttonPressed[this.buttonL1]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonPressed[this.shareButton]?this.buttonPressed[this.shareButton]=!0:this.gamepad.buttons[this.shareButton].pressed||(this.buttonPressed[this.shareButton]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?this.buttonPressed[this.padUp]=!0:this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?this.buttonPressed[this.padDown]=!0:this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?this.buttonPressed[this.padLeft]=!0:this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?this.buttonPressed[this.padRight]=!0:this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttonA].pressed&&!this.buttonPressed[this.buttonA]?this.buttonPressed[this.buttonA]=!0:this.gamepad.buttons[this.buttonA].pressed||(this.buttonPressed[this.buttonA]=!1),this.gamepad.buttons[this.buttonB].pressed&&!this.buttonPressed[this.buttonB]?this.buttonPressed[this.buttonB]=!0:this.gamepad.buttons[this.buttonB].pressed||(this.buttonPressed[this.buttonB]=!1),this.gamepad.buttons[this.buttonY].pressed&&!this.buttonPressed[this.buttonY]?this.buttonPressed[this.buttonY]=!0:this.gamepad.buttons[this.buttonY].pressed||(this.buttonPressed[this.buttonY]=!1),this.gamepad.buttons[this.buttonX].pressed&&!this.buttonPressed[this.buttonX]?this.buttonPressed[this.buttonX]=!0:this.gamepad.buttons[this.buttonX].pressed||(this.buttonPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonPressed[this.buttonR3]?this.buttonPressed[this.buttonR3]=!0:this.gamepad.buttons[this.buttonR3].pressed||(this.buttonPressed[this.buttonR3]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonPressed[this.buttonL3]?this.buttonPressed[this.buttonL3]=!0:this.gamepad.buttons[this.buttonL3].pressed||(this.buttonPressed[this.buttonL3]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?this.buttonPressed[this.padUp]=!0:this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?this.buttonPressed[this.padDown]=!0:this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?this.buttonPressed[this.padLeft]=!0:this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?this.buttonPressed[this.padRight]=!0:this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttomHome].pressed&&!this.buttonPressed[this.buttomHome]?(this.globalControllerHandler.changeShiftBox("semi-auto"),this.buttonPressed[this.buttomHome]=!0):this.gamepad.buttons[this.buttomHome].pressed||(this.buttonPressed[this.buttomHome]=!1),this.gamepad.buttons[this.optionButton].pressed&&!this.buttonPressed[this.optionButton]?(this.globalControllerHandler.turnOnCar(),this.buttonPressed[this.optionButton]=!0):this.gamepad.buttons[this.optionButton].pressed||(this.buttonPressed[this.optionButton]=!1)}doActionByMapping(){this.doActionHotKeys(),this.doActionsAxes(),this.doActionsTriggers(),this.doActionsButtons()}}class A{constructor(){throw new Error("Can not construct singleton. Call get instance instead.")}static getInstance(t){return A.instance||(A.instance=new T(t)),A.instance}}class C{constructor(){this.observers=[]}attachObserver(t){this.observers.push(t)}removeObserver(t){let e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)}notifyObservers(t){for(let e=0;e<this.observers.length;e++)this.observers[e].update(t)}}var D=s(179),E=s.n(D);class L{constructor(){throw new Error("Can not construct singleton. Call get instance instead.")}static async getInstance(){return L.AmmoInstanceToReturn||(L.AmmoInstanceToReturn=await E()()),L.AmmoInstanceToReturn}}L.AmmoInstanceToReturn=null;class B{constructor(t,e,s,i,n,o,a){this.position=t,this.quaternion=e,this.inertia=s,this.mass=i,this.shape=n,this.physicsWorld=o,this.friction=a}async buildAmmoPhysics(){let t=await L.getInstance();this.inertia=new t.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=t;let e=new t.btTransform;e.setIdentity(),e.setOrigin(new t.btVector3(this.position.x,this.position.y,this.position.z)),e.setRotation(new t.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new t.btTransform;let s=new t.btDefaultMotionState(e),i=new t.btBoxShape(new t.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2));i.calculateLocalInertia(this.mass,this.inertia);let n=new t.btRigidBodyConstructionInfo(this.mass,s,i,this.inertia);this.rigidBody=new t.btRigidBody(n),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(10*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.tuning=new this.Ammo.btVehicleTuning;var o=new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld);this.vehicle=new this.Ammo.btRaycastVehicle(this.tuning,this.rigidBody,o),this.vehicle.setCoordinateSystem(0,1,2),this.physicsWorld.addAction(this.vehicle);this.addWheel(!0,new this.Ammo.btVector3(.85,.2,1.65),.35,.35,0,1),this.addWheel(!0,new this.Ammo.btVector3(-.85,.2,1.65),.35,.35,1,-1),this.addWheel(!1,new this.Ammo.btVector3(.85,.2,-1.45),.35,.35,2,1),this.addWheel(!1,new this.Ammo.btVector3(-.85,.2,-1.45),.35,.35,3,-1),this.mass>0&&this.rigidBody.setActivationState(4)}addWheel(t,e,s,i,n,o){var a=new this.Ammo.btVector3(0,-1,0),r=new this.Ammo.btVector3(-1,0,0),h=this.vehicle.addWheel(e,a,r,.6,s,this.tuning,t);h.set_m_suspensionStiffness(2),h.set_m_wheelsDampingRelaxation(3.3),h.set_m_wheelsDampingCompression(4.4),h.set_m_frictionSlip(1e3),h.set_m_rollInfluence(.2)}updatePhysics(){let t={chassis:{position:null,rotation:null},wheels:[]};for(let n=0;n<this.vehicle.getNumWheels();n++){this.vehicle.updateWheelTransform(n,!0);let e=this.vehicle.getWheelTransformWS(n),s=e.getOrigin(),i=e.getRotation();t.wheels.push({position:new r.Ib(s.x(),s.y(),s.z()),rotation:new r.Jb(i.x(),i.y(),i.z(),i.w())})}let e=this.vehicle.getChassisWorldTransform(),s=e.getOrigin(),i=e.getRotation();return t.chassis={position:new r.Ib(s.x(),s.y(),s.z()),rotation:new r.Jb(i.x(),i.y(),i.z(),i.w())},t}getRigidBody(){return this.rigidBody}setEngineForce(t){this.vehicle.applyEngineForce(t,2),this.vehicle.applyEngineForce(t,3)}brake(t){let e=Math.abs(this.vehicle.getCurrentSpeedKmHour()),s=100/e;0===e&&(s=0),t+=s,this.vehicle.setBrake(t/2,0),this.vehicle.setBrake(t/2,1),this.vehicle.setBrake(t,2),this.vehicle.setBrake(t,3)}setSteeringRotation(t){this.vehicle.setSteeringValue(-.5*t,0),this.vehicle.setSteeringValue(-.5*t,1)}getVelocity(){return this.vehicle.getCurrentSpeedKmHour()}}const H=8e3,W=200;class G{changeValueInRPMCurve(t,e,s,i){let n;if(e){n=2*(t-s/H)}else n=1.5*-t;return(i+=n)>600?i=600:i<0&&(i=0),[s=H*(1-Math.exp(-i/W)),i]}}class N extends G{accelerate(t,e,s){return this.changeValueInRPMCurve(0,!0,e,s)}brake(t,e,s){return this.changeValueInRPMCurve(t,!1,e,s)}}class _ extends G{accelerate(t,e,s){return this.changeValueInRPMCurve(t,!0,e,s)}brake(t,e,s){return this.changeValueInRPMCurve(t,!1,e,s)}}class k{constructor(){this.engineState=new N,this.currentRPM=0,this.currentXInRPMCurve=0}turnOn(){this.engineState=new _}clutchIsPressed(t){return t<=.25}handleEngineShutdown(t,e){e.shutDownEngine(t,this.currentRPM)&&this.engineState instanceof _&&(this.engineState=new N)}isInConditionToAccelerate(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)||this.clutchIsPressed(t)}engineCanApplyForce(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)}accelerate(t,e,s){let i=this.engineState.accelerate(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=i[0],this.currentXInRPMCurve=i[1],this.handleEngineShutdown(t,s)}brake(t,e,s){let i=this.engineState.brake(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=i[0],this.currentXInRPMCurve=i[1],this.handleEngineShutdown(t,s)}changeRPM(t){this.currentRPM=t,-this.currentRPM/H+1>0?(this.currentXInRPMCurve=-Math.log(-this.currentRPM/H+1)*W,this.currentXInRPMCurve<0&&(this.currentXInRPMCurve=0)):this.currentRPM===H&&(this.currentXInRPMCurve=600)}getCurrentRPM(){return this.currentRPM}}class V{constructor(t){this.NEUTRAL=0,this.REVERSE=-1,this.FIRST=1,this.SECOND=2,this.THIRD=3,this.FOURTH=4,this.FIFTH=5,this.SIXTH=6,this.validShifts=[this.REVERSE,this.NEUTRAL,this.FIRST,this.SECOND,this.THIRD,this.FOURTH,this.FIFTH,this.SIXTH],this.currentShift=this.NEUTRAL,this.carEngine=t,this.minimumVelocityOnShift=[0,10,20,35,60,90],this.maximumVelocityOnShift=[40,60,80,110,140,200]}isValidShift(t){if(this.validShifts.indexOf(t)>=0)return!0;throw new Error("Shift "+t+" is not valid.")}calculateNormalFactorRPM(t,e){return(e-this.minimumVelocityOnShift[Math.abs(t)-1])/(this.maximumVelocityOnShift[Math.abs(t)-1]-this.minimumVelocityOnShift[Math.abs(t)-1])}getValueForNewRPM(t,e){if(t===this.NEUTRAL||Math.abs(t)===this.FIRST&&Math.abs(e)<5)return this.carEngine.getCurrentRPM();if(t===this.REVERSE&&e>0)return 0;if(t>0&&e<0)return 0;let s=this.calculateNormalFactorRPM(t,e);if(s>1)return H;{let t=s*W;return H*(1-Math.exp(-t/W))}}clutchIsPressed(t){return t<=-.75}shutDownEngine(){return!1}getEngineForce(t,e){t=Math.abs(t);let s=this.carEngine.getCurrentRPM();if(this.currentShift===this.NEUTRAL)return 0;let i=(e+1)/2,n=this.minimumVelocityOnShift[Math.abs(this.currentShift)-1]*(1-Math.exp(3*-i)),o=(1-(t-n)/(this.maximumVelocityOnShift[Math.abs(this.currentShift)-1]-n))**2;return o>1&&(o=0),6/this.currentShift*s*o}changeShift(){}getCurrentShift(){return this.currentShift}}class F extends V{changeShift(t,e,s){if(!this.isValidShift(e)||!this.clutchIsPressed(t))throw new Error("Can't change shift if clutch is not pressed");this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,s,t))}shutDownEngine(t,e){return!this.clutchIsPressed(t)&&e<1e3}}class z extends V{changeShift(t,e,s){this.isValidShift(e)&&(this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,s,t)))}}const U=[0,1,0];class X extends C{constructor(t){super(),this.carEngine=new k,this.shiftBox=new z(this.carEngine),this.currentDirectionTurn=0,this.currentTireRotation=0,this.position=new r.Ib(U[0],U[1],U[2]),this.rotationQuaternion=new r.Jb(0,0,0,1),this.mass=1e3,this.physicsShape=new r.Ib(2,1.3,5),this.rotation=new r.Jb(0,0,0,1),this.inertia=new r.Ib(1,0,1),this.carPhysics=new B(this.position,this.rotationQuaternion,this.inertia,this.mass,this.physicsShape,t,0),this.carPhysics.buildAmmoPhysics()}accelerate(t,e){this.carEngine.accelerate(t,e,this.shiftBox),e>.1&&this.carEngine.engineCanApplyForce(t)?this.carPhysics.setEngineForce(this.shiftBox.getEngineForce(this.carPhysics.getVelocity(),t)):this.carPhysics.setEngineForce(0)}brake(t,e){this.carEngine.brake(t,e,this.shiftBox),this.carPhysics.brake(300*e)}changeShift(t,e){this.shiftBox.changeShift(t,e,this.carPhysics.getVelocity())}turnOnRightLight(){}turnOnLeftLight(){}turnOnCar(){this.carEngine.turnOn()}turnDirection(t){this.currentTireRotation=t,this.carPhysics.setSteeringRotation(t)}update(){let t=this.carPhysics.updatePhysics();this.position=t.chassis.position,this.rotation=t.chassis.rotation,this.wheelsData=t.wheels,super.notifyObservers(this.getDataToAnimate())}getLastRotation(){return this.currentTireRotation}getDataToAnimate(){return{direction:this.currentDirectionTurn,velocity:this.carPhysics.getVelocity(),lastRotationWheel:this.currentTireRotation,position:this.position,rotation:this.rotation,physicsBody:this.carPhysics,wheelsData:this.wheelsData,rpm:this.getCurrentRPM()}}getSpeed(){return this.carPhysics.getVelocity()}getCurrentRPM(){return this.carEngine.getCurrentRPM()}changeShiftBox(t){"semi-auto"===t?this.shiftBox=new z(this.carEngine):"manual"===t&&(this.shiftBox=new F(this.carEngine))}getCurrentShift(){return this.shiftBox.getCurrentShift()}}class q extends C{constructor(t,e,s,i,n,o,a){super(),this.position=t,this.quaternion=e,this.inertia=s,this.mass=i,this.shape=n,this.physicsWorld=o,a||(a=1),this.friction=a}async generateShape(){return null}async buildAmmoPhysics(){let t=await L.getInstance();this.inertia=new t.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=t;let e=new t.btTransform;e.setIdentity(),e.setOrigin(new t.btVector3(this.position.x,this.position.y,this.position.z)),e.setRotation(new t.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new t.btTransform;let s=new t.btDefaultMotionState(e),i=await this.generateShape();i.setMargin(.05),i.calculateLocalInertia(this.mass,this.inertia);let n=new t.btRigidBodyConstructionInfo(this.mass,s,i,this.inertia);this.rigidBody=new t.btRigidBody(n),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(2*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.mass>0&&this.rigidBody.setActivationState(4)}updatePhysics(){let t=this.rigidBody.getMotionState();if(t){t.getWorldTransform(this.tempTransform);let e=this.tempTransform.getOrigin(),s=this.tempTransform.getRotation();const i={position:new r.Ib(e.x(),e.y(),e.z()),rotation:new r.Jb(s.x(),s.y(),s.z(),s.w())};return this.notifyObservers(i),i}throw new Error("No motion state found in rigid body")}setLinearVelocity(t){let e=new this.Ammo.btVector3(this.mass*t.x,this.mass*t.y,this.mass*t.z);this.rigidBody.applyForce(e)}getRigidBody(){return this.rigidBody}}class J extends q{async generateShape(){let t=await L.getInstance();return new t.btBoxShape(new t.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2))}}class Y extends g{constructor(t){super(t),this.pathToTexture=t,this.RADIUS_TOP=.1,this.RADIUS_BOTTOM=.8,this.HEIGHT=1.25,this.observedState=null}animate(){null!=this.observedState&&(this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w))}async addToScene(t,e,s,i){if(!this.threeDModel){const n=new r.l(this.RADIUS_TOP,this.RADIUS_BOTTOM,this.HEIGHT,32,void 0,!0),o=(new r.Bb).load(this.pathToTexture),a=new r.U({map:o}),h=new r.U({color:13984548}),d=new r.e(2*this.RADIUS_BOTTOM,.1,2*this.RADIUS_BOTTOM),l=new r.T(d,h);l.position.set(0,-this.HEIGHT/2,0);const c=new r.T(n,a);c.position.set(0,0,0),this.threeDModel=new r.u,this.threeDModel.add(c).add(l),this.threeDModel.name=e,this.threeDModel.position.set(s[0],s[1],s[2]),this.threeDModel.scale.set(i[0],i[1],i[2]),this.RADIUS_TOP*=i[0],this.RADIUS_BOTTOM*=i[0],this.HEIGHT*=i[1],t.add(this.threeDModel)}return this}}class Z extends q{async generateShape(){let t=await L.getInstance();return new t.btCylinderShape(new t.btVector3(this.shape.x,this.shape.y,this.shape.z))}}class K extends g{constructor(t){super(t),this.pathToTexture=t,this.pathToNormalMap="textures/pavimento_map.png",this.SIZE=30,this.SIDEWALK_HEIGHT=.4,this.observedState=null}animate(){null!=this.observedState&&(this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w))}createSidewalkMesh(t){const e=(new r.Bb).load("textures/pavimento.jpg");e.wrapS=r.qb,e.wrapT=r.qb,e.repeat.set(3,2*t);let s=(new r.Bb).load(this.pathToNormalMap);s.repeat.set(3,2*t),s.wrapS=r.qb,s.wrapT=r.qb;const i=new r.Y({map:e,side:r.n});i.normalMap=s;const n=new r.e(7*this.SIZE/24,this.SIDEWALK_HEIGHT,this.SIZE);return new r.T(n,i)}createStreetMesh(t){const e=new r.e(10*this.SIZE/24,.1,this.SIZE),s=(new r.Bb).load(this.pathToTexture);s.repeat.set(1,2*t),s.wrapS=r.qb,s.wrapT=r.qb;let i=(new r.Bb).load(this.pathToNormalMap);i.repeat.set(1,2*t),i.wrapS=r.qb,i.wrapT=r.qb;const n=new r.Y({map:s,side:r.n});return n.normalMap=i,new r.T(e,n)}async loadBuildingBlock(t){const e=await S.getInstance();return(await e[`building_${t}`]).clone()}async createBuildings(t,e){let s=await this.loadBuildingBlock(1+parseInt(4*Math.random()));s.name="buildingsRight_"+e,s.position.x=t[0]+10*this.SIZE/24,s.position.y=t[1]+this.SIDEWALK_HEIGHT+.05,s.position.z=t[2]-this.LONG/2+4+7*e,s.scale.x=.8,s.scale.y=1,s.scale.z=.6,s.rotateOnAxis(new r.Ib(0,1,0),-Math.PI/2),s.updateMatrix(),s.updateMatrixWorld(),s.matrixAutoUpdate=!1;let i=await this.loadBuildingBlock(1+parseInt(4*Math.random()));i.name="buildingsLeft_"+e,i.position.x=t[0]-10*this.SIZE/24,i.position.y=t[1]+this.SIDEWALK_HEIGHT+.05,i.position.z=t[2]-this.LONG/2+4+7*e,i.scale.x=.8,i.scale.y=1,i.scale.z=.6,i.rotateOnAxis(new r.Ib(0,1,0),Math.PI/2),i.updateMatrix(),i.updateMatrixWorld(),i.matrixAutoUpdate=!1,this.threeDModel.add(s,i)}async addToScene(t,e,s,i){if(!this.threeDModel){const n=this.createStreetMesh(i),o=this.createSidewalkMesh(i),a=this.createSidewalkMesh(i);n.position.set(0,0,0),o.position.set(-8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0),a.position.set(8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0),this.threeDModel=new r.u,this.threeDModel.add(n).add(o).add(a);for(let t=0;t<4*i;t++)this.createBuildings(s,t);this.threeDModel.name=e,this.threeDModel.position.set(s[0],s[1],s[2]),n.scale.set(1,1,i),o.scale.set(1,1,i),a.scale.set(1,1,i),n.updateMatrix(),n.updateMatrixWorld(),n.matrixAutoUpdate=!1,o.updateMatrix(),o.updateMatrixWorld(),o.matrixAutoUpdate=!1,a.updateMatrix(),a.updateMatrixWorld(),a.matrixAutoUpdate=!1,this.threeDModel.matrixAutoUpdate=!1,this.LONG=this.SIZE*i,t.add(this.threeDModel)}return this}}class ${constructor(t,e){this.scene=t,this.physicsWorld=e,this.physicsToUpdate=[],this.objectsToAnimate=[]}updatePhysics(){this.physicsToUpdate.forEach((function(t){t.updatePhysics()}))}animate(){this.objectsToAnimate.forEach((function(t){t.animate()}))}async createRectangle(t,e,s,i,n,o,a){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const d=(new r.Bb).load(o);d.wrapS=r.qb,d.wrapT=r.qb,d.repeat.set(e,i);const l=new r.Y({map:d,side:r.n});if(h){let t=(new r.Bb).load(h);t.repeat.set(e,i),t.wrapS=r.qb,t.wrapT=r.qb,l.normalMap=t,l.normalScale.set(10,10)}const c=new r.e(e,s,i);c.rotateX(n);const u=new r.ob;u.setFromAxisAngle(new r.Ib(1,0,0),n);let p=new J(new r.Ib(t[0],t[1],t[2]),u,new a.btVector3(0,0,0),0,new r.Ib(e,s,i),this.physicsWorld,1e3);await p.buildAmmoPhysics(),this.physicsToUpdate.push(p);let b=new r.T(c,l);b.position.set(t[0],t[1],t[2]),this.scene.add(b)}async createCone(t,e){let s=new Y("textures/coneTexture.jpg");s.addToScene(this.scene,"trafficCone",t,[.5,.5,.5]);let i=new Z(new r.Ib(t[0],t[1],t[2]),(new r.ob).setFromAxisAngle(new r.Ib(1,0,0),0),new e.btVector3(0,0,0),10,new r.Ib(s.RADIUS_BOTTOM,s.HEIGHT/2,s.RADIUS_BOTTOM),this.physicsWorld,1e3);await i.buildAmmoPhysics(),this.physicsToUpdate.push(i),i.attachObserver(s),this.objectsToAnimate.push(s)}async buildStreetPhysics(t,e,s){let i=new J(new r.Ib(t[0],t[1],t[2]),(new r.ob).setFromAxisAngle(new r.Ib(1,0,0),0),new s.btVector3(0,0,0),0,new r.Ib(e.SIZE,.1,e.LONG),this.physicsWorld,1e3);await i.buildAmmoPhysics();let n=new J(new r.Ib(t[0]-8.4*e.SIZE/24,t[1]+e.SIDEWALK_HEIGHT/2,t[2]),(new r.ob).setFromAxisAngle(new r.Ib(1,0,0),0),new s.btVector3(0,0,0),0,new r.Ib(7*e.SIZE/24,e.SIDEWALK_HEIGHT,e.LONG),this.physicsWorld,1e3);await n.buildAmmoPhysics();let o=new J(new r.Ib(t[0]+8.4*e.SIZE/24,t[1]+e.SIDEWALK_HEIGHT/2,t[2]),(new r.ob).setFromAxisAngle(new r.Ib(1,0,0),0),new s.btVector3(0,0,0),0,new r.Ib(7*e.SIZE/24,e.SIDEWALK_HEIGHT,e.LONG),this.physicsWorld,1e3);await o.buildAmmoPhysics(),i.attachObserver(e),this.physicsToUpdate.push(i),this.physicsToUpdate.push(n),this.physicsToUpdate.push(o)}async createStreet(t,e,s,i){let n=new K("textures/road.jpg");await n.addToScene(this.scene,"street",t,i),await this.buildStreetPhysics(t,n,s),this.objectsToAnimate.push(n)}async createLevel0(){let t=await L.getInstance();this.createRectangle([10,0,10],10,2,10,-Math.PI/8,"textures/pavimento.jpg",t,"textures/pavimento_map.png"),this.createRectangle([-10,0,10],10,2,10,-Math.PI/4,"textures/pavimento.jpg",t,"textures/pavimento_map.png"),this.createRectangle([0,0,0],100,.1,100,0,"textures/pavimento.jpg",t,"textures/pavimento_map.png"),this.createCone([0,.5,10],t),this.createCone([0,.5,30],t),this.createCone([0,.5,20],t)}async createLevelCustom(){let t=await L.getInstance();this.createStreet([0,0,0],0,t,20)}}class Q{static createButton(t){const e=document.createElement("button");function s(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}function i(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return e.id="VRButton",e.style.display="none",i(e),navigator.xr.isSessionSupported("immersive-vr").then((function(i){i?function(){let s=null;async function i(i){i.addEventListener("end",n),await t.xr.setSession(i),e.textContent="EXIT VR",s=i}function n(){s.removeEventListener("end",n),e.textContent="ENTER VR",s=null}e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",e.textContent="ENTER VR",e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){if(null===s){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(i),localStorage.setItem("VR",!0)}else s.end()}}():(s(),e.textContent="VR NOT SUPPORTED"),i&&Q.xrSessionIsGranted&&e.click()})).catch((function(t){s(),console.warn("Exception when trying to call xr.isSessionSupported",t),e.textContent="VR NOT ALLOWED"})),e;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",i(t),t}}static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{Q.xrSessionIsGranted=!0}))}}}Q.xrSessionIsGranted=!1,Q.registerSessionGrantedListener();var tt=s(180),et=s.n(tt),st=s(2);class it extends i.Component{constructor(){super(),this.state={currentRPM:0,velocity:0,currentShift:0},this.physicsToUpdate=[],localStorage.setItem("VR",!1),this.gotAnyEvent=!1,this.stats=new et.a}async componentDidMount(){this.objectsToAnimate=[],this.scene=new r.sb,this.renderer=new r.Mb({alpha:!0,powerPreference:"high-performance",antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(8900346,1),this.camera=new d(this.renderer),this.camera.addContainerToScene(this.scene),this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.clock=new r.i,await this.createAmmo(),this.ambientLight=new r.a(16777215,1),this.scene.add(this.ambientLight),this.level=new $(this.scene,this.physicsWorld),await this.level.createLevelCustom(),this.physicsToUpdate.push(this.level),this.objectsToAnimate.push(this.level),this.carLogic=new X(this.physicsWorld);let t=new P;this.carLogic.attachObserver(t),this.carLogic.attachObserver(this.camera),this.objectsToAnimate.push(await t.addToScene(this.scene)),this.carLogic.notifyObservers(),this.animation=this.animation.bind(this),this.handleWindowResize=this.handleWindowResize.bind(this),this.generateEvents=this.generateEvents.bind(this),this.generateEvents(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.xr.enabled=!0,this.renderer.xr.setFramebufferScaleFactor(.5),this.mount.appendChild(this.renderer.domElement),document.body.appendChild(Q.createButton(this.renderer)),this.renderer.setAnimationLoop(this.animation)}generateEvents(){window.addEventListener("resize",this.handleWindowResize),window.addEventListener("gamepaddisconnected",(function(t){R.removeInstance()})),document.addEventListener("keydown",(t=>{var e=t.key;switch(this.carLogic.removeObserver(this.camera),e){case"1":this.camera=new d(this.renderer),this.camera.addContainerToScene(this.scene);break;case"2":this.camera=new u(this.renderer);break;case"3":this.camera=new l(new r.Ib(-4.35,.6,-.1));break;case"4":this.camera=new l(new r.Ib(4.35,.6,-.1));break;case"5":this.camera=new l(new r.Ib(0,3,-5))}this.carLogic.attachObserver(this.camera),this.carLogic.notifyObservers()}),!1)}async createAmmo(){let t=await L.getInstance();this.tempTransform=new t.btTransform;let e=new t.btDefaultCollisionConfiguration,s=new t.btCollisionDispatcher(e),i=new t.btDbvtBroadphase,n=new t.btSequentialImpulseConstraintSolver;this.physicsWorld=new t.btDiscreteDynamicsWorld(s,i,n,e),this.physicsWorld.setGravity(new t.btVector3(0,-9.8,0))}handleWindowResize(){this.camera.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera.getCameraInstance())}animation(){this.stats.begin();let t=this.clock.getDelta();this.physicsWorld.stepSimulation(t,10),this.objectsToAnimate.forEach((function(t){t.animate()})),this.physicsToUpdate.forEach((function(t){t.updatePhysics()})),this.camera.setPositionRelativeToObject(),A.getInstance(this.carLogic).checkEvents(),this.setState({velocity:this.carLogic.getSpeed(),currentRPM:this.carLogic.getCurrentRPM(),currentShift:this.carLogic.getCurrentShift()}),this.renderer.render(this.scene,this.camera.getCameraInstance()),console.log("drawCalls:",this.renderer.info.render.calls),this.stats.end()}render(){return Object(st.jsxs)("div",{style:{width:"100vw"},children:[Object(st.jsx)("div",{style:{position:"absolute",top:"10px",right:"10px",color:"red",width:"175px"},id:"Acelerador",children:Object(st.jsxs)("p",{style:{zIndex:20,display:"float",fontWeight:"bold"},children:["Cambio Actual: ",parseInt(this.state.currentShift)]})}),Object(st.jsx)("div",{ref:t=>{this.mount=t}})]})}}var nt=s(8);const ot={width:"100vw",height:"100vh",backgroundImage:'url("DrivingSimMenuNoTitle.png")',backgroundSize:"cover",backgroundRepeat:"no-repeat"},at=()=>{const t=Object(nt.n)();return Object(st.jsx)(st.Fragment,{children:Object(st.jsx)("div",{style:ot,children:Object(st.jsxs)("div",{id:"button-box",style:{position:"absolute",top:"5%",right:"5%"},children:[Object(st.jsx)("div",{className:"MainMenuTitle",children:Object(st.jsxs)("h1",{style:{textAlign:"center",fontSize:"7rem"},children:["Driving",Object(st.jsx)("br",{}),"Simulator"]})}),Object(st.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(st.jsx)("button",{className:"buttonMainMenu",onClick:()=>t("/scene"),children:"Iniciar"})}),Object(st.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(st.jsx)("button",{className:"buttonMainMenu",onClick:()=>t("/level-editor"),children:"Editor de Niveles"})}),Object(st.jsx)("div",{className:"buttonWrapperMainMenu",children:Object(st.jsx)("button",{className:"buttonMainMenu",onClick:()=>t("/configs"),children:"Configuraci\xf3n"})})]})})})};var rt=s(381),ht=s(375),dt=s(5),lt=s(376),ct=s(380),ut=s(185),pt=s.n(ut);const bt=t=>{let{openConfigs:e,handleDrawerClose:s}=t;const[i,o]=n.a.useState(!1);n.a.useEffect((()=>{o(e)}),[e]);const a=Object(dt.a)("div")((t=>{let{theme:e}=t;return{display:"flex",alignItems:"center",width:"100%",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-start"}}));return Object(st.jsx)(st.Fragment,{children:Object(st.jsx)(ht.a,{children:Object(st.jsxs)(lt.a,{sx:{width:window.innerWidth/6,flexShrink:0,"& .MuiDrawer-paper":{width:window.innerWidth/6,boxSizing:"border-box"}},variant:"persistent",anchor:"right",open:i,children:[Object(st.jsxs)(a,{className:"drawer-header",onClick:s,children:[Object(st.jsx)(pt.a,{}),Object(st.jsx)("div",{style:{width:"100%"},children:Object(st.jsx)("h3",{style:{textAlign:"right",paddingRight:30},children:"Configurations"})})]}),Object(st.jsx)(ct.a,{})]})})})};var gt=s(186),mt=s.n(gt);const wt=Object(i.createContext)(),St={cone:null,trapecio:null,street:null},ft=t=>{let{openItems:e,handleDrawerClose:s}=t;const[i,o]=n.a.useState(!1),{setLastSelectedItem:a,lastSelectedItem:r}=n.a.useContext(wt);n.a.useEffect((()=>{o(e)}),[e]);const h=Object(dt.a)("div")((t=>{let{theme:e}=t;return{display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"}})),[d,l]=n.a.useState(St);return Object(st.jsx)(st.Fragment,{children:Object(st.jsx)(ht.a,{children:Object(st.jsxs)(lt.a,{sx:{width:window.innerWidth/6,flexShrink:0,"& .MuiDrawer-paper":{width:window.innerWidth/6,boxSizing:"border-box"}},variant:"persistent",anchor:"left",open:i,children:[Object(st.jsxs)(h,{onClick:s,className:"drawer-header",children:[Object(st.jsx)("div",{style:{width:"100%"},children:Object(st.jsx)("h3",{style:{textAlign:"left",paddingLeft:10},children:"Items"})}),Object(st.jsx)(mt.a,{})]}),Object(st.jsx)(ct.a,{}),Object(st.jsx)(ht.a,{style:{justifyContent:"center",display:"flex",alignItems:"center",flexDirection:"column"},children:Object.entries(d).map((t=>{let[e,s]=t;return Object(st.jsx)("img",{alt:`${e}`,src:`${e}.png`,width:75,height:75,className:`imageLevelEditor ${s}`,onClick:()=>(t=>{const e={...St};e[t]="selected",l(e),a({selectedItem:t,scale:1,positionX:0,positionY:0,zIndex:r?r.zIndex+1:1})})(e)},e)}))})]})})})};var xt=s(189),vt=s.n(xt),yt=s(188),Pt=s.n(yt),jt=s(378);const Ot=t=>{let{setGridDimensions:e,gridDimensions:s}=t;const[n,o]=Object(i.useState)(s.width),[a,r]=Object(i.useState)(s.height);return Object(st.jsxs)(ht.a,{container:!0,direction:"row",width:"80%",marginLeft:"10%",justifyContent:"space-evenly",alignItems:"center",spacing:2,children:[Object(st.jsxs)(ht.a,{item:!0,xs:2,children:[Object(st.jsx)("p",{children:"Ancho:"}),Object(st.jsx)("input",{value:n,type:"number",step:"1",onChange:t=>{let e=parseInt(t.target.value.replaceAll(",","").replaceAll(".",""));o(e>40?40:e)}})]}),Object(st.jsx)(ht.a,{item:!0,xs:2,children:Object(st.jsxs)("div",{children:[Object(st.jsx)("p",{children:"Alto:"}),Object(st.jsx)("input",{value:a,type:"number",step:"1",onChange:t=>{let e=parseInt(t.target.value.replaceAll(",","").replaceAll(".",""));r(e>40?40:e)}})]})}),Object(st.jsx)(ht.a,{item:!0,xs:2,children:Object(st.jsx)(jt.a,{variant:"contained",onClick:()=>{e({width:n,height:a})},children:"Actualizar"})})]})};var Rt=s(187),It=s.n(Rt);const Mt=30;class Tt{constructor(t,e,s){const i=t[1][2].filled,n=t[0][1].filled,o=t[2][1].filled,a=t[1][0].filled;this.rotation=this.determineStreetRotation(n,a,o,i),this.long=[Mt,Mt],this.position=[e*Mt+15,s*Mt+15]}static isValidNinePerNineGrid(t){}static sumValueForCell(t){return t.filled?1:0}static calculateNeighboursFilled(t){let e=0,s=0;return e+=Tt.sumValueForCell(t[1][0])+Tt.sumValueForCell(t[1][2]),s+=Tt.sumValueForCell(t[0][1])+Tt.sumValueForCell(t[2][1]),[e,s]}isStraight(){return!1}determineStreetRotation(){}getAsJSON(){return{position_x:this.position[0],position_y:this.position[1],rotation:this.rotation,long_x:this.long[0],long_y:this.long[1]}}getPositionAsRowAndColumn(){return[(this.position[0]-15)/Mt,(this.position[1]-15)/Mt]}getPositionX(){return this.position[0]}getPositionY(){return this.position[1]}getLongX(){return this.long[0]}getLongY(){return this.long[1]}}const At={TOP_TO_LEFT:0,LEFT_TO_BOT:Math.PI/2,BOT_TO_RIGHT:Math.PI,RIGHT_TO_TOP:3*Math.PI/2};const Ct={HORIZONTAL:0,VERTICAL:Math.PI/2};const Dt={TOP_SINGLE:0,LEFT_SINGLE:Math.PI/2,BOT_SINGLE:Math.PI,RIGHT_SINGLE:3*Math.PI/2};class Et{constructor(t){this.sections=this.segregateSections(t),this.sectionsAsJSON=this.linkSections()}segregateSections(t){const e={},s={};let i=[];for(let n=0;n<t.length;n++){let[i,o]=t[n].getPositionAsRowAndColumn();t[n].isHorizontal()?(i in e||(e[i]=[]),e[i].push({idx:o,street:t[n]})):(o in s||(s[o]=[]),s[o].push({idx:i,street:t[n]}))}for(const[,n]of Object.entries(e))i=[...i,...this.generateArraySubsections(n)];for(const[,n]of Object.entries(s))i=[...i,...this.generateArraySubsections(n)];return i}generateArraySubsections(t){const e=[];for(let s=0;s<t.length;s++)0===s||t[s].idx-t[s-1].idx>1?e.push([t[s].street]):e[e.length-1].push(t[s].street);return e}linkSections(){const t=[];for(let e=0;e<this.sections.length;e++){console.log(this.sections[e]);const s={position_x:this.sections[e].reduce(((t,e)=>t+e.getPositionX()),0)/this.sections[e].length,position_y:this.sections[e].reduce(((t,e)=>t+e.getPositionY()),0)/this.sections[e].length,rotation:this.sections[e][0].rotation,long_x:this.sections[e][0].isHorizontal()?this.sections[e].reduce(((t,e)=>t+e.getLongX()),0):this.sections[e][0].getLongX(),long_y:this.sections[e][0].isHorizontal()?this.sections[e][0].getLongY():this.sections[e].reduce(((t,e)=>t+e.getLongY()),0),type:"STRAIGHT"};t.push(s)}return t}getSectionsAsJSON(){return this.sectionsAsJSON}}const Lt=[class extends Tt{static isValidNinePerNineGrid(t){let[e,s]=Tt.calculateNeighboursFilled(t);return 2===s&&0===e||0===s&&2===e}determineStreetRotation(t,e,s,i){return t&&s?Ct.VERTICAL:e&&i?Ct.HORIZONTAL:void 0}isStraight(){return!0}getAsJSON(){let t=super.getAsJSON();return t.type="STRAIGHT",t}isHorizontal(){return this.rotation===Ct.HORIZONTAL}},class extends Tt{static isValidNinePerNineGrid(t){let[e,s]=Tt.calculateNeighboursFilled(t);return 1===e&&1===s}determineStreetRotation(t,e,s,i){return t&&e?At.TOP_TO_LEFT:e&&s?At.LEFT_TO_BOT:s&&i?At.BOT_TO_RIGHT:i&&t?At.RIGHT_TO_TOP:void 0}getAsJSON(){let t=super.getAsJSON();return t.type="CURVE",t}},class extends Tt{static isValidNinePerNineGrid(t){let[e,s]=Tt.calculateNeighboursFilled(t);return 2===s&&1===e||1===s&&2===e}determineStreetRotation(t,e,s,i){return t&&e&&i?Dt.TOP_SINGLE:e&&s&&t?Dt.LEFT_SINGLE:s&&i&&e?Dt.BOT_SINGLE:i&&t&&s?Dt.RIGHT_SINGLE:void 0}getAsJSON(){let t=super.getAsJSON();return t.type="T_STREET",t}},class extends Tt{static isValidNinePerNineGrid(t){let[e,s]=Tt.calculateNeighboursFilled(t);return 2===s&&2===e}determineStreetRotation(){return 0}getAsJSON(){let t=super.getAsJSON();return t.type="INTERSECTION",t}}];class Bt{constructor(t,e){this.levelGrid=t,this.getNinePerNineGrid=e?this.getNinePerNineGridInfinite:this.getNinePerNineGridFinite}constructStreets(){const t=[],e=[];for(let i=0;i<this.levelGrid.length;i++)for(let s=0;s<this.levelGrid[i].length;s++){if(this.levelGrid[i][s].filled){const n=this.defineTypeOfStreet(i,s);n.isStraight()?t.push(n):e.push(n)}}const s=this.linkStraightStreets(t);return[...e.map((t=>t.getAsJSON())),...s]}getNinePerNineGridInfinite(t,e){const s=[];for(let i=t-1;i<=t+1;i++){const t=[],n=i<0?this.levelGrid.length-1:i%this.levelGrid.length;for(let s=e-1;s<=e+1;s++){const e=s<0?this.levelGrid[n].length-1:s%this.levelGrid[n].length;t.push(this.levelGrid[n][e])}s.push(t)}return s}getNinePerNineGridFinite(t,e){const s=[],i={filled:!1};for(let n=t-1;n<=t+1;n++)if(n<0||n===this.levelGrid.length)s.push([i,i,i]);else{const t=[];for(let s=e-1;s<=e+1;s++)s<0||s===this.levelGrid[n].length?t.push(i):t.push(this.levelGrid[n][s]);s.push(t)}return s}defineTypeOfStreet(t,e){const s=this.getNinePerNineGrid(t,e);let i,n=!1;for(let o=0;o<Lt.length&&!n;o++)n=Lt[o].isValidNinePerNineGrid(s),i=Lt[o];if(!n)throw new Error("No se pudo definir el tipo de calle dentro de los tipos validos.");return new i(s,this.levelGrid.length-1-t,e)}linkStraightStreets(t){return new Et(t).getSectionsAsJSON()}}function Ht(t,e,s){let i=0;for(let n=e-1;n<=e+1&&n<t.length;n++)n>=0&&n!==e&&(i+=t[n][s].filled?1:0);for(let n=s-1;n<=s+1&&n<t[e].length;n++)n>=0&&n!==s&&(i+=t[e][n].filled?1:0);return i}function Wt(t,e){return e?void 0:function(t){let e=!0,s=[];for(let i=0;i<t.length;i++)for(let n=0;n<t[i].length;n++)t[i][n].filled&&Ht(t,i,n)<=1&&(e=!1,s.push([i,n]));return{valid:e,wrongCells:s}}(t)}const Gt="darkgray",Nt="white",_t="orange",kt=t=>{let{gridDimensions:e}=t;const[s,n]=Object(i.useState)([]),[o,a]=Object(i.useState)(!1),[r,h]=Object(i.useState)(!1);Object(i.useEffect)((()=>{let t=[];for(let s=0;s<e.height;s++){let s=[];for(let t=0;t<e.width;t++){let t={filled:!1,div_color:Nt};s.push(t)}t.push(s)}n(t)}),[e.width,e.height]),Object(i.useEffect)((()=>{window.addEventListener("mouseup",(t=>{t.preventDefault(),0===t.button?a(!1):2===t.button&&h(!1)})),window.addEventListener("contextmenu",(t=>{t.preventDefault()}))}),[]);const d=(t,e)=>{if(!e||!t)return!1;for(let i=0;i<t.length;i++){let n=!0;for(let o=0;o<t[i].length;o++)try{t[i][o]!==e[o]&&(n=!1)}catch(s){o=t[i].length,n=!1}if(n)return!0}return!1};return Object(st.jsxs)("div",{style:{width:600,height:600,marginTop:25,marginLeft:"auto",marginRight:"auto"},onMouseDown:t=>{t.preventDefault(),0===t.button?a(!0):2===t.button&&h(!0)},children:[s.map(((t,i)=>Object(st.jsx)("div",{className:"row-level-grid",id:`row_${i}`,style:{width:"100%",height:600/e.height,display:"flex",flexDirection:"row"},children:t.map(((t,a)=>Object(st.jsx)("div",{className:"cell-level-grid",id:`cell_${i}_${a}`,style:{backgroundColor:t.div_color,width:100/e.width+"%",height:"100%",border:"1px solid black"},onMouseMove:t=>{t.preventDefault(),((t,e)=>{if(o){const i=[...s];i[t][e].filled=!0,i[t][e].div_color=Gt,n(i)}else if(r){const i=[...s];i[t][e].filled=!1,i[t][e].div_color=Nt,n(i)}})(i,a)},onMouseUp:t=>{((t,e,i)=>{if(0===i){const i=[...s];i[t][e].filled=!0,i[t][e].div_color=Gt,n(i)}else if(2===i){const i=[...s];i[t][e].filled=!1,i[t][e].div_color=Nt,n(i)}})(i,a,t.button)}},`cell_${i}_${a}`)))},`row_${i}`))),Object(st.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:40},children:Object(st.jsxs)(jt.a,{variant:"contained",onClick:()=>{let t=Wt(s),e=[...s];for(let i=0;i<s.length;i++)for(let n=0;n<s[i].length;n++)e[i][n].filled&&(e[i][n].div_color=d(t.wrongCells,[i,n])?_t:Gt);n(e),t.valid&&function(t,e){var s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),i=document.createElement("a");i.setAttribute("href",s),i.setAttribute("download",e+".json"),document.body.appendChild(i),i.click(),i.remove()}(function(t){return{streets:new Bt(t).constructStreets()}}(s),"Driving_Simulator_Custom_Level.json")},color:"success",children:[Object(st.jsx)(It.a,{})," Procesar nivel..."]})})]})},Vt=()=>{const[t,e]=Object(i.useState)(!1),[s,o]=Object(i.useState)(!1),[a,r]=Object(i.useState)([]),[h,d]=Object(i.useState)(null),[l,c]=Object(i.useState)({width:20,height:20});return n.a.useEffect((()=>{null!==h&&r((t=>[...t,h]))}),[h]),Object(st.jsx)(st.Fragment,{children:Object(st.jsxs)(wt.Provider,{value:{lastSelectedItem:h,setLastSelectedItem:d},children:[Object(st.jsxs)("div",{children:[Object(st.jsxs)("div",{style:{flexDirection:"row",justifyContent:"space-between",display:"flex"},children:[Object(st.jsx)(rt.a,{onClick:()=>e(!0),style:{height:40,margin:10},className:"header",children:Object(st.jsx)(Pt.a,{})}),Object(st.jsx)("h1",{children:"Driving Simulator - Level Editor"}),Object(st.jsx)(rt.a,{onClick:()=>o(!0),style:{height:40,margin:10},className:"header",children:Object(st.jsx)(vt.a,{})})]}),Object(st.jsxs)("div",{children:[Object(st.jsx)(Ot,{setGridDimensions:c,gridDimensions:l}),Object(st.jsx)(kt,{gridDimensions:l}),a.map(((t,e)=>Object(st.jsx)("span",{},e)))]})]}),Object(st.jsx)(ft,{openItems:t,handleDrawerClose:()=>{e(!1)}}),Object(st.jsx)(bt,{openConfigs:s,handleDrawerClose:()=>{o(!1)}})]})})};var Ft=s(41);const zt="http://localhost:8001",Ut=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,Xt=Object(i.createContext)(void 0);var qt=s(371),Jt=s(368),Yt=s(373),Zt=s(83),Kt=s(366),$t=s(367);const{createHash:Qt}=s(220),te=t=>Qt("sha256").update(t).digest("hex"),ee=()=>{const t=Object(nt.n)(),[e,s]=n.a.useState(""),[o,a]=n.a.useState(""),[r,h]=n.a.useState(!1),[d,l]=n.a.useState(void 0),{setSessionWithResponse:c}=(()=>{const{session:t,setSession:e}=Object(i.useContext)(Xt);return{setSessionWithResponse:t=>{e({user:t.user,jwt:t.jwt})},getUser:()=>t.user?t.user:void 0,getJWT:()=>t.jwt?t.jwt:void 0}})(),u=async t=>{try{const e=await(async t=>{const e=await fetch(`${zt}/users/login_google`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})});if(200!==e.status){const t=await e.json(),s=t.detail[0].msg?t.detail[0].msg:t.detail;let i=e.status+" - "+e.statusText+" - "+s;throw new Error(i)}return e.json()})(t);c(e)}catch(e){l([e.toString().replaceAll("Error: ","")])}};return Object(st.jsx)("form",{onSubmit:async s=>{if(s.preventDefault(),(()=>{const t=[];return""===o&&t.push("El campo contrase\xf1a se encuentra vac\xedo."),""===e&&t.push("El campo email se encuentra vac\xedo"),e.match(Ut)||t.push("El email establecido es inv\xe1lido."),!(t.length>0)||(l(t),!1)})())try{const s=await(async()=>{try{const t=await fetch(`${zt}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:te(o)})});if(200!==t.status){const e=await t.json(),s=e.detail[0].msg?e.detail[0].msg:e.detail;let i=t.status+" - "+t.statusText+" - "+s;throw new Error(i)}return t.json()}catch(t){throw new Error(t)}})();c(s),t("/")}catch(i){l([i.toString().replaceAll("Error: ","")])}},children:Object(st.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column",textAlign:"center",margin:"auto",marginTop:40,padding:30,border:"2px solid black",borderRadius:20,maxWidth:400},children:[d&&Object(st.jsxs)(qt.a,{severity:"error",style:{textAlign:"justify"},onClose:()=>l(void 0),children:["Han ocurrido los siguientes errores:",Object(st.jsx)("ul",{children:d.map(((t,e)=>Object(st.jsx)("li",{children:t},e)))})]}),Object(st.jsx)("h1",{children:"Iniciar Sesi\xf3n"}),Object(st.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(st.jsx)("img",{src:"logo_transp.png",width:"25%",alt:"Driving Simulator Logo"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:"text",onChange:t=>s(t.target.value),value:e,name:"email",label:"E-Mail"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:r?"text":"password",onChange:t=>a(t.target.value),value:o,name:"password",label:"Contrase\xf1a",InputProps:{endAdornment:Object(st.jsx)(Yt.a,{position:"end",children:Object(st.jsx)(rt.a,{"aria-label":"toggle password visibility",onClick:()=>h(!r),children:r?Object(st.jsx)(Kt.a,{}):Object(st.jsx)($t.a,{})})})}})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(jt.a,{variant:"contained",type:"submit",children:"Iniciar Sesi\xf3n"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Ft.b,{to:"/signup",children:"\xbfNo posees una cuenta? Registrate aqu\xed..."})}),Object(st.jsx)("div",{style:{marginTop:20,display:"flex",justifyContent:"center",textAlign:"center",alignContent:"center"},children:Object(st.jsx)(Zt.a,{onSuccess:t=>{const e=t.credential;u(e)},onError:()=>{l(["El inicio de sesi\xf3n con Google ha fallado."])}})})]})})},se=()=>{const[t,e]=n.a.useState(""),[s,i]=n.a.useState(""),[o,a]=n.a.useState(""),[r,h]=n.a.useState(""),[d,l]=n.a.useState(!1),[c,u]=n.a.useState(void 0);return Object(st.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=[];return""!==t&&""!==s&&""!==o&&""!==r||e.push("A\xfan existen campos sin completar."),s!==o&&e.push("Las contrase\xf1as establecidas no coinciden."),s.length<8&&e.push("La contrase\xf1a debe tener una longitud m\xednima de 8 caracteres."),t.match(Ut)||e.push("El email establecido es inv\xe1lido."),e.length>0?(u(e),!1):(u(void 0),!0)})())return;const i=await(async()=>{const e=`${zt}/users/register`;try{const i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:te(s),name_to_show:r})});if(200!==i.status){const t=await i.json(),e=t.detail[0].msg?t.detail[0].msg:t.detail;let s=i.status+" - "+i.statusText+" - "+e;throw new Error(s)}return i.json()}catch(i){throw new Error(i)}})();console.log(i)},children:Object(st.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",flexDirection:"column",textAlign:"center",margin:"auto",marginTop:40,padding:30,border:"2px solid black",borderRadius:20,maxWidth:400},children:[c&&Object(st.jsxs)(qt.a,{severity:"error",style:{textAlign:"justify"},onClose:()=>u(void 0),children:["Han ocurrido los siguientes errores:",Object(st.jsx)("ul",{children:c.map(((t,e)=>Object(st.jsx)("li",{children:t},e)))})]}),Object(st.jsx)("h1",{children:"Crea tu cuenta"}),Object(st.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:Object(st.jsx)("img",{src:"logo_transp.png",width:"25%",alt:"Driving Simulator Logo"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:"text",onChange:t=>e(t.target.value),value:t,name:"email",label:"E-Mail"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:"text",onChange:t=>h(t.target.value),value:r,name:"username",label:"Nombre para mostrar"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:d?"text":"password",onChange:t=>i(t.target.value),value:s,name:"password",label:"Contrase\xf1a",InputProps:{endAdornment:Object(st.jsx)(Yt.a,{position:"end",children:Object(st.jsx)(rt.a,{"aria-label":"toggle password visibility",onClick:()=>l(!d),children:d?Object(st.jsx)(Kt.a,{}):Object(st.jsx)($t.a,{})})})}})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Jt.a,{style:{width:"80%"},type:d?"text":"password",onChange:t=>a(t.target.value),value:o,name:"passwordConfirmation",label:"Repetir Contrase\xf1a"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(jt.a,{variant:"contained",type:"submit",children:"CREAR CUENTA"})}),Object(st.jsx)("div",{style:{marginTop:20},children:Object(st.jsx)(Ft.b,{to:"/login",children:"\xbfYa poses una cuenta? Inicia sesi\xf3n..."})})]})})},ie=t=>{let{childElement:e}=t;const[s,n]=Object(i.useState)({user:void 0,jwt:void 0});return Object(st.jsx)(Zt.b,{clientId:"18785041157-s9ga39r0i6up45radtj3soo6je1pneon.apps.googleusercontent.com",children:Object(st.jsx)(Xt.Provider,{value:{session:s,setSession:n},children:e})})};var ne=function(){return Object(i.useEffect)((()=>{document.title="Driving Simulator"}),[]),Object(st.jsx)(ie,{childElement:Object(st.jsx)(Ft.a,{children:Object(st.jsxs)(nt.c,{children:[Object(st.jsx)(nt.a,{exact:!0,path:"/scene",element:Object(st.jsx)(it,{})}),Object(st.jsx)(nt.a,{exact:!0,path:"/",element:Object(st.jsx)(at,{})}),Object(st.jsx)(nt.a,{exact:!0,path:"/level-editor",element:Object(st.jsx)(Vt,{})}),Object(st.jsx)(nt.a,{exact:!0,path:"/login",element:Object(st.jsx)(ee,{})}),Object(st.jsx)(nt.a,{exact:!0,path:"/signup",element:Object(st.jsx)(se,{})})]})})})};a.a.createRoot(document.getElementById("root")).render(Object(st.jsx)(ne,{}))}},[[318,1,2]]]);
//# sourceMappingURL=main.b7cd6e05.chunk.js.map