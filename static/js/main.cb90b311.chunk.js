/*! For license information please see main.cb90b311.chunk.js.LICENSE.txt */
(this["webpackJsonptpp-driving-simulator"]=this["webpackJsonptpp-driving-simulator"]||[]).push([[0],{22:function(t,e,s){"use strict";s.r(e),s.d(e,"default",(function(){return a}));var i=s(1),n=s(2),a=function(){function t(e){Object(i.a)(this,t),this.car=e}return Object(n.a)(t,[{key:"handleAccelerate",value:function(t,e){this.car.accelerate(t,e)}},{key:"handleBrake",value:function(t,e){this.car.brake(t,e)}},{key:"changeShift",value:function(t,e){this.car.changeShift(t,e)}},{key:"turnDirection",value:function(t){this.car.turnDirection(t)}},{key:"turnOnCar",value:function(){this.car.turnOnCar()}},{key:"updateCar",value:function(){this.car.update()}},{key:"changeShiftBox",value:function(t){this.car.changeShiftBox(t)}}]),t}()},35:function(t,e,s){},42:function(t,e,s){"use strict";s.r(e);var i=s(12),n=s(24),a=s.n(n),o=(s(35),s(7)),r=s(8),h=s(1),u=s(2),c=s(3),d=s(4),l=s(0),b=function(){function t(){Object(h.a)(this,t),this.observedState=null}return Object(u.a)(t,[{key:"update",value:function(t){this.observedState=t}}]),t}(),p=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this)).camera=new l.cb(75,window.innerWidth/window.innerHeight,.1,1e3),i.group=new l.ab,i.group180Rot=(new l.ab).add(i.camera),i.group.add(i.group180Rot),i.renderer=t,i}return Object(u.a)(s,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"setPositionRelativeToObject",value:function(){var t=new l.yb(.35,.6,-.1);if(null!=this.observedState)if(t.applyQuaternion(this.observedState.rotation),this.group.position.copy(this.observedState.position).add(t),"true"==localStorage.getItem("VR")){var e=new l.yb(0,-1.55,0);e.applyQuaternion(this.observedState.rotation),this.group.position.add(e),this.group.setRotationFromQuaternion(this.observedState.rotation),this.group180Rot.setRotationFromAxisAngle(new l.yb(0,1,0),Math.PI),this.camera.lookAt(new l.yb(0,0,5))}else{var s=new l.yb(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),i=new l.yb(0,0,5);i.applyQuaternion(this.observedState.rotation),s.x+=i.x,s.y+=i.y,s.z+=i.z,this.camera.lookAt(s)}else this.camera.lookAt(new l.yb(0,0,5))}},{key:"getCameraInstance",value:function(){return this.camera}}]),s}(b),f=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this)).positionCamera=t,i.camera=new l.cb(75,window.innerWidth/window.innerHeight,.1,1e3),i}return Object(u.a)(s,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"setPositionRelativeToObject",value:function(){var t=new l.yb(this.positionCamera.x,this.positionCamera.y,this.positionCamera.z);if(null!=this.observedState){var e=t.applyQuaternion(this.observedState.rotation);this.camera.position.copy(this.observedState.position).add(e);var s=new l.yb(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z);this.camera.lookAt(s)}else this.camera.lookAt(new l.yb(0,0,0)),this.camera.position.copy(t)}},{key:"getCameraInstance",value:function(){return this.camera}}]),s}(b),g=s(25),v=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this)).camera=new l.cb(75,window.innerWidth/window.innerHeight,.1,1e3),i.renderer=t,i.controls=new g.a(i.camera,i.renderer.domElement),i.controls.enableDamping=!0,i.controls.dampingFactor=.25,i.controls.enableZoom=!0,i.camera.position.set(0,5.5,0),i}return Object(u.a)(s,[{key:"handleResize",value:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{key:"getCameraInstance",value:function(){return this.camera}},{key:"setPositionRelativeToObject",value:function(){this.controls.update(),null!=this.observedState?this.camera.lookAt(this.observedState.position):this.camera.lookAt(new l.yb(0,0,0))}}]),s}(b),m=s(6),y=s(5),w=s(28),S=s(26),P=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this)).fbxLoader=new w.a,i.gltfLoader=new S.a,i.threeDModel=null,i.pathToTexture=t,i}return Object(u.a)(s,[{key:"loadFBX",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.pathToTexture,t.next=3,this.fbxLoader.loadAsync(e,(function(t){return t}));case 3:return s=t.sent,t.abrupt("return",s);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadGLTF",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.pathToTexture,t.next=3,this.gltfLoader.loadAsync(e,(function(t){return t}));case 3:return s=t.sent,t.abrupt("return",s);case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addToScene",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(e,s,i,n){var a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.threeDModel){t.next=22;break}return t.prev=1,t.next=4,this.loadFBX();case 4:a=t.sent,this.threeDModel=a,t.next=14;break;case 8:return t.prev=8,t.t0=t.catch(1),t.next=12,this.loadGLTF();case 12:a=t.sent,this.threeDModel=a.scene;case 14:this.threeDModel.name=s,this.threeDModel.position.x=i[0],this.threeDModel.position.y=i[1],this.threeDModel.position.z=i[2],this.threeDModel.scale.x=n[0],this.threeDModel.scale.y=n[1],this.threeDModel.scale.z=n[2],e.add(this.threeDModel);case 22:return t.abrupt("return",this);case 23:case"end":return t.stop()}}),t,this,[[1,8]])})));return function(e,s,i,n){return t.apply(this,arguments)}}()},{key:"getModel",value:function(){return this.threeDModel}},{key:"animate",value:function(){return null}}]),s}(b),O=[1,1,1],R=[0,0,0],x=.75,k=1/3600,j=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){var t;return Object(h.a)(this,s),(t=e.call(this,"res/models/source/AutoConInterior.gltf")).carModel=null,t.carLogic=null,t.lastValueRotation=0,t.currentSpeedRotation=0,t.currentWheelRotation=0,t.lastSteeringRotation=0,t.lastVelocityRotation=0,t.lastRPMRotation=0,t}return Object(u.a)(s,[{key:"addToScene",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(e){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(m.a)(Object(y.a)(s.prototype),"addToScene",this).call(this,e,"driverCar",R,O);case 2:return t.abrupt("return",this);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"animate",value:function(){this.moveCar()}},{key:"addPhysicsView",value:function(t){this.physicsShape=new l.yb(2,1.35,5);var e=new l.e(this.physicsShape.x,this.physicsShape.y,this.physicsShape.z),s=new l.Q({color:255});this.PHYSICSSQUARE=new l.P(e,s),this.PHYSICSSQUARE.position.set(0,0,0),t.add(this.PHYSICSSQUARE);var i=new l.l(.35,.35,.35,32,32);i.rotateZ(Math.PI/2);var n=new l.Q({color:16711680});this.wheelMesh1=new l.P(i,n),this.wheelMesh1.position.set(0,4,0),t.add(this.wheelMesh1),this.wheelMesh2=new l.P(i,n),this.wheelMesh2.position.set(0,4,0),t.add(this.wheelMesh2),this.wheelMesh3=new l.P(i,n),this.wheelMesh3.position.set(0,4,0),t.add(this.wheelMesh3),this.wheelMesh4=new l.P(i,n),this.wheelMesh4.position.set(0,4,0),t.add(this.wheelMesh4)}},{key:"watchPhysicsColliders",value:function(){null!=this.observedState&&(this.PHYSICSSQUARE.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.PHYSICSSQUARE.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.wheelMesh1.position.set(this.observedState.wheelsData[0].position.x,this.observedState.wheelsData[0].position.y,this.observedState.wheelsData[0].position.z),this.wheelMesh1.quaternion.set(this.observedState.wheelsData[0].rotation.x,this.observedState.wheelsData[0].rotation.y,this.observedState.wheelsData[0].rotation.z,this.observedState.wheelsData[0].rotation.w),this.wheelMesh2.position.set(this.observedState.wheelsData[1].position.x,this.observedState.wheelsData[1].position.y,this.observedState.wheelsData[1].position.z),this.wheelMesh2.quaternion.set(this.observedState.wheelsData[1].rotation.x,this.observedState.wheelsData[1].rotation.y,this.observedState.wheelsData[1].rotation.z,this.observedState.wheelsData[1].rotation.w),this.wheelMesh3.position.set(this.observedState.wheelsData[2].position.x,this.observedState.wheelsData[2].position.y,this.observedState.wheelsData[2].position.z),this.wheelMesh3.quaternion.set(this.observedState.wheelsData[2].rotation.x,this.observedState.wheelsData[2].rotation.y,this.observedState.wheelsData[2].rotation.z,this.observedState.wheelsData[2].rotation.w),this.wheelMesh4.position.set(this.observedState.wheelsData[3].position.x,this.observedState.wheelsData[3].position.y,this.observedState.wheelsData[3].position.z),this.wheelMesh4.quaternion.set(this.observedState.wheelsData[3].rotation.x,this.observedState.wheelsData[3].rotation.y,this.observedState.wheelsData[3].rotation.z,this.observedState.wheelsData[3].rotation.w))}},{key:"moveCar",value:function(){null!=this.observedState&&(this.threeDModel.userData.physicsBody=this.observedState.physicsBody,this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w),this.lastValueRotation=this.observedState.direction,this.rotateWheels(),this.rotateSteeringWheel(),this.rotateVelocityAndRPM())}},{key:"rotateSteeringWheel",value:function(){var t=this.threeDModel.children.find((function(t){return"Steering_Wheel"===t.name})),e=new l.yb(0,0,1).applyAxisAngle(new l.yb(1,0,0),-.35);t.rotateOnAxis(e,-this.lastSteeringRotation),t.rotateOnAxis(e,540*-this.observedState.lastRotationWheel/360*Math.PI*2),this.lastSteeringRotation=540*-this.observedState.lastRotationWheel/360*Math.PI*2}},{key:"rotateVelocityAndRPM",value:function(){var t=this.threeDModel.children.find((function(t){return"Cubo"===t.name})),e=this.threeDModel.children.find((function(t){return"Cubo001"===t.name})),s=-Math.abs(this.observedState.velocity)*(240*Math.PI/180)/240,i=-this.observedState.rpm*(260*Math.PI/180)/6e3;t.rotateOnAxis(new l.yb(0,1,0),-this.lastVelocityRotation),t.rotateOnAxis(new l.yb(0,1,0),s),e.rotateOnAxis(new l.yb(0,1,0),-this.lastRPMRotation),e.rotateOnAxis(new l.yb(0,1,0),i),this.lastVelocityRotation=s,this.lastRPMRotation=i}},{key:"rotateWheels",value:function(){var t=this.threeDModel.children.find((function(t){return"wheel002"===t.name})),e=this.threeDModel.children.find((function(t){return"wheel"===t.name})),s=this.threeDModel.children.find((function(t){return"wheel003"===t.name})),i=this.threeDModel.children.find((function(t){return"wheel001"===t.name})),n=new l.yb(0,1,0).applyAxisAngle(new l.yb(1,0,0),this.currentSpeedRotation),a=new l.yb(0,1,0).applyAxisAngle(new l.yb(1,0,0),-this.currentSpeedRotation);e.rotateOnAxis(a,this.currentWheelRotation),t.rotateOnAxis(n,this.currentWheelRotation),e.rotateX(this.observedState.velocity*k*4),t.rotateX(-this.observedState.velocity*k*4),s.rotateX(-this.observedState.velocity*k*4),i.rotateX(this.observedState.velocity*k*4),n=new l.yb(0,1,0).applyAxisAngle(new l.yb(1,0,0),this.currentSpeedRotation+this.observedState.velocity*k*4),a=new l.yb(0,1,0).applyAxisAngle(new l.yb(1,0,0),-this.currentSpeedRotation-this.observedState.velocity*k*4),e.rotateOnAxis(a,-this.observedState.lastRotationWheel*x),t.rotateOnAxis(n,-this.observedState.lastRotationWheel*x),this.currentWheelRotation=this.observedState.lastRotationWheel*x,this.currentSpeedRotation+=this.observedState.velocity*k*4,this.currentSpeedRotation>=2*Math.PI&&(this.currentSpeedRotation-=2*Math.PI)}}]),s}(P),M=s(22).default,A=function(){function t(e){Object(h.a)(this,t),this.carLogic=e;var s=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(var i=0;i<s.length;i++)s[i]&&s[i].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=s[i]);this.buttonX=0,this.buttonSquare=1,this.buttonCircle=2,this.buttonTriangle=3,this.bumperRight=4,this.bumperLeft=5,this.buttonR2=6,this.buttonL2=7,this.shareButton=8,this.optionsButton=9,this.buttonR3=10,this.buttonL3=11,this.firstShift=12,this.secondShift=13,this.thirdShift=14,this.fourthShift=15,this.fifthShift=16,this.sixthShift=17,this.reverseShift=18,this.buttonPlus=19,this.buttonMinus=20,this.wheelInEnterRight=21,this.wheelInEnterLeft=22,this.enter=23,this.psButton=24,this.buttonsPressed=[];for(var n=0;n<=24;n++)this.buttonsPressed.push(!1);this.wheelAxes=0,this.clutch=1,this.accelerator=2,this.brake=5,this.DPad=9,this.valueDpadUP=-1,this.valueDpadDOWN=.14285719394683838,this.valueDpadLEFT=.7142857313156128,this.valueDpadRIGHT=-.4285714030265808,this.dpadPressed=[];for(var a=0;a<=3;a++)this.dpadPressed.push(!1);this.globalControllerHandler=new M(e)}return Object(u.a)(t,[{key:"checkGamepadChanges",value:function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("G29 Driving Force Racing Wheel")&&(this.gamepad=t[e])}},{key:"checkEvents",value:function(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}},{key:"doActionsPedals",value:function(){var t=Math.pow(this.gamepad.axes[this.clutch],3),e=Math.pow(this.gamepad.axes[this.brake],3);e=1-(e+1)/2;var s=Math.pow(this.gamepad.axes[this.accelerator],3);s=1-(s+1)/2,this.globalControllerHandler.handleAccelerate(t,s),this.globalControllerHandler.handleBrake(t,e)}},{key:"doActionsWheel",value:function(){this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes])}},{key:"doActionsDPad",value:function(){if(1.2857143878936768!==this.gamepad.axes[this.DPad])this.gamepad.axes[this.DPad]!==this.valueDpadDOWN||this.dpadPressed[1]?this.gamepad.axes[this.DPad]!==this.valueDpadDOWN&&(this.dpadPressed[1]=!1):(console.log("DPAD DOWN"),this.dpadPressed[1]=!0),this.gamepad.axes[this.DPad]!==this.valueDpadLEFT||this.dpadPressed[2]?this.gamepad.axes[this.DPad]!==this.valueDpadLEFT&&(this.dpadPressed[2]=!1):(console.log("DPAD LEFT"),this.dpadPressed[2]=!0),this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT||this.dpadPressed[3]?this.gamepad.axes[this.DPad]!==this.valueDpadRIGHT&&(this.dpadPressed[3]=!1):(console.log("DPAD RIGHT"),this.dpadPressed[3]=!0),this.gamepad.axes[this.DPad]!==this.valueDpadUP||this.dpadPressed[0]?this.gamepad.axes[this.DPad]!==this.valueDpadUP&&(this.dpadPressed[0]=!1):(console.log("DPAD UP"),this.dpadPressed[0]=!0);else for(var t=0;t<this.dpadPressed.length;t++)this.dpadPressed[t]=!1}},{key:"doActionsButtons",value:function(){this.gamepad.buttons[this.buttonX].pressed&&!this.buttonsPressed[this.buttonX]?(console.log("BOTON X"),this.buttonsPressed[this.buttonX]=!0):this.gamepad.buttons[this.buttonX].pressed||(this.buttonsPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonTriangle].pressed&&!this.buttonsPressed[this.buttonTriangle]?(console.log("BOTON TRIANGULO"),this.buttonsPressed[this.buttonTriangle]=!0):this.gamepad.buttons[this.buttonTriangle].pressed||(this.buttonsPressed[this.buttonTriangle]=!1),this.gamepad.buttons[this.buttonCircle].pressed&&!this.buttonsPressed[this.buttonCircle]?(console.log("BOTON CIRCULO"),this.buttonsPressed[this.buttonCircle]=!0):this.gamepad.buttons[this.buttonCircle].pressed||(this.buttonsPressed[this.buttonCircle]=!1),this.gamepad.buttons[this.buttonSquare].pressed&&!this.buttonsPressed[this.buttonSquare]?(console.log("BOTON CUADRADO"),this.buttonsPressed[this.buttonSquare]=!0):this.gamepad.buttons[this.buttonSquare].pressed||(this.buttonsPressed[this.buttonSquare]=!1),this.gamepad.buttons[this.psButton].pressed&&!this.buttonsPressed[this.psButton]?(this.carLogic.changeShiftBox("manual"),this.buttonsPressed[this.psButton]=!0):this.gamepad.buttons[this.psButton].pressed||(this.buttonsPressed[this.psButton]=!1),this.gamepad.buttons[this.buttonPlus].pressed&&!this.buttonsPressed[this.buttonPlus]?(console.log("BOTON +"),this.buttonsPressed[this.buttonPlus]=!0):this.gamepad.buttons[this.buttonPlus].pressed||(this.buttonsPressed[this.buttonPlus]=!1),this.gamepad.buttons[this.buttonMinus].pressed&&!this.buttonsPressed[this.buttonMinus]?(console.log("BOTON -"),this.buttonsPressed[this.buttonMinus]=!0):this.gamepad.buttons[this.buttonMinus].pressed||(this.buttonsPressed[this.buttonMinus]=!1),this.gamepad.buttons[this.buttonL2].pressed&&!this.buttonsPressed[this.buttonL2]?(console.log("BOTON L2"),this.buttonsPressed[this.buttonL2]=!0):this.gamepad.buttons[this.buttonL2].pressed||(this.buttonsPressed[this.buttonL2]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonsPressed[this.buttonL3]?(console.log("BOTON L3"),this.buttonsPressed[this.buttonL3]=!0):this.gamepad.buttons[this.buttonL3].pressed||(this.buttonsPressed[this.buttonL3]=!1),this.gamepad.buttons[this.buttonR2].pressed&&!this.buttonsPressed[this.buttonR2]?(this.globalControllerHandler.turnOnCar(),this.buttonsPressed[this.buttonR2]=!0):this.gamepad.buttons[this.buttonR2].pressed||(this.buttonsPressed[this.buttonR2]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonsPressed[this.buttonR3]?(console.log("BOTON R3"),this.buttonsPressed[this.buttonR3]=!0):this.gamepad.buttons[this.buttonR3].pressed||(this.buttonsPressed[this.buttonR3]=!1),this.gamepad.buttons[this.enter].pressed&&!this.buttonsPressed[this.enter]?(console.log("BOTON ENTER"),this.buttonsPressed[this.enter]=!0):this.gamepad.buttons[this.enter].pressed||(this.buttonsPressed[this.enter]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonsPressed[this.shareButton]?(console.log("BOTON SHARE"),this.buttonsPressed[this.shareButton]=!0):this.gamepad.buttons[this.shareButton].pressed||(this.buttonsPressed[this.shareButton]=!1),this.gamepad.buttons[this.optionsButton].pressed&&!this.buttonsPressed[this.optionsButton]?(console.log("BOTON OPTIONS"),this.buttonsPressed[this.optionsButton]=!0):this.gamepad.buttons[this.optionsButton].pressed||(this.buttonsPressed[this.optionsButton]=!1),this.gamepad.buttons[this.bumperLeft].pressed&&!this.buttonsPressed[this.bumperLeft]?(console.log("BOTON BUMPER LEFT"),this.buttonsPressed[this.bumperLeft]=!0):this.gamepad.buttons[this.bumperLeft].pressed||(this.buttonsPressed[this.bumperLeft]=!1),this.gamepad.buttons[this.bumperRight].pressed&&!this.buttonsPressed[this.bumperRight]?(console.log("BOTON BUMPER RIGHT"),this.buttonsPressed[this.bumperRight]=!0):this.gamepad.buttons[this.bumperRight].pressed||(this.buttonsPressed[this.bumperRight]=!1),this.gamepad.buttons[this.wheelInEnterLeft].pressed&&!this.buttonsPressed[this.wheelInEnterLeft]?(console.log("RUEDA IZQ"),this.buttonsPressed[this.wheelInEnterLeft]=!0):this.gamepad.buttons[this.wheelInEnterLeft].pressed||(this.buttonsPressed[this.wheelInEnterLeft]=!1),this.gamepad.buttons[this.wheelInEnterRight].pressed&&!this.buttonsPressed[this.wheelInEnterRight]?(console.log("RUEDA DER"),this.buttonsPressed[this.wheelInEnterRight]=!0):this.gamepad.buttons[this.wheelInEnterRight].pressed||(this.buttonsPressed[this.wheelInEnterRight]=!1)}},{key:"doActionsShifter",value:function(){this.gamepad.buttons[this.firstShift].pressed&&!this.buttonsPressed[this.firstShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],1),this.buttonsPressed[this.firstShift]=!0):!this.gamepad.buttons[this.firstShift].pressed&&this.buttonsPressed[this.firstShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.firstShift]=!1),this.gamepad.buttons[this.secondShift].pressed&&!this.buttonsPressed[this.secondShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],2),this.buttonsPressed[this.secondShift]=!0):!this.gamepad.buttons[this.secondShift].pressed&&this.buttonsPressed[this.secondShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.secondShift]=!1),this.gamepad.buttons[this.thirdShift].pressed&&!this.buttonsPressed[this.thirdShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],3),this.buttonsPressed[this.thirdShift]=!0):!this.gamepad.buttons[this.thirdShift].pressed&&this.buttonsPressed[this.thirdShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.thirdShift]=!1),this.gamepad.buttons[this.fourthShift].pressed&&!this.buttonsPressed[this.fourthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],4),this.buttonsPressed[this.fourthShift]=!0):!this.gamepad.buttons[this.fourthShift].pressed&&this.buttonsPressed[this.fourthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fourthShift]=!1),this.gamepad.buttons[this.fifthShift].pressed&&!this.buttonsPressed[this.fifthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],5),this.buttonsPressed[this.fifthShift]=!0):!this.gamepad.buttons[this.fifthShift].pressed&&this.buttonsPressed[this.fifthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.fifthShift]=!1),this.gamepad.buttons[this.sixthShift].pressed&&!this.buttonsPressed[this.sixthShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],6),this.buttonsPressed[this.sixthShift]=!0):!this.gamepad.buttons[this.sixthShift].pressed&&this.buttonsPressed[this.sixthShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.sixthShift]=!1),this.gamepad.buttons[this.reverseShift].pressed&&!this.buttonsPressed[this.reverseShift]?(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],-1),this.buttonsPressed[this.reverseShift]=!0):!this.gamepad.buttons[this.reverseShift].pressed&&this.buttonsPressed[this.reverseShift]&&(this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch],0),this.buttonsPressed[this.reverseShift]=!1)}},{key:"doActionByMapping",value:function(){this.doActionsPedals(),this.doActionsWheel(),this.doActionsDPad(),this.doActionsButtons(),this.doActionsShifter()}}]),t}(),D=function(){function t(){throw Object(h.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(e){return t.instance||(t.instance=new A(e)),t.instance}}]),t}(),T=s(22).default,C=.1,I=function(){function t(e){Object(h.a)(this,t);var s=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];this.gamepad=null;for(var i=0;i<s.length;i++)s[i]&&s[i].id.startsWith("Xbox")&&(this.gamepad=s[i]);this.buttonA=0,this.buttonB=1,this.buttonX=2,this.buttonY=3,this.buttonL1=4,this.buttonR1=5,this.buttonL2=6,this.buttonR2=7,this.shareButton=8,this.optionButton=9,this.buttonL3=10,this.buttonR3=11,this.padUp=12,this.padDown=13,this.padLeft=14,this.padRight=15,this.buttomHome=16,this.buttonPressed=[],this.actualShift=0;for(var n=0;n<=16;n++)this.buttonPressed.push(!1);this.xLeftAxe=0,this.yLeftAxe=1,this.xRightAxe=2,this.yRightAxe=3,this.globalControllerHandler=new T(e)}return Object(u.a)(t,[{key:"checkGamepadChanges",value:function(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],e=0;e<t.length;e++)t[e]&&t[e].id.startsWith("Xbox")&&(this.gamepad=t[e])}},{key:"checkEvents",value:function(){this.gamepad=null,this.checkGamepadChanges(),null!=this.gamepad&&this.doActionByMapping(),this.globalControllerHandler.updateCar()}},{key:"doActionsAxes",value:function(){if(Math.abs(this.gamepad.axes[this.yLeftAxe]),Math.abs(this.gamepad.axes[this.xLeftAxe])>=C){var t=Math.pow(this.gamepad.axes[this.xLeftAxe],3);this.globalControllerHandler.turnDirection(t)}else this.globalControllerHandler.turnDirection(0);Math.abs(this.gamepad.axes[this.yRightAxe]),Math.abs(this.gamepad.axes[this.xRightAxe])}},{key:"doActionHotKeys",value:function(){this.globalControllerHandler.handleAccelerate(1,this.gamepad.buttons[this.buttonR2].value),this.globalControllerHandler.handleBrake(0,this.gamepad.buttons[this.buttonL2].value)}},{key:"doActionsTriggers",value:function(){this.gamepad.buttons[this.buttonR2].pressed&&console.log("accelerator: "+this.gamepad.buttons[this.buttonR2].value),this.gamepad.buttons[this.buttonL2].pressed}},{key:"doActionsButtons",value:function(){this.gamepad.buttons[this.buttonR1].pressed&&!this.buttonPressed[this.buttonR1]?(this.actualShift<=5&&(this.actualShift+=1,console.log("Marcha Actual: "+this.actualShift),this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonR1]=!0):this.gamepad.buttons[this.buttonR1].pressed||(this.buttonPressed[this.buttonR1]=!1),this.gamepad.buttons[this.buttonL1].pressed&&!this.buttonPressed[this.buttonL1]?(this.actualShift>=0&&(this.actualShift-=1,console.log("Marcha Actual: "+this.actualShift),this.globalControllerHandler.changeShift(0,this.actualShift)),this.buttonPressed[this.buttonL1]=!0):this.gamepad.buttons[this.buttonL1].pressed||(this.buttonPressed[this.buttonL1]=!1),this.gamepad.buttons[this.shareButton].pressed&&!this.buttonPressed[this.shareButton]?(console.log("shareButton"),this.buttonPressed[this.shareButton]=!0):this.gamepad.buttons[this.shareButton].pressed||(this.buttonPressed[this.shareButton]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?(console.log("padUp"),this.buttonPressed[this.padUp]=!0):this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?(console.log("padDown"),this.buttonPressed[this.padDown]=!0):this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?(console.log("padLeft"),this.buttonPressed[this.padLeft]=!0):this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?(console.log("padRight"),this.buttonPressed[this.padRight]=!0):this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttonA].pressed&&!this.buttonPressed[this.buttonA]?(console.log("buttonA"),this.buttonPressed[this.buttonA]=!0):this.gamepad.buttons[this.buttonA].pressed||(this.buttonPressed[this.buttonA]=!1),this.gamepad.buttons[this.buttonB].pressed&&!this.buttonPressed[this.buttonB]?(console.log("buttonB"),this.buttonPressed[this.buttonB]=!0):this.gamepad.buttons[this.buttonB].pressed||(this.buttonPressed[this.buttonB]=!1),this.gamepad.buttons[this.buttonY].pressed&&!this.buttonPressed[this.buttonY]?(console.log("buttonY"),this.buttonPressed[this.buttonY]=!0):this.gamepad.buttons[this.buttonY].pressed||(this.buttonPressed[this.buttonY]=!1),this.gamepad.buttons[this.buttonX].pressed&&!this.buttonPressed[this.buttonX]?(console.log("buttonX"),this.buttonPressed[this.buttonX]=!0):this.gamepad.buttons[this.buttonX].pressed||(this.buttonPressed[this.buttonX]=!1),this.gamepad.buttons[this.buttonR3].pressed&&!this.buttonPressed[this.buttonR3]?(console.log("buttonR3"),this.buttonPressed[this.buttonR3]=!0):this.gamepad.buttons[this.buttonR3].pressed||(this.buttonPressed[this.buttonR3]=!1),this.gamepad.buttons[this.buttonL3].pressed&&!this.buttonPressed[this.buttonL3]?(console.log("buttonL3"),this.buttonPressed[this.buttonL3]=!0):this.gamepad.buttons[this.buttonL3].pressed||(this.buttonPressed[this.buttonL3]=!1),this.gamepad.buttons[this.padUp].pressed&&!this.buttonPressed[this.padUp]?(console.log("padUp"),this.buttonPressed[this.padUp]=!0):this.gamepad.buttons[this.padUp].pressed||(this.buttonPressed[this.padUp]=!1),this.gamepad.buttons[this.padDown].pressed&&!this.buttonPressed[this.padDown]?(console.log("padDown"),this.buttonPressed[this.padDown]=!0):this.gamepad.buttons[this.padDown].pressed||(this.buttonPressed[this.padDown]=!1),this.gamepad.buttons[this.padLeft].pressed&&!this.buttonPressed[this.padLeft]?(console.log("padLeft"),this.buttonPressed[this.padLeft]=!0):this.gamepad.buttons[this.padLeft].pressed||(this.buttonPressed[this.padLeft]=!1),this.gamepad.buttons[this.padRight].pressed&&!this.buttonPressed[this.padRight]?(console.log("padRight"),this.buttonPressed[this.padRight]=!0):this.gamepad.buttons[this.padRight].pressed||(this.buttonPressed[this.padRight]=!1),this.gamepad.buttons[this.buttomHome].pressed&&!this.buttonPressed[this.buttomHome]?(console.log("Menu"),this.globalControllerHandler.changeShiftBox("semi-auto"),this.buttonPressed[this.buttomHome]=!0):this.gamepad.buttons[this.buttomHome].pressed||(this.buttonPressed[this.buttomHome]=!1),this.gamepad.buttons[this.optionButton].pressed&&!this.buttonPressed[this.optionButton]?(this.globalControllerHandler.turnOnCar(),this.buttonPressed[this.optionButton]=!0):this.gamepad.buttons[this.optionButton].pressed||(this.buttonPressed[this.optionButton]=!1)}},{key:"doActionByMapping",value:function(){this.doActionHotKeys(),this.doActionsAxes(),this.doActionsTriggers(),this.doActionsButtons()}}]),t}(),B=function(){function t(){throw Object(h.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(e){return t.instance||(t.instance=new I(e)),t.instance}}]),t}(),E=function(){function t(){Object(h.a)(this,t),this.observers=[]}return Object(u.a)(t,[{key:"attachObserver",value:function(t){this.observers.push(t)}},{key:"removeObserver",value:function(t){var e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)}},{key:"notifyObservers",value:function(t){for(var e=0;e<this.observers.length;e++)this.observers[e].update(t)}}]),t}(),L=s(27),H=s.n(L),W=function(){function t(){throw Object(h.a)(this,t),new Error("Can not construct singleton. Call get instance instead.")}return Object(u.a)(t,null,[{key:"getInstance",value:function(){var e=Object(r.a)(Object(o.a)().mark((function e(){return Object(o.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.AmmoInstanceToReturn){e.next=4;break}return e.next=3,H()();case 3:t.AmmoInstanceToReturn=e.sent;case 4:return e.abrupt("return",t.AmmoInstanceToReturn);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}();W.AmmoInstanceToReturn=null;var V=function(){function t(e,s,i,n,a,o,r){Object(h.a)(this,t),this.position=e,this.quaternion=s,this.inertia=i,this.mass=n,this.shape=a,this.physicsWorld=o,this.friction=r}return Object(u.a)(t,[{key:"buildAmmoPhysics",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s,i,n,a,r;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:e=t.sent,this.inertia=new e.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=e,(s=new e.btTransform).setIdentity(),s.setOrigin(new e.btVector3(this.position.x,this.position.y,this.position.z)),s.setRotation(new e.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new e.btTransform,i=new e.btDefaultMotionState(s),(n=new e.btBoxShape(new e.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2))).calculateLocalInertia(this.mass,this.inertia),a=new e.btRigidBodyConstructionInfo(this.mass,i,n,this.inertia),this.rigidBody=new e.btRigidBody(a),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(10*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.tuning=new this.Ammo.btVehicleTuning,r=new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld),this.vehicle=new this.Ammo.btRaycastVehicle(this.tuning,this.rigidBody,r),this.vehicle.setCoordinateSystem(0,1,2),this.physicsWorld.addAction(this.vehicle),.35,.85,-1.45,.35,.35,-.85,.2,1.65,.85,.2,.35,.35,this.addWheel(!0,new this.Ammo.btVector3(.85,.2,1.65),.35,.35,0,1),this.addWheel(!0,new this.Ammo.btVector3(-.85,.2,1.65),.35,.35,1,-1),this.addWheel(!1,new this.Ammo.btVector3(.85,.2,-1.45),.35,.35,2,1),this.addWheel(!1,new this.Ammo.btVector3(-.85,.2,-1.45),.35,.35,3,-1),this.mass>0&&this.rigidBody.setActivationState(4);case 40:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addWheel",value:function(t,e,s,i,n,a){var o=new this.Ammo.btVector3(0,-1,0),r=new this.Ammo.btVector3(-1,0,0),h=this.vehicle.addWheel(e,o,r,.6,s,this.tuning,t);h.set_m_suspensionStiffness(2),h.set_m_wheelsDampingRelaxation(3.3),h.set_m_wheelsDampingCompression(4.4),h.set_m_frictionSlip(1e3),h.set_m_rollInfluence(.2)}},{key:"updatePhysics",value:function(){for(var t={chassis:{position:null,rotation:null},wheels:[]},e=0;e<this.vehicle.getNumWheels();e++){this.vehicle.updateWheelTransform(e,!0);var s=this.vehicle.getWheelTransformWS(e),i=s.getOrigin(),n=s.getRotation();t.wheels.push({position:new l.yb(i.x(),i.y(),i.z()),rotation:new l.zb(n.x(),n.y(),n.z(),n.w())})}var a=this.vehicle.getChassisWorldTransform(),o=a.getOrigin(),r=a.getRotation();return t.chassis={position:new l.yb(o.x(),o.y(),o.z()),rotation:new l.zb(r.x(),r.y(),r.z(),r.w())},t}},{key:"getRigidBody",value:function(){return this.rigidBody}},{key:"setEngineForce",value:function(t){this.vehicle.applyEngineForce(t,2),this.vehicle.applyEngineForce(t,3)}},{key:"brake",value:function(t){var e=Math.abs(this.vehicle.getCurrentSpeedKmHour()),s=100/e;0===e&&(s=0),t+=s,this.vehicle.setBrake(t/2,0),this.vehicle.setBrake(t/2,1),this.vehicle.setBrake(t,2),this.vehicle.setBrake(t,3)}},{key:"setSteeringRotation",value:function(t){this.vehicle.setSteeringValue(-.5*t,0),this.vehicle.setSteeringValue(-.5*t,1)}},{key:"getVelocity",value:function(){return this.vehicle.getCurrentSpeedKmHour()}}]),t}(),z=8e3,U=200,G=function(){function t(){Object(h.a)(this,t)}return Object(u.a)(t,[{key:"changeValueInRPMCurve",value:function(t,e,s,i){var n;e?n=2*(t-s/z):n=1.5*-t;return(i+=n)>600?i=600:i<0&&(i=0),[s=z*(1-Math.exp(-i/U)),i]}}]),t}(),F=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"accelerate",value:function(t,e,s){return this.changeValueInRPMCurve(0,!0,e,s)}},{key:"brake",value:function(t,e,s){return this.changeValueInRPMCurve(t,!1,e,s)}}]),s}(G),N=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"accelerate",value:function(t,e,s){return this.changeValueInRPMCurve(t,!0,e,s)}},{key:"brake",value:function(t,e,s){return this.changeValueInRPMCurve(t,!1,e,s)}}]),s}(G),X=function(){function t(){Object(h.a)(this,t),this.engineState=new F,this.currentRPM=0,this.currentXInRPMCurve=0}return Object(u.a)(t,[{key:"turnOn",value:function(){this.engineState=new N}},{key:"clutchIsPressed",value:function(t){return t<=.25}},{key:"handleEngineShutdown",value:function(t,e){e.shutDownEngine(t,this.currentRPM)&&this.engineState instanceof N&&(this.engineState=new F)}},{key:"isInConditionToAccelerate",value:function(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)||this.clutchIsPressed(t)}},{key:"engineCanApplyForce",value:function(t){return this.currentRPM>=0&&!this.clutchIsPressed(t)}},{key:"accelerate",value:function(t,e,s){var i=this.engineState.accelerate(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=i[0],this.currentXInRPMCurve=i[1],this.handleEngineShutdown(t,s)}},{key:"brake",value:function(t,e,s){var i=this.engineState.brake(e,this.currentRPM,this.currentXInRPMCurve);this.currentRPM=i[0],this.currentXInRPMCurve=i[1],this.handleEngineShutdown(t,s)}},{key:"changeRPM",value:function(t){this.currentRPM=t,-this.currentRPM/z+1>0?(this.currentXInRPMCurve=-Math.log(-this.currentRPM/z+1)*U,this.currentXInRPMCurve<0&&(this.currentXInRPMCurve=0)):this.currentRPM===z&&(this.currentXInRPMCurve=600)}},{key:"getCurrentRPM",value:function(){return this.currentRPM}}]),t}(),_=function(){function t(e){Object(h.a)(this,t),this.NEUTRAL=0,this.REVERSE=-1,this.FIRST=1,this.SECOND=2,this.THIRD=3,this.FOURTH=4,this.FIFTH=5,this.SIXTH=6,this.validShifts=[this.REVERSE,this.NEUTRAL,this.FIRST,this.SECOND,this.THIRD,this.FOURTH,this.FIFTH,this.SIXTH],this.currentShift=this.NEUTRAL,this.carEngine=e,this.minimumVelocityOnShift=[0,10,20,35,60,90],this.maximumVelocityOnShift=[40,60,80,110,140,200]}return Object(u.a)(t,[{key:"isValidShift",value:function(t){if(this.validShifts.indexOf(t)>=0)return!0;throw new Error("Shift "+t+" is not valid.")}},{key:"calculateNormalFactorRPM",value:function(t,e){return(e-this.minimumVelocityOnShift[Math.abs(t)-1])/(this.maximumVelocityOnShift[Math.abs(t)-1]-this.minimumVelocityOnShift[Math.abs(t)-1])}},{key:"getValueForNewRPM",value:function(t,e){if(t===this.NEUTRAL||Math.abs(t)===this.FIRST&&Math.abs(e)<5)return this.carEngine.getCurrentRPM();if(t===this.REVERSE&&e>0)return 0;if(t>0&&e<0)return 0;var s=this.calculateNormalFactorRPM(t,e);if(s>1)return z;var i=s*U;return z*(1-Math.exp(-i/U))}},{key:"clutchIsPressed",value:function(t){return t<=-.75}},{key:"shutDownEngine",value:function(){return!1}},{key:"getEngineForce",value:function(t,e){t=Math.abs(t);var s=this.carEngine.getCurrentRPM();if(this.currentShift===this.NEUTRAL)return 0;var i=(e+1)/2,n=this.minimumVelocityOnShift[Math.abs(this.currentShift)-1]*(1-Math.exp(3*-i)),a=(t-n)/(this.maximumVelocityOnShift[Math.abs(this.currentShift)-1]-n),o=Math.pow(1-a,2);return o>1&&(o=0),6/this.currentShift*s*o}},{key:"changeShift",value:function(){}},{key:"getCurrentShift",value:function(){return this.currentShift}}]),t}(),q=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"changeShift",value:function(t,e,s){if(!this.isValidShift(e)||!this.clutchIsPressed(t))throw new Error("Can't change shift if clutch is not pressed");this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,s,t))}},{key:"shutDownEngine",value:function(t,e){return!this.clutchIsPressed(t)&&e<1e3}}]),s}(_),Q=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"changeShift",value:function(t,e,s){this.isValidShift(e)&&(this.currentShift=e,this.carEngine.changeRPM(this.getValueForNewRPM(e,s,t)))}}]),s}(_),Y=[0,0,0],K=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this)).carEngine=new X,i.shiftBox=new Q(i.carEngine),i.currentDirectionTurn=0,i.currentTireRotation=0,i.position=new l.yb(Y[0],Y[1],Y[2]),i.rotationQuaternion=new l.zb(0,0,0,1),i.mass=1e3,i.physicsShape=new l.yb(2,1.3,5),i.rotation=new l.zb(0,0,0,1),i.inertia=new l.yb(1,0,1),i.carPhysics=new V(i.position,i.rotationQuaternion,i.inertia,i.mass,i.physicsShape,t,0),i.carPhysics.buildAmmoPhysics(),i}return Object(u.a)(s,[{key:"accelerate",value:function(t,e){this.carEngine.accelerate(t,e,this.shiftBox),e>.1&&this.carEngine.engineCanApplyForce(t)?this.carPhysics.setEngineForce(this.shiftBox.getEngineForce(this.carPhysics.getVelocity(),t)):this.carPhysics.setEngineForce(0)}},{key:"brake",value:function(t,e){this.carEngine.brake(t,e,this.shiftBox),this.carPhysics.brake(300*e)}},{key:"changeShift",value:function(t,e){this.shiftBox.changeShift(t,e,this.carPhysics.getVelocity())}},{key:"turnOnRightLight",value:function(){}},{key:"turnOnLeftLight",value:function(){}},{key:"turnOnCar",value:function(){this.carEngine.turnOn()}},{key:"turnDirection",value:function(t){this.currentTireRotation=t,this.carPhysics.setSteeringRotation(t)}},{key:"update",value:function(){var t=this.carPhysics.updatePhysics();this.position=t.chassis.position,this.rotation=t.chassis.rotation,this.wheelsData=t.wheels,Object(m.a)(Object(y.a)(s.prototype),"notifyObservers",this).call(this,this.getDataToAnimate())}},{key:"getLastRotation",value:function(){return this.currentTireRotation}},{key:"getDataToAnimate",value:function(){return{direction:this.currentDirectionTurn,velocity:this.carPhysics.getVelocity(),lastRotationWheel:this.currentTireRotation,position:this.position,rotation:this.rotation,physicsBody:this.carPhysics,wheelsData:this.wheelsData,rpm:this.getCurrentRPM()}}},{key:"getSpeed",value:function(){return this.carPhysics.getVelocity()}},{key:"getCurrentRPM",value:function(){return this.carEngine.getCurrentRPM()}},{key:"changeShiftBox",value:function(t){"semi-auto"===t?this.shiftBox=new Q(this.carEngine):"manual"===t&&(this.shiftBox=new q(this.carEngine))}},{key:"getCurrentShift",value:function(){return this.shiftBox.getCurrentShift()}}]),s}(E),Z=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t,i,n,a,o,r,u){var c;return Object(h.a)(this,s),(c=e.call(this)).position=t,c.quaternion=i,c.inertia=n,c.mass=a,c.shape=o,c.physicsWorld=r,u||(u=1),c.friction=u,c}return Object(u.a)(s,[{key:"generateShape",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"buildAmmoPhysics",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s,i,n,a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:return e=t.sent,this.inertia=new e.btVector3(this.inertia.x,this.inertia.y,this.inertia.z),this.Ammo=e,(s=new e.btTransform).setIdentity(),s.setOrigin(new e.btVector3(this.position.x,this.position.y,this.position.z)),s.setRotation(new e.btQuaternion(this.quaternion.x,this.quaternion.y,this.quaternion.z,this.quaternion.w)),this.tempTransform=new e.btTransform,i=new e.btDefaultMotionState(s),t.next=13,this.generateShape();case 13:(n=t.sent).setMargin(.05),n.calculateLocalInertia(this.mass,this.inertia),a=new e.btRigidBodyConstructionInfo(this.mass,i,n,this.inertia),this.rigidBody=new e.btRigidBody(a),this.rigidBody.setFriction(this.friction),this.rigidBody.setRollingFriction(2*this.friction),this.physicsWorld.addRigidBody(this.rigidBody),this.mass>0&&this.rigidBody.setActivationState(4);case 22:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updatePhysics",value:function(){var t=this.rigidBody.getMotionState();if(t){t.getWorldTransform(this.tempTransform);var e=this.tempTransform.getOrigin(),s=this.tempTransform.getRotation(),i={position:new l.yb(e.x(),e.y(),e.z()),rotation:new l.zb(s.x(),s.y(),s.z(),s.w())};return this.notifyObservers(i),i}throw new Error("No motion state found in rigid body")}},{key:"setLinearVelocity",value:function(t){var e=new this.Ammo.btVector3(this.mass*t.x,this.mass*t.y,this.mass*t.z);this.rigidBody.applyForce(e)}},{key:"getRigidBody",value:function(){return this.rigidBody}}]),s}(E),J=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"generateShape",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:return e=t.sent,t.abrupt("return",new e.btCylinderShape(new e.btVector3(this.shape.x,this.shape.y,this.shape.z)));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),s}(Z),$=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(t){var i;return Object(h.a)(this,s),(i=e.call(this,t)).pathToTexture=t,i.RADIUS_TOP=.1,i.RADIUS_BOTTOM=.8,i.HEIGHT=1.25,i.observedState=null,i}return Object(u.a)(s,[{key:"animate",value:function(){null!=this.observedState&&(this.threeDModel.position.set(this.observedState.position.x,this.observedState.position.y,this.observedState.position.z),this.threeDModel.quaternion.set(this.observedState.rotation.x,this.observedState.rotation.y,this.observedState.rotation.z,this.observedState.rotation.w))}},{key:"addToScene",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(e,s,i,n){var a,r,h,u,c,d,b;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.threeDModel||(a=new l.l(this.RADIUS_TOP,this.RADIUS_BOTTOM,this.HEIGHT,32,void 0,!0),r=(new l.tb).load(this.pathToTexture),h=new l.Q({map:r}),u=new l.Q({color:13984548}),c=new l.e(2*this.RADIUS_BOTTOM,.1,2*this.RADIUS_BOTTOM),(d=new l.P(c,u)).position.set(0,-this.HEIGHT/2,0),(b=new l.P(a,h)).position.set(0,0,0),this.threeDModel=new l.u,this.threeDModel.add(b).add(d),this.threeDModel.name=s,this.threeDModel.position.set(i[0],i[1],i[2]),this.threeDModel.scale.set(n[0],n[1],n[2]),this.RADIUS_TOP*=n[0],this.RADIUS_BOTTOM*=n[0],this.HEIGHT*=n[1],e.add(this.threeDModel)),t.abrupt("return",this);case 2:case"end":return t.stop()}}),t,this)})));return function(e,s,i,n){return t.apply(this,arguments)}}()}]),s}(P),tt=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){return Object(h.a)(this,s),e.apply(this,arguments)}return Object(u.a)(s,[{key:"generateShape",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:return e=t.sent,t.abrupt("return",new e.btBoxShape(new e.btVector3(this.shape.x/2,this.shape.y/2,this.shape.z/2)));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),s}(Z),et=function(){function t(e,s,i){Object(h.a)(this,t),this.scene=s,this.physicsWorld=i,this.physicsToUpdate=[],this.objectsToAnimate=[],0===e&&this.createLevel0()}return Object(u.a)(t,[{key:"updatePhysics",value:function(){this.physicsToUpdate.forEach((function(t){t.updatePhysics()}))}},{key:"animate",value:function(){this.objectsToAnimate.forEach((function(t){t.animate()}))}},{key:"createRectangle",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(e,s,i,n,a,r,h){var u,c,d,b,p,f,g,v,m=arguments;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=m.length>7&&void 0!==m[7]?m[7]:null,(c=(new l.tb).load(r)).wrapS=l.jb,c.wrapT=l.jb,c.repeat.set(s,n),d=new l.U({map:c,side:l.n}),u&&((b=(new l.tb).load(u)).repeat.set(s,n),b.wrapS=l.jb,b.wrapT=l.jb,d.normalMap=b,d.normalScale.set(10,10)),(p=new l.e(s,i,n)).rotateX(a),(f=new l.hb).setFromAxisAngle(new l.yb(1,0,0),a),g=new tt(new l.yb(e[0],e[1],e[2]),f,new h.btVector3(0,0,0),0,new l.yb(s,i,n),this.physicsWorld,1e3),t.next=14,g.buildAmmoPhysics();case 14:this.physicsToUpdate.push(g),(v=new l.P(p,d)).position.set(e[0],e[1],e[2]),this.scene.add(v);case 18:case"end":return t.stop()}}),t,this)})));return function(e,s,i,n,a,o,r){return t.apply(this,arguments)}}()},{key:"createCone",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(e,s){var i,n;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=new $("textures/coneTexture.jpg")).addToScene(this.scene,"trafficCone",e,[.5,.5,.5]),n=new J(new l.yb(e[0],e[1],e[2]),(new l.hb).setFromAxisAngle(new l.yb(1,0,0),0),new s.btVector3(0,0,0),10,new l.yb(i.RADIUS_BOTTOM,i.HEIGHT/2,i.RADIUS_BOTTOM),this.physicsWorld,1e3),t.next=5,n.buildAmmoPhysics();case 5:this.physicsToUpdate.push(n),n.attachObserver(i),this.objectsToAnimate.push(i);case 8:case"end":return t.stop()}}),t,this)})));return function(e,s){return t.apply(this,arguments)}}()},{key:"createLevel0",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:e=t.sent,this.createRectangle([10,0,10],10,2,10,-Math.PI/8,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createRectangle([-10,0,10],10,2,10,-Math.PI/4,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createRectangle([0,0,0],100,.1,100,0,"textures/pavimento.jpg",e,"textures/pavimento_map.png"),this.createCone([0,.5,10],e),this.createCone([0,.5,30],e),this.createCone([0,.5,20],e);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),st=function(){function t(){Object(h.a)(this,t)}return Object(u.a)(t,null,[{key:"createButton",value:function(e){var s=document.createElement("button");function i(){s.style.display="",s.style.cursor="auto",s.style.left="calc(50% - 75px)",s.style.width="150px",s.onmouseenter=null,s.onmouseleave=null,s.onclick=null}function n(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return s.id="VRButton",s.style.display="none",n(s),navigator.xr.isSessionSupported("immersive-vr").then((function(n){n?function(){var t=null;function i(t){return n.apply(this,arguments)}function n(){return(n=Object(r.a)(Object(o.a)().mark((function i(n){return Object(o.a)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.addEventListener("end",a),i.next=3,e.xr.setSession(n);case 3:s.textContent="EXIT VR",t=n;case 5:case"end":return i.stop()}}),i)})))).apply(this,arguments)}function a(){t.removeEventListener("end",a),s.textContent="ENTER VR",t=null}s.style.display="",s.style.cursor="pointer",s.style.left="calc(50% - 50px)",s.style.width="100px",s.textContent="ENTER VR",s.onmouseenter=function(){s.style.opacity="1.0"},s.onmouseleave=function(){s.style.opacity="0.5"},s.onclick=function(){null===t?(navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(i),localStorage.setItem("VR",!0)):t.end()}}():(i(),s.textContent="VR NOT SUPPORTED"),n&&t.xrSessionIsGranted&&s.click()})).catch((function(t){i(),console.warn("Exception when trying to call xr.isSessionSupported",t),s.textContent="VR NOT ALLOWED"})),s;var a=document.createElement("a");return!1===window.isSecureContext?(a.href=document.location.href.replace(/^http:/,"https:"),a.innerHTML="WEBXR NEEDS HTTPS"):(a.href="https://immersiveweb.dev/",a.innerHTML="WEBXR NOT AVAILABLE"),a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",n(a),a}},{key:"registerSessionGrantedListener",value:function(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(function(){t.xrSessionIsGranted=!0}))}}}]),t}();st.xrSessionIsGranted=!1,st.registerSessionGrantedListener();var it=s(10),nt=function(t){Object(c.a)(s,t);var e=Object(d.a)(s);function s(){var t;return Object(h.a)(this,s),(t=e.call(this)).state={currentRPM:0,velocity:0,currentShift:0},t.physicsToUpdate=[],localStorage.setItem("VR",!1),t.gotAnyEvent=!1,t}return Object(u.a)(s,[{key:"componentDidMount",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.objectsToAnimate=[],this.scene=new l.kb,this.renderer=new l.Bb({alpha:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(8900346,1),this.renderer.outputEncoding=l.Cb,this.camera=new p(this.renderer),this.clock=new l.i,t.next=10,this.createAmmo();case 10:return this.ambientLight=new l.a(16777215,1),this.scene.add(this.ambientLight),this.sunLight=new l.m(16777215,1),this.sunLight.position.set(0,100,0),this.scene.add(this.sunLight),t.next=17,W.getInstance();case 17:return e=t.sent,this.level=new et(0,this.scene,this.physicsWorld),this.physicsToUpdate.push(this.level),this.objectsToAnimate.push(this.level),this.cone=new $("textures/coneTexture.jpg"),this.cone.addToScene(this.scene,"trafficCone",[10,0,0],[1,1,1]),this.conePhysics=new J(new l.yb(10,0,0),(new l.hb).setFromAxisAngle(new l.yb(1,0,0),0),new e.btVector3(0,0,0),10,new l.yb(this.cone.RADIUS_BOTTOM,this.cone.HEIGHT/2,this.cone.RADIUS_BOTTOM),this.physicsWorld,1e3),t.next=26,this.conePhysics.buildAmmoPhysics();case 26:return this.physicsToUpdate.push(this.conePhysics),this.conePhysics.attachObserver(this.cone),this.objectsToAnimate.push(this.cone),this.carLogic=new K(this.physicsWorld),s=new j,this.carLogic.attachObserver(s),this.carLogic.attachObserver(this.camera),t.t0=this.objectsToAnimate,t.next=36,s.addToScene(this.scene);case 36:t.t1=t.sent,t.t0.push.call(t.t0,t.t1),this.carLogic.notifyObservers(),this.animation=this.animation.bind(this),this.handleWindowResize=this.handleWindowResize.bind(this),this.generateEvents=this.generateEvents.bind(this),this.generateEvents(),this.mount.appendChild(this.renderer.domElement),this.animation(),document.body.appendChild(st.createButton(this.renderer)),this.renderer.xr.enabled=!0;case 47:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"generateEvents",value:function(){var t=this;window.addEventListener("resize",this.handleWindowResize),window.addEventListener("gamepaddisconnected",(function(t){D.removeInstance()})),document.addEventListener("keydown",(function(e){var s=e.key;switch(t.carLogic.removeObserver(t.camera),s){case"1":t.camera=new p(t.renderer);break;case"2":t.camera=new v(t.renderer);break;case"3":t.camera=new f(new l.yb(-4.35,.6,-.1));break;case"4":t.camera=new f(new l.yb(4.35,.6,-.1));break;case"5":t.camera=new f(new l.yb(0,3,-5))}t.carLogic.attachObserver(t.camera),t.carLogic.notifyObservers()}),!1)}},{key:"createAmmo",value:function(){var t=Object(r.a)(Object(o.a)().mark((function t(){var e,s,i,n,a;return Object(o.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W.getInstance();case 2:e=t.sent,this.tempTransform=new e.btTransform,s=new e.btDefaultCollisionConfiguration,i=new e.btCollisionDispatcher(s),n=new e.btDbvtBroadphase,a=new e.btSequentialImpulseConstraintSolver,this.physicsWorld=new e.btDiscreteDynamicsWorld(i,n,a,s),this.physicsWorld.setGravity(new e.btVector3(0,-9.8,0));case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleWindowResize",value:function(){this.camera.handleResize(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.render(this.scene,this.camera.getCameraInstance())}},{key:"animation",value:function(){var t=this.clock.getDelta();this.renderer.setAnimationLoop(this.animation),this.physicsWorld.stepSimulation(t,10),this.objectsToAnimate.forEach((function(t){t.animate()})),this.physicsToUpdate.forEach((function(t){t.updatePhysics()})),this.camera.setPositionRelativeToObject(),B.getInstance(this.carLogic).checkEvents(),this.setState({velocity:this.carLogic.getSpeed(),currentRPM:this.carLogic.getCurrentRPM(),currentShift:this.carLogic.getCurrentShift()}),this.renderer.render(this.scene,this.camera.getCameraInstance())}},{key:"render",value:function(){var t=this;return Object(it.jsxs)("div",{children:[Object(it.jsxs)("div",{style:{position:"absolute",left:"10px",top:"10px",color:"red"},id:"Acelerador",children:[Object(it.jsxs)("p",{style:{zIndex:20,display:"float",fontWeight:"bold"},children:["Velocidad: ",parseInt(this.state.velocity)," km/h"]}),Object(it.jsxs)("p",{style:{zIndex:20,display:"float",fontWeight:"bold"},children:["RPM: ",parseInt(this.state.currentRPM)]}),Object(it.jsxs)("p",{style:{zIndex:20,display:"float",fontWeight:"bold"},children:["Cambio Actual: ",parseInt(this.state.currentShift)]})]}),Object(it.jsx)("div",{ref:function(e){t.mount=e}})]})}}]),s}(i.Component);var at=function(){return Object(i.useEffect)((function(){document.title="Driving Simulator"}),[]),Object(it.jsx)("div",{children:Object(it.jsx)(nt,{})})};a.a.createRoot(document.getElementById("root")).render(Object(it.jsx)(at,{}))}},[[42,1,2]]]);
//# sourceMappingURL=main.cb90b311.chunk.js.map