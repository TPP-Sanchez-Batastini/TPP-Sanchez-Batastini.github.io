{"version":3,"sources":["LogicModel/ControllerMapping/GlobalControllerHandling.js","ObserverPattern/Observer.js","Camera/Camera.js","Camera/CarOffsetCamera.js","Camera/OribtalCamera.js","3DModels/VisualEntity.js","3DModels/Models.js","3DModels/CarModel.js","LogicModel/ControllerMapping/LogitechG29Controller.js","LogicModel/ControllerMapping/XboxController.js","ObserverPattern/Observable.js","LogicModel/Physics/AmmoInstance.js","LogicModel/Physics/PhysicsTypes/CarPhysics.js","LogicModel/CarLogic/CarEngineStates/AbstractEngineState.js","LogicModel/CarLogic/CarEngineStates/TurnedOffEngine.js","LogicModel/CarLogic/CarEngineStates/TurnedOnEngine.js","LogicModel/CarLogic/CarEngine.js","LogicModel/CarLogic/ShiftBox.js","LogicModel/CarLogic/ShiftBoxTypes/ManualBox.js","LogicModel/CarLogic/ShiftBoxTypes/SemiAutomaticBox.js","LogicModel/CarLogic/Car.js","LogicModel/Physics/PhysicsTypes/GeneralPhysics.js","LogicModel/Physics/PhysicsTypes/BoxPhysics.js","3DModels/TrafficCone.js","LogicModel/Physics/PhysicsTypes/CylinderPhysics.js","LogicModel/Physics/PhysicsTypes/CustomGeometryPhysics.js","3DModels/StraightStreet.js","3DModels/Intersection.js","3DModels/Curve.js","3DModels/TStreet.js","3DModels/Checkpoint.js","Levels/LevelScore.js","Levels/LevelsFactory.js","addons/VRbutton.js","LogicModel/IA/TrafficModel.js","Scene/ThreeScene.jsx","Menus/MainMenu.jsx","Menus/Components/ConfigDrawer.jsx","Menus/LevelEditorContext/ItemsContext.jsx","Menus/Components/ItemsDrawer.jsx","Menus/Components/InputsGrid.jsx","Menus/Resources/Street/AbstractStreet.js","Menus/Resources/Street/Curve.js","Menus/Resources/Street/StraightStreet.js","Menus/Resources/Street/TStreet.js","Menus/Resources/Street/StraightStreetLinker.js","Menus/Resources/StreetFactory.js","Menus/Resources/Street/Intersection.js","Menus/Resources/LevelEditor.js","Menus/Components/LevelGrid.jsx","Menus/LevelEditor.jsx","Menus/Constants/Constants.js","Menus/Sessions/SessionContext.jsx","Menus/Resources/Hasher.js","Menus/Components/LoginForm.jsx","Menus/Sessions/SessionHooks.jsx","Menus/Components/SignUpForm.jsx","Menus/Sessions/SessionProvider.jsx","Menus/Components/CardLevel/CardContentHover.jsx","Menus/Components/CardLevel/CardContentNotHover.jsx","Menus/Components/LevelsSelectionGrid.jsx","Menus/LevelsList.jsx","App.jsx","index.jsx"],"names":["GlobalControllerHandling","constructor","car","this","handleAccelerate","valueClutch","valueAccelerator","accelerate","handleBrake","valueBrake","brake","doHorn","changeShift","valueShift","turnDirection","wheelAxesValue","turnOnCar","updateCar","update","changeShiftBox","mode","turnRightLight","turnLeftLight","turnParkingLight","Observer","observedState","newState","Camera","renderer","super","camera","THREE","window","innerWidth","innerHeight","group","group180Rot","add","rotation","handleResize","aspect","updateProjectionMatrix","setPositionRelativeToObject","cameraOffset","Vector3","applyQuaternion","position","copy","localStorage","getItem","offsetVectorCamera","setRotationFromQuaternion","setRotationFromAxisAngle","Math","PI","lookAt","rotationQuat","x","y","z","w","normalize","quaternion","getCameraInstance","addContainerToScene","scene","rotate","CarOffsetCamera","positionCamera","cameraOffsetRotated","positionToLookAt","OrbitalCamera","controls","OrbitControls","domElement","enableDamping","dampingFactor","enableZoom","set","VisualEntity","pathToTexture","fbxLoader","FBXLoader","gltfLoader","GLTFLoader","threeDModel","async","loadAsync","threeDObject","objectName","scale","modelVariable","loadFBX","e","loadGLTF","name","getModel","animate","ModelsSingleton","carModel","building_1","building_2","building_3","building_4","changeMaterialsToBasic","children","i","length","child","isGroup","isMesh","newMaterial","prototype","call","material","receiveShadow","castShadow","pathToTextureRcvd","result","Models","static","loadModels","Error","SCALE","POSITION","MAX_TIRE_TURN_IN_RADS","FACTOR_KMH_TO_MS","LIGTH_TIC","CarModel","carLogic","lastValueRotation","currentSpeedRotation","currentWheelRotation","lastSteeringRotation","lastVelocityRotation","lastRPMRotation","lastTurnOff","Date","generateRetrovisor","plane","retrovisor","Reflector","textureWidth","textureHeight","clipBias","multisample","rotateX","rotateY","generateLeftMirror","leftMirrorGeometry","leftMirror","container","Object3D","generateRightMirror","rightMirrorGeometry","rightMirror","generateMirrors","generateSpotlights","rightSpotlight","leftSpotlight","targetRight","targetLeft","target","shadow","mapSize","width","height","near","far","fov","intensity","angle","rightTurnlight","targetTurnRight","leftTurnlight","targetTurnLeft","rightTurnlightBack","targetTurnRightBack","leftTurnlightBack","targetTurnLeftBack","turnRigth","time","timePassed","turnLeft","arguments","undefined","hasMirrors","models","getInstance","clone","moveCar","addPhysicsView","physicsShape","Geometry","texture","color","PHYSICSSQUARE","GeometryRueda","rotateZ","textureRueda","wheelMesh1","wheelMesh2","wheelMesh3","wheelMesh4","watchPhysicsColliders","wheelsData","userData","physicsBody","rotateWheels","rotateSteeringWheel","rotateVelocityAndRPM","steeringWheel","find","o","vectorRotation","applyAxisAngle","rotateOnAxis","velocityIndicator","rpmIndicator","newVelRotation","abs","newRPMRotation","wheelFrontRight","wheelFrontLeft","wheelBackRight","wheelBackLeft","rotationYVectorOne","default","require","LogitechG29Controller","gamepads","navigator","getGamepads","webkitGetGamepads","gamepad","id","startsWith","buttonX","buttonSquare","buttonCircle","buttonTriangle","bumperRight","bumperLeft","buttonR2","buttonL2","shareButton","optionsButton","buttonR3","buttonL3","firstShift","secondShift","thirdShift","fourthShift","fifthShift","sixthShift","reverseShift","buttonPlus","buttonMinus","wheelInEnterRight","wheelInEnterLeft","enter","psButton","buttonsPressed","push","wheelAxes","clutch","accelerator","DPad","valueDpadUP","valueDpadDOWN","valueDpadLEFT","valueDpadRIGHT","dpadPressed","globalControllerHandler","checkGamepadChanges","checkEvents","doActionByMapping","doActionsPedals","axes","doActionsWheel","doActionsDPad","doActionsButtons","buttons","pressed","doActionsShifter","LogitechG29ControllerSingleton","instance","XboxController","auto","buttonA","buttonB","buttonY","buttonL1","buttonR1","optionButton","padUp","padDown","padLeft","padRight","buttomHome","buttonPressed","actualShift","xLeftAxe","yLeftAxe","xRightAxe","yRightAxe","doActionsAxes","axe","doActionHotKeys","value","doActionsTriggers","XboxControllerSingleton","Observable","observers","attachObserver","observer","removeObserver","index","indexOf","splice","notifyObservers","stateToSend","AmmoInstance","AmmoInstanceToReturn","Ammo","CarPhysics","inertia","mass","shape","physicsWorld","friction","btVector3","transform","btTransform","setIdentity","setOrigin","setRotation","btQuaternion","tempTransform","motionState","btDefaultMotionState","btBoxShape","calculateLocalInertia","rigidBodyInfo","btRigidBodyConstructionInfo","rigidBody","btRigidBody","setFriction","setRollingFriction","addRigidBody","tuning","btVehicleTuning","rayCaster","btDefaultVehicleRaycaster","vehicle","btRaycastVehicle","setCoordinateSystem","addAction","addWheel","setActivationState","isFront","pos","radius","side","wheelDirectionCS0","wheelAxleCS","wheelInfo","set_m_suspensionStiffness","set_m_wheelsDampingRelaxation","set_m_wheelsDampingCompression","set_m_frictionSlip","set_m_rollInfluence","updatePhysics","returnValue","getNumWheels","updateWheelTransform","transfMatrix","getWheelTransformWS","getOrigin","getRotation","wheels","Vector4","worldTransformChassis","getChassisWorldTransform","chassis","getRigidBody","setEngineForce","engineForce","applyEngineForce","speedKMH","getCurrentSpeedKmHour","frictionBrake","setBrake","setSteeringRotation","setSteeringValue","getVelocity","MAX_RPM","EXPONENTIAL_COEF_TO_RPM","AbstractEngineState","changeValueInRPMCurve","valuePedal","accelerating","currentRPM","currentXInRPMCurve","sumToValueInCurve","exp","TurnedOffEngine","TurnedOnEngine","CarEngine","useAudio","engineState","playbackRate","turnOn","Audio","play","setTimeout","soundEngine","AudioContext","webkitAudioContext","fetch","then","response","arrayBuffer","buffer","decodeAudioData","soundEngineSource","createBufferSource","loop","connect","destination","start","clutchIsPressed","handleEngineShutdown","shiftBox","shutDownEngine","isInConditionToAccelerate","engineCanApplyForce","rpmReturn","changeRPM","RPMModification","log","getCurrentRPM","ShiftBox","carEngine","NEUTRAL","REVERSE","FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH","validShifts","currentShift","minimumVelocityOnShift","maximumVelocityOnShift","isValidShift","shift","calculateNormalFactorRPM","newShift","oldVelocity","getValueForNewRPM","normalFactorRPM","XValue","getEngineForce","currentVelocity","valueClutchNormalized","minVelocityBasedOnClutch","normalFactor","getCurrentShift","ManualBox","SemiAutomaticBox","Car","initialPosition","initialRotation","Quaternion","identity","currentDirectionTurn","currentTireRotation","rotationQuaternion","carPhysics","turnRigthLigth","turnLeftLigth","positionAndRotation","getDataToAnimate","getLastRotation","getSpeed","GeneralPhysics","generateShape","getMotionState","getWorldTransform","setLinearVelocity","velocityVector","velVectorBT","applyForce","BoxPhysics","setMargin","TrafficCone","RADIUS_TOP","RADIUS_BOTTOM","HEIGHT","geometry","load","map","materialBox","geometryPlane","box","cone","CylinderPhysics","btCylinderShape","CustomGeometryPhysics","triangle_mesh","btTriangleMesh","vectA","vectB","vectC","verticesPos","getAttribute","array","triangles","setX","setY","setZ","addTriangle","destroy","btBvhTriangleMeshShape","StraightStreet","pathToNormalMap","SIZE","SIDEWALK_HEIGHT","createSidewalkMesh","wrapS","wrapT","repeat","materialSidewalk","geometrySidewalk","createStreetMesh","mesh","iter","model3D","loadBuildingBlock","parseInt","random","LONG","updateMatrix","updateMatrixWorld","matrixAutoUpdate","secondModel3D","rotationY","baseStreet","leftSidewalk","rightSidewalk","createBuildings","Intersection","SQUARE_SIZE","getLerpPoints","vec1","vec2","quantPoints","points","createSidewalkCurve","initialPoint","lerpPoints","pointsCurve","getPoints","secondLerpPoints","thirdLerpPoints","fourthLerpPoints","getGeometrySidewalk","geom","columnas","aux_vertices","indexes","uv1","uv2","uv3","accum_x","accum_z","uv","vertex","filas","j","vertexArr","Float32Array","uvArr","setIndex","setAttribute","computeVertexNormals","sidewalk","Curve","TOP_CENTER","createLongSidewalkCurve","fifthLerpPoints","sixthLerpPoints","getGeometryLongSidewalk","createLongSidewalkMesh","longSidewalk","TStreet","createStraightSidewalkMesh","createBuilding","Checkpoint","checkpointsData","RADIUS","stepHeartbeat","LEAST_OPACITY","MAX_OPACITY","newOpacity","opacity","transparent","checkpoint","LevelScore","initialScore","score","alterScore","isNaN","getCurrentScore","LevelFactory","levelScore","physicsToUpdate","objectsToAnimate","STREET_TYPES","createStreet","bind","createCurve","createTStreet","createIntersection","OBJECTS","createCone","forEach","phys","object","pathTexture","normalMapPath","floorMaterial","normalTexture","normalMap","normalScale","rampa","quaternionRamp","setFromAxisAngle","rampPhysics","buildAmmoPhysics","ramp","addToScene","conePhysics","threeObject","onCollide","console","street","streetPhysics","movingLeft","leftSidewalkPhysics","movingRight","rightSidewalkPhysics","tStreet","movingOne","cornerPhysicsOne","movingTwo","cornerPhysicsTwo","intersection","cornerPhysicsThree","cornerPhysicsFour","curve","movingCorner","cornerPhysics","longSidePhysics","segmentsQuantity","buildStreetPhysics","buildIntersectionPhysics","buildCurvePhysics","buildTStreetPhysics","checkpoints","checkpointPhysics","removeRigidBody","rigidyBody","removeCollisionObject","remove","end","createCheckpoint","position_x","position_y","createRectangle","long","type","segments","json","streets","instantiateStreet","long_x","long_y","objects","obj","instantiateObject","VRButton","button","document","createElement","disableButton","style","display","cursor","left","onmouseenter","onmouseleave","onclick","stylizeElement","element","bottom","padding","border","borderRadius","background","font","textAlign","outline","zIndex","xr","isSessionSupported","supported","currentSession","onSessionStarted","session","addEventListener","onSessionEnded","setSession","textContent","removeEventListener","sessionInit","optionalFeatures","requestSession","setItem","showEnterVR","xrSessionIsGranted","click","catch","exception","warn","message","isSecureContext","href","location","replace","innerHTML","textDecoration","test","userAgent","registerSessionGrantedListener","TrafficModel","SIZE_OF_TRAFFIC","timeSinceLastUpdate","now","trafficWorker","Worker","currentTraffic","levelStreets","lastID","onmessage","onReceiveResponseFromWorker","updateCarEngines","data","onCollideWithCarOfTraffic","object3D","engine","deleteCar","carId","objectsInTraffic","generateCar","updateTraffic","trafficCars","Object","entries","entry","carData","postMessage","playersCar","carActions","keys","steering","values","carObject","SEGMENT_SIZE","ThreeScene","Component","state","velocity","gotAnyEvent","stats","Stats","alpha","powerPreference","antialias","setSize","shadowMap","enabled","clock","jsonLevel","props","generateGeneralElements","animation","handleWindowResize","generateEvents","addPlayerCar","generateLevel","addVR","createAmmo","addGeneralLights","createTraffic","setAnimationLoop","setPixelRatio","devicePixelRatio","setFramebufferScaleFactor","mount","appendChild","body","createButton","level","updateDataLevel","createLevelCustom","geomField","matField","meshField","setClearColor","showPanel","dom","initial_position","initial_rotation","trafficModel","generateInitialTraffic","removeInstance","event","numCamera","key","collisionConfiguratation","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","overlappingPairCache","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","setGravity","onEnterColission","addFunction","cp","obj0","obj1","castObject","wrapPointer","btManifoldPoint","get_m_userPersistentData","collisionContactID","set_m_userPersistentData","setContactProcessedCallback","render","vecDistance","vectorA","vectorB","distanceTo","getMaxSizeStreets","maxX","maxZ","generateSegmentedScenesChildren","segmentedScenes","segmentPosition","filter","isLight","includes","getReducedScene","cloneScene","lastPlayerPos","begin","deltaTime","getDelta","stepSimulation","setState","_jsxs","_jsx","top","right","fontWeight","ref","styleMenu","backgroundImage","backgroundSize","backgroundRepeat","MainMenu","navigate","useNavigate","_Fragment","className","fontSize","onClick","ConfigDrawer","_ref","openConfigs","handleDrawerClose","open","setOpen","React","useState","useEffect","DrawerHeader","styled","_ref2","theme","alignItems","spacing","mixins","toolbar","justifyContent","Grid","Drawer","sx","flexShrink","boxSizing","variant","anchor","ChevronRightIcon","paddingRight","Divider","ItemsContext","createContext","allUnselected","ItemsDrawer","openItems","setLastSelectedItem","lastSelectedItem","useContext","itemSelected","setItemSelected","paddingLeft","ChevronLeftIcon","flexDirection","_ref3","nameItem","isSelected","alt","src","item","dictSelection","selectedItem","positionX","positionY","handleSelection","InputsGrid","setGridDimensions","gridDimensions","InputWidth","setInputWidth","InputHeight","setInputHeight","direction","marginLeft","xs","step","onChange","replaceAll","Button","onSubmit","STANDARD_BOX_LONG","AbstractStreet","ninePerNineGrid","rowIndex","columnIndex","rightFilled","filled","topFilled","botFilled","leftFilled","determineStreetRotation","cell","rowCount","columnCount","sumValueForCell","isStraight","getAsJSON","getPositionAsRowAndColumn","getPositionX","getPositionY","getLongX","getLongY","POSSIBLE_ROTATIONS","StraightStreetLinker","arrayOfStreets","sections","segregateSections","sectionsAsJSON","linkSections","rows","cols","sectionsArray","streetRow","streetCol","isHorizontal","generateArraySubsections","finalArray","sectionsJSON","jsonForStreet","reduce","acum","elem","getSectionsAsJSON","TYPES_OF_STREETS","calculateNeighboursFilled","bot","dict","StreetFactory","levelGrid","isInfiniteLevel","getNinePerNineGrid","getNinePerNineGridInfinite","getNinePerNineGridFinite","constructStreets","straightStreetsArray","curvedStreetsArray","streetObject","defineTypeOfStreet","conjunctedStraightStreets","linkStraightStreets","indexRow","indexColumn","matrix","rowArray","realRow","realColumn","celda_vacia","row","column","typeResult","typeDefined","isValidNinePerNineGrid","getCountSidesPainted","aux","validateGrid","isInfinite","validateGridInfinite","valid","wrongCells","validateGridNotInfinite","COLORS","LevelGrid","setLevelGrid","setClick","rightClick","setRightClick","finalGrid","currentRow","newCell","preventDefault","arrayContains","insiderArray","equals","exc","marginTop","marginRight","onMouseDown","idx_row","idx_col","backgroundColor","onMouseMove","onEnterHoverWithClickCell","col","levelGridCopy","div_color","onMouseUp","onClickCell","btn_click","onSubmitLevel","vec_aux","exportObj","exportName","dataStr","encodeURIComponent","JSON","stringify","downloadAnchorNode","downloadObjectAsJson","generateJSONFromGrid","MemoryIcon","LevelEditor","setOpenItems","setOpenConfigs","itemsInGrid","setItemsInGrid","currentItems","Provider","IconButton","margin","AddIcon","SettingsIcon","idx","API_URL","VALID_REGEX_EMAIL","SessionContext","createHash","hash","string","digest","LoginForm","email","setEmail","password","setPassword","showPassword","setShowPassword","error","setError","setSessionWithResponse","SessionHooks","loginResponse","user","jwt","getUser","getJWT","submitGoogleLogin","responseAPI","APIResponse","method","headers","token","status","endMSG","detail","msg","error_msg","statusText","postLoginGoogle","toString","validateFields","errors","match","postLogin","alignContent","maxWidth","Alert","severity","onClose","listerror","TextField","label","InputProps","endAdornment","InputAdornment","handleClickShowPassword","Visibility","VisibilityOff","Link","to","GoogleLogin","onSuccess","credentialResponse","OAuthToken","credential","onError","SignUpForm","passwordConfirmation","setPasswordConfirmation","nameToShow","setNameToShow","errorArray","fetchUrl","postSignUp","SessionProvider","childElement","GoogleOAuthProvider","clientId","CardContentHover","CardContentNotHover","CardContent","CardMedia","component","image","title","objectFit","CardHeader","subheader","description","LevelsSelectionGrid","levels","setLevels","cardHovers","setCardHovers","levelsEffect","hovers","rowSpacing","md","lg","Card","CardActions","onMouseOver","onMouseOut","LevelsList","App","setJson","Router","Switch","Route","exact","path","ReactDOM","createRoot","getElementById"],"mappings":"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","file":"static/js/main.30e85342.chunk.js","sourcesContent":["export default class GlobalControllerHandling{\r\n\r\n    \r\n    constructor(car){\r\n        this.car = car;\r\n    }\r\n\r\n\r\n    handleAccelerate(valueClutch, valueAccelerator){\r\n        this.car.accelerate(valueClutch, valueAccelerator);\r\n    }\r\n\r\n\r\n    handleBrake(valueClutch, valueBrake){\r\n        this.car.brake(valueClutch, valueBrake);\r\n    }\r\n\r\n    doHorn(){\r\n        this.car.doHorn();\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, valueShift){\r\n        this.car.changeShift(valueClutch, valueShift);\r\n    }\r\n\r\n\r\n    turnDirection(wheelAxesValue){\r\n        this.car.turnDirection(wheelAxesValue);\r\n    }\r\n\r\n\r\n    turnOnCar(){\r\n        this.car.turnOnCar();\r\n    }\r\n\r\n\r\n    updateCar(){\r\n        this.car.update();\r\n    }\r\n\r\n\r\n    changeShiftBox(mode){\r\n        this.car.changeShiftBox(mode);\r\n    }\r\n    turnRightLight(){\r\n        this.car.turnRightLight();\r\n    }\r\n    turnLeftLight(){\r\n        this.car.turnLeftLight();\r\n    }\r\n    turnParkingLight(){\r\n        this.car.turnParkingLight();\r\n    }\r\n}","//Methods to override. This is an interface but can not be declared as interface in JS.\r\nexport default class Observer{\r\n\r\n    constructor(){\r\n        this.observedState = null;\r\n    }\r\n\r\n    update(newState){\r\n        this.observedState = newState;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\nconst Y_DISTANCE = 0.6;\r\nconst Z_DISTANCE = -0.1;\r\nconst X_DISTANCE = 0.4;\r\nexport default class Camera extends Observer{\r\n\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 85, window.innerWidth / window.innerHeight, 0.1, 300 );\r\n        this.group =  new THREE.Object3D();\r\n        this.group180Rot = new THREE.Object3D().add(this.camera);\r\n        this.group.add(this.group180Rot);\r\n        this.renderer = renderer;\r\n        this.rotation = 0;\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(X_DISTANCE, Y_DISTANCE, Z_DISTANCE);\r\n        if(this.observedState != null){\r\n            cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.group.position.copy(this.observedState.position).add(cameraOffset);\r\n            \r\n            if (localStorage.getItem(\"VR\") === \"true\"){\r\n                let offsetVectorCamera = new Vector3(0,-1.25,0); //Offset to be in place for driver's seat\r\n                offsetVectorCamera.applyQuaternion(this.observedState.rotation);\r\n                this.group.position.add(offsetVectorCamera);\r\n                this.group.setRotationFromQuaternion(this.observedState.rotation);\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), Math.PI);\r\n                this.camera.lookAt(new Vector3(0,0,5));\r\n            }else{\r\n                const rotationQuat = new THREE.Quaternion(this.observedState.rotation.x, this.observedState.rotation.y, this.observedState.rotation.z, this.observedState.rotation.w).normalize();\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), -5*Math.PI/180 + this.rotation); //SUMAR ROTACION EXTRA SI USAMOS EL JOYSTICK DERECHO\r\n                this.group.quaternion.copy(rotationQuat);\r\n            }\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,5));\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    \r\n    addContainerToScene(scene){\r\n        scene.add(this.group);\r\n    }\r\n\r\n    rotate(rotation){\r\n        this.rotation = rotation;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\n\r\nexport default class CarOffsetCamera extends Observer{\r\n\r\n\r\n    constructor(positionCamera){\r\n        super();\r\n        this.positionCamera = positionCamera;\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 300 );\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(this.positionCamera.x, this.positionCamera.y, this.positionCamera.z);\r\n        if(this.observedState != null){\r\n            let cameraOffsetRotated = cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.camera.position.copy(this.observedState.position).add(cameraOffsetRotated);\r\n            let positionToLookAt = new Vector3(this.observedState.position.x, this.observedState.position.y, this.observedState.position.z);\r\n            this.camera.lookAt(positionToLookAt);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n            this.camera.position.copy(cameraOffset);\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\"\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\nexport default class OrbitalCamera extends Observer{\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );\r\n        this.renderer = renderer;\r\n        this.controls = new OrbitControls(this.camera, this.renderer.domElement);\r\n        this.controls.enableDamping = true;\r\n        this.controls.dampingFactor = 0.25;\r\n        this.controls.enableZoom = true;\r\n        this.camera.position.set(0,5.5,0);\r\n    }\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    setPositionRelativeToObject(){\r\n        this.controls.update();\r\n        if(this.observedState != null){\r\n            this.camera.lookAt(this.observedState[\"position\"]);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n        }\r\n    }\r\n}","import { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\nimport Observer from \"../ObserverPattern/Observer\"\r\n\r\nexport default class VisualEntity extends Observer{\r\n\r\n    constructor(pathToTexture){\r\n        super();\r\n        this.fbxLoader = new FBXLoader();\r\n        this.gltfLoader = new GLTFLoader();\r\n        this.threeDModel = null;\r\n        this.pathToTexture = pathToTexture;\r\n    }\r\n\r\n    async loadFBX(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.fbxLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n        \r\n    }\r\n\r\n    async loadGLTF(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.gltfLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n\r\n    }\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            let modelVariable;\r\n            try{\r\n                modelVariable =  await this.loadFBX();\r\n                this.threeDModel = modelVariable;\r\n            }catch(e){\r\n                modelVariable =  await this.loadGLTF();\r\n                this.threeDModel = modelVariable.scene;\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.x = position[0];\r\n            this.threeDModel.position.y = position[1];\r\n            this.threeDModel.position.z = position[2];\r\n            this.threeDModel.scale.x = scale[0];\r\n            this.threeDModel.scale.y = scale[1];\r\n            this.threeDModel.scale.z = scale[2];\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getModel(){\r\n        return this.threeDModel;\r\n    }\r\n\r\n    //Abstract Method\r\n    animate(){\r\n        return null;\r\n    }\r\n\r\n\r\n}","import { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\nimport * as THREE from 'three';\r\n\r\nclass ModelsSingleton{\r\n\r\n    constructor(){\r\n        this.gltfLoader = new GLTFLoader();\r\n        this.carModel = null;\r\n        this.building_1 = null;\r\n        this.building_2 = null;\r\n        this.building_3 = null;\r\n        this.building_4 = null;\r\n    }\r\n\r\n\r\n    changeMaterialsToBasic(children){\r\n        for (let i=0; i < children.length; i++) {\r\n            const child = children[i];\r\n            \r\n            if(child.isGroup){\r\n                this.changeMaterialsToBasic(child.children);\r\n            }else if(child.isMesh){\r\n                const newMaterial = new THREE.MeshPhongMaterial();\r\n                THREE.MeshBasicMaterial.prototype.copy.call( newMaterial, child.material );\r\n                child.material = newMaterial;\r\n                child.receiveShadow = true;\r\n                child.castShadow = true;\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    async loadGLTF(pathToTextureRcvd){\r\n        let pathToTexture = pathToTextureRcvd;\r\n        const result = await this.gltfLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        this.changeMaterialsToBasic(result.scene.children);\r\n        return result.scene;\r\n    }\r\n\r\n    async loadModels(){\r\n        this.carModel = this.loadGLTF('res/models/source/Mercedes.glb');\r\n        this.building_1 = this.loadGLTF('res/models/source/buildings/Building_1.glb');\r\n        this.building_2 = this.loadGLTF('res/models/source/buildings/Building_2.glb');\r\n        this.building_3 = this.loadGLTF('res/models/source/buildings/Building_3.glb');\r\n        this.building_4 = this.loadGLTF('res/models/source/buildings/Building_4.glb');\r\n        return \"OK\";\r\n    }\r\n\r\n    \r\n}\r\n\r\nexport default class Models{\r\n\r\n    static ModelsSingleton\r\n\r\n    static async getInstance(){\r\n        if (!Models.ModelsSingleton){\r\n            Models.ModelsSingleton = new ModelsSingleton();\r\n            let res = await Models.ModelsSingleton.loadModels();\r\n            if (res === \"OK\"){\r\n                return Models.ModelsSingleton;\r\n            }else{\r\n                throw new Error(\"Error al cargar los modelos.\");\r\n            }\r\n        }else{\r\n            return Models.ModelsSingleton;\r\n        }\r\n        \r\n    }\r\n}","import { Vector3 } from 'three';\r\nimport * as THREE from 'three';\r\nimport VisualEntity from './VisualEntity';\r\nimport { Reflector } from 'three/examples/jsm/objects/Reflector';\r\nimport { Object3D } from 'three';\r\nimport Models from './Models';\r\n\r\nconst SCALE = [1.0, 1.0, 1.0];\r\nconst POSITION = [0,0,0];\r\nconst MAX_TIRE_TURN_IN_RADS = 0.75;\r\nconst FACTOR_KMH_TO_MS = 1/3600;\r\nconst VELOCITY_TO_ANGULAR_VEL = 1/0.25; //Velocity/Radius\r\n//const STEERING_WHEEL_INITIAL_ROTATION_ON_X = -0.35;\r\nconst STEERING_WHEEL_INITIAL_ROTATION_ON_X = 0.13\r\nconst MAX_VELOCITY_SHOWN = 240;\r\nconst MAX_RPM_SHOWN = 6000;\r\n\r\nconst LIGTH_TIC = 1000;\r\n\r\nexport default class CarModel extends VisualEntity{\r\n    \r\n    \r\n    constructor(){\r\n        //super('res/models/source/AutoConInterior.glb');\r\n        super('res/models/source/Mercedes.glb');\r\n        this.carModel = null;\r\n        this.carLogic = null;\r\n        this.lastValueRotation = 0;\r\n        this.currentSpeedRotation = 0;\r\n        this.currentWheelRotation = 0;\r\n        this.lastSteeringRotation = 0;\r\n        this.lastVelocityRotation = 0;\r\n        this.lastRPMRotation = 0;\r\n        this.lastTurnOff = new Date();\r\n    }\r\n\r\n\r\n    generateRetrovisor(){\r\n        //const path = new THREE.Shape();\r\n        //path.absellipse(0,0,0.15,0.075,0, Math.PI*2, false,0);\r\n        //const ellipseGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const plane = new THREE.PlaneGeometry(0.145, 0.085);\r\n\r\n\r\n        const retrovisor = new Reflector(\r\n            plane,\r\n            //ellipseGeometry,\r\n            {\r\n                textureWidth: window.innerWidth,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: window.innerHeight,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0.35,\r\n                multisample: 4\r\n            }\r\n        );\r\n        retrovisor.rotateX( Math.PI-0.04 );\r\n        retrovisor.rotateY( 0.35 );\r\n        retrovisor.position.set(0.075,0.625,0.31);\r\n        this.threeDModel.add(retrovisor);\r\n    }\r\n\r\n\r\n    generateLeftMirror(){\r\n        const leftMirrorGeometry = new THREE.PlaneGeometry(0.19, 0.10);\r\n        //const radius = 2\r\n        //const leftMirrorGeometry = new THREE.CylinderGeometry( radius, radius, 0.10, 512, 512,true,0.18,0.15 ); \r\n\r\n        const leftMirror = new Reflector(\r\n            leftMirrorGeometry, \r\n            {\r\n                textureWidth:2* window.innerWidth,//512\r\n                textureHeight:2* window.innerHeight,//512\r\n                clipBias: 0,\r\n                multisample: 4\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(leftMirror);\r\n        container.position.set(0.96, 0.345, 0.62);\r\n        //container.position.set(0.4, 0.345,0.5+  radius);\r\n        container.rotateX(-Math.PI+0.13);\r\n        //container.rotateX(-Math.PI);\r\n        leftMirror.rotateY(-18*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateRightMirror(){\r\n        const rightMirrorGeometry = new THREE.PlaneGeometry(0.19, 0.10);\r\n        const rightMirror = new Reflector(\r\n            rightMirrorGeometry, \r\n            {\r\n                textureWidth: window.innerWidth,\r\n                textureHeight: window.innerHeight,\r\n                clipBias: 0,\r\n                multisample: 4\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(rightMirror);\r\n        container.position.set(-0.96, 0.345, 0.62);\r\n        container.rotateX(-Math.PI+0.1);\r\n        rightMirror.rotateY(18*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateMirrors(){\r\n        this.generateRetrovisor();\r\n        this.generateLeftMirror();\r\n        this.generateRightMirror();\r\n    }\r\n\r\n    generateSpotlights(){\r\n        this.rightSpotlight = new THREE.SpotLight(0xffffff);\r\n        this.leftSpotlight = new THREE.SpotLight(0xffffff);\r\n        this.targetRight = new Object3D();\r\n        this.targetLeft = new Object3D();\r\n        this.targetRight.position.set(-0.8, 0.05, 3.0);\r\n        this.targetLeft.position.set(0.8, 0.05, 3.0);\r\n        this.rightSpotlight.position.set(-0.8, 0.3, 2.6);\r\n        this.leftSpotlight.position.set(0.8, 0.3, 2.6);\r\n        this.rightSpotlight.target = this.targetRight;\r\n        this.leftSpotlight.target = this.targetLeft;\r\n        this.leftSpotlight.castShadow = true;\r\n        this.rightSpotlight.castShadow = true;\r\n        this.rightSpotlight.shadow.mapSize.width = 1024;\r\n        this.leftSpotlight.shadow.mapSize.height = 1024;\r\n        this.rightSpotlight.shadow.camera.near = 0.1;\r\n        this.leftSpotlight.shadow.camera.near = 0.1;\r\n        this.rightSpotlight.shadow.camera.far = 2;\r\n        this.leftSpotlight.shadow.camera.far = 2;\r\n        this.rightSpotlight.shadow.camera.fov = 10;\r\n        this.leftSpotlight.shadow.camera.fov = 10;\r\n        this.rightSpotlight.intensity = 0.5;\r\n        this.leftSpotlight.intensity = 0.5;\r\n        this.rightSpotlight.angle = Math.PI/5;\r\n        this.leftSpotlight.angle = Math.PI/5;\r\n\r\n        this.threeDModel.add(this.leftSpotlight);\r\n        this.threeDModel.add(this.rightSpotlight);\r\n        this.threeDModel.add(this.targetLeft);\r\n        this.threeDModel.add(this.targetRight);\r\n\r\n        this.rightTurnlight = new THREE.SpotLight(0xDB8A10);\r\n        this.targetTurnRight = new Object3D();\r\n        this.targetTurnRight.position.set(-0.85, 0.05, 3.0);\r\n        this.rightTurnlight.position.set(-0.8, 0.3, 2.6);\r\n        this.rightTurnlight.target = this.targetTurnRight;\r\n        this.rightTurnlight.castShadow = false;\r\n        this.rightTurnlight.intensity = 0;\r\n        this.rightTurnlight.angle = Math.PI/5;\r\n        this.threeDModel.add(this.targetTurnRight);\r\n        this.threeDModel.add(this.rightTurnlight);\r\n\r\n        this.leftTurnlight = new THREE.SpotLight(0xDB8A10);\r\n        this.targetTurnLeft = new Object3D();\r\n        this.targetTurnLeft.position.set(0.85, 0.05, 3.0);\r\n        this.leftTurnlight.position.set(0.8, 0.3, 2.6);\r\n        this.leftTurnlight.target = this.targetTurnLeft;\r\n        this.leftTurnlight.castShadow = false;\r\n        this.leftTurnlight.intensity = 0;\r\n        this.leftTurnlight.angle = Math.PI/5;\r\n        this.threeDModel.add(this.targetTurnLeft);\r\n        this.threeDModel.add(this.leftTurnlight);\r\n\r\n\r\n        this.rightTurnlightBack = new THREE.SpotLight(0xDB8A10);\r\n        this.targetTurnRightBack = new Object3D();\r\n        this.targetTurnRightBack.position.set(-0.85, 3, -3.0);\r\n        this.rightTurnlightBack.position.set(-0.8, 3.2, 2.6);\r\n        this.rightTurnlightBack.target = this.targetTurnRightBack;\r\n        this.rightTurnlightBack.castShadow = false;\r\n        this.rightTurnlightBack.intensity = 0;\r\n        this.rightTurnlightBack.angle = Math.PI/5;\r\n        this.threeDModel.add(this.targetTurnRightBack);\r\n        this.threeDModel.add(this.rightTurnlightBack);\r\n\r\n        this.leftTurnlightBack = new THREE.SpotLight(0xDB8A10);\r\n        this.targetTurnLeftBack = new Object3D();\r\n        this.targetTurnLeftBack.position.set(0.85, 3, -3.0);\r\n        this.leftTurnlightBack.position.set(0.8, 3.2, 2.6);\r\n        this.leftTurnlightBack.target = this.targetTurnLeftBack;\r\n        this.leftTurnlightBack.castShadow = false;\r\n        this.leftTurnlightBack.intensity = 0;\r\n        this.leftTurnlightBack.angle = Math.PI/5;\r\n        this.threeDModel.add(this.targetTurnLeftBack);\r\n        this.threeDModel.add(this.leftTurnlightBack);\r\n        \r\n    }\r\n\r\n    turnRigth(){\r\n        let time = new Date();\r\n        if(this.observedState[\"turnRigthLigth\"]  ){\r\n            let timePassed = time - this.lastTurnOff;\r\n            if( timePassed < LIGTH_TIC ){\r\n                this.rightTurnlight.intensity = 0.5;\r\n                this.rightTurnlightBack.intensity = 0.5;\r\n            }else if(timePassed < 2*LIGTH_TIC){\r\n                \r\n                this.rightTurnlight.intensity = 0;\r\n                this.rightTurnlightBack.intensity = 0;\r\n            }else{\r\n                this.lastTurnOff = new Date();\r\n            }\r\n        }else{\r\n            this.rightTurnlight.intensity = 0;\r\n            this.rightTurnlightBack.intensity = 0;\r\n        }\r\n    }\r\n\r\n    turnLeft(){\r\n        let time = new Date();\r\n        if(this.observedState[\"turnLeftLigth\"]  ){\r\n            let timePassed = time - this.lastTurnOff;\r\n            if( timePassed < LIGTH_TIC ){\r\n                this.leftTurnlight.intensity = 0.5;\r\n                this.leftTurnlightBack.intensity = 0.5;\r\n            }else if(timePassed < 2*LIGTH_TIC){\r\n                this.leftTurnlight.intensity = 0;\r\n                this.leftTurnlightBack.intensity = 0;\r\n            }else{\r\n                this.lastTurnOff = new Date();\r\n            }\r\n        }else{\r\n            this.leftTurnlight.intensity = 0;\r\n            this.leftTurnlightBack.intensity = 0;\r\n        }\r\n    }\r\n\r\n\r\n    async addToScene(scene, name=\"driverCar\", hasMirrors = true){\r\n        const models = await Models.getInstance();\r\n        this.threeDModel = await models.carModel;\r\n        this.threeDModel = this.threeDModel.clone();\r\n        this.threeDModel.name = name;\r\n        this.threeDModel.position.x = POSITION[0];\r\n        this.threeDModel.position.y = POSITION[1];\r\n        this.threeDModel.position.z = POSITION[2];\r\n        this.threeDModel.scale.x = SCALE[0];\r\n        this.threeDModel.scale.y = SCALE[1];\r\n        this.threeDModel.scale.z = SCALE[2];\r\n        scene.add(this.threeDModel);\r\n        if(hasMirrors){\r\n            this.generateMirrors();\r\n        }\r\n        this.generateSpotlights();\r\n        return this;\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.moveCar();\r\n        //this.watchPhysicsColliders();\r\n    }\r\n\r\n\r\n    addPhysicsView(scene){\r\n        this.physicsShape = new Vector3(2,1.35,5);\r\n        \r\n        const Geometry = new THREE.BoxGeometry( this.physicsShape.x, this.physicsShape.y, this.physicsShape.z);\r\n        const texture = new THREE.MeshBasicMaterial( {color: 0x0000ff} );\r\n        this.PHYSICSSQUARE = new THREE.Mesh( Geometry, texture );\r\n        this.PHYSICSSQUARE.position.set (0,0,0);\r\n        scene.add(this.PHYSICSSQUARE);\r\n\r\n        const GeometryRueda = new THREE.CylinderGeometry( 0.35, 0.35, 0.35, 32, 32);\r\n        GeometryRueda.rotateZ(Math.PI / 2);\r\n        const textureRueda = new THREE.MeshBasicMaterial( {color: 0xff0000} );\r\n        this.wheelMesh1 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh1.position.set (0,4,0);\r\n        scene.add(this.wheelMesh1);\r\n\r\n        this.wheelMesh2 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh2.position.set (0,4,0);\r\n        scene.add(this.wheelMesh2);\r\n\r\n        this.wheelMesh3 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh3.position.set (0,4,0);\r\n        scene.add(this.wheelMesh3);\r\n\r\n        this.wheelMesh4 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh4.position.set (0,4,0);\r\n        scene.add(this.wheelMesh4);\r\n    }\r\n\r\n    //Only for debug purpose2\r\n    watchPhysicsColliders(){\r\n        \r\n        if(this.observedState != null){\r\n            this.PHYSICSSQUARE.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            this.PHYSICSSQUARE.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh1.position.set(\r\n                this.observedState.wheelsData[0][\"position\"].x, \r\n                this.observedState.wheelsData[0][\"position\"].y, \r\n                this.observedState.wheelsData[0][\"position\"].z\r\n            );\r\n            this.wheelMesh1.quaternion.set(\r\n                this.observedState.wheelsData[0][\"rotation\"].x, \r\n                this.observedState.wheelsData[0][\"rotation\"].y, \r\n                this.observedState.wheelsData[0][\"rotation\"].z, \r\n                this.observedState.wheelsData[0][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh2.position.set(\r\n                this.observedState.wheelsData[1][\"position\"].x, \r\n                this.observedState.wheelsData[1][\"position\"].y, \r\n                this.observedState.wheelsData[1][\"position\"].z\r\n            );\r\n            this.wheelMesh2.quaternion.set(\r\n                this.observedState.wheelsData[1][\"rotation\"].x, \r\n                this.observedState.wheelsData[1][\"rotation\"].y, \r\n                this.observedState.wheelsData[1][\"rotation\"].z, \r\n                this.observedState.wheelsData[1][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh3.position.set(\r\n                this.observedState.wheelsData[2][\"position\"].x, \r\n                this.observedState.wheelsData[2][\"position\"].y, \r\n                this.observedState.wheelsData[2][\"position\"].z\r\n            );\r\n            this.wheelMesh3.quaternion.set(\r\n                this.observedState.wheelsData[2][\"rotation\"].x, \r\n                this.observedState.wheelsData[2][\"rotation\"].y, \r\n                this.observedState.wheelsData[2][\"rotation\"].z, \r\n                this.observedState.wheelsData[2][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh4.position.set(\r\n                this.observedState.wheelsData[3][\"position\"].x, \r\n                this.observedState.wheelsData[3][\"position\"].y, \r\n                this.observedState.wheelsData[3][\"position\"].z\r\n            );\r\n            this.wheelMesh4.quaternion.set(\r\n                this.observedState.wheelsData[3][\"rotation\"].x, \r\n                this.observedState.wheelsData[3][\"rotation\"].y, \r\n                this.observedState.wheelsData[3][\"rotation\"].z, \r\n                this.observedState.wheelsData[3][\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    moveCar(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.userData.physicsBody = this.observedState[\"physicsBody\"];\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n            this.lastValueRotation = this.observedState[\"direction\"];\r\n            this.rotateWheels();\r\n            this.rotateSteeringWheel();\r\n            this.rotateVelocityAndRPM();\r\n            this.turnRigth();\r\n            this.turnLeft();\r\n        }\r\n    }\r\n\r\n\r\n    rotateSteeringWheel(){\r\n        let steeringWheel = this.threeDModel.children.find(o => o.name === 'Steering_Wheel');\r\n        let vectorRotation = new Vector3(0,0,1).applyAxisAngle(new Vector3(1,0,0), STEERING_WHEEL_INITIAL_ROTATION_ON_X);\r\n        steeringWheel.rotateOnAxis(vectorRotation, this.lastSteeringRotation);\r\n        steeringWheel.rotateOnAxis(vectorRotation, this.observedState['lastRotationWheel']*540/360*Math.PI*2);\r\n        this.lastSteeringRotation = -this.observedState['lastRotationWheel']*540/360*Math.PI*2;\r\n    }\r\n\r\n\r\n    rotateVelocityAndRPM(){\r\n        let velocityIndicator = this.threeDModel.children.find(o => o.name === 'Cubo001');\r\n        let rpmIndicator = this.threeDModel.children.find(o => o.name === 'Cubo');\r\n        const newVelRotation = -Math.abs(this.observedState[\"velocity\"])*(240*Math.PI/180)/MAX_VELOCITY_SHOWN;\r\n        const newRPMRotation = -this.observedState[\"rpm\"]*(260*Math.PI/180)/MAX_RPM_SHOWN; //Can surpass a little bit the rpm meter\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastVelocityRotation);\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), newVelRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastRPMRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), newRPMRotation);\r\n        this.lastVelocityRotation = newVelRotation;\r\n        this.lastRPMRotation = newRPMRotation;\r\n    }\r\n\r\n\r\n    rotateWheels(){\r\n        // let wheelFrontRight = this.threeDModel.children.find(o => o.name === 'wheel002');\r\n        // let wheelFrontLeft = this.threeDModel.children.find(o => o.name === 'wheel');\r\n        // let wheelBackRight = this.threeDModel.children.find(o => o.name === 'wheel003');\r\n        // let wheelBackLeft = this.threeDModel.children.find(o => o.name === 'wheel001');\r\n        let wheelFrontRight = this.threeDModel.children.find(o => o.name === 'W222WheelFtR');\r\n        let wheelFrontLeft = this.threeDModel.children.find(o => o.name === 'W222WheelFtL');\r\n        let wheelBackRight = this.threeDModel.children.find(o => o.name === 'W222WheelBkR');\r\n        let wheelBackLeft = this.threeDModel.children.find(o => o.name === 'W222WheelBkL');\r\n        let rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation\r\n        );\r\n\r\n        //Resetting position in direction\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, this.currentWheelRotation);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorOne, this.currentWheelRotation);\r\n        \r\n        //Moving by rotation caused by speed.\r\n        wheelFrontLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelFrontRight.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackRight.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n\r\n        rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation - this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL\r\n        );\r\n\r\n        //Moving to the sides based on steering wheel value\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorOne, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        this.currentWheelRotation = this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS;\r\n\r\n        this.currentSpeedRotation += this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL;\r\n        if(this.currentSpeedRotation >= Math.PI*2){\r\n            this.currentSpeedRotation -= Math.PI*2;\r\n        }\r\n    }\r\n}","const { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst DPAD_NOT_PRESSED = 1.2857143878936768;\r\nconst DPAD_UP = -1;\r\nconst DPAD_UP_PRESSED = 0;\r\nconst DPAD_DOWN = 0.14285719394683838;\r\nconst DPAD_DOWN_PRESSED = 1;\r\nconst DPAD_LEFT = 0.7142857313156128;\r\nconst DPAD_LEFT_PRESSED = 2;\r\nconst DPAD_RIGHT = -0.4285714030265808;\r\nconst DPAD_RIGHT_PRESSED = 3;\r\n\r\n\r\nclass LogitechG29Controller{\r\n    constructor(carLogic){\r\n        this.carLogic = carLogic;\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonX = 0;\r\n        this.buttonSquare = 1;\r\n        this.buttonCircle = 2;\r\n        this.buttonTriangle = 3;\r\n        this.bumperRight = 4;\r\n        this.bumperLeft = 5;\r\n        this.buttonR2 = 6;\r\n        this.buttonL2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionsButton = 9;\r\n        this.buttonR3 = 10;\r\n        this.buttonL3 = 11;\r\n        this.firstShift = 12;\r\n        this.secondShift = 13;\r\n        this.thirdShift = 14;\r\n        this.fourthShift = 15;\r\n        this.fifthShift = 16;\r\n        this.sixthShift = 17;\r\n        this.reverseShift = 18;\r\n        this.buttonPlus = 19;\r\n        this.buttonMinus = 20;\r\n        this.wheelInEnterRight = 21;\r\n        this.wheelInEnterLeft = 22;\r\n        this.enter = 23;\r\n        this.psButton = 24;\r\n\r\n        this.buttonsPressed = [];\r\n        for(let i=0; i <= 24; i++){\r\n            this.buttonsPressed.push(false);\r\n        }\r\n\r\n        this.wheelAxes = 0;\r\n        this.clutch = 1;\r\n        this.accelerator = 2;\r\n        this.brake = 5;\r\n        this.DPad = 9;\r\n\r\n        //This is conveniently defined by using distances if needed, it is not exact.\r\n        this.valueDpadUP = DPAD_UP;\r\n        this.valueDpadDOWN = DPAD_DOWN;\r\n        this.valueDpadLEFT = DPAD_LEFT;\r\n        this.valueDpadRIGHT = DPAD_RIGHT;\r\n\r\n        this.dpadPressed = [];\r\n        for(let i=0; i <= 3; i++){\r\n            this.dpadPressed.push(false);\r\n        }\r\n        \r\n        this.globalControllerHandler = new GlobalControllerHandling(carLogic);\r\n    }\r\n\r\n    \r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n\r\n    doActionsPedals(){\r\n        let clutch = ((this.gamepad.axes[this.clutch] )**3);\r\n        let brake = ((this.gamepad.axes[this.brake] )**3);\r\n        brake = (1 - (brake + 1) / 2);\r\n        let accelerator = ((this.gamepad.axes[this.accelerator] )**3);\r\n        accelerator = (1 - (accelerator + 1) / 2);\r\n        this.globalControllerHandler.handleAccelerate(clutch, accelerator);\r\n        this.globalControllerHandler.handleBrake(clutch, brake);\r\n    }\r\n\r\n\r\n    doActionsWheel(){\r\n        this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes]);\r\n    }\r\n\r\n\r\n    doActionsDPad(){\r\n        if(this.gamepad.axes[this.DPad] !== DPAD_NOT_PRESSED){\r\n            \r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadDOWN && !this.dpadPressed[DPAD_DOWN_PRESSED]){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadDOWN){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadLEFT && !this.dpadPressed[DPAD_LEFT_PRESSED]){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadLEFT){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadRIGHT && !this.dpadPressed[DPAD_RIGHT_PRESSED]){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadRIGHT){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadUP && !this.dpadPressed[DPAD_UP_PRESSED]){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadUP){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = false;\r\n            }\r\n        }else{\r\n            for(let i = 0; i < this.dpadPressed.length; i++){\r\n                this.dpadPressed[i] = false;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    doActionsButtons(){\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonsPressed[this.buttonX]) {\r\n            this.buttonsPressed[this.buttonX] = true\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonsPressed[this.buttonX] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonTriangle].pressed && !this.buttonsPressed[this.buttonTriangle]) {\r\n            this.buttonsPressed[this.buttonTriangle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonTriangle].pressed){\r\n            this.buttonsPressed[this.buttonTriangle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonCircle].pressed && !this.buttonsPressed[this.buttonCircle]) {\r\n            this.buttonsPressed[this.buttonCircle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonCircle].pressed){\r\n            this.buttonsPressed[this.buttonCircle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonSquare].pressed && !this.buttonsPressed[this.buttonSquare]) {\r\n            this.buttonsPressed[this.buttonSquare] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonSquare].pressed){\r\n            this.buttonsPressed[this.buttonSquare] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.psButton].pressed && !this.buttonsPressed[this.psButton]) {\r\n            this.buttonsPressed[this.psButton] = true;\r\n        }else if(!this.gamepad.buttons[this.psButton].pressed){\r\n            this.buttonsPressed[this.psButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonPlus].pressed && !this.buttonsPressed[this.buttonPlus]) {\r\n            this.buttonsPressed[this.buttonPlus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonPlus].pressed){\r\n            this.buttonsPressed[this.buttonPlus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonMinus].pressed && !this.buttonsPressed[this.buttonMinus]) {\r\n            this.buttonsPressed[this.buttonMinus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonMinus].pressed){\r\n            this.buttonsPressed[this.buttonMinus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed && !this.buttonsPressed[this.buttonL2]) {\r\n            this.buttonsPressed[this.buttonL2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL2].pressed){\r\n            this.buttonsPressed[this.buttonL2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonsPressed[this.buttonL3]) {\r\n            this.buttonsPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonsPressed[this.buttonL3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR2].pressed && !this.buttonsPressed[this.buttonR2]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonsPressed[this.buttonR2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR2].pressed){\r\n            this.buttonsPressed[this.buttonR2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonsPressed[this.buttonR3]) {\r\n            this.globalControllerHandler.doHorn();\r\n            this.buttonsPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonsPressed[this.buttonR3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.enter].pressed && !this.buttonsPressed[this.enter]) {\r\n            this.buttonsPressed[this.enter] = true;\r\n        }else if(!this.gamepad.buttons[this.enter].pressed){\r\n            this.buttonsPressed[this.enter] = false;\r\n        }\r\n        \r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonsPressed[this.shareButton]) {\r\n            this.buttonsPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonsPressed[this.shareButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.optionsButton].pressed && !this.buttonsPressed[this.optionsButton]) {\r\n            this.buttonsPressed[this.optionsButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionsButton].pressed){\r\n            this.buttonsPressed[this.optionsButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperLeft].pressed && !this.buttonsPressed[this.bumperLeft]) {\r\n            this.buttonsPressed[this.bumperLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperLeft].pressed){\r\n            this.buttonsPressed[this.bumperLeft] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperRight].pressed && !this.buttonsPressed[this.bumperRight]) {\r\n            this.buttonsPressed[this.bumperRight] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperRight].pressed){\r\n            this.buttonsPressed[this.bumperRight] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.wheelInEnterLeft].pressed && !this.buttonsPressed[this.wheelInEnterLeft]) {\r\n            this.buttonsPressed[this.wheelInEnterLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterLeft].pressed){\r\n            this.buttonsPressed[this.wheelInEnterLeft] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.wheelInEnterRight].pressed && !this.buttonsPressed[this.wheelInEnterRight]) {\r\n            this.buttonsPressed[this.wheelInEnterRight] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterRight].pressed){\r\n            this.buttonsPressed[this.wheelInEnterRight] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionsShifter(){\r\n        if (this.gamepad.buttons[this.firstShift].pressed && !this.buttonsPressed[this.firstShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 1);\r\n            this.buttonsPressed[this.firstShift] = true;\r\n        }else if(!this.gamepad.buttons[this.firstShift].pressed && this.buttonsPressed[this.firstShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.firstShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.secondShift].pressed && !this.buttonsPressed[this.secondShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 2);\r\n            this.buttonsPressed[this.secondShift] = true;\r\n        }else if(!this.gamepad.buttons[this.secondShift].pressed && this.buttonsPressed[this.secondShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.secondShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.thirdShift].pressed && !this.buttonsPressed[this.thirdShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 3);\r\n            this.buttonsPressed[this.thirdShift] = true;\r\n        }else if(!this.gamepad.buttons[this.thirdShift].pressed && this.buttonsPressed[this.thirdShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.thirdShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fourthShift].pressed && !this.buttonsPressed[this.fourthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 4);\r\n            this.buttonsPressed[this.fourthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fourthShift].pressed && this.buttonsPressed[this.fourthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fourthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fifthShift].pressed && !this.buttonsPressed[this.fifthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 5);\r\n            this.buttonsPressed[this.fifthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fifthShift].pressed && this.buttonsPressed[this.fifthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fifthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.sixthShift].pressed && !this.buttonsPressed[this.sixthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 6);\r\n            this.buttonsPressed[this.sixthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.sixthShift].pressed && this.buttonsPressed[this.sixthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.sixthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.reverseShift].pressed && !this.buttonsPressed[this.reverseShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], -1);\r\n            this.buttonsPressed[this.reverseShift] = true;\r\n        }else if(!this.gamepad.buttons[this.reverseShift].pressed && this.buttonsPressed[this.reverseShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.reverseShift] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionByMapping(){\r\n        this.doActionsPedals();\r\n        this.doActionsWheel();\r\n        this.doActionsDPad();\r\n        this.doActionsButtons();\r\n        this.doActionsShifter();\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport default class LogitechG29ControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(carLogic) {\r\n        if (!LogitechG29ControllerSingleton.instance) {\r\n            LogitechG29ControllerSingleton.instance = new LogitechG29Controller(carLogic);\r\n        }\r\n        return LogitechG29ControllerSingleton.instance;\r\n    }\r\n}\r\n\r\n\r\n//module.exports = LogitechG29ControllerSingleton;","\r\nconst { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst STICK_LIMIT = 0.1;\r\nconst CLUTCH_PRESED = 0;\r\nconst CLUTCH_NOT_PRESED = 1;\r\n\r\nclass XboxController{\r\n    constructor(auto, camera){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('Xbox') || gamepads[i].id.startsWith('xinput')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonA = 0;\r\n        this.buttonB = 1;\r\n        this.buttonX = 2;\r\n        this.buttonY = 3;\r\n        this.buttonL1 = 4;\r\n        this.buttonR1 = 5;\r\n        this.buttonL2 = 6;\r\n        this.buttonR2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionButton = 9;\r\n        this.buttonL3 = 10;\r\n        this.buttonR3 = 11;\r\n        this.padUp = 12;\r\n        this.padDown = 13;\r\n        this.padLeft = 14;\r\n        this.padRight = 15;\r\n        this.buttomHome = 16;\r\n        this.buttonPressed = [];\r\n        this.actualShift = 0;\r\n        for(let i = 0; i <= 16; i++){\r\n            this.buttonPressed.push(false);\r\n        }\r\n        \r\n        this.xLeftAxe = 0;\r\n        this.yLeftAxe = 1;\r\n        this.xRightAxe = 2;\r\n        this.yRightAxe = 3;\r\n        this.globalControllerHandler = new GlobalControllerHandling(auto);\r\n        this.camera = camera;\r\n    }\r\n\r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('Xbox')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n    doActionsAxes(){\r\n        if(Math.abs(this.gamepad.axes[this.yLeftAxe]) >= STICK_LIMIT){    \r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.xLeftAxe]) >= STICK_LIMIT){\r\n            let axe = ((this.gamepad.axes[this.xLeftAxe] )**3)\r\n            this.globalControllerHandler.turnDirection(axe);\r\n        }else{\r\n            this.globalControllerHandler.turnDirection(0);\r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.yRightAxe]) >= STICK_LIMIT){\r\n        }\r\n        let rotation = ((this.gamepad.axes[this.xRightAxe] )**3)\r\n            this.camera.rotate(-rotation);\r\n        // if(Math.abs(this.gamepad.axes[this.xRightAxe]) >= STICK_LIMIT){\r\n        //     let rotation = ((this.gamepad.axes[this.xRightAxe] )**3)\r\n        //     this.camera.rotate(-rotation);\r\n        // }\r\n    }\r\n\r\n    doActionHotKeys(){\r\n        this.globalControllerHandler.handleAccelerate(CLUTCH_NOT_PRESED, this.gamepad.buttons[this.buttonR2].value);\r\n        this.globalControllerHandler.handleBrake(CLUTCH_PRESED, this.gamepad.buttons[this.buttonL2].value);\r\n    }\r\n\r\n    doActionsTriggers(){\r\n        if (this.gamepad.buttons[this.buttonR2].pressed) {\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed) {\r\n        }\r\n    }\r\n\r\n\r\n\r\n    doActionsButtons(){\r\n        \r\n        if (this.gamepad.buttons[this.buttonR1].pressed && !this.buttonPressed[this.buttonR1]) {\r\n            if(this.actualShift <= 5){\r\n                this.actualShift += 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonR1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR1].pressed){\r\n            \r\n            this.buttonPressed[this.buttonR1] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL1].pressed && !this.buttonPressed[this.buttonL1]) {\r\n            if(this.actualShift >= 0){\r\n                this.actualShift -= 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonL1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL1].pressed){\r\n            this.buttonPressed[this.buttonL1] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonPressed[this.shareButton]) {\r\n            this.buttonPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonPressed[this.shareButton] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padUp].pressed && !this.buttonPressed[this.padUp]) {\r\n            this.globalControllerHandler.turnParkingLight();\r\n            this.buttonPressed[this.padUp] = true;\r\n        }else if(!this.gamepad.buttons[this.padUp].pressed){\r\n            this.buttonPressed[this.padUp] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.padDown].pressed && !this.buttonPressed[this.padDown]) {\r\n            this.buttonPressed[this.padDown] = true;\r\n        }else if(!this.gamepad.buttons[this.padDown].pressed){\r\n            this.buttonPressed[this.padDown] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padLeft].pressed && !this.buttonPressed[this.padLeft]) {\r\n            this.globalControllerHandler.turnLeftLight();\r\n            this.buttonPressed[this.padLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.padLeft].pressed){\r\n            this.buttonPressed[this.padLeft] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padRight].pressed && !this.buttonPressed[this.padRight]) {\r\n            \r\n            this.globalControllerHandler.turnRightLight();\r\n            this.buttonPressed[this.padRight] = true;\r\n        }else if(!this.gamepad.buttons[this.padRight].pressed){\r\n            this.buttonPressed[this.padRight] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonA].pressed && !this.buttonPressed[this.buttonA]) {\r\n            this.buttonPressed[this.buttonA] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonA].pressed){\r\n            this.buttonPressed[this.buttonA] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonB].pressed && !this.buttonPressed[this.buttonB]) {\r\n            this.buttonPressed[this.buttonB] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonB].pressed){\r\n            this.buttonPressed[this.buttonB] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonY].pressed && !this.buttonPressed[this.buttonY]) {\r\n            this.buttonPressed[this.buttonY] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonY].pressed){\r\n            this.buttonPressed[this.buttonY] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonPressed[this.buttonX]) {\r\n            this.globalControllerHandler.doHorn();\r\n            this.buttonPressed[this.buttonX] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonPressed[this.buttonX] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonPressed[this.buttonR3]) {\r\n\r\n            this.buttonPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonPressed[this.buttonR3] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonPressed[this.buttonL3]) {\r\n            this.buttonPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonPressed[this.buttonL3] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.buttomHome].pressed && !this.buttonPressed[this.buttomHome]) {\r\n            this.globalControllerHandler.changeShiftBox(\"semi-auto\");\r\n            this.buttonPressed[this.buttomHome] = true;\r\n        }else if(!this.gamepad.buttons[this.buttomHome].pressed){\r\n            this.buttonPressed[this.buttomHome] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.optionButton].pressed && !this.buttonPressed[this.optionButton]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonPressed[this.optionButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionButton].pressed){\r\n            this.buttonPressed[this.optionButton] = false;\r\n        }\r\n    }\r\n\r\n    doActionByMapping(){\r\n        this.doActionHotKeys();\r\n        this.doActionsAxes();\r\n        this.doActionsTriggers();\r\n        this.doActionsButtons();\r\n    }\r\n}\r\n\r\nexport default class XboxControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(auto, camera) {\r\n        if (!XboxControllerSingleton.instance) {\r\n            XboxControllerSingleton.instance = new XboxController(auto, camera);\r\n        }\r\n        return XboxControllerSingleton.instance;\r\n    }\r\n}","export default class Observable{\r\n\r\n    constructor(){\r\n        this.observers = [];\r\n    }\r\n\r\n    attachObserver(observer){\r\n        this.observers.push(observer);\r\n    }\r\n\r\n    removeObserver(observer){\r\n        let index = this.observers.indexOf(observer);\r\n        if(index > -1){\r\n            this.observers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    notifyObservers(stateToSend){\r\n        for (let i = 0; i < this.observers.length; i++){\r\n            this.observers[i].update(stateToSend);\r\n        }\r\n    }\r\n}","import Ammo from 'ammo.js'\r\n\r\nexport default class AmmoInstance{\r\n\r\n    static AmmoInstanceToReturn = null;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static async getInstance(){\r\n        if(!AmmoInstance.AmmoInstanceToReturn){\r\n            AmmoInstance.AmmoInstanceToReturn = await Ammo();\r\n        }\r\n        return AmmoInstance.AmmoInstanceToReturn;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst FRONT_LEFT = 0;\r\nconst FRONT_RIGHT = 1;\r\nconst BACK_LEFT = 2;\r\nconst BACK_RIGHT = 3;\r\n\r\nconst SIDE_RIGHT =-1;\r\nconst SIDE_LEFT = 1;\r\nconst MAX_STEER = -0.5;\r\n\r\nconst MAX_FRICTION_FORCE = 100;\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\nexport default class CarPhysics{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction *10);\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        this.tuning = new this.Ammo.btVehicleTuning();\r\n        var rayCaster = new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld);\r\n        this.vehicle = new this.Ammo.btRaycastVehicle(this.tuning, this.rigidBody, rayCaster);\r\n        this.vehicle.setCoordinateSystem(0, 1, 2);\r\n        this.physicsWorld.addAction(this.vehicle);\r\n\r\n        let radio_rueda = 0.35;\r\n        let disti_center = 0.85;\r\n        var wheelAxisPositionBack = -1.45;\r\n        var wheelRadiusBack = radio_rueda;\r\n        var wheelWidthBack = 0.35;\r\n        var wheelHalfTrackBack = -disti_center;\r\n        var wheelAxisHeightBack = 0.2;\r\n\r\n        var wheelAxisFrontPosition = 1.65;\r\n        var wheelHalfTrackFront = disti_center;\r\n        var wheelAxisHeightFront = 0.2;\r\n        var wheelRadiusFront = radio_rueda;\r\n        var wheelWidthFront = 0.35;\r\n\r\n\r\n        this.addWheel(true, new this.Ammo.btVector3(wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_LEFT,SIDE_LEFT);\r\n        this.addWheel(true, new this.Ammo.btVector3(-wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_RIGHT,SIDE_RIGHT);\r\n        this.addWheel(false, new this.Ammo.btVector3(-wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_LEFT,SIDE_LEFT);\r\n        this.addWheel(false, new this.Ammo.btVector3(wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_RIGHT,SIDE_RIGHT);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    addWheel(isFront, pos, radius, width, index, side) {\r\n        var wheelDirectionCS0 = new this.Ammo.btVector3(0, -1, 0);\r\n        var wheelAxleCS = new this.Ammo.btVector3(-1, 0, 0);\r\n        var suspensionStiffness = 2.0;\r\n        var suspensionRestLength = 0.6;\r\n        var rollInfluence = 0.2;\r\n        var friction = 1000;\r\n        var suspensionDamping = 3.3;\r\n        var suspensionCompression = 4.4;\r\n        var wheelInfo = this.vehicle.addWheel(\r\n            pos,\r\n            wheelDirectionCS0,\r\n            wheelAxleCS,\r\n            suspensionRestLength,\r\n            radius,\r\n            this.tuning,\r\n            isFront\r\n        );\r\n\r\n        wheelInfo.set_m_suspensionStiffness(suspensionStiffness);\r\n        wheelInfo.set_m_wheelsDampingRelaxation(suspensionDamping);\r\n        wheelInfo.set_m_wheelsDampingCompression(suspensionCompression);\r\n        wheelInfo.set_m_frictionSlip(friction);\r\n        wheelInfo.set_m_rollInfluence(rollInfluence);\r\n\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let returnValue = {\r\n            \"chassis\": {\r\n                \"position\": null,\r\n                \"rotation\": null,\r\n            },\r\n            \"wheels\": []\r\n        }\r\n        for (let i=0; i < this.vehicle.getNumWheels(); i++){\r\n            this.vehicle.updateWheelTransform(i, true);\r\n            let transfMatrix = this.vehicle.getWheelTransformWS(i);\r\n            let position = transfMatrix.getOrigin();\r\n            let rotation = transfMatrix.getRotation();\r\n            returnValue.wheels.push({\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            });\r\n        }\r\n        let worldTransformChassis = this.vehicle.getChassisWorldTransform();\r\n            \r\n        let position = worldTransformChassis.getOrigin();\r\n        let rotation = worldTransformChassis.getRotation();\r\n        returnValue.chassis = {\r\n            \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n            \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n        };\r\n        return returnValue;\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n\r\n    \r\n    setEngineForce( engineForce ){\r\n        this.vehicle.applyEngineForce( engineForce, BACK_LEFT );\r\n        this.vehicle.applyEngineForce( engineForce, BACK_RIGHT );\r\n    }\r\n\r\n\r\n    brake(valueBrake){\r\n        let speedKMH = Math.abs(this.vehicle.getCurrentSpeedKmHour());\r\n        let frictionBrake = MAX_FRICTION_FORCE / ( speedKMH );\r\n        if( speedKMH === 0 ){\r\n            frictionBrake = 0;\r\n        }\r\n        valueBrake += frictionBrake;\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_LEFT);\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_RIGHT);\r\n        this.vehicle.setBrake(valueBrake, BACK_LEFT);\r\n        this.vehicle.setBrake(valueBrake, BACK_RIGHT);\r\n    }\r\n\r\n\r\n    setSteeringRotation( rotation ){\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_LEFT);\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_RIGHT);\r\n    }\r\n\r\n\r\n    getVelocity(){\r\n        return this.vehicle.getCurrentSpeedKmHour();\r\n    }\r\n}","export const MAX_RPM = 8000;\r\nconst ACCEL_COEF = 2;\r\nconst BRAKE_COEF = 1.5;\r\nexport const EXPONENTIAL_COEF_TO_RPM = 200;\r\n\r\nexport class AbstractEngineState{\r\n    changeValueInRPMCurve(valuePedal, accelerating, currentRPM, currentXInRPMCurve){\r\n\r\n        let sumToValueInCurve;\r\n        let previousRPM = currentRPM;\r\n        if(accelerating){\r\n            let normalizedAccelerator = valuePedal;\r\n            //let normalizedAccelerator = (1 - (valuePedal + 1) / 2);\r\n            let normalizedRPM = previousRPM/MAX_RPM;\r\n            sumToValueInCurve = (normalizedAccelerator - normalizedRPM) * ACCEL_COEF;\r\n        }else{\r\n            sumToValueInCurve = -valuePedal * BRAKE_COEF;\r\n        }\r\n        currentXInRPMCurve = currentXInRPMCurve + sumToValueInCurve;\r\n        if (currentXInRPMCurve > 3 * EXPONENTIAL_COEF_TO_RPM){\r\n            currentXInRPMCurve = 3 * EXPONENTIAL_COEF_TO_RPM;\r\n        }\r\n        else if(currentXInRPMCurve < 0){ //X's value is not able to have negative value in our calculation.\r\n            currentXInRPMCurve = 0;\r\n        }\r\n\r\n        //We'll simulate the RPM's in an equation similar to capacitors in order to not make it linear and make it independent of everything.\r\n        currentRPM = MAX_RPM * (1 - Math.exp(-currentXInRPMCurve/EXPONENTIAL_COEF_TO_RPM));\r\n\r\n        return [currentRPM, currentXInRPMCurve];\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nconst ACCEL_NOT_PRESSED = 0;\r\n\r\nexport default class TurnedOffEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(ACCEL_NOT_PRESSED, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nexport default class TurnedOnEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueAccelerator, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from './CarEngineStates/AbstractEngineState';\r\nimport TurnedOffEngine from './CarEngineStates/TurnedOffEngine';\r\nimport TurnedOnEngine from './CarEngineStates/TurnedOnEngine';\r\n\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 0;//1000\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = 0.25;\r\n\r\nexport default class CarEngine{\r\n\r\n\r\n    constructor(useAudio){\r\n        this.engineState = new TurnedOffEngine();\r\n        this.currentRPM = 0;\r\n        this.currentXInRPMCurve = 0;\r\n        this.playbackRate = 1.1;\r\n        this.useAudio = useAudio;\r\n    }\r\n\r\n\r\n    turnOn(){\r\n        if(this.engineState instanceof TurnedOffEngine){\r\n            this.engineState = new TurnedOnEngine();\r\n            if (this.useAudio){\r\n                new Audio('./sounds/encendido.wav').play();\r\n                setTimeout(() => {\r\n                    this.soundEngine = new (window.AudioContext || window.webkitAudioContext)();\r\n                    fetch(\"./sounds/engine.wav\").then(\r\n                        response => response.arrayBuffer()\r\n                    ).then(buffer => this.soundEngine.decodeAudioData(buffer)\r\n                    ).then(buffer => {\r\n                        this.soundEngineSource = this.soundEngine.createBufferSource();\r\n                        this.soundEngineSource.buffer = buffer;\r\n                        this.soundEngineSource.loop = true;\r\n                        this.soundEngineSource.connect(this.soundEngine.destination);\r\n                        this.soundEngineSource.start();\r\n                    });\r\n                }, 1300);\r\n            }            \r\n        }\r\n    }\r\n\r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    handleEngineShutdown(valueClutch,shiftBox){\r\n        //!this.clutchIsPressed(valueClutch) && this.currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN\r\n        if(shiftBox.shutDownEngine(valueClutch,this.currentRPM)){\r\n            if(this.engineState instanceof TurnedOnEngine){\r\n                this.engineState = new TurnedOffEngine();\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n\r\n    isInConditionToAccelerate(valueClutch){\r\n        return ((this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch)) || this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    engineCanApplyForce(valueClutch){\r\n        return (this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator, shiftBox){\r\n        let rpmReturn = this.engineState.accelerate(valueAccelerator, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        if (this.soundEngineSource) this.soundEngineSource.playbackRate.value = 1.1 + this.currentRPM/MAX_RPM * 2.0;\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake,shiftBox){\r\n        let rpmReturn = this.engineState.brake(valueBrake, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        if (this.soundEngineSource) this.soundEngineSource.playbackRate.value = 1.1 + this.currentRPM/MAX_RPM * 2.0;\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    changeRPM(RPMModification){\r\n        this.currentRPM = RPMModification;\r\n        if( (-this.currentRPM/MAX_RPM + 1) > 0 ){\r\n            this.currentXInRPMCurve = -Math.log( -this.currentRPM/MAX_RPM + 1) * EXPONENTIAL_COEF_TO_RPM;\r\n            if(this.currentXInRPMCurve < 0){\r\n                this.currentXInRPMCurve = 0;\r\n            }\r\n        }else if(this.currentRPM === MAX_RPM){\r\n            this.currentXInRPMCurve = EXPONENTIAL_COEF_TO_RPM * 3;\r\n        }\r\n    }\r\n\r\n\r\n    getCurrentRPM(){\r\n        return this.currentRPM;\r\n    }\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from \"./CarEngineStates/AbstractEngineState\";\r\n\r\n\r\nconst QUANTITY_SHIFTS = 6;\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = -0.75;\r\n\r\nexport default class ShiftBox{\r\n\r\n    constructor(carEngine){\r\n        this.NEUTRAL = 0;\r\n        this.REVERSE = -1;\r\n        this.FIRST = 1;\r\n        this.SECOND = 2;\r\n        this.THIRD = 3;\r\n        this.FOURTH = 4;\r\n        this.FIFTH = 5;\r\n        this.SIXTH = 6;\r\n        this.validShifts = [this.REVERSE, this.NEUTRAL, this.FIRST, this.SECOND, this.THIRD, this.FOURTH, this.FIFTH, this.SIXTH];\r\n\r\n        this.currentShift = this.NEUTRAL;\r\n        this.carEngine = carEngine;\r\n\r\n        this.minimumVelocityOnShift = [0, 10, 20, 35, 60, 90];\r\n        this.maximumVelocityOnShift = [40, 60, 80, 110, 140, 200];\r\n\r\n    }\r\n\r\n    isValidShift(shift){\r\n        if (this.validShifts.indexOf(shift) >= 0){\r\n            return true;\r\n        }else{\r\n            throw new Error(\"Shift \" + shift + \" is not valid.\");\r\n        }\r\n    }\r\n    \r\n\r\n    calculateNormalFactorRPM(newShift,oldVelocity){\r\n        return ((oldVelocity - this.minimumVelocityOnShift[Math.abs(newShift) - 1]) / \r\n            (this.maximumVelocityOnShift[Math.abs(newShift) - 1] - this.minimumVelocityOnShift[Math.abs(newShift) - 1]));\r\n    }\r\n    \r\n\r\n    getValueForNewRPM(newShift, oldVelocity){\r\n        if(newShift === this.NEUTRAL || (Math.abs(newShift) === this.FIRST && Math.abs(oldVelocity) < 5)){\r\n            return this.carEngine.getCurrentRPM();\r\n        }\r\n        if(newShift === this.REVERSE && oldVelocity > 0){\r\n            return 0;\r\n        }\r\n        if(newShift > 0 && oldVelocity < 0){\r\n            return 0;\r\n        }\r\n        let normalFactorRPM = this.calculateNormalFactorRPM(newShift, oldVelocity);\r\n        if ( normalFactorRPM > 1 ){\r\n            return MAX_RPM;\r\n        }else{\r\n            let XValue = normalFactorRPM * EXPONENTIAL_COEF_TO_RPM;\r\n            return (MAX_RPM * (1 - Math.exp(-XValue/EXPONENTIAL_COEF_TO_RPM)));\r\n        }\r\n    }\r\n    \r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    shutDownEngine(){\r\n        return false;\r\n    }\r\n\r\n    //CONSIDERAR EL VALUE DEL ACCELERATOR DE FORMA SIMILAR A COMO SE CONSIDERA EN ABSTRACT ENGINE STATE PARA QUE SI ES NEGATIVO DECREMENTE LA VELOCIDAD Y NO AUMENTE\r\n    getEngineForce(currentVelocity, valueClutch){\r\n        currentVelocity = Math.abs(currentVelocity);\r\n        let currentRPM = this.carEngine.getCurrentRPM();\r\n\r\n        if(this.currentShift === this.NEUTRAL){\r\n            return 0;\r\n        }\r\n\r\n        let valueClutchNormalized = (valueClutch + 1)/2;\r\n        let minVelocityBasedOnClutch = this.minimumVelocityOnShift[Math.abs(this.currentShift) - 1] * (1 - Math.exp(-valueClutchNormalized*3));\r\n        //If there is a next shift and it has ideal velocity we can calculate the Normalized Engine Force based on velocity range\r\n\r\n        let rangeOfVelocities = this.maximumVelocityOnShift[Math.abs(this.currentShift) - 1] - minVelocityBasedOnClutch;\r\n        let normalFactorToDecrement = (currentVelocity - minVelocityBasedOnClutch) / rangeOfVelocities;\r\n        if(currentVelocity < minVelocityBasedOnClutch){\r\n            //Debería dar trompicones\r\n        }\r\n        let normalFactor = (1 - normalFactorToDecrement)**2;\r\n\r\n        if(normalFactor > 1){\r\n            normalFactor = 0;\r\n        }\r\n\r\n        let powerFactor = (QUANTITY_SHIFTS / this.currentShift);\r\n        let finalEngineForce =  powerFactor * currentRPM * normalFactor;\r\n        return finalEngineForce\r\n\r\n    }\r\n\r\n    changeShift(){\r\n        //METHOD TO OVERRIDE\r\n    }\r\n\r\n\r\n    getCurrentShift(){\r\n        return this.currentShift;\r\n    }\r\n\r\n}","import ShiftBox from '../ShiftBox';\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 1000;\r\nexport default class ManualBox extends ShiftBox{\r\n\r\n    \r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift) && this.clutchIsPressed(valueClutch)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }else{\r\n            throw new Error(\"Can't change shift if clutch is not pressed\");\r\n        }\r\n    }\r\n\r\n\r\n    shutDownEngine(valueClutch, currentRPM){\r\n        return !this.clutchIsPressed(valueClutch) && currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN;\r\n    }\r\n}","import ShiftBox from '../ShiftBox';\r\n\r\nexport default class SemiAutomaticBox extends ShiftBox{\r\n\r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }\r\n    }\r\n}","import { Vector3, Vector4, Quaternion } from 'three';\r\nimport Observable from '../../ObserverPattern/Observable';\r\nimport CarPhysics from '../Physics/PhysicsTypes/CarPhysics';\r\nimport CarEngine from './CarEngine';\r\nimport ManualBox from './ShiftBoxTypes/ManualBox';\r\nimport SemiAutomaticBox from './ShiftBoxTypes/SemiAutomaticBox';\r\n\r\n\r\nconst FACTOR_BRAKE_TO_FORCE = 180;\r\nexport default class Car extends Observable{\r\n\r\n    constructor(physicsWorld, initialPosition, useAudio = true, initialRotation = new Quaternion().identity()){\r\n        super();\r\n        this.carEngine = new CarEngine(useAudio);\r\n        this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        this.currentDirectionTurn = 0; //in rads\r\n        this.currentTireRotation = 0;\r\n        this.position = new Vector3(initialPosition[0], initialPosition[1], initialPosition[2]);\r\n        this.rotationQuaternion = initialRotation;\r\n        this.mass = 1000;\r\n        this.physicsShape = new Vector3(2,1.3,5);\r\n        this.rotation = new Vector4(0,0,0,1);\r\n        this.inertia = new Vector3(1,0,1);\r\n        this.carPhysics = new CarPhysics(this.position, this.rotationQuaternion, this.inertia, this.mass, this.physicsShape, physicsWorld, 0);\r\n        this.turnRigthLigth = false;\r\n        this.turnLeftLigth = false;\r\n\r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator){\r\n        this.carEngine.accelerate(valueClutch, valueAccelerator,this.shiftBox);\r\n        if(valueAccelerator > 0.1 && this.carEngine.engineCanApplyForce(valueClutch)){\r\n            this.carPhysics.setEngineForce( this.shiftBox.getEngineForce(this.carPhysics.getVelocity(), valueClutch) );\r\n        }else{\r\n            this.carPhysics.setEngineForce( 0 );\r\n        }\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake){\r\n        this.carEngine.brake(valueClutch, valueBrake,this.shiftBox);\r\n        //Mapping [-1;1] to [0;1]\r\n        this.carPhysics.brake(valueBrake*FACTOR_BRAKE_TO_FORCE);\r\n    }\r\n\r\n    doHorn(){\r\n        new Audio(\"./sounds/bocina.wav\").play();\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, newShift){\r\n        this.shiftBox.changeShift(valueClutch, newShift, this.carPhysics.getVelocity());\r\n    }\r\n\r\n\r\n    turnRightLight(){\r\n        if(!this.turnRigthLigth && this.turnLeftLigth){\r\n            this.turnLeftLigth = false;\r\n        } \r\n        this.turnRigthLigth = !this.turnRigthLigth;\r\n    }\r\n\r\n\r\n    turnLeftLight(){\r\n        if(!this.turnLeftLigth && this.turnRigthLigth){\r\n            this.turnRigthLigth = false;\r\n        } \r\n        this.turnLeftLigth = !this.turnLeftLigth;\r\n    }\r\n\r\n    turnParkingLight(){\r\n        if(this.turnLeftLigth && this.turnRigthLigth){\r\n            this.turnLeftLigth = !this.turnLeftLigth;\r\n            this.turnRigthLigth = !this.turnRigthLigth;\r\n        }else{\r\n            this.turnRigthLigth = true;\r\n            this.turnLeftLigth = true;\r\n        }\r\n    }\r\n\r\n    \r\n    turnOnCar(){\r\n        this.carEngine.turnOn();\r\n    }\r\n\r\n    \r\n    turnDirection(wheelAxesValue){\r\n        this.currentTireRotation = wheelAxesValue;\r\n        this.carPhysics.setSteeringRotation( wheelAxesValue );\r\n    }\r\n\r\n\r\n    update(){\r\n        let positionAndRotation = this.carPhysics.updatePhysics();\r\n        this.position = positionAndRotation[\"chassis\"][\"position\"];\r\n        this.rotation = positionAndRotation[\"chassis\"][\"rotation\"];\r\n        this.wheelsData = positionAndRotation[\"wheels\"];\r\n        super.notifyObservers(this.getDataToAnimate());\r\n    }\r\n\r\n\r\n    getLastRotation(){\r\n        return this.currentTireRotation;\r\n    }\r\n\r\n    \r\n    getDataToAnimate(){\r\n        return {\r\n            \"direction\": this.currentDirectionTurn, \r\n            \"velocity\": this.carPhysics.getVelocity(), \r\n            \"lastRotationWheel\": this.currentTireRotation,\r\n            \"dirVector\": new Vector3(0,0,1).applyQuaternion(this.rotation),\r\n            \"position\": this.position,\r\n            \"rotation\": this.rotation,\r\n            \"physicsBody\": this.carPhysics,\r\n            \"wheelsData\": this.wheelsData,\r\n            \"rpm\": this.getCurrentRPM(),\r\n            \"turnRigthLigth\": this.turnRigthLigth,\r\n            \"turnLeftLigth\": this.turnLeftLigth,\r\n        };\r\n    }\r\n\r\n    getSpeed(){\r\n        return this.carPhysics.getVelocity();\r\n    }\r\n\r\n    getCurrentRPM(){\r\n        return this.carEngine.getCurrentRPM();\r\n    }\r\n\r\n    changeShiftBox(mode){\r\n        if(mode ===  \"semi-auto\"){\r\n            this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        }else if(mode === \"manual\"){\r\n            //TODO: asignar boton en volante\r\n            this.shiftBox = new ManualBox(this.carEngine);\r\n        }\r\n    }\r\n\r\n    getCurrentShift(){\r\n        return this.shiftBox.getCurrentShift();\r\n    }\r\n}","import Observable from \"../../../ObserverPattern/Observable\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\n\r\nexport default class GeneralPhysics extends Observable{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        super();\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        if(!friction) friction = 1;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async generateShape(){\r\n        return null;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = await this.generateShape();\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction * 2)\r\n\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let motionState = this.rigidBody.getMotionState();\r\n        if(motionState){\r\n            motionState.getWorldTransform(this.tempTransform);\r\n            \r\n            let position = this.tempTransform.getOrigin();\r\n            let rotation = this.tempTransform.getRotation();\r\n            const newState = {\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            }\r\n            this.notifyObservers(newState);\r\n            return newState;\r\n        }else{\r\n            throw new Error(\"No motion state found in rigid body\");\r\n        }\r\n    }\r\n\r\n\r\n    setLinearVelocity(velocityVector){\r\n        let velVectorBT = new this.Ammo.btVector3(this.mass*velocityVector.x, this.mass*velocityVector.y, this.mass*velocityVector.z);\r\n        this.rigidBody.applyForce(velVectorBT);\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n}","import GeneralPhysics from \"./GeneralPhysics\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nexport default class BoxPhysics extends GeneralPhysics{\r\n\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        const shape = new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n        shape.setMargin(0.05);\r\n        return shape;\r\n    }\r\n}","import VisualEntity from \"./VisualEntity\";\r\nimport * as THREE from 'three';\r\n\r\nexport default class TrafficCone extends VisualEntity{\r\n\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.RADIUS_TOP = 0.1;\r\n        this.RADIUS_BOTTOM = 0.8;\r\n        this.HEIGHT = 1.25;\r\n        this.observedState = null;\r\n    }\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            const geometry = new THREE.CylinderGeometry( this.RADIUS_TOP, this.RADIUS_BOTTOM, this.HEIGHT, 32, undefined, true );\r\n            const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n            const material = new THREE.MeshBasicMaterial( { map: texture });\r\n            const materialBox = new THREE.MeshBasicMaterial( { color: 0xd56324 } );\r\n            const geometryPlane = new THREE.BoxGeometry(this.RADIUS_BOTTOM*2, 0.1, this.RADIUS_BOTTOM*2);\r\n            const box = new THREE.Mesh( geometryPlane, materialBox );\r\n            box.position.set(0,-this.HEIGHT/2,0);\r\n            const cone = new THREE.Mesh( geometry, material );\r\n            cone.castShadow = true;\r\n            cone.receiveShadow = true;\r\n            cone.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(cone).add(box);\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.scale.set(scale[0], scale[1], scale[2]);\r\n\r\n            this.RADIUS_TOP *= scale[0];\r\n            this.RADIUS_BOTTOM *= scale[0];\r\n            this.HEIGHT *= scale[1];\r\n\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport GeneralPhysics from \"./GeneralPhysics\";\r\n\r\nexport default class CylinderPhysics extends GeneralPhysics{\r\n    \r\n    // Shape is a Vector3(Radius, HeightCylinder/2, Radius). \r\n    // See: https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=5889\r\n    // It's origin is in the center of the cylinder so calculate position by using height/2.\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        const shape = new Ammo.btCylinderShape(new Ammo.btVector3(this.shape.x, this.shape.y, this.shape.z));\r\n        shape.setMargin(0.05);\r\n        return shape;\r\n    }\r\n}","import GeneralPhysics from \"./GeneralPhysics\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nexport default class CustomGeometryPhysics extends GeneralPhysics{\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        // eslint-disable-next-line\r\n        let _triangle, triangle_mesh = new Ammo.btTriangleMesh();\r\n        //declare triangles position vectors\r\n        let vectA = new Ammo.btVector3(0, 0, 0);\r\n        let vectB = new Ammo.btVector3(0, 0, 0);\r\n        let vectC = new Ammo.btVector3(0, 0, 0);\r\n        //retrieve vertices positions from object\r\n        let verticesPos = this.shape.getAttribute('position').array;\r\n        let triangles = [];\r\n        for (let i = 0; i < verticesPos.length; i += 3) {\r\n            triangles.push({\r\n                x: verticesPos[i],\r\n                y: verticesPos[i + 1],\r\n                z: verticesPos[i + 2]\r\n            });\r\n        }\r\n        //use triangles data to draw ammo shape\r\n        for (let i = 0; i < triangles.length - 3; i += 3) {\r\n\r\n            vectA.setX(triangles[i].x);\r\n            vectA.setY(triangles[i].y);\r\n            vectA.setZ(triangles[i].z);\r\n\r\n            vectB.setX(triangles[i + 1].x);\r\n            vectB.setY(triangles[i + 1].y);\r\n            vectB.setZ(triangles[i + 1].z);\r\n\r\n            vectC.setX(triangles[i + 2].x);\r\n            vectC.setY(triangles[i + 2].y);\r\n            vectC.setZ(triangles[i + 2].z);\r\n\r\n            triangle_mesh.addTriangle(vectA, vectB, vectC, true);\r\n        }\r\n        Ammo.destroy(vectA);\r\n        Ammo.destroy(vectB);\r\n        Ammo.destroy(vectC);\r\n\r\n        var shape = new Ammo.btBvhTriangleMeshShape(triangle_mesh, true);\r\n        shape.setMargin(0);\r\n        return shape;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from \"./VisualEntity\";\r\nimport Models from './Models';\r\n\r\nconst SEPARATION_BETWEEN_BUILDINGS = 7.5;\r\n\r\nexport default class StraightStreet extends VisualEntity{\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.pathToNormalMap = \"textures/pavimento_map.png\"\r\n        this.SIZE = 30;\r\n        this.SIDEWALK_HEIGHT = .4;\r\n        this.observedState = null;\r\n    }\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n    createSidewalkMesh(scale){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        texture.repeat.set( 3, 10*scale );\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = new THREE.BoxGeometry(7*this.SIZE/24, this.SIDEWALK_HEIGHT, this.SIZE);\r\n        return new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n    }\r\n\r\n    createStreetMesh(scale){\r\n        const geometry = new THREE.BoxGeometry( 10*this.SIZE/24, 0.1, this.SIZE );\r\n        const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n        \r\n        texture.repeat.set( 1, 2*scale );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const material = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        mesh.receiveShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n    async loadBuildingBlock(id){\r\n        const models = await Models.getInstance();\r\n        const modelBuilding = await models[`building_${id}`];\r\n        return modelBuilding.clone();\r\n    }\r\n\r\n    async createBuildings(position, iter){\r\n        let model3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        model3D.name = \"buildingsRight_\"+iter;\r\n        model3D.position.x = 10*this.SIZE/24;\r\n        model3D.position.y = this.SIDEWALK_HEIGHT+0.05;\r\n        model3D.position.z = -this.LONG/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        model3D.scale.x = 0.8;\r\n        model3D.scale.y = 1;\r\n        model3D.scale.z = 0.6;\r\n        model3D.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n        model3D.updateMatrix();\r\n        model3D.updateMatrixWorld();\r\n        model3D.matrixAutoUpdate = false;\r\n        let secondModel3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        secondModel3D.name = \"buildingsLeft_\"+iter;\r\n        secondModel3D.position.x = -10*this.SIZE/24;\r\n        secondModel3D.position.y = this.SIDEWALK_HEIGHT+0.05;\r\n        secondModel3D.position.z = -this.LONG/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        secondModel3D.scale.x = 0.8;\r\n        secondModel3D.scale.y = 1;\r\n        secondModel3D.scale.z = 0.6;\r\n        secondModel3D.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI/2);\r\n        secondModel3D.updateMatrix();\r\n        secondModel3D.updateMatrixWorld();\r\n        secondModel3D.matrixAutoUpdate = false;\r\n        this.threeDModel.add(model3D, secondModel3D);\r\n    }\r\n\r\n    async addToScene(scene, objectName, position, scale, rotationY){\r\n        if(!this.threeDModel){\r\n            const baseStreet = this.createStreetMesh(scale);\r\n            const leftSidewalk = this.createSidewalkMesh(scale);\r\n            const rightSidewalk = this.createSidewalkMesh(scale);\r\n            baseStreet.position.set(0,0,0);\r\n            leftSidewalk.position.set(-8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0);\r\n            rightSidewalk.position.set(8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(baseStreet).add(leftSidewalk).add(rightSidewalk)\r\n            for (let i=0; i<4*scale; i++){\r\n                this.createBuildings(position, i);\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.rotateOnAxis(new THREE.Vector3(0,1,0), rotationY);\r\n            baseStreet.scale.set(1.0, 1.0, scale);\r\n            leftSidewalk.scale.set(1.0, 1.0, scale);\r\n            rightSidewalk.scale.set(1.0, 1.0, scale);\r\n            baseStreet.updateMatrix();\r\n            baseStreet.updateMatrixWorld();\r\n            baseStreet.matrixAutoUpdate = false;\r\n            leftSidewalk.updateMatrix();\r\n            leftSidewalk.updateMatrixWorld();\r\n            leftSidewalk.matrixAutoUpdate = false;\r\n            rightSidewalk.updateMatrix();\r\n            rightSidewalk.updateMatrixWorld();\r\n            rightSidewalk.matrixAutoUpdate = false;\r\n            this.threeDModel.updateMatrix();\r\n            this.threeDModel.updateMatrixWorld();\r\n            this.threeDModel.matrixAutoUpdate = false;\r\n            this.LONG = this.SIZE*scale;\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from \"./VisualEntity\";\r\n\r\nexport default class Intersection extends VisualEntity{\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.pathToNormalMap = \"textures/pavimento_map.png\"\r\n        this.SIZE = 30;\r\n        this.SIDEWALK_HEIGHT = .4;\r\n        this.SQUARE_SIZE = 7*30/24 + 0.12;\r\n        this.observedState = null;\r\n    }\r\n\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    getLerpPoints(vec1, vec2, quantPoints){\r\n        const points = [];\r\n        for (let i=0; i<=quantPoints; i++){\r\n            points.push(new THREE.Vector3(\r\n                vec1.x + (vec2.x - vec1.x) * i/quantPoints,\r\n                vec1.y + (vec2.y - vec1.y) * i/quantPoints,\r\n                vec1.z + (vec2.z - vec1.z) * i/quantPoints,\r\n            ))\r\n        }\r\n        return points;\r\n    }\r\n\r\n    createSidewalkCurve(){\r\n        let initialPoint = new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2);\r\n        const lerpPoints = this.getLerpPoints(initialPoint, new THREE.Vector3(-this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/10), 5);\r\n        const curve = new THREE.QuadraticBezierCurve(\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/10),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/2),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/10,this.SQUARE_SIZE/2)\r\n        );\r\n        const pointsCurve = curve.getPoints(10);\r\n        for (let i=0; i<pointsCurve.length; i++){\r\n            pointsCurve[i] = new THREE.Vector3(pointsCurve[i].x, 0, pointsCurve[i].y);\r\n        }\r\n        const secondLerpPoints = this.getLerpPoints(new THREE.Vector3(-this.SQUARE_SIZE/10,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), 5);\r\n        const thirdLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        const fourthLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        return [\r\n            ...lerpPoints, \r\n            ...pointsCurve, \r\n            ...secondLerpPoints, \r\n            ...thirdLerpPoints, \r\n            ...fourthLerpPoints\r\n        ];\r\n    }\r\n\r\n\r\n    getGeometrySidewalk(){\r\n        const geom = new THREE.BufferGeometry();\r\n        const points = this.createSidewalkCurve();\r\n        const columnas = points.length;\r\n        const filas = 4; //Fila baja, fila alta, tapa alta\r\n        const aux_vertices = [[],[],[]];\r\n        const indexes = [];\r\n        const uv1 = [];\r\n        const uv2 = [];\r\n        const uv3 = [];\r\n        let accum_x = 0;\r\n        let accum_z = 0;\r\n        for (let i=0; i<points.length; i++){\r\n            accum_x += points[i].x;\r\n            accum_z += points[i].z;\r\n        }\r\n        \r\n        for (let i=0; i<points.length; i++){\r\n            aux_vertices[0].push(points[i].x, points[i].y, points[i].z);\r\n            aux_vertices[1].push(points[i].x, this.SIDEWALK_HEIGHT, points[i].z);\r\n            aux_vertices[2].push(accum_x/points.length, this.SIDEWALK_HEIGHT, accum_z/points.length);            \r\n            // Los uvs se calculan como la posicion del punto en la tapa (X,Z)\r\n            // Normalizar para el UV con +this.SQUARE_SIZE/2 / this.SQUARE_SIZE.\r\n            //uv1.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv1.push(0.03414,0);\r\n            uv2.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv3.push(((accum_x/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, ((accum_z/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n        }\r\n        const uv = [...uv1, ...uv1, ...uv2, ...uv3];\r\n        const vertex = [...aux_vertices[0], ...aux_vertices[1], ...aux_vertices[1], ...aux_vertices[2]];\r\n        for (let i=0; i < filas-1; i++) {\r\n            for (let j=1; j < columnas; j++) {\r\n                //1er triangulo\r\n                indexes.push(i*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push(i*columnas+j);\r\n                //2do triangulo\r\n                indexes.push(i*columnas+j);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j);\r\n\r\n            }\r\n        }\r\n        const vertexArr = new Float32Array(vertex);\r\n        const uvArr = new Float32Array(uv);\r\n        geom.setIndex(indexes);\r\n        geom.setAttribute(\"position\", new THREE.BufferAttribute(vertexArr, 3));\r\n        geom.setAttribute(\"uv\", new THREE.BufferAttribute(uvArr, 2));\r\n        geom.computeVertexNormals();\r\n        return geom;\r\n    }\r\n\r\n\r\n    createSidewalkMesh(){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.repeat.set( 3, 3 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = this.getGeometrySidewalk();\r\n        const mesh = new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n        mesh.receiveShadow = true;\r\n        mesh.castShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n    createStreetMesh(){\r\n        const geometry = new THREE.BoxGeometry( this.SIZE, 0.1, this.SIZE );\r\n        const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n        texture.repeat.set( 2.4, 2.4 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const material = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        mesh.receiveShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position){\r\n        if(!this.threeDModel){\r\n            const baseStreet = this.createStreetMesh();\r\n            baseStreet.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(baseStreet);\r\n            for (let i=0; i<4; i++){\r\n                const sidewalk = this.createSidewalkMesh();\r\n                if (i===0){\r\n                    sidewalk.position.set(-this.SIZE/2+this.SQUARE_SIZE/2,0,-this.SIZE/2+this.SQUARE_SIZE/2);\r\n                    sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI/2);\r\n                }else if(i===2){\r\n                    sidewalk.position.set(-this.SIZE/2+this.SQUARE_SIZE/2,0,this.SIZE/2-this.SQUARE_SIZE/2);\r\n                    sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI);\r\n                }else if(i===3){\r\n                    sidewalk.position.set(this.SIZE/2-this.SQUARE_SIZE/2,0,-this.SIZE/2+this.SQUARE_SIZE/2);\r\n                }else{\r\n                    sidewalk.position.set(this.SIZE/2-this.SQUARE_SIZE/2,0,this.SIZE/2-this.SQUARE_SIZE/2);\r\n                    sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n                }\r\n                sidewalk.updateMatrix();\r\n                sidewalk.updateMatrixWorld();\r\n                sidewalk.matrixAutoUpdate = false;\r\n                this.threeDModel.add(sidewalk);\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.receiveShadow = true;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            baseStreet.updateMatrix();\r\n            baseStreet.updateMatrixWorld();\r\n            baseStreet.matrixAutoUpdate = false;\r\n            this.threeDModel.updateMatrix();\r\n            this.threeDModel.updateMatrixWorld();\r\n            this.threeDModel.matrixAutoUpdate = false;\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from \"./VisualEntity\";\r\nimport Models from './Models';\r\n\r\nconst SEPARATION_BETWEEN_BUILDINGS = 7.5;\r\n\r\nexport default class Curve extends VisualEntity{\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.pathToNormalMap = \"textures/pavimento_map.png\"\r\n        this.SIZE = 30;\r\n        this.SIDEWALK_HEIGHT = .4;\r\n        this.SQUARE_SIZE = 7*30/24+0.12;\r\n        this.TOP_CENTER = [this.SIZE/2-this.SQUARE_SIZE, this.SIDEWALK_HEIGHT, -this.SIZE/2+this.SQUARE_SIZE];\r\n        this.observedState = null;\r\n    }\r\n\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    getLerpPoints(vec1, vec2, quantPoints){\r\n        const points = [];\r\n        for (let i=0; i<=quantPoints; i++){\r\n            points.push(new THREE.Vector3(\r\n                vec1.x + (vec2.x - vec1.x) * i/quantPoints,\r\n                vec1.y + (vec2.y - vec1.y) * i/quantPoints,\r\n                vec1.z + (vec2.z - vec1.z) * i/quantPoints,\r\n            ))\r\n        }\r\n        return points;\r\n    }\r\n\r\n    createSidewalkCurve(){\r\n        let initialPoint = new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2);\r\n        const lerpPoints = this.getLerpPoints(initialPoint, new THREE.Vector3(-this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/10), 5);\r\n        const curve = new THREE.QuadraticBezierCurve(\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/10),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/2),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/10,this.SQUARE_SIZE/2)\r\n        );\r\n        const pointsCurve = curve.getPoints(10);\r\n        for (let i=0; i<pointsCurve.length; i++){\r\n            pointsCurve[i] = new THREE.Vector3(pointsCurve[i].x, 0, pointsCurve[i].y);\r\n        }\r\n        const secondLerpPoints = this.getLerpPoints(new THREE.Vector3(-this.SQUARE_SIZE/10,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), 5);\r\n        const thirdLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        const fourthLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        return [\r\n            ...lerpPoints, \r\n            ...pointsCurve, \r\n            ...secondLerpPoints, \r\n            ...thirdLerpPoints, \r\n            ...fourthLerpPoints\r\n        ];\r\n    }\r\n\r\n\r\n    createLongSidewalkCurve(){\r\n        let initialPoint = new THREE.Vector3(-this.SIZE/2,0,-this.SIZE/2);\r\n        const lerpPoints = this.getLerpPoints(\r\n            initialPoint, \r\n            new THREE.Vector3(this.SIZE/2, 0, -this.SIZE/2), \r\n            5\r\n            );\r\n        const secondLerpPoints = this.getLerpPoints(\r\n            new THREE.Vector3(this.SIZE/2, 0, -this.SIZE/2), \r\n            new THREE.Vector3(this.SIZE/2, 0, this.SIZE/2), \r\n            5\r\n        );\r\n        const thirdLerpPoints = this.getLerpPoints(\r\n            new THREE.Vector3(this.SIZE/2, 0, this.SIZE/2), \r\n            new THREE.Vector3(this.SIZE/2-this.SQUARE_SIZE, 0, this.SIZE/2), \r\n            5\r\n        );\r\n        const fourthLerpPoints = this.getLerpPoints(\r\n            new THREE.Vector3(this.SIZE/2-this.SQUARE_SIZE, 0, this.SIZE/2), \r\n            new THREE.Vector3(this.SIZE/2-this.SQUARE_SIZE, 0, this.SIZE/2 - this.SQUARE_SIZE), \r\n            5\r\n        );\r\n        const curve = new THREE.QuadraticBezierCurve(\r\n            new THREE.Vector2(this.SIZE/2-this.SQUARE_SIZE, this.SIZE/2-this.SQUARE_SIZE), \r\n            new THREE.Vector2(this.SIZE/2-this.SQUARE_SIZE,-this.SIZE/2+this.SQUARE_SIZE),\r\n            new THREE.Vector2(-this.SIZE/2+this.SQUARE_SIZE,-this.SIZE/2+this.SQUARE_SIZE),\r\n        );\r\n        let pointsCurve = curve.getPoints(30);\r\n        for (let i=0; i<pointsCurve.length; i++){\r\n            pointsCurve[i] = new THREE.Vector3(pointsCurve[i].x, 0, pointsCurve[i].y);\r\n        }\r\n        const fifthLerpPoints = this.getLerpPoints(\r\n            new THREE.Vector3(-this.SIZE/2+this.SQUARE_SIZE, 0, -this.SIZE/2+this.SQUARE_SIZE), \r\n            new THREE.Vector3(-this.SIZE/2, 0, -this.SIZE/2+this.SQUARE_SIZE), \r\n            5\r\n        );\r\n        const sixthLerpPoints = this.getLerpPoints(\r\n            new THREE.Vector3(-this.SIZE/2, 0, -this.SIZE/2+this.SQUARE_SIZE),\r\n            new THREE.Vector3(-this.SIZE/2, 0, -this.SIZE/2),\r\n            5\r\n        );\r\n        return [\r\n            ...lerpPoints, \r\n            ...secondLerpPoints, \r\n            ...thirdLerpPoints, \r\n            ...fourthLerpPoints,\r\n            ...pointsCurve,\r\n            ...fifthLerpPoints,\r\n            ...sixthLerpPoints\r\n        ];\r\n    }\r\n\r\n\r\n    getGeometrySidewalk(){\r\n        const geom = new THREE.BufferGeometry();\r\n        const points = this.createSidewalkCurve();\r\n        const columnas = points.length;\r\n        const filas = 4; //Fila baja, fila alta, tapa alta\r\n        const aux_vertices = [[],[],[]];\r\n        const indexes = [];\r\n        const uv1 = [];\r\n        const uv2 = [];\r\n        const uv3 = [];\r\n        let accum_x = 0;\r\n        let accum_z = 0;\r\n        \r\n        for (let i=0; i<points.length; i++){\r\n            aux_vertices[0].push(points[i].x, points[i].y, points[i].z);\r\n            aux_vertices[1].push(points[i].x, this.SIDEWALK_HEIGHT, points[i].z);\r\n            aux_vertices[2].push(accum_x/points.length, this.SIDEWALK_HEIGHT, accum_z/points.length);            \r\n            // Los uvs se calculan como la posicion del punto en la tapa (X,Z)\r\n            // Normalizar para el UV con +this.SQUARE_SIZE/2 / this.SQUARE_SIZE.\r\n            //uv1.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv1.push(0.03414,0);\r\n            uv2.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv3.push(((accum_x/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, ((accum_z/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n        }\r\n        const uv = [...uv1, ...uv1, ...uv2, ...uv3];\r\n        const vertex = [...aux_vertices[0], ...aux_vertices[1], ...aux_vertices[1], ...aux_vertices[2]];\r\n        for (let i=0; i < filas-1; i++) {\r\n            for (let j=1; j < columnas; j++) {\r\n                //1er triangulo\r\n                indexes.push(i*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push(i*columnas+j);\r\n                //2do triangulo\r\n                indexes.push(i*columnas+j);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j);\r\n\r\n            }\r\n        }\r\n        const vertexArr = new Float32Array(vertex);\r\n        const uvArr = new Float32Array(uv);\r\n        geom.setIndex(indexes);\r\n        geom.setAttribute(\"position\", new THREE.BufferAttribute(vertexArr, 3));\r\n        geom.setAttribute(\"uv\", new THREE.BufferAttribute(uvArr, 2));\r\n        geom.computeVertexNormals();\r\n        return geom;\r\n    }\r\n\r\n\r\n    getGeometryLongSidewalk(){\r\n        const geom = new THREE.BufferGeometry();\r\n        const points = this.createLongSidewalkCurve();\r\n        const columnas = points.length;\r\n        const filas = 4; //Fila baja, fila alta, tapa alta\r\n        const aux_vertices = [[],[],[]];\r\n        const indexes = [];\r\n        const uv1 = [];\r\n        const uv2 = [];\r\n        const uv3 = [];\r\n        \r\n        for (let i=0; i<points.length; i++){\r\n            aux_vertices[0].push(points[i].x, points[i].y, points[i].z);\r\n            aux_vertices[1].push(points[i].x, this.SIDEWALK_HEIGHT, points[i].z);\r\n            aux_vertices[2].push(this.TOP_CENTER[0], this.TOP_CENTER[1], this.TOP_CENTER[2]);            \r\n            // Los uvs se calculan como la posicion del punto en la tapa (X,Z)\r\n            // Normalizar para el UV con +this.SQUARE_SIZE/2 / this.SQUARE_SIZE.\r\n            //uv1.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv1.push(0.03414,0);\r\n            uv2.push((points[i].x+this.SIZE/2)/this.SIZE, (points[i].z+this.SIZE/2)/this.SIZE);\r\n            uv3.push((this.TOP_CENTER[0]+this.SIZE/2)/this.SIZE, (this.TOP_CENTER[2]+this.SIZE/2)/this.SIZE);\r\n        }\r\n        const uv = [...uv1, ...uv1, ...uv2, ...uv3];\r\n        const vertex = [...aux_vertices[0], ...aux_vertices[1], ...aux_vertices[1], ...aux_vertices[2]];\r\n        for (let i=0; i < filas-1; i++) {\r\n            for (let j=1; j < columnas; j++) {\r\n                //1er triangulo\r\n                indexes.push(i*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push(i*columnas+j);\r\n                //2do triangulo\r\n                indexes.push(i*columnas+j);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j);\r\n\r\n            }\r\n        }\r\n        const vertexArr = new Float32Array(vertex);\r\n        const uvArr = new Float32Array(uv);\r\n        geom.setIndex(indexes);\r\n        geom.setAttribute(\"position\", new THREE.BufferAttribute(vertexArr, 3));\r\n        geom.setAttribute(\"uv\", new THREE.BufferAttribute(uvArr, 2));\r\n        geom.computeVertexNormals();\r\n        return geom;\r\n    }\r\n\r\n\r\n\r\n    createSidewalkMesh(){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.repeat.set( 3, 3 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = this.getGeometrySidewalk();\r\n        const mesh = new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n        mesh.receiveShadow = true;\r\n        mesh.castShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    createLongSidewalkMesh(){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.repeat.set( 10, 10 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = this.getGeometryLongSidewalk();\r\n        const mesh = new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n        mesh.receiveShadow = true;\r\n        mesh.castShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    async loadBuildingBlock(id){\r\n        const models = await Models.getInstance();\r\n        const modelBuilding = await models[`building_${id}`];\r\n        return modelBuilding.clone();\r\n    }\r\n\r\n\r\n    async createBuildings(position, iter){\r\n        let model3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        model3D.name = \"buildingsCurve_\"+iter;\r\n        model3D.position.x = 10*this.SIZE/24;\r\n        model3D.position.y = this.SIDEWALK_HEIGHT+0.05;\r\n        model3D.position.z = -this.SIZE/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        model3D.scale.x = 0.8;\r\n        model3D.scale.y = 1;\r\n        model3D.scale.z = 0.6;\r\n        model3D.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n        model3D.updateMatrix();\r\n        model3D.updateMatrixWorld();\r\n        model3D.matrixAutoUpdate = false;\r\n        let secondModel3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        secondModel3D.name = \"buildingsCurveOtherSide_\"+iter;\r\n        secondModel3D.position.x = -this.SIZE/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;      \r\n        secondModel3D.position.y = this.SIDEWALK_HEIGHT+0.05;\r\n        secondModel3D.position.z = 10*this.SIZE/24;\r\n        secondModel3D.scale.x = 0.8;\r\n        secondModel3D.scale.y = 1;\r\n        secondModel3D.scale.z = 0.6;\r\n        secondModel3D.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI);\r\n        secondModel3D.updateMatrix();\r\n        secondModel3D.updateMatrixWorld();\r\n        secondModel3D.matrixAutoUpdate = false;\r\n        this.threeDModel.add(model3D, secondModel3D);\r\n    }\r\n\r\n    createStreetMesh(){\r\n        const geometry = new THREE.BoxGeometry( this.SIZE, 0.1, this.SIZE );\r\n        const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n        texture.repeat.set( 1, 1 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const material = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        mesh.receiveShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position, rotationY){\r\n        if(!this.threeDModel){\r\n            const baseStreet = this.createStreetMesh();\r\n            baseStreet.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(baseStreet);\r\n            const sidewalk = this.createSidewalkMesh();\r\n            sidewalk.position.set(-this.SIZE/2+this.SQUARE_SIZE/2,0,-this.SIZE/2+this.SQUARE_SIZE/2);\r\n            sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI/2);\r\n            sidewalk.updateMatrix();\r\n            sidewalk.updateMatrixWorld();\r\n            sidewalk.matrixAutoUpdate = false;\r\n            const longSidewalk = this.createLongSidewalkMesh();\r\n            longSidewalk.position.set(0,0,0);\r\n            longSidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n            longSidewalk.updateMatrix();\r\n            longSidewalk.updateMatrixWorld();\r\n            longSidewalk.matrixAutoUpdate = false;\r\n            this.threeDModel.add(sidewalk).add(longSidewalk);\r\n            for (let i=0; i<3; i++){\r\n                this.createBuildings(position, i);\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.receiveShadow = true;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.rotateOnAxis(new THREE.Vector3(0,1,0), rotationY);\r\n            baseStreet.updateMatrix();\r\n            baseStreet.updateMatrixWorld();\r\n            baseStreet.matrixAutoUpdate = false;\r\n            this.threeDModel.updateMatrix();\r\n            this.threeDModel.updateMatrixWorld();\r\n            this.threeDModel.matrixAutoUpdate = false;\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from \"./VisualEntity\";\r\nimport Models from './Models';\r\n\r\nconst SEPARATION_BETWEEN_BUILDINGS = 7.5;\r\n\r\nexport default class TStreet extends VisualEntity{\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.pathToNormalMap = \"textures/pavimento_map.png\"\r\n        this.SIZE = 30;\r\n        this.SIDEWALK_HEIGHT = .4;\r\n        this.SQUARE_SIZE = 7*30/24 + 0.12;\r\n        this.observedState = null;\r\n    }\r\n\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    getLerpPoints(vec1, vec2, quantPoints){\r\n        const points = [];\r\n        for (let i=0; i<=quantPoints; i++){\r\n            points.push(new THREE.Vector3(\r\n                vec1.x + (vec2.x - vec1.x) * i/quantPoints,\r\n                vec1.y + (vec2.y - vec1.y) * i/quantPoints,\r\n                vec1.z + (vec2.z - vec1.z) * i/quantPoints,\r\n            ))\r\n        }\r\n        return points;\r\n    }\r\n\r\n    createSidewalkCurve(){\r\n        let initialPoint = new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2);\r\n        const lerpPoints = this.getLerpPoints(initialPoint, new THREE.Vector3(-this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/10), 5);\r\n        const curve = new THREE.QuadraticBezierCurve(\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/10),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/2,this.SQUARE_SIZE/2),\r\n            new THREE.Vector2(-this.SQUARE_SIZE/10,this.SQUARE_SIZE/2)\r\n        );\r\n        const pointsCurve = curve.getPoints(10);\r\n        for (let i=0; i<pointsCurve.length; i++){\r\n            pointsCurve[i] = new THREE.Vector3(pointsCurve[i].x, 0, pointsCurve[i].y);\r\n        }\r\n        const secondLerpPoints = this.getLerpPoints(new THREE.Vector3(-this.SQUARE_SIZE/10,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), 5);\r\n        const thirdLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,this.SQUARE_SIZE/2), new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        const fourthLerpPoints = this.getLerpPoints(new THREE.Vector3(this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), new THREE.Vector3(-this.SQUARE_SIZE/2,0,-this.SQUARE_SIZE/2), 5);\r\n        return [\r\n            ...lerpPoints, \r\n            ...pointsCurve, \r\n            ...secondLerpPoints, \r\n            ...thirdLerpPoints, \r\n            ...fourthLerpPoints\r\n        ];\r\n    }\r\n\r\n\r\n    getGeometrySidewalk(){\r\n        const geom = new THREE.BufferGeometry();\r\n        const points = this.createSidewalkCurve();\r\n        const columnas = points.length;\r\n        const filas = 4; //Fila baja, fila alta, tapa alta\r\n        const aux_vertices = [[],[],[]];\r\n        const indexes = [];\r\n        const uv1 = [];\r\n        const uv2 = [];\r\n        const uv3 = [];\r\n        let accum_x = 0;\r\n        let accum_z = 0;\r\n        for (let i=0; i<points.length; i++){\r\n            accum_x += points[i].x;\r\n            accum_z += points[i].z;\r\n        }\r\n        \r\n        for (let i=0; i<points.length; i++){\r\n            aux_vertices[0].push(points[i].x, points[i].y, points[i].z);\r\n            aux_vertices[1].push(points[i].x, this.SIDEWALK_HEIGHT, points[i].z);\r\n            aux_vertices[2].push(accum_x/points.length, this.SIDEWALK_HEIGHT, accum_z/points.length);            \r\n            // Los uvs se calculan como la posicion del punto en la tapa (X,Z)\r\n            // Normalizar para el UV con +this.SQUARE_SIZE/2 / this.SQUARE_SIZE.\r\n            //uv1.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv1.push(0.03414,0);\r\n            uv2.push((points[i].x+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, (points[i].z+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n            uv3.push(((accum_x/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE, ((accum_z/points.length)+this.SQUARE_SIZE/2)/this.SQUARE_SIZE);\r\n        }\r\n        const uv = [...uv1, ...uv1, ...uv2, ...uv3];\r\n        const vertex = [...aux_vertices[0], ...aux_vertices[1], ...aux_vertices[1], ...aux_vertices[2]];\r\n        for (let i=0; i < filas-1; i++) {\r\n            for (let j=1; j < columnas; j++) {\r\n                //1er triangulo\r\n                indexes.push(i*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push(i*columnas+j);\r\n                //2do triangulo\r\n                indexes.push(i*columnas+j);\r\n                indexes.push((i+1)*columnas+j-1);\r\n                indexes.push((i+1)*columnas+j);\r\n\r\n            }\r\n        }\r\n        const vertexArr = new Float32Array(vertex);\r\n        const uvArr = new Float32Array(uv);\r\n        geom.setIndex(indexes);\r\n        geom.setAttribute(\"position\", new THREE.BufferAttribute(vertexArr, 3));\r\n        geom.setAttribute(\"uv\", new THREE.BufferAttribute(uvArr, 2));\r\n        geom.computeVertexNormals();\r\n        return geom;\r\n    }\r\n\r\n\r\n    createSidewalkMesh(){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.repeat.set( 3, 3 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = this.getGeometrySidewalk();\r\n        const mesh = new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n        mesh.receiveShadow = true;\r\n        mesh.castShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    async loadBuildingBlock(id){\r\n        const models = await Models.getInstance();\r\n        const modelBuilding = await models[`building_${id}`];\r\n        return modelBuilding.clone();\r\n    }\r\n\r\n    async createBuilding(position, iter){\r\n        let model3D = await this.loadBuildingBlock(1+(parseInt(Math.random()*4)));\r\n        model3D.name = \"buildingsRight_\"+iter;\r\n        model3D.position.x = 10*this.SIZE/24;\r\n        model3D.position.y = this.SIDEWALK_HEIGHT+0.05;\r\n        model3D.position.z = -this.SIZE/2+4+iter*SEPARATION_BETWEEN_BUILDINGS;\r\n        model3D.scale.x = 0.8;\r\n        model3D.scale.y = 1;\r\n        model3D.scale.z = 0.6;\r\n        model3D.rotateOnAxis(new THREE.Vector3(0,1,0), -Math.PI/2);\r\n        model3D.updateMatrix();\r\n        model3D.updateMatrixWorld();\r\n        model3D.matrixAutoUpdate = false;\r\n        this.threeDModel.add(model3D);\r\n    }\r\n\r\n\r\n    createStraightSidewalkMesh(){\r\n        const texture = new THREE.TextureLoader().load(\"textures/pavimento.jpg\");\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        texture.repeat.set( 3, 10 );\r\n        const materialSidewalk = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const geometrySidewalk = new THREE.BoxGeometry(7*this.SIZE/24, this.SIDEWALK_HEIGHT, this.SIZE);\r\n        return new THREE.Mesh( geometrySidewalk, materialSidewalk );\r\n    }\r\n\r\n    createStreetMesh(){\r\n        const geometry = new THREE.BoxGeometry( this.SIZE, 0.1, this.SIZE );\r\n        const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n        texture.repeat.set( 2.4, 2.4 );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        const material = new THREE.MeshPhongMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        const mesh = new THREE.Mesh( geometry, material );\r\n        mesh.receiveShadow = true;\r\n        return mesh;\r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position, rotationY){\r\n        if(!this.threeDModel){\r\n            const baseStreet = this.createStreetMesh();\r\n            baseStreet.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(baseStreet);\r\n            for (let i=0; i<2; i++){\r\n                const sidewalk = this.createSidewalkMesh();\r\n                if (i===0){\r\n                    sidewalk.position.set(-this.SIZE/2+this.SQUARE_SIZE/2,0,-this.SIZE/2+this.SQUARE_SIZE/2);\r\n                    sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI/2);\r\n                }else{\r\n                    sidewalk.position.set(-this.SIZE/2+this.SQUARE_SIZE/2,0,this.SIZE/2-this.SQUARE_SIZE/2);\r\n                    sidewalk.rotateOnAxis(new THREE.Vector3(0,1,0), Math.PI);\r\n                }\r\n                sidewalk.updateMatrix();\r\n                sidewalk.updateMatrixWorld();\r\n                sidewalk.matrixAutoUpdate = false;\r\n                this.threeDModel.add(sidewalk);\r\n            }\r\n            for (let i=0; i<4; i++){\r\n                this.createBuilding(position, i);\r\n            }\r\n            const leftSidewalk = this.createStraightSidewalkMesh();\r\n            leftSidewalk.position.set(8.4*this.SIZE/24,this.SIDEWALK_HEIGHT/2,0);\r\n            leftSidewalk.updateMatrix();\r\n            leftSidewalk.updateMatrixWorld();\r\n            leftSidewalk.matrixAutoUpdate = false;\r\n            this.threeDModel.add(leftSidewalk);\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.receiveShadow = true;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.rotateOnAxis(new THREE.Vector3(0,1,0), rotationY);\r\n            baseStreet.updateMatrix();\r\n            baseStreet.updateMatrixWorld();\r\n            baseStreet.matrixAutoUpdate = false;\r\n            this.threeDModel.updateMatrix();\r\n            this.threeDModel.updateMatrixWorld();\r\n            this.threeDModel.matrixAutoUpdate = false;\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n}","import * as THREE from 'three';\r\nimport VisualEntity from './VisualEntity';\r\n\r\nexport default class Checkpoint extends VisualEntity{\r\n\r\n    constructor(checkpointsData){\r\n        super(null);\r\n        this.checkpointsData = checkpointsData;\r\n        this.RADIUS = 1;\r\n        this.HEIGHT = 5;\r\n        this.observedState = null;\r\n        this.stepHeartbeat = -0.002;\r\n        this.LEAST_OPACITY = 0.25;\r\n        this.MAX_OPACITY = 0.5;\r\n    } \r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n        const currentOpacity = this.threeDModel.children[0].material.opacity;\r\n        const newOpacity = currentOpacity - this.stepHeartbeat;\r\n        this.threeDModel.children[0].material.opacity = newOpacity;\r\n        if(newOpacity <= this.LEAST_OPACITY || newOpacity >= this.MAX_OPACITY){\r\n            this.stepHeartbeat *= -1;\r\n        }\r\n    }\r\n\r\n    \r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            const geometry = new THREE.CylinderGeometry( this.RADIUS, this.RADIUS, this.HEIGHT, 32 );\r\n            const material = new THREE.MeshBasicMaterial( { color: 0x00ff00, opacity: 0.4, transparent:true });\r\n            const checkpoint = new THREE.Mesh( geometry, material );\r\n            checkpoint.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(checkpoint);\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.scale.set(scale[0], scale[1], scale[2]);\r\n\r\n            this.RADIUS *= scale[0];\r\n            this.RADIUS *= scale[0];\r\n            this.HEIGHT *= scale[1];\r\n\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n}","export default class LevelScore {\r\n\r\n    constructor(initialScore = 0){\r\n        this.score = initialScore;\r\n    }\r\n\r\n    alterScore(points){\r\n        if (isNaN(points)){\r\n            throw new Error(\"Solo se puede alterar el puntaje con números.\");\r\n        }\r\n        this.score += points;\r\n    }\r\n\r\n    getCurrentScore(){\r\n        return this.score;\r\n    }\r\n}","import * as THREE from \"three\";\r\nimport BoxPhysics from \"../LogicModel/Physics/PhysicsTypes/BoxPhysics\";\r\nimport AmmoInstance from \"../LogicModel/Physics/AmmoInstance\";\r\nimport TrafficCone from \"../3DModels/TrafficCone\";\r\nimport CylinderPhysics from \"../LogicModel/Physics/PhysicsTypes/CylinderPhysics\";\r\nimport CustomGeometryPhysics from \"../LogicModel/Physics/PhysicsTypes/CustomGeometryPhysics\";\r\nimport StraightStreet from \"../3DModels/StraightStreet\";\r\nimport Intersection from \"../3DModels/Intersection\";\r\nimport Curve from \"../3DModels/Curve\";\r\nimport TStreet from \"../3DModels/TStreet\";\r\nimport Checkpoint from \"../3DModels/Checkpoint\";\r\nimport LevelScore from \"./LevelScore\";\r\n\r\n\r\nconst SUM_FOR_CHECKPOINT = 1000;\r\nconst SUB_FOR_CONE = -100;\r\nconst INITIAL_SCORE = 0;\r\n\r\nexport default class LevelFactory {\r\n  constructor(scene, physicsWorld) {\r\n    this.scene = scene;\r\n    this.physicsWorld = physicsWorld;\r\n    this.levelScore = new LevelScore(INITIAL_SCORE);\r\n    this.physicsToUpdate = [];\r\n    this.objectsToAnimate = [];\r\n    this.STREET_TYPES = {\r\n      \"STRAIGHT\": this.createStreet.bind(this),\r\n      \"CURVE\": this.createCurve.bind(this),\r\n      \"T_STREET\": this.createTStreet.bind(this),\r\n      \"INTERSECTION\": this.createIntersection.bind(this)\r\n    };\r\n    this.OBJECTS = {\r\n      \"CONE\": this.createCone.bind(this)\r\n    };\r\n  }\r\n\r\n  updatePhysics() {\r\n    this.physicsToUpdate.forEach(function (phys) {\r\n      phys.updatePhysics();\r\n    });\r\n  }\r\n\r\n  animate() {\r\n    this.objectsToAnimate.forEach(function (object) {\r\n      object.animate();\r\n    });\r\n  }\r\n\r\n  async createRectangle(\r\n    position,\r\n    length,\r\n    width,\r\n    height,\r\n    rotation,\r\n    pathTexture,\r\n    Ammo,\r\n    normalMapPath = null\r\n  ) {\r\n    const texture = new THREE.TextureLoader().load(pathTexture);\r\n    texture.wrapS = THREE.RepeatWrapping;\r\n    texture.wrapT = THREE.RepeatWrapping;\r\n    texture.repeat.set(length, height);\r\n    const floorMaterial = new THREE.MeshStandardMaterial({\r\n      map: texture,\r\n      side: THREE.DoubleSide,\r\n    });\r\n    if (normalMapPath) {\r\n      let normalTexture = new THREE.TextureLoader().load(normalMapPath);\r\n      normalTexture.repeat.set(length, height);\r\n      normalTexture.wrapS = THREE.RepeatWrapping;\r\n      normalTexture.wrapT = THREE.RepeatWrapping;\r\n      floorMaterial.normalMap = normalTexture;\r\n      floorMaterial.normalScale.set(10, 10);\r\n    }\r\n    const rampa = new THREE.BoxGeometry(length, width, height);\r\n    rampa.rotateX(rotation);\r\n    const quaternionRamp = new THREE.Quaternion();\r\n    quaternionRamp.setFromAxisAngle(new THREE.Vector3(1, 0, 0), rotation);\r\n\r\n    let rampPhysics = new BoxPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]), //Position\r\n      quaternionRamp, //Quaternion2\r\n      new Ammo.btVector3(0, 0, 0), //Inertia\r\n      0, //Mass\r\n      new THREE.Vector3(length, width, height), //Shape\r\n      this.physicsWorld, //Physics World\r\n      1000 // friction\r\n    );\r\n\r\n    await rampPhysics.buildAmmoPhysics();\r\n    //this.physicsToUpdate.push(rampPhysics);\r\n    let ramp = new THREE.Mesh(rampa, floorMaterial);\r\n    ramp.position.set(position[0], position[1], position[2]);\r\n    this.scene.add(ramp);\r\n  }\r\n\r\n  async createCone(position, Ammo, rotationY) {\r\n    let cone = new TrafficCone(\"textures/coneTexture.jpg\");\r\n    cone = await cone.addToScene(this.scene, \"trafficCone\", position, [0.5, 1, 0.5]);\r\n    let conePhysics = new CylinderPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]), //Position\r\n      new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), rotationY),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      10,\r\n      new THREE.Vector3(\r\n        cone.RADIUS_BOTTOM,\r\n        cone.HEIGHT / 2,\r\n        cone.RADIUS_BOTTOM\r\n      ),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await conePhysics.buildAmmoPhysics();\r\n    conePhysics.rigidBody.threeObject = cone;\r\n    conePhysics.rigidBody.onCollide = () => {\r\n      this.levelScore.alterScore(SUB_FOR_CONE);\r\n      console.log(\"New score: \", this.levelScore.getCurrentScore());\r\n    };\r\n    this.physicsToUpdate.push(conePhysics);\r\n    conePhysics.attachObserver(cone);\r\n    this.objectsToAnimate.push(cone);\r\n  }\r\n\r\n  async buildStreetPhysics(position, street, Ammo, rotationY) {\r\n    let streetPhysics = new BoxPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(street.SIZE, 0.1, street.LONG),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await streetPhysics.buildAmmoPhysics();\r\n    const movingLeft = new THREE.Vector3(\r\n      (-8.4 * street.SIZE) / 24,\r\n      street.SIDEWALK_HEIGHT / 2,\r\n      0\r\n    ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    let leftSidewalkPhysics = new BoxPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingLeft.x,\r\n        position[1] + movingLeft.y,\r\n        position[2] + movingLeft.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(\r\n        (7 * street.SIZE) / 24,\r\n        street.SIDEWALK_HEIGHT,\r\n        street.LONG\r\n      ),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await leftSidewalkPhysics.buildAmmoPhysics();\r\n    const movingRight = new THREE.Vector3(\r\n      (8.4 * street.SIZE) / 24,\r\n      street.SIDEWALK_HEIGHT / 2,\r\n      0\r\n    ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    let rightSidewalkPhysics = new BoxPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingRight.x,\r\n        position[1] + street.SIDEWALK_HEIGHT / 2 + movingRight.y,\r\n        position[2] + movingRight.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(\r\n        (7 * street.SIZE) / 24,\r\n        street.SIDEWALK_HEIGHT,\r\n        street.LONG\r\n      ),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await rightSidewalkPhysics.buildAmmoPhysics();\r\n  }\r\n\r\n  async buildTStreetPhysics(position, Ammo, tStreet, rotationY) {\r\n    let streetPhysics = new BoxPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]),\r\n      new THREE.Quaternion().identity(),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(30, 0.1, 30),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await streetPhysics.buildAmmoPhysics();\r\n    const movingOne = new THREE.Vector3(\r\n        - tStreet.SIZE / 2 + tStreet.SQUARE_SIZE / 2,\r\n        0,\r\n        - tStreet.SIZE / 2 + tStreet.SQUARE_SIZE / 2\r\n      ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    const cornerPhysicsOne = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingOne.x,\r\n        position[1] + movingOne.y,\r\n        position[2] + movingOne.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        Math.PI / 2 + rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      tStreet.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsOne.buildAmmoPhysics();\r\n    const movingTwo = new THREE.Vector3(\r\n      -tStreet.SIZE / 2 + tStreet.SQUARE_SIZE / 2,\r\n      0,\r\n      tStreet.SIZE / 2 - tStreet.SQUARE_SIZE / 2\r\n    ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    const cornerPhysicsTwo = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingTwo.x,\r\n        position[1] + movingTwo.y,\r\n        position[2] + movingTwo.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        Math.PI + rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      tStreet.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsTwo.buildAmmoPhysics();\r\n    const movingRight = new THREE.Vector3(\r\n      (8.4 * tStreet.SIZE) / 24,\r\n      tStreet.SIDEWALK_HEIGHT / 2,\r\n      0\r\n    ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    let rightSidewalkPhysics = new BoxPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingRight.x,\r\n        position[1] + movingRight.y,\r\n        position[2] + movingRight.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(\r\n        (7 * tStreet.SIZE) / 24,\r\n        tStreet.SIDEWALK_HEIGHT,\r\n        tStreet.SIZE\r\n      ),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await rightSidewalkPhysics.buildAmmoPhysics();\r\n  }\r\n\r\n  async buildIntersectionPhysics(position, Ammo, intersection) {\r\n    let streetPhysics = new BoxPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]),\r\n      new THREE.Quaternion().identity(),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(30, 0.1, 30),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await streetPhysics.buildAmmoPhysics();\r\n    const cornerPhysicsOne = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] - intersection.SIZE / 2 + intersection.SQUARE_SIZE / 2,\r\n        position[1],\r\n        position[2] - intersection.SIZE / 2 + intersection.SQUARE_SIZE / 2\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        Math.PI / 2\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      intersection.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsOne.buildAmmoPhysics();\r\n    const cornerPhysicsTwo = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] - intersection.SIZE / 2 + intersection.SQUARE_SIZE / 2,\r\n        position[1],\r\n        position[2] + intersection.SIZE / 2 - intersection.SQUARE_SIZE / 2\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        Math.PI\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      intersection.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsTwo.buildAmmoPhysics();\r\n    const cornerPhysicsThree = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + intersection.SIZE / 2 - intersection.SQUARE_SIZE / 2,\r\n        position[1],\r\n        position[2] - intersection.SIZE / 2 + intersection.SQUARE_SIZE / 2\r\n      ),\r\n      new THREE.Quaternion().identity(),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      intersection.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsThree.buildAmmoPhysics();\r\n    const cornerPhysicsFour = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + intersection.SIZE / 2 - intersection.SQUARE_SIZE / 2,\r\n        position[1],\r\n        position[2] + intersection.SIZE / 2 - intersection.SQUARE_SIZE / 2\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        -Math.PI / 2\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      intersection.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysicsFour.buildAmmoPhysics();\r\n  }\r\n\r\n  async buildCurvePhysics(position, Ammo, curve, rotationY) {\r\n    let streetPhysics = new BoxPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      new THREE.Vector3(30, 0.1, 30),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await streetPhysics.buildAmmoPhysics();\r\n    const movingCorner = new THREE.Vector3(\r\n      -curve.SIZE / 2 + curve.SQUARE_SIZE / 2,\r\n      0,\r\n      -curve.SIZE / 2 + curve.SQUARE_SIZE / 2\r\n    ).applyAxisAngle(new THREE.Vector3(0, 1, 0), rotationY);\r\n    const cornerPhysics = new CustomGeometryPhysics(\r\n      new THREE.Vector3(\r\n        position[0] + movingCorner.x,\r\n        position[1] + movingCorner.y,\r\n        position[2] + movingCorner.z\r\n      ),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        Math.PI / 2 + rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      curve.getGeometrySidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await cornerPhysics.buildAmmoPhysics();\r\n    const longSidePhysics = new CustomGeometryPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]),\r\n      new THREE.Quaternion().setFromAxisAngle(\r\n        new THREE.Vector3(0, 1, 0),\r\n        -Math.PI / 2 + rotationY\r\n      ),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      0,\r\n      curve.getGeometryLongSidewalk(),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    await longSidePhysics.buildAmmoPhysics();\r\n  }\r\n\r\n  async createStreet(position, Ammo, rotationY, segmentsQuantity) {\r\n    let street = new StraightStreet(\"textures/road.jpg\");\r\n    await street.addToScene(\r\n      this.scene,\r\n      \"street\",\r\n      position,\r\n      segmentsQuantity,\r\n      rotationY\r\n    );\r\n    await this.buildStreetPhysics(position, street, Ammo, rotationY);\r\n  }\r\n\r\n  async createIntersection(position, Ammo) {\r\n    let intersection = new Intersection(\"textures/roadWithCrossWalk.jpg\");\r\n    await intersection.addToScene(this.scene, \"intersection\", position);\r\n    await this.buildIntersectionPhysics(position, Ammo, intersection);\r\n  }\r\n\r\n  async createCurve(position, Ammo, rotationY) {\r\n    let curve = new Curve(\"textures/roadWithCrossWalk.jpg\");\r\n    await curve.addToScene(this.scene, \"curve\", position, rotationY);\r\n    await this.buildCurvePhysics(position, Ammo, curve, rotationY);\r\n  }\r\n\r\n  async createTStreet(position, Ammo, rotationY) {\r\n    let tStreet = new TStreet(\"textures/roadWithCrossWalk.jpg\");\r\n    await tStreet.addToScene(this.scene, \"tStreet\", position, rotationY);\r\n    await this.buildTStreetPhysics(position, Ammo, tStreet, rotationY);\r\n  }\r\n\r\n\r\n  async createCheckpoint(position, checkpoints){\r\n    let checkpoint = new Checkpoint(checkpoints);\r\n    let Ammo = await AmmoInstance.getInstance();\r\n    await checkpoint.addToScene(this.scene, \"checkpoint\", position, [1,1,1]);\r\n    let checkpointPhysics = new CylinderPhysics(\r\n      new THREE.Vector3(position[0], position[1], position[2]), //Position\r\n      new THREE.Quaternion().identity(),\r\n      new Ammo.btVector3(0, 0, 0),\r\n      1,\r\n      new THREE.Vector3(\r\n        checkpoint.RADIUS,\r\n        checkpoint.HEIGHT / 2,\r\n        checkpoint.RADIUS\r\n      ),\r\n      this.physicsWorld,\r\n      1000\r\n    );\r\n    this.physicsToUpdate.push(checkpointPhysics);\r\n    await checkpointPhysics.buildAmmoPhysics();\r\n    checkpointPhysics.rigidBody.threeObject = checkpoint;\r\n    checkpointPhysics.rigidBody.onCollide = async () => {\r\n      this.physicsWorld.removeRigidBody( checkpointPhysics.rigidyBody );\r\n      this.physicsWorld.removeCollisionObject( checkpointPhysics.rigidBody );\r\n      this.levelScore.alterScore(SUM_FOR_CHECKPOINT);\r\n      console.log(\"New score: \", this.levelScore.getCurrentScore());\r\n      this.scene.remove( checkpoint.threeDModel );\r\n      const lastElemUsed = checkpoints.shift();\r\n      if (lastElemUsed.end){\r\n        //TODO: Fin?\r\n      } else if(checkpoints.length > 0){\r\n        await this.createCheckpoint([checkpoints[0].position_x, 1, checkpoints[0].position_y], checkpoints);\r\n      }\r\n    };\r\n    checkpointPhysics.attachObserver(checkpoint);\r\n    this.objectsToAnimate.push(checkpoint);\r\n  }\r\n\r\n  async createLevel0() {\r\n    let Ammo = await AmmoInstance.getInstance();\r\n    this.createRectangle(\r\n      [10, 0, 10],\r\n      10,\r\n      2,\r\n      10,\r\n      -Math.PI / 8,\r\n      \"textures/pavimento.jpg\",\r\n      Ammo,\r\n      \"textures/pavimento_map.png\"\r\n    );\r\n    this.createRectangle(\r\n      [-10, 0, 10],\r\n      10,\r\n      2,\r\n      10,\r\n      -Math.PI / 4,\r\n      \"textures/pavimento.jpg\",\r\n      Ammo,\r\n      \"textures/pavimento_map.png\"\r\n    );\r\n    this.createRectangle(\r\n      [0, 0, 0],\r\n      100,\r\n      0.1,\r\n      100,\r\n      0,\r\n      \"textures/pavimento.jpg\",\r\n      Ammo,\r\n      \"textures/pavimento_map.png\"\r\n    );\r\n    this.createCone([0, 0.5, 10], Ammo);\r\n    this.createCone([0, 0.5, 30], Ammo);\r\n    this.createCone([0, 0.5, 20], Ammo);\r\n  }\r\n\r\n\r\n  async instantiateStreet(position, rotation, long, type){\r\n    let Ammo = await AmmoInstance.getInstance();\r\n    let segments = (long[0] === 30 ? long[1] : long[0])/30;\r\n    await this.STREET_TYPES[type]([position[0], 0, position[1]], Ammo, rotation, segments);\r\n  }\r\n\r\n\r\n  async instantiateObject(position, rotation, type){\r\n    let Ammo = await AmmoInstance.getInstance();\r\n    await this.OBJECTS[type]([position[0], 0.5, position[1]], Ammo, rotation);\r\n  }\r\n\r\n  async createLevelCustom(json) {\r\n    \r\n    for( let i=0 ; i<json.streets.length; i++ ){\r\n      let street = json.streets[i];\r\n      await this.instantiateStreet(\r\n        [street.position_x,street.position_y], \r\n        street.rotation, \r\n        [street.long_x, street.long_y], \r\n        street.type\r\n      );\r\n    }\r\n    for( let i=0 ; i<json.objects.length; i++){\r\n      let obj = json.objects[i];\r\n      await this.instantiateObject(\r\n        [obj.position_x,obj.position_y], \r\n        obj.rotation, \r\n        obj.type\r\n      );\r\n    }\r\n    if (json.checkpoints.length > 0){\r\n      await this.createCheckpoint(\r\n        [json.checkpoints[0].position_x, 1, json.checkpoints[0].position_y],\r\n        json.checkpoints\r\n      );\r\n    }\r\n    return {\r\n      physicsToUpdate: this.physicsToUpdate,\r\n      objectsToAnimate: this.objectsToAnimate\r\n    };\r\n    // json.checkpoints.forEach --> Instancio y guardo en un array\r\n    // onCollide de un checkpoint --> saco ese de la escena y agrego uno nuevo (El que le sigue)\r\n    // Si el checkpoint es el ultimo --> Fin de nivel? Solo si esta marcado con un bool de fin nivel o algo asi\r\n  }\r\n}\r\n","class VRButton {\r\n\r\n\tstatic createButton( renderer ) {\r\n\t\t\r\n\t\tconst button = document.createElement( 'button' );\r\n\r\n\t\tfunction showEnterVR( /*device*/ ) {\r\n\r\n\t\t\tlet currentSession = null;\r\n\r\n\t\t\tasync function onSessionStarted( session ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tawait renderer.xr.setSession( session );\r\n\t\t\t\tbutton.textContent = 'EXIT VR';\r\n\r\n\t\t\t\tcurrentSession = session;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onSessionEnded( /*event*/ ) {\r\n\r\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\t\tcurrentSession = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'pointer';\r\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\r\n\t\t\tbutton.style.width = '100px';\r\n\r\n\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\tbutton.onmouseenter = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '1.0';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onmouseleave = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '0.5';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onclick = function () {\r\n\r\n\t\t\t\tif ( currentSession === null ) {\r\n\r\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\r\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\r\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\r\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\r\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\r\n\t\t\t\t\t// be requested separately.)\r\n\r\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking', 'layers' ] };\r\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\r\n\t\t\t\t\tlocalStorage.setItem(\"VR\", true);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction disableButton() {\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'auto';\r\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\r\n\t\t\tbutton.style.width = '150px';\r\n\r\n\t\t\tbutton.onmouseenter = null;\r\n\t\t\tbutton.onmouseleave = null;\r\n\r\n\t\t\tbutton.onclick = null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction showWebXRNotFound() {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction showVRNotAllowed( exception ) {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tconsole.warn( 'Exception when trying to call xr.isSessionSupported', exception );\r\n\r\n\t\t\tbutton.textContent = 'VR NOT ALLOWED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction stylizeElement( element ) {\r\n\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.bottom = '20px';\r\n\t\t\telement.style.padding = '12px 6px';\r\n\t\t\telement.style.border = '1px solid #fff';\r\n\t\t\telement.style.borderRadius = '4px';\r\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\r\n\t\t\telement.style.color = '#fff';\r\n\t\t\telement.style.font = 'normal 13px sans-serif';\r\n\t\t\telement.style.textAlign = 'center';\r\n\t\t\telement.style.opacity = '0.5';\r\n\t\t\telement.style.outline = 'none';\r\n\t\t\telement.style.zIndex = '999';\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tbutton.id = 'VRButton';\r\n\t\t\tbutton.style.display = 'none';\r\n\r\n\t\t\tstylizeElement( button );\r\n\r\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\r\n\r\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\r\n\r\n\t\t\t\tif ( supported && VRButton.xrSessionIsGranted ) {\r\n\r\n\t\t\t\t\tbutton.click();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( showVRNotAllowed );\r\n\r\n\t\t\treturn button;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst message = document.createElement( 'a' );\r\n\r\n\t\t\tif ( window.isSecureContext === false ) {\r\n\r\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\r\n\t\t\tmessage.style.width = '180px';\r\n\t\t\tmessage.style.textDecoration = 'none';\r\n\r\n\t\t\tstylizeElement( message );\r\n\r\n\t\t\treturn message;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstatic xrSessionIsGranted = false;\r\n\r\n\tstatic registerSessionGrantedListener() {\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\t// WebXRViewer (based on Firefox) has a bug where addEventListener\r\n\t\t\t// throws a silent exception and aborts execution entirely.\r\n\t\t\tif ( /WebXRViewer\\//i.test( navigator.userAgent ) ) return;\r\n\r\n\t\t\tnavigator.xr.addEventListener( 'sessiongranted', () => {\r\n\r\n\t\t\t\tVRButton.xrSessionIsGranted = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nVRButton.registerSessionGrantedListener();\r\n\r\nexport { VRButton };","import CarModel from \"../../3DModels/CarModel\";\r\nimport Observer from \"../../ObserverPattern/Observer\";\r\nimport Car from \"../CarLogic/Car.js\";\r\n\r\nconst CLUTCH_PRESSED = 0;\r\nconst CLUTCH_NOT_PRESSED = 1;\r\n\r\n\r\nexport default class TrafficModel extends Observer {\r\n\r\n    constructor(scene, physicsWorld, streets){\r\n        super();\r\n        this.SIZE_OF_TRAFFIC = 2;\r\n        this.timeSinceLastUpdate = Date.now();\r\n        this.trafficWorker = new Worker(\"./workers/TrafficWorker.js\");\r\n        this.currentTraffic = {};\r\n        this.scene = scene;\r\n        this.physicsWorld = physicsWorld;\r\n        this.levelStreets = streets;\r\n        this.lastID = 0;\r\n        \r\n        this.trafficWorker.onmessage = (message) => {\r\n            this.onReceiveResponseFromWorker(message);\r\n        }\r\n    }\r\n\r\n    async onReceiveResponseFromWorker(message){\r\n        this.updateCarEngines(message.data);\r\n    }\r\n\r\n\r\n    async onCollideWithCarOfTraffic () {\r\n        console.log(\"CHOCASTE AL AUTO\");\r\n    }\r\n\r\n\r\n    async generateCar(){\r\n        \r\n        let carLogic = new Car(this.physicsWorld, [12 ,2,15 + this.lastID * 5], false);//12\r\n        await carLogic.carPhysics.buildAmmoPhysics(); \r\n        \r\n        let carModel = new CarModel();\r\n        await carModel.addToScene(this.scene, `traffic_car_${this.lastID}`, false);\r\n\r\n        carLogic.carPhysics.rigidBody.threeObject = carModel;\r\n        carLogic.carPhysics.rigidBody.onCollide = this.onCollideWithCarOfTraffic;\r\n\r\n        carLogic.attachObserver(carModel);\r\n        carLogic.notifyObservers();\r\n        \r\n        this.currentTraffic[this.lastID] = {\r\n            object3D: carModel,\r\n            engine: carLogic\r\n        };\r\n        this.lastID += 1;\r\n        return carModel;\r\n    }\r\n\r\n\r\n    deleteCar(carId){\r\n        this.currentTraffic[carId].engine.removeObserver(this.currentTraffic[carId].object3D);\r\n        this.physicsWorld.removeRigidBody( this.currentTraffic[carId].engine.carPhysics.rigidyBody );\r\n        this.physicsWorld.removeCollisionObject( this.currentTraffic[carId].engine.carPhysics.rigidyBody );\r\n        this.scene.remove( this.currentTraffic[carId].object3D.threeDModel );\r\n        delete this.currentTraffic[carId];\r\n    }\r\n\r\n\r\n    async generateInitialTraffic(){\r\n        const objectsInTraffic = [];\r\n        for (let i=0; i<this.SIZE_OF_TRAFFIC; i++){\r\n            objectsInTraffic.push(await this.generateCar());\r\n        }\r\n        return objectsInTraffic;\r\n    }\r\n\r\n    updateTraffic(){\r\n        const trafficCars = [];\r\n        Object.entries(this.currentTraffic).forEach(entry => {\r\n            const [carId, value] = entry;\r\n            const carData = value.engine.getDataToAnimate();\r\n            carData.carId = carId;\r\n            delete carData.physicsBody;\r\n            delete carData.wheelsData;\r\n            trafficCars.push(carData);\r\n        });\r\n        if (this.observedState){\r\n            delete this.observedState.physicsBody;\r\n            delete this.observedState.wheelsData;\r\n        }\r\n        this.trafficWorker.postMessage({\r\n            playersCar: this.observedState,\r\n            streets: this.levelStreets,\r\n            trafficCars\r\n        });\r\n    }\r\n\r\n\r\n    /* carActions trae un object que tiene de key carId, y de value:\r\n        * deleteCar: boolean -> define si desinstancia el auto o no\r\n        * accelerate: float entre 0 y 1 -> define si acelera o no el auto\r\n        * brake: float entre 0 y 1 -> define si frena o no el auto\r\n        * steering: float entre -1 y 1 -> define la rotacion del volante\r\n    */ \r\n    updateCarEngines(carActions){\r\n        Object.keys(carActions).forEach(carId => {\r\n            if (carActions[carId].deleteCar){\r\n                this.deleteCar(carId);\r\n            }else{\r\n                this.currentTraffic[carId].engine.turnOnCar();\r\n                this.currentTraffic[carId].engine.turnDirection(carActions[carId].steering);\r\n                this.currentTraffic[carId].engine.changeShift(CLUTCH_PRESSED, 1);\r\n                this.currentTraffic[carId].engine.accelerate(CLUTCH_NOT_PRESSED, carActions[carId].accelerate);  \r\n                this.currentTraffic[carId].engine.brake(CLUTCH_PRESSED, carActions[carId].brake);\r\n                this.currentTraffic[carId].engine.update();\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.updateTraffic();\r\n        Object.values(this.currentTraffic).forEach(carObject => {\r\n            carObject.object3D.animate();\r\n        });\r\n    }\r\n}","import React, { Component } from \"react\";\r\nimport * as THREE from \"three\";\r\nimport Camera from \"../Camera/Camera\";\r\nimport CarOffsetCamera from \"../Camera/CarOffsetCamera\";\r\nimport OrbitalCamera from \"../Camera/OribtalCamera\";\r\nimport CarModel from \"../3DModels/CarModel\";\r\nimport LogitechG29ControllerSingleton from \"../LogicModel/ControllerMapping/LogitechG29Controller\";\r\nimport XboxControllerSingleton from \"../LogicModel/ControllerMapping/XboxController\";\r\nimport Car from \"../LogicModel/CarLogic/Car\";\r\nimport AmmoInstance from \"../LogicModel/Physics/AmmoInstance\";\r\nimport { Vector3 } from \"three\";\r\nimport LevelFactory from \"../Levels/LevelsFactory\";\r\nimport { VRButton } from \"../addons/VRbutton\";\r\nimport Stats from \"stats.js\";\r\nimport TrafficModel from \"../LogicModel/IA/TrafficModel\";\r\n\r\n\r\nconst MAXIMUM_DISTANCE_FROM_PLAYER_TO_RENDER = 200;\r\nconst SEGMENT_SIZE = 50;\r\n\r\nexport default class ThreeScene extends Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      currentRPM: 0,\r\n      velocity: 0,\r\n      currentShift: 0,\r\n    };\r\n    this.physicsToUpdate = [];\r\n    localStorage.setItem(\"VR\", false);\r\n    this.gotAnyEvent = false;\r\n    this.stats = new Stats();\r\n    this.objectsToAnimate = [];\r\n    this.scene = new THREE.Scene();\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      alpha: true,\r\n      powerPreference: \"high-performance\",\r\n      antialias: true,\r\n    });\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.shadowMap.enabled = true;\r\n    this.clock = new THREE.Clock();\r\n  }\r\n\r\n  async componentDidMount() {\r\n    this.jsonLevel = this.props.jsonLevel;\r\n    this.generateGeneralElements = this.generateGeneralElements.bind(this);\r\n    this.animation = this.animation.bind(this);\r\n    this.handleWindowResize = this.handleWindowResize.bind(this);\r\n    this.generateEvents = this.generateEvents.bind(this);\r\n    this.addPlayerCar = this.addPlayerCar.bind(this);\r\n    this.generateLevel = this.generateLevel.bind(this);\r\n    this.addVR = this.addVR.bind(this);\r\n\r\n    await this.generateGeneralElements();\r\n    await this.createAmmo();\r\n    await this.addGeneralLights();\r\n    await this.generateLevel();\r\n    await this.addPlayerCar();\r\n    if(this.jsonLevel[\"has-traffic\"]){\r\n      await this.createTraffic();\r\n    }\r\n    this.generateEvents();\r\n    this.addVR();\r\n    this.renderer.setAnimationLoop(this.animation);\r\n  }\r\n\r\n  async addVR() {\r\n    this.renderer.setPixelRatio(window.devicePixelRatio);\r\n    this.renderer.xr.enabled = true;\r\n    this.renderer.xr.setFramebufferScaleFactor(0.75);\r\n    this.mount.appendChild(this.renderer.domElement);\r\n    document.body.appendChild(VRButton.createButton(this.renderer));\r\n  }\r\n\r\n  async generateLevel() {\r\n    this.level = new LevelFactory(this.scene, this.physicsWorld);\r\n    let updateDataLevel = await this.level.createLevelCustom(this.jsonLevel);\r\n    this.objectsToAnimate = [\r\n      ...this.objectsToAnimate,\r\n      ...updateDataLevel.objectsToAnimate,\r\n    ];\r\n    this.physicsToUpdate = [\r\n      ...this.physicsToUpdate,\r\n      ...updateDataLevel.physicsToUpdate,\r\n    ];\r\n    const geomField = new THREE.BoxGeometry(10000, 10000);\r\n    const texture = new THREE.TextureLoader().load(\"./textures/pasto.jpeg\");\r\n    texture.repeat.set(500, 500);\r\n    texture.wrapS = THREE.RepeatWrapping;\r\n    texture.wrapT = THREE.RepeatWrapping;\r\n    const matField = new THREE.MeshBasicMaterial({ map: texture });\r\n    const meshField = new THREE.Mesh(geomField, matField);\r\n    meshField.name = \"GREEN_FIELD\";\r\n    meshField.position.set(0, -1, 0);\r\n    meshField.rotateOnAxis(new THREE.Vector3(1, 0, 0), Math.PI / 2);\r\n    this.scene.add(meshField);\r\n  }\r\n\r\n  async generateGeneralElements() {\r\n    this.renderer.setClearColor(0x87cefa, 1);\r\n    this.camera = new Camera(this.renderer);\r\n    this.camera.addContainerToScene(this.scene);\r\n    this.stats.showPanel(0);\r\n    document.body.appendChild(this.stats.dom);\r\n  }\r\n\r\n  async addGeneralLights() {\r\n    this.scene.add(new THREE.AmbientLight(0xffffff, 0.5));\r\n  }\r\n\r\n  async addPlayerCar() {\r\n    this.carLogic = new Car(\r\n      this.physicsWorld, \r\n      [this.jsonLevel.initial_position[0],1,this.jsonLevel.initial_position[1]], //Initial Position\r\n      true, // Use Engine Audio\r\n      new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 0, 1, 0 ), this.jsonLevel.initial_rotation ) // Initial Rotation\r\n    );\r\n    await this.carLogic.carPhysics.buildAmmoPhysics();\r\n    let carModel = new CarModel();\r\n    this.carLogic.carPhysics.rigidBody.threeObject = carModel;\r\n    this.carLogic.attachObserver(carModel);\r\n    this.carLogic.attachObserver(this.camera);\r\n    this.objectsToAnimate.push(await carModel.addToScene(this.scene));\r\n    this.carLogic.notifyObservers();\r\n  }\r\n\r\n\r\n  async createTraffic(){\r\n    this.trafficModel = new TrafficModel(this.scene, this.physicsWorld, this.jsonLevel.streets);\r\n    this.carLogic.attachObserver(this.trafficModel);\r\n    await this.trafficModel.generateInitialTraffic();\r\n  }\r\n\r\n  generateEvents() {\r\n    window.addEventListener(\"resize\", this.handleWindowResize);\r\n    window.addEventListener(\"gamepaddisconnected\", function (e) {\r\n      LogitechG29ControllerSingleton.removeInstance();\r\n    });\r\n\r\n    document.addEventListener(\r\n      \"keydown\",\r\n      (event) => {\r\n        var numCamera = event.key;\r\n        this.carLogic.removeObserver(this.camera);\r\n        switch (numCamera) {\r\n          case \"1\":\r\n            this.camera = new Camera(this.renderer);\r\n            this.camera.addContainerToScene(this.scene);\r\n            break;\r\n          case \"2\":\r\n            this.camera = new OrbitalCamera(this.renderer);\r\n            break;\r\n          case \"3\":\r\n            this.camera = new CarOffsetCamera(new Vector3(-4.35, 0.6, -0.1));\r\n            break;\r\n          case \"4\":\r\n            this.camera = new CarOffsetCamera(new Vector3(4.35, 0.6, -0.1));\r\n            break;\r\n          case \"5\":\r\n            this.camera = new CarOffsetCamera(new Vector3(0.0, 3.0, -5.0));\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n        this.carLogic.attachObserver(this.camera);\r\n        this.carLogic.notifyObservers();\r\n      },\r\n      false\r\n    );\r\n  }\r\n\r\n  async createAmmo() {\r\n    let Ammo = await AmmoInstance.getInstance();\r\n    this.tempTransform = new Ammo.btTransform();\r\n    let collisionConfiguratation = new Ammo.btDefaultCollisionConfiguration();\r\n    let dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguratation);\r\n    let overlappingPairCache = new Ammo.btDbvtBroadphase();\r\n    let solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n\r\n    this.physicsWorld = new Ammo.btDiscreteDynamicsWorld(\r\n      dispatcher,\r\n      overlappingPairCache,\r\n      solver,\r\n      collisionConfiguratation\r\n    );\r\n    this.physicsWorld.setGravity(new Ammo.btVector3(0, -9.8, 0));\r\n\r\n    const onEnterColission = Ammo.addFunction(async (cp, obj0, obj1) => {\r\n      let Ammo = await AmmoInstance.getInstance();\r\n      obj0 = Ammo.castObject(\r\n        Ammo.wrapPointer(obj0, Ammo.btRigidBody),\r\n        Ammo.btRigidBody\r\n      );\r\n      obj1 = Ammo.castObject(\r\n        Ammo.wrapPointer(obj1, Ammo.btRigidBody),\r\n        Ammo.btRigidBody\r\n      );\r\n      if (\r\n        obj0.threeObject &&\r\n        obj1.threeObject &&\r\n        (obj0.threeObject.threeDModel.name === \"driverCar\" ||\r\n          obj1.threeObject.threeDModel.name === \"driverCar\")\r\n      ) {\r\n        cp = Ammo.wrapPointer(cp, Ammo.btManifoldPoint);\r\n        const userPersistentData = cp.get_m_userPersistentData();\r\n        if (userPersistentData === 0) {\r\n            obj0.onCollide ? obj0.onCollide() : obj1.onCollide();\r\n            //Se cambia el contactId para denotar que la colision es constante. Para no restar puntos infinitamente.\r\n            const collisionContactID = 1; \r\n            cp.set_m_userPersistentData(collisionContactID);\r\n       }\r\n      }\r\n    });\r\n    this.physicsWorld.setContactProcessedCallback(onEnterColission);\r\n  }\r\n\r\n  handleWindowResize() {\r\n    this.camera.handleResize();\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.render(this.scene, this.camera.getCameraInstance());\r\n  }\r\n\r\n  vecDistance(vectorA, vectorB){\r\n    return vectorA.distanceTo(vectorB);\r\n  }\r\n\r\n  getMaxSizeStreets(){\r\n    let maxX = 0, maxZ = 0;\r\n    for (let i=0; i< this.jsonLevel.streets.length; i++){\r\n      const street = this.jsonLevel.streets[i];\r\n      if ( maxX < street.position_x + street.long_x/2 ) {\r\n        maxX = street.position_x + street.long_x/2;\r\n      }\r\n      if ( maxZ < street.position_y + street.long_y/2 ) {\r\n        maxZ = street.position_y + street.long_y/2;\r\n      }\r\n    }\r\n    return [maxX, maxZ];\r\n  }\r\n\r\n  \r\n  generateSegmentedScenesChildren(){\r\n    const [maxX, maxZ] = this.getMaxSizeStreets();\r\n    this.segmentedScenes = [];\r\n    for (let i=0; i< parseInt(maxX/SEGMENT_SIZE) + 1; i++){\r\n      this.segmentedScenes.push([]);\r\n      for (let j=0; j<parseInt(maxZ/SEGMENT_SIZE) + 1; j++){\r\n        const segmentPosition = new THREE.Vector3(\r\n          i*SEGMENT_SIZE,\r\n          0,\r\n          j*SEGMENT_SIZE\r\n        );\r\n        this.segmentedScenes[i].push(this.scene.children.filter(\r\n          object => object.isLight || \r\n                      object.name === \"GREEN_FIELD\" || \r\n                      object.name.includes(\"traffic_car\") ||\r\n                      object.name === \"driverCar\" ||\r\n                      this.vecDistance(object.position, segmentPosition) <= MAXIMUM_DISTANCE_FROM_PLAYER_TO_RENDER\r\n        ));\r\n      }\r\n    }\r\n    \r\n  }\r\n\r\n\r\n  getReducedScene() {\r\n    const cloneScene = new THREE.Scene();\r\n    if(this.segmentedScenes.length === 0){\r\n      this.generateSegmentedScenesChildren();\r\n    }\r\n    cloneScene.children = this.segmentedScenes\r\n    [\r\n      parseInt(this.lastPlayerPos.x/SEGMENT_SIZE)\r\n    ]\r\n    [\r\n      parseInt(this.lastPlayerPos.z/SEGMENT_SIZE)\r\n    ]\r\n    return cloneScene;\r\n  }\r\n\r\n  animation() {\r\n    this.stats.begin();\r\n    let deltaTime = this.clock.getDelta();\r\n    this.physicsWorld.stepSimulation(deltaTime, 10);\r\n    this.jsonLevel[\"has-traffic\"] && this.trafficModel.animate();\r\n    this.objectsToAnimate.forEach(function (object) {\r\n      object.animate();\r\n    });\r\n    this.physicsToUpdate.forEach(function (phys) {\r\n      phys.updatePhysics();\r\n    });\r\n    this.camera.setPositionRelativeToObject();\r\n    XboxControllerSingleton.getInstance(this.carLogic, this.camera).checkEvents();\r\n    this.setState({\r\n      velocity: this.carLogic.getSpeed(),\r\n      currentRPM: this.carLogic.getCurrentRPM(),\r\n      currentShift: this.carLogic.getCurrentShift(),\r\n    });\r\n    // this.lastPlayerPos = this.carLogic.getDataToAnimate()[\"position\"];\r\n    // this.lastRenderScene = this.getReducedScene();\r\n    // this.renderer.render(this.lastRenderScene, this.camera.getCameraInstance());\r\n    this.renderer.render(this.scene, this.camera.getCameraInstance());\r\n    this.stats.end();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={{ width: \"100vw\" }}>\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            top: \"10px\",\r\n            right: \"10px\",\r\n            color: \"red\",\r\n            width: \"175px\",\r\n          }}\r\n          id=\"Acelerador\"\r\n        >\r\n          <p style={{ zIndex: 20, display: \"float\", fontWeight: \"bold\" }}>\r\n            Cambio Actual: {parseInt(this.state.currentShift)}\r\n          </p>\r\n        </div>\r\n        <div\r\n          ref={(mount) => {\r\n            this.mount = mount;\r\n          }}\r\n        ></div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\n\r\nconst styleMenu = {\r\n  width:\"100vw\", \r\n  height:\"100vh\", \r\n  backgroundImage:`url(\"DrivingSimMenuNoTitle.png\")`, \r\n  backgroundSize:\"cover\", \r\n  backgroundRepeat: \"no-repeat\"\r\n}\r\n\r\n\r\nexport const MainMenu = () => {\r\n\r\n  const navigate = useNavigate()\r\n\r\n  return (\r\n    <>\r\n      <div style={styleMenu}>\r\n        <div id=\"button-box\" style={{position:\"absolute\", top:\"5%\", right:\"5%\"}}>\r\n          <div className={\"MainMenuTitle\"}>\r\n            <h1 style={{textAlign:\"center\", fontSize:\"7rem\"}}>\r\n              Driving<br/>Simulator\r\n            </h1>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/scene\")}\r\n            >\r\n              Iniciar\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n          <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/level-editor\")}\r\n            >\r\n              Editor de Niveles\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/configs\")}\r\n            >\r\n              Configuración\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\n\r\n\r\nexport const ConfigDrawer = ( {openConfigs, handleDrawerClose} ) => {\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openConfigs);\r\n    }, [openConfigs]);\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        width:'100%',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-start',\r\n    }));\r\n\r\n    return (\r\n        <>  \r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"right\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader className='drawer-header' onClick={handleDrawerClose}>\r\n                        <ChevronRightIcon />\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"right\", paddingRight:30}}>Configurations</h3>\r\n                        </div>\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                </Drawer>\r\n            </Grid>\r\n        </>\r\n    );\r\n}","import { createContext } from 'react';\r\n\r\nexport const ItemsContext = createContext();\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport { ItemsContext } from '../LevelEditorContext/ItemsContext';\r\n\r\n\r\nconst allUnselected = {\r\n    \"cone\": null,\r\n    \"trapecio\": null,\r\n    \"street\": null\r\n};\r\n\r\n\r\nexport const ItemsDrawer = ( {openItems, handleDrawerClose} ) => {\r\n    \r\n    const [open, setOpen] = React.useState(false);\r\n    const {setLastSelectedItem, lastSelectedItem} = React.useContext(ItemsContext);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openItems);\r\n    }, [openItems]);\r\n\r\n    //const theme = useTheme();\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-end',\r\n    }));\r\n\r\n    const [itemSelected, setItemSelected] = React.useState(allUnselected);\r\n\r\n\r\n    const handleSelection = (item) => {\r\n        const dictSelection = {...allUnselected};\r\n        dictSelection[item] = \"selected\";\r\n        setItemSelected(dictSelection);\r\n        setLastSelectedItem({\r\n            selectedItem: item,\r\n            scale: 1.0,\r\n            positionX: 0.0,\r\n            positionY: 0.0,\r\n            zIndex: lastSelectedItem ? lastSelectedItem.zIndex + 1 : 1\r\n        });\r\n    }\r\n\r\n    return (\r\n\r\n        <>\r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"left\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader onClick={handleDrawerClose} className='drawer-header'>\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"left\", paddingLeft:10}}>Items</h3>\r\n                        </div>\r\n                        <ChevronLeftIcon />\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                    <Grid style={{justifyContent: \"center\", display: \"flex\", alignItems:\"center\", flexDirection:\"column\"}}>\r\n                        {\r\n                            Object.entries(itemSelected).map(([nameItem, isSelected]) => {\r\n                                return (\r\n                                    <img \r\n                                        alt={`${nameItem}`}\r\n                                        key={nameItem}\r\n                                        src={`${nameItem}.png`} \r\n                                        width={75}\r\n                                        height={75} \r\n                                        className={`imageLevelEditor ${isSelected}`} \r\n                                        onClick={() => handleSelection(nameItem)}\r\n                                    />\r\n                                );\r\n                            })\r\n                        }\r\n                    </Grid>\r\n                </Drawer>\r\n            </Grid>\r\n            \r\n        </>\r\n\r\n    );\r\n}","import React from 'react'\r\nimport {useState} from 'react';\r\nimport Button from '@mui/material/Button';\r\nimport Grid from '@mui/material/Grid';\r\n\r\nconst MAX_WIDTH_INPUT = 40;\r\nconst MAX_HEIGHT_INPUT = 40;\r\n\r\nexport const InputsGrid = ({setGridDimensions, gridDimensions}) => {\r\n    const [InputWidth, setInputWidth] = useState(gridDimensions.width);\r\n    const [InputHeight, setInputHeight] = useState(gridDimensions.height);\r\n\r\n    const onSubmit = () =>{\r\n      setGridDimensions(\r\n        {\r\n          width: InputWidth, \r\n          height: InputHeight\r\n        }\r\n      );\r\n    }\r\n  return (\r\n    <Grid container  direction=\"row\" width={\"80%\"} marginLeft={'10%'}\r\n    justifyContent=\"space-evenly\"\r\n    alignItems=\"center\" spacing={2}>\r\n        <Grid item xs={2}>\r\n        <p>Ancho:</p>\r\n          <input \r\n            value={InputWidth} \r\n            type=\"number\" \r\n            step=\"1\" \r\n          onChange={\r\n              (event) => {\r\n                let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                setInputWidth(value > MAX_WIDTH_INPUT ? MAX_WIDTH_INPUT : value);\r\n              }\r\n        } \r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={2}>\r\n          <div>\r\n            <p>Alto:</p>\r\n            <input \r\n              value={InputHeight} \r\n              type=\"number\" \r\n              step=\"1\" \r\n              onChange={\r\n                (event) => {\r\n                  let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                  setInputHeight(value > MAX_HEIGHT_INPUT ? MAX_HEIGHT_INPUT : value);\r\n                  \r\n                }\r\n              }\r\n            />\r\n          </div>\r\n        </Grid>\r\n        <Grid item xs={2}>\r\n          <Button variant=\"contained\" onClick={onSubmit}>Actualizar</Button>\r\n        </Grid>\r\n    </Grid>\r\n    \r\n  )\r\n}\r\n","\r\nconst STANDARD_BOX_LONG = 30;\r\n\r\nexport class AbstractStreet{\r\n\r\n    constructor(ninePerNineGrid, rowIndex, columnIndex){\r\n        const rightFilled = ninePerNineGrid[1][2].filled;\r\n        const topFilled = ninePerNineGrid[0][1].filled;\r\n        const botFilled = ninePerNineGrid[2][1].filled;\r\n        const leftFilled = ninePerNineGrid[1][0].filled;\r\n        this.rotation = this.determineStreetRotation(topFilled, leftFilled, botFilled, rightFilled);\r\n        this.long = [\r\n            STANDARD_BOX_LONG, \r\n            STANDARD_BOX_LONG\r\n        ];\r\n        this.position = [\r\n            rowIndex*STANDARD_BOX_LONG + STANDARD_BOX_LONG/2, \r\n            columnIndex*STANDARD_BOX_LONG + STANDARD_BOX_LONG/2\r\n        ];\r\n    }\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        //To implement by each son\r\n    }\r\n\r\n    static sumValueForCell(cell){\r\n        return cell.filled ? 1 : 0\r\n    }\r\n\r\n    static calculateNeighboursFilled(ninePerNineGrid){\r\n        let rowCount = 0;\r\n        let columnCount = 0;\r\n        rowCount += AbstractStreet.sumValueForCell(ninePerNineGrid[1][0]) + AbstractStreet.sumValueForCell(ninePerNineGrid[1][2]);\r\n        columnCount += AbstractStreet.sumValueForCell(ninePerNineGrid[0][1]) + AbstractStreet.sumValueForCell(ninePerNineGrid[2][1]);\r\n        return [rowCount, columnCount];\r\n    }\r\n\r\n    isStraight(){\r\n        return false;\r\n    }\r\n\r\n\r\n    determineStreetRotation(){\r\n        //To be defined by sons\r\n    }\r\n\r\n    getAsJSON(){\r\n        return {\r\n            \"position_x\": this.position[0],\r\n            \"position_y\": this.position[1],\r\n            \"rotation\": this.rotation,\r\n            \"long_x\": this.long[0],\r\n            \"long_y\": this.long[1]\r\n        }\r\n    }\r\n\r\n    getPositionAsRowAndColumn(){\r\n        const row = (this.position[0] - STANDARD_BOX_LONG/2) / STANDARD_BOX_LONG;\r\n        const col = (this.position[1] - STANDARD_BOX_LONG/2) / STANDARD_BOX_LONG;\r\n        return [row, col];\r\n    }\r\n\r\n\r\n    getPositionX(){\r\n        return this.position[0];\r\n    }\r\n\r\n    getPositionY(){\r\n        return this.position[1];\r\n    }\r\n\r\n    getLongX(){\r\n        return this.long[0];\r\n    }\r\n\r\n    getLongY(){\r\n        return this.long[1];\r\n    }\r\n   \r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"TOP_TO_LEFT\": Math.PI*3/2,\r\n    \"LEFT_TO_BOT\": 0,\r\n    \"BOT_TO_RIGHT\": Math.PI/2,\r\n    \"RIGHT_TO_TOP\": Math.PI\r\n}\r\n\r\nexport class Curve extends AbstractStreet{\r\n    \r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        //Tiene que tener solo 2 lindantes, y no ser en misma direccion.\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return (rowCount === 1 && columnCount === 1);\r\n    }\r\n\r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && left){\r\n            return POSSIBLE_ROTATIONS[\"TOP_TO_LEFT\"];\r\n        }\r\n        if(left && bot){\r\n            return POSSIBLE_ROTATIONS[\"LEFT_TO_BOT\"];\r\n        }\r\n        if(bot && right){\r\n            return POSSIBLE_ROTATIONS[\"BOT_TO_RIGHT\"];\r\n        }\r\n        if(right && top){\r\n            return POSSIBLE_ROTATIONS[\"RIGHT_TO_TOP\"];\r\n        }\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"CURVE\";\r\n        return dict;\r\n    }\r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"HORIZONTAL\": 0,\r\n    \"VERTICAL\": Math.PI/2\r\n}\r\n\r\nexport class StraightStreet extends AbstractStreet {\r\n    \r\n    \r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        \r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);\r\n        return(columnCount === 2 && rowCount === 0 )|| (columnCount === 0 && rowCount === 2 )\r\n\r\n    }\r\n\r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && bot){\r\n            return POSSIBLE_ROTATIONS[\"VERTICAL\"];\r\n        }\r\n        if(left && right){\r\n            return POSSIBLE_ROTATIONS[\"HORIZONTAL\"];\r\n        }\r\n    }\r\n\r\n    isStraight(){\r\n        return true;\r\n    }\r\n\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"STRAIGHT\";\r\n        return dict;\r\n    }\r\n\r\n\r\n    isHorizontal(){\r\n        return this.rotation === POSSIBLE_ROTATIONS[\"HORIZONTAL\"];\r\n    }\r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\nconst POSSIBLE_ROTATIONS = {\r\n    \"TOP_SINGLE\": Math.PI,\r\n    \"LEFT_SINGLE\": Math.PI*3/2,\r\n    \"BOT_SINGLE\": 0,\r\n    \"RIGHT_SINGLE\": Math.PI/2\r\n}\r\nexport class TStreet extends AbstractStreet {\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return(columnCount === 2 && rowCount === 1 )|| (columnCount === 1 && rowCount === 2 );\r\n    }\r\n    \r\n    determineStreetRotation(top, left, bot, right){\r\n        if(top && left && right){\r\n            return POSSIBLE_ROTATIONS[\"TOP_SINGLE\"];\r\n        }\r\n        if(left && bot && top){\r\n            return POSSIBLE_ROTATIONS[\"LEFT_SINGLE\"];\r\n        }\r\n        if(bot && right && left){\r\n            return POSSIBLE_ROTATIONS[\"BOT_SINGLE\"];\r\n        }\r\n        if(right && top && bot){\r\n            return POSSIBLE_ROTATIONS[\"RIGHT_SINGLE\"];\r\n        }\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"T_STREET\";\r\n        return dict;\r\n    }\r\n\r\n}","export class StraightStreetLinker{\r\n\r\n    constructor(arrayOfStreets){\r\n        this.sections = this.segregateSections(arrayOfStreets);\r\n        this.sectionsAsJSON = this.linkSections();\r\n    }\r\n\r\n    //Genero un array para cada tramo recto, que contenga todas las StraightStreets de ese tramo\r\n    //Cada array de seccion va dentro de un array general y eso retornamos\r\n    segregateSections(arrayOfStreets){\r\n        // Recorro array de streets --> Armo un hashMap de filas, y otro de columnas.\r\n        // Para cada fila o columna, separar las subsecciones correspondientes.\r\n        const rows = {};\r\n        const cols = {};\r\n        let sectionsArray = [];\r\n\r\n        for(let i = 0; i < arrayOfStreets.length; i++){\r\n            let [streetRow, streetCol] = arrayOfStreets[i].getPositionAsRowAndColumn();\r\n            if( arrayOfStreets[i].isHorizontal() ){\r\n                if( !(streetRow in rows) ){\r\n                    rows[streetRow] = [];\r\n                }\r\n                rows[streetRow].push({\"idx\":streetCol, \"street\":arrayOfStreets[i]});\r\n            }\r\n            else{\r\n                if( !(streetCol in cols) ){\r\n                    cols[streetCol] = [];\r\n                }\r\n                cols[streetCol].push({\"idx\":streetRow, \"street\":arrayOfStreets[i]});\r\n            }\r\n        }\r\n        for(const [, value] of Object.entries(rows)){\r\n            sectionsArray = [...sectionsArray, ...this.generateArraySubsections(value)];\r\n        }\r\n        for(const [, value] of Object.entries(cols)){\r\n            sectionsArray = [...sectionsArray, ...this.generateArraySubsections(value)];\r\n        }\r\n        return sectionsArray;\r\n        \r\n    }\r\n\r\n\r\n    generateArraySubsections(array){\r\n        const finalArray = [];\r\n        //Sort de array por idx creciente... CREEMOS que ya viene sorteado - VERIFICAR.\r\n        for ( let i=0; i<array.length; i++){\r\n            //Primer elemento, o no son lindantes\r\n            if( i === 0 || (Math.abs(array[i][\"idx\"] - array[i-1][\"idx\"]) > 1)){\r\n                finalArray.push([array[i][\"street\"]]);\r\n            }else{\r\n                finalArray[finalArray.length - 1].push(array[i][\"street\"]);\r\n            }\r\n        }\r\n        return finalArray;\r\n    }\r\n\r\n\r\n    linkSections(){\r\n        const sectionsJSON = [];\r\n        for(let i = 0; i < this.sections.length; i++){\r\n            //Rotation is the same for all of them\r\n            const jsonForStreet = {\r\n                \"position_x\": this.sections[i].reduce((acum, elem) => acum + elem.getPositionX(), 0)/this.sections[i].length,\r\n                \"position_y\": this.sections[i].reduce((acum, elem) => acum + elem.getPositionY(), 0)/this.sections[i].length ,\r\n                \"rotation\": this.sections[i][0].rotation,\r\n                \"long_x\": this.sections[i][0].isHorizontal() ? this.sections[i].reduce((acum, elem) => acum + elem.getLongX(), 0) : this.sections[i][0].getLongX(),\r\n                \"long_y\": !this.sections[i][0].isHorizontal() ? this.sections[i].reduce((acum, elem) => acum + elem.getLongY(), 0) : this.sections[i][0].getLongY(),\r\n                \"type\": \"STRAIGHT\"\r\n            }\r\n            sectionsJSON.push(jsonForStreet);\r\n        }\r\n        return sectionsJSON;\r\n    }\r\n\r\n    getSectionsAsJSON(){\r\n        return this.sectionsAsJSON;\r\n    }\r\n}","import { StraightStreet, TStreet, Intersection, Curve, StraightStreetLinker } from \"./Street\";\r\n\r\nconst TYPES_OF_STREETS = [\r\n    StraightStreet,\r\n    Curve,\r\n    TStreet,\r\n    Intersection\r\n];\r\n\r\nexport class StreetFactory{\r\n    \r\n    constructor(levelGrid, isInfiniteLevel){\r\n        this.levelGrid = levelGrid;\r\n        this.getNinePerNineGrid = isInfiniteLevel ? this.getNinePerNineGridInfinite : this.getNinePerNineGridFinite;\r\n    }\r\n\r\n    constructStreets(){\r\n        const straightStreetsArray = [];\r\n        const curvedStreetsArray = [];\r\n        //ararco desde la parte superior izq\r\n        for ( let i = 0; i < this.levelGrid.length ; i++ ){\r\n            for ( let j = 0; j < this.levelGrid[i].length ; j++ ){\r\n                const myCell = this.levelGrid[i][j];\r\n                if (myCell.filled){\r\n                    const streetObject = this.defineTypeOfStreet(i, j);\r\n                    if (streetObject.isStraight()){\r\n                        straightStreetsArray.push(streetObject);\r\n                    }\r\n                    else{\r\n                        curvedStreetsArray.push(streetObject);\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }\r\n        const conjunctedStraightStreets = this.linkStraightStreets(straightStreetsArray);\r\n        let finalArray = curvedStreetsArray.map(street => street.getAsJSON());\r\n        return [...finalArray, ...conjunctedStraightStreets];\r\n        //const finalArray = [...conjunctedStraightStreets, ...curvedStreetsArray];\r\n        //return finalArray.map(street => street.getAsJSON());\r\n    }\r\n\r\n    getNinePerNineGridInfinite(indexRow, indexColumn){\r\n        const matrix = [];\r\n        for (let i = indexRow - 1; i <= indexRow + 1; i++){\r\n            const rowArray = [];\r\n            //Si es negativo es la ultima, y sino es el modulo entre el index y la cant de filas.\r\n            const realRow = i < 0 ? this.levelGrid.length-1 : i % this.levelGrid.length;\r\n            for (let y = indexColumn - 1; y <= indexColumn + 1; y++ ){\r\n                //Simil row pero para columna\r\n                const realColumn = y < 0 ? this.levelGrid[realRow].length-1 : y % this.levelGrid[realRow].length;\r\n                rowArray.push(this.levelGrid[realRow][realColumn]);\r\n            }\r\n            matrix.push(rowArray);\r\n        }\r\n        return matrix;\r\n    }\r\n\r\n    getNinePerNineGridFinite(indexRow, indexColumn){\r\n        const matrix = [];\r\n        const celda_vacia = {\r\n            \"filled\": false,\r\n        }\r\n        for (let i = indexRow - 1; i <= indexRow + 1; i++){\r\n            //Casos Filas Imaginarias vacías\r\n            if (i < 0 || i === this.levelGrid.length){\r\n                matrix.push([celda_vacia, celda_vacia, celda_vacia]);\r\n            }else{\r\n                const rowArray = [];\r\n                for (let y = indexColumn - 1; y <= indexColumn + 1; y++ ){\r\n                    if (y < 0 || y === this.levelGrid[i].length){\r\n                        rowArray.push(celda_vacia);\r\n                    }else{\r\n                        rowArray.push(this.levelGrid[i][y]);\r\n                    }\r\n                }\r\n                matrix.push(rowArray);\r\n            }\r\n        }\r\n        return matrix;\r\n    }\r\n\r\n    /* Example:\r\n        | | | | | | | |\r\n        | | | x x x | |\r\n        | | | x Y x | |\r\n        | | | x x x | |\r\n        | | | | | | | |\r\n    */\r\n    defineTypeOfStreet(row, column){\r\n        const ninePerNineGrid = this.getNinePerNineGrid(row, column);\r\n        let typeDefined = false;\r\n        let typeResult = undefined;\r\n        for ( let i = 0; i < TYPES_OF_STREETS.length && !typeDefined; i++){\r\n            typeDefined = TYPES_OF_STREETS[i].isValidNinePerNineGrid(ninePerNineGrid);\r\n            typeResult = TYPES_OF_STREETS[i];\r\n        }\r\n        if (!typeDefined){\r\n            throw new Error(\"No se pudo definir el tipo de calle dentro de los tipos validos.\");\r\n        }\r\n        //Row 0 es la de abajo del todo. Invertimos la row.\r\n        return new typeResult(ninePerNineGrid, this.levelGrid.length - 1 - row, column);\r\n    }\r\n\r\n\r\n    linkStraightStreets(straightStreetsArray){\r\n        const linker = new StraightStreetLinker(straightStreetsArray);\r\n        return linker.getSectionsAsJSON();\r\n    }\r\n    \r\n}","import { AbstractStreet } from \"./AbstractStreet\";\r\n\r\n\r\nexport class Intersection extends AbstractStreet{\r\n\r\n    static isValidNinePerNineGrid(ninePerNineGrid){\r\n        let [rowCount, columnCount] = AbstractStreet.calculateNeighboursFilled(ninePerNineGrid);    \r\n        return(columnCount === 2 && rowCount === 2 )\r\n    }\r\n\r\n    determineStreetRotation(){\r\n        //No sense to rotate it\r\n        return 0;\r\n    }\r\n\r\n    getAsJSON(){\r\n        let dict = super.getAsJSON();\r\n        dict[\"type\"] = \"INTERSECTION\";\r\n        return dict;\r\n    }\r\n}\r\n","import { StreetFactory } from \"./StreetFactory\";\r\n\r\n\r\nexport function downloadObjectAsJson(exportObj, exportName){\r\n    var dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(exportObj));\r\n    var downloadAnchorNode = document.createElement('a');\r\n    downloadAnchorNode.setAttribute(\"href\",     dataStr);\r\n    downloadAnchorNode.setAttribute(\"download\", exportName + \".json\");\r\n    document.body.appendChild(downloadAnchorNode); // required for firefox\r\n    downloadAnchorNode.click();\r\n    downloadAnchorNode.remove();\r\n};\r\n\r\n\r\n\r\n\r\nfunction getCountSidesPainted(levelGrid, i, j){\r\n    let aux = 0;\r\n    for (let x = i-1; x <= i+1 && x < levelGrid.length; x++){\r\n        if (x >= 0 && x !== i){\r\n            aux += levelGrid[x][j].filled ? 1 : 0;\r\n        }\r\n    }\r\n    for(let y = j-1; y <= j+1 && y < levelGrid[i].length; y++){\r\n        if(y >= 0 && y !== j){\r\n            aux += levelGrid[i][y].filled ? 1 : 0;\r\n        }\r\n    }\r\n    return aux;\r\n}\r\n\r\nfunction validateGridNotInfinite(levelGrid){\r\n    let valid = true;\r\n    let wrongCells = [];\r\n    for (let i=0; i<levelGrid.length; i++){\r\n        for (let j=0; j<levelGrid[i].length; j++){\r\n            if (levelGrid[i][j].filled && getCountSidesPainted(levelGrid, i,j) <= 1){\r\n                valid = false;\r\n                wrongCells.push([i,j]);\r\n            }\r\n        }\r\n    }\r\n    \r\n    return {\r\n        \"valid\": valid,\r\n        \"wrongCells\": wrongCells\r\n    }\r\n}\r\n\r\nfunction validateGridInfinite(){\r\n\r\n}\r\n\r\nexport function validateGrid(levelGrid, isInfinite){\r\n    \r\n    return (isInfinite ? validateGridInfinite(levelGrid) : validateGridNotInfinite(levelGrid));\r\n    \r\n}\r\n\r\nexport function generateJSONFromGrid(levelGrid){\r\n    \r\n    const streetFactory = new StreetFactory(levelGrid);\r\n    const streetsArray = streetFactory.constructStreets();\r\n    const objectsAndStreets = {\r\n        \"streets\": streetsArray\r\n    };\r\n    return objectsAndStreets;\r\n\r\n    \r\n}","import { useEffect, useState } from 'react';\r\nimport { Button } from '@mui/material';\r\nimport MemoryIcon from '@mui/icons-material/Memory';\r\nimport { downloadObjectAsJson, validateGrid, generateJSONFromGrid } from '../Resources/LevelEditor';\r\n\r\nconst COLORS = {\r\n  \"FILLED\": \"darkgray\",\r\n  \"EMPTY\": \"white\",\r\n  \"WARNING\": 'orange',\r\n};\r\n\r\nconst WIDTH_GRID_VIEW = 600;\r\nconst HEIGHT_GRID_VIEW = 600;\r\nconst LEFT_CLICK = 0;\r\nconst RIGHT_CLICK = 2;\r\n\r\n\r\nexport const LevelGrid = ({gridDimensions}) => {\r\n\r\n  const [levelGrid, setLevelGrid] = useState([]);\r\n  const [click, setClick] = useState(false);\r\n  const [rightClick, setRightClick] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let finalGrid = [];\r\n    for(let i=0; i<gridDimensions.height; i++){\r\n      let currentRow = [];\r\n      for(let j=0; j<gridDimensions.width; j++){\r\n        let newCell = {\r\n          \"filled\": false,\r\n          \"div_color\": COLORS[\"EMPTY\"]\r\n        }\r\n        currentRow.push(newCell);\r\n      }\r\n      finalGrid.push(currentRow);\r\n    }\r\n    setLevelGrid(finalGrid);\r\n  }, [gridDimensions.width, gridDimensions.height]);\r\n\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mouseup\", (event) => {\r\n      event.preventDefault();\r\n      if(event.button === LEFT_CLICK){\r\n        setClick(false);\r\n      }else if (event.button === RIGHT_CLICK){\r\n        setRightClick(false);\r\n      }\r\n    });\r\n    window.addEventListener(\"contextmenu\", (event) => { event.preventDefault(); });\r\n  }, []);\r\n\r\n\r\n  const arrayContains = (array, insiderArray) => {\r\n    if (!insiderArray || !array){\r\n      return false;\r\n    }\r\n    for (let i=0; i<array.length; i++){\r\n      let equals = true;\r\n      for (let j=0; j<array[i].length; j++){\r\n        try{\r\n          if(array[i][j] !== insiderArray[j]){\r\n            equals = false;\r\n          }\r\n        }catch(exc){j=array[i].length; equals=false;}\r\n      }\r\n      if(equals) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n\r\n  const onSubmitLevel = () =>{\r\n    let result = validateGrid(levelGrid);\r\n    let vec_aux = [...levelGrid];\r\n    for( let i=0; i< levelGrid.length; i++ ){\r\n      for( let j=0; j < levelGrid[i].length; j++){\r\n        if (vec_aux[i][j].filled){\r\n          vec_aux[i][j].div_color = arrayContains(result.wrongCells, [i,j]) ? COLORS[\"WARNING\"] : COLORS[\"FILLED\"];\r\n        }\r\n        \r\n      }\r\n    }\r\n    setLevelGrid(vec_aux);\r\n    if (result.valid) {\r\n      downloadObjectAsJson(generateJSONFromGrid(levelGrid), \"Driving_Simulator_Custom_Level.json\");\r\n    }\r\n    \r\n  }\r\n\r\n\r\n  const onEnterHoverWithClickCell = (row, col) => {\r\n    if(click){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(rightClick){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n  \r\n  const onClickCell = (row, col, btn_click) => {\r\n    if(btn_click === LEFT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(btn_click === RIGHT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div \r\n      style={{\r\n        width: WIDTH_GRID_VIEW,\r\n        height: HEIGHT_GRID_VIEW,\r\n        marginTop: 25,\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n      }}\r\n      onMouseDown = {(event) => {\r\n        event.preventDefault();\r\n        if(event.button === LEFT_CLICK){\r\n          setClick(true);\r\n        }else if (event.button === RIGHT_CLICK){\r\n          setRightClick(true);\r\n        }\r\n      }}\r\n    >\r\n      {levelGrid.map((row, idx_row) => {\r\n        return(\r\n          <div \r\n            className=\"row-level-grid\" \r\n            id={`row_${idx_row}`}\r\n            key={`row_${idx_row}`}\r\n            style={{\r\n              width: \"100%\",\r\n              height: HEIGHT_GRID_VIEW/gridDimensions.height,\r\n              display: \"flex\",\r\n              flexDirection: \"row\"\r\n            }}\r\n          >\r\n            {row.map((cell, idx_col) => {\r\n              return (\r\n                <div \r\n                  className=\"cell-level-grid\" \r\n                  key={`cell_${idx_row}_${idx_col}`}\r\n                  id={`cell_${idx_row}_${idx_col}`} \r\n                  style={{\r\n                    backgroundColor: cell[\"div_color\"],\r\n                    width: `${100/gridDimensions.width}%`,\r\n                    height: \"100%\",\r\n                    border: \"1px solid black\"\r\n                  }} \r\n                  //onMouseEnter = {() => onEnterHoverWithClickCell(idx_row, idx_col)}\r\n                  onMouseMove = {(event) => {\r\n                    event.preventDefault();\r\n                    onEnterHoverWithClickCell(idx_row, idx_col);\r\n                  }}\r\n                  onMouseUp = {(event) => {\r\n                    onClickCell(idx_row, idx_col, event.button);\r\n                  }}\r\n                  \r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n        );\r\n      })}\r\n      <div style={{display:\"flex\", justifyContent:\"center\", marginTop:40}}>\r\n        <Button variant=\"contained\" onClick={onSubmitLevel}  color=\"success\">\r\n          <MemoryIcon/> Procesar nivel...\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}","import React from 'react'\r\nimport { IconButton } from '@mui/material'\r\nimport { ConfigDrawer } from './Components/ConfigDrawer';\r\nimport { ItemsDrawer } from './Components/ItemsDrawer';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport { ItemsContext } from './LevelEditorContext/ItemsContext';\r\nimport { useState } from 'react';\r\nimport { InputsGrid } from './Components/InputsGrid';\r\n\r\nimport { LevelGrid } from './Components/LevelGrid';\r\n\r\nexport const LevelEditor = () => {\r\n\r\n  const [openItems, setOpenItems] = useState(false);\r\n  const [openConfigs, setOpenConfigs] = useState(false);\r\n\r\n  const [itemsInGrid, setItemsInGrid] = useState([]);\r\n\r\n  const [lastSelectedItem, setLastSelectedItem] = useState(null);\r\n\r\n  const [gridDimensions, setGridDimensions] = useState({width:20, height:20});\r\n\r\n  React.useEffect(() => {\r\n    if (lastSelectedItem !== null){\r\n      setItemsInGrid(currentItems => [...currentItems, lastSelectedItem]);\r\n    }\r\n  }, [lastSelectedItem]);\r\n\r\n  return (\r\n    <>\r\n      <ItemsContext.Provider value={{lastSelectedItem, setLastSelectedItem}}>\r\n        <div>\r\n          <div style={{flexDirection:'row',justifyContent:'space-between', display:\"flex\"}}>\r\n            <IconButton onClick={() => setOpenItems(true)} style={{height:40, margin:10}} className='header'>\r\n              <AddIcon/>\r\n            </IconButton>\r\n            <h1>Driving Simulator - Level Editor</h1>\r\n            <IconButton onClick={() => setOpenConfigs(true)} style={{height:40, margin:10}} className='header' >\r\n              <SettingsIcon/>\r\n            </IconButton>\r\n          </div>\r\n          <div>\r\n              <InputsGrid setGridDimensions={setGridDimensions} gridDimensions={gridDimensions}></InputsGrid>\r\n              <LevelGrid gridDimensions = {gridDimensions}/>\r\n              {itemsInGrid.map((item, idx) => {\r\n                return(\r\n                  <span key={idx}></span>\r\n                  /*<img \r\n                    key={idx} \r\n                    src={`${item.selectedItem}.png`} \r\n                    width={item.scale*75} \r\n                    height={item.scale*75} \r\n                    style={{\r\n                      top:item.positionY, \r\n                      left:item.positionX,\r\n                      position: \"absolute\",\r\n                      zIndex: item.zIndex.toString()\r\n                    }}\r\n                    onClick={() => {console.log(`OPEN CONFIGS OF idx: ${idx}, obj: ${JSON.stringify(itemsInGrid[idx])}`)}}\r\n                  />*/\r\n                );\r\n              })}\r\n          </div>\r\n          \r\n        </div>\r\n        <ItemsDrawer openItems={openItems} handleDrawerClose={() => {setOpenItems(false)}}/>\r\n        <ConfigDrawer openConfigs={openConfigs} handleDrawerClose={() => {setOpenConfigs(false)}}/>\r\n      </ItemsContext.Provider>\r\n    </>\r\n  );\r\n}\r\n","//export const API_URL = \"https://backend-bata340.cloud.okteto.net\";\r\nexport const API_URL = \"http://localhost:8001\";\r\nexport const VALID_REGEX_EMAIL = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;","import { createContext } from \"react\";\r\n\r\nexport const SessionContext  = createContext(undefined);","\r\nconst { createHash } = require('crypto');\r\n\r\nexport const hash = (string) => {\r\n  return createHash('sha256').update(string).digest('hex');\r\n}","import React from 'react'\r\nimport {API_URL} from '../Constants/Constants'\r\nimport { SessionHooks } from '../Sessions/SessionHooks';\r\nimport { Alert, Button, TextField, InputAdornment, IconButton } from \"@mui/material\"\r\nimport { Link } from 'react-router-dom';\r\nimport { GoogleLogin } from '@react-oauth/google';\r\nimport { Visibility, VisibilityOff } from '@mui/icons-material';\r\nimport { VALID_REGEX_EMAIL } from '../Constants/Constants';\r\nimport { hash } from '../Resources/Hasher';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nexport const LoginForm = () => {\r\n\r\n  const navigate = useNavigate();\r\n  const [email, setEmail] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const [showPassword, setShowPassword] = React.useState(false);\r\n  const [error, setError] = React.useState(undefined);\r\n  const handleClickShowPassword = () => setShowPassword(!showPassword);\r\n  const { setSessionWithResponse } = SessionHooks();\r\n\r\n  const postLogin = async () => {\r\n    try{\r\n        const APIResponse = await fetch(\r\n            `${API_URL}/users/login`,\r\n            {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\"\r\n                },\r\n                body: JSON.stringify({\r\n                    \"email\": email,\r\n                    \"password\": hash(password)\r\n                })\r\n            }\r\n        );\r\n        if (APIResponse.status !== 200){\r\n            const json = await APIResponse.json();\r\n            const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n            let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n            throw new Error(error_msg);\r\n        }\r\n        return APIResponse.json();\r\n    }catch(e){\r\n        throw new Error(e);\r\n    }\r\n  }\r\n\r\n\r\n  const validateFields = () => {\r\n    const errors = []\r\n    if (password === \"\"){\r\n        errors.push(\"El campo contraseña se encuentra vacío.\");\r\n    }\r\n    if (email === \"\"){\r\n        errors.push(\"El campo email se encuentra vacío\");\r\n    }\r\n    if (!email.match(VALID_REGEX_EMAIL)){\r\n        errors.push(\"El email establecido es inválido.\");\r\n      }\r\n    if(errors.length > 0){\r\n        setError(errors);\r\n        return false;\r\n    }else{\r\n        return true;\r\n    }\r\n  }\r\n\r\n\r\n  const submitLogin = async (event) => {\r\n    event.preventDefault();\r\n    if(!validateFields()){\r\n        return;\r\n    }\r\n    try{\r\n        const loginResponse = await postLogin();\r\n        setSessionWithResponse(loginResponse);\r\n        /*TODO: DAR UN FEEDBACK DE SESION INICIADA CORRECTAMENTE ANTES DE REDIR*/\r\n        navigate(\"/\");\r\n    }catch(e){\r\n        setError([e.toString().replaceAll(\"Error: \", \"\")]);\r\n    }\r\n  }\r\n\r\n\r\n  const postLoginGoogle = async (token) => {\r\n    const APIResponse = await fetch(\r\n        `${API_URL}/users/login_google`,\r\n        {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({\r\n                \"token\": token\r\n            })\r\n        }\r\n    );\r\n    if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n        let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n        throw new Error(error_msg);\r\n    }\r\n    return APIResponse.json();\r\n  }\r\n\r\n  const submitGoogleLogin = async (token) => {\r\n    try{\r\n        const responseAPI = await postLoginGoogle(token);\r\n        setSessionWithResponse(responseAPI);\r\n    }catch(e){\r\n        setError([e.toString().replaceAll(\"Error: \", \"\")]);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={submitLogin}>\r\n        <div style={{\r\n            display:\"flex\", \r\n            justifyContent:\"center\", \r\n            alignContent:\"center\", \r\n            flexDirection:\"column\", \r\n            textAlign:\"center\",\r\n            margin: \"auto\",\r\n            marginTop:40,\r\n            padding: 30,\r\n            border: \"2px solid black\",\r\n            borderRadius: 20,\r\n            maxWidth:400\r\n        }}>\r\n            {error && \r\n                <Alert severity=\"error\" style={{textAlign:\"justify\"}} onClose={() => setError(undefined)}>\r\n                    Han ocurrido los siguientes errores:\r\n                    <ul>\r\n                        {error.map((listerror, idx) => <li key={idx}>{listerror}</li>)}\r\n                    </ul>\r\n                </Alert>\r\n            }\r\n            <h1>Iniciar Sesión</h1>\r\n            <div style={{display:\"flex\", justifyContent:\"center\"}}>\r\n                <img src=\"logo_transp.png\" width=\"25%\" alt=\"Driving Simulator Logo\"/>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type=\"text\" \r\n                    onChange={(event) => setEmail(event.target.value)} \r\n                    value={email} \r\n                    name=\"email\"\r\n                    label=\"E-Mail\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    onChange={(event) => setPassword(event.target.value)} \r\n                    value={password} \r\n                    name=\"password\"\r\n                    label=\"Contraseña\"\r\n                    InputProps={{ // <-- This is where the toggle button is added.\r\n                        endAdornment: (\r\n                          <InputAdornment position=\"end\">\r\n                            <IconButton\r\n                              aria-label=\"toggle password visibility\"\r\n                              onClick={handleClickShowPassword}\r\n                            >\r\n                              {showPassword ? <Visibility /> : <VisibilityOff />}\r\n                            </IconButton>\r\n                          </InputAdornment>\r\n                        )\r\n                    }}\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                {/*TODO: CONSIDERAR EL SPINNER CUANDO ESTA CARGANDO*/}\r\n                <Button variant=\"contained\" type=\"submit\">Iniciar Sesión</Button>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Link to={\"/signup\"}>¿No posees una cuenta? Registrate aquí...</Link>\r\n            </div>\r\n            <div style={{marginTop:20, display:\"flex\", justifyContent:\"center\", textAlign:\"center\", alignContent:\"center\"}}>\r\n                <GoogleLogin\r\n                    onSuccess={credentialResponse => {\r\n                        const OAuthToken = credentialResponse.credential;\r\n                        submitGoogleLogin(OAuthToken);\r\n                    }}\r\n                    onError={() => {\r\n                        setError(['El inicio de sesión con Google ha fallado.']);\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    </form>\r\n  )\r\n}\r\n\r\n","import { useContext } from 'react';\r\nimport { SessionContext } from './SessionContext';\r\n\r\nexport const SessionHooks = () => {\r\n  \r\n    const { session, setSession } = useContext(SessionContext);\r\n\r\n\r\n    const setSessionWithResponse = (loginResponse) => {\r\n        setSession({\r\n            user: loginResponse.user,\r\n            jwt: loginResponse.jwt\r\n        });\r\n    }\r\n\r\n    const getUser = () => {\r\n        return session.user ? session.user : undefined;\r\n    }\r\n\r\n    const getJWT = () => {\r\n        return session.jwt ? session.jwt : undefined;\r\n    }\r\n\r\n    return({\r\n        setSessionWithResponse,\r\n        getUser,\r\n        getJWT\r\n    })\r\n}\r\n","import React from 'react'\r\nimport {API_URL} from '../Constants/Constants';\r\nimport { Alert, Button, TextField, InputAdornment, IconButton } from \"@mui/material\"\r\nimport { Link } from 'react-router-dom';\r\nimport { Visibility, VisibilityOff } from '@mui/icons-material';\r\nimport { VALID_REGEX_EMAIL } from '../Constants/Constants';\r\nimport { hash } from '../Resources/Hasher';\r\n\r\n\r\nexport const SignUpForm = () => {\r\n\r\n  const [email, setEmail] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const [passwordConfirmation, setPasswordConfirmation] = React.useState(\"\");\r\n  const [nameToShow, setNameToShow] = React.useState(\"\");\r\n  const [showPassword, setShowPassword] = React.useState(false);\r\n  const [error, setError] = React.useState(undefined);\r\n  const handleClickShowPassword = () => setShowPassword(!showPassword);\r\n\r\n  const validateFields = () => {\r\n    const errorArray = [];\r\n    if (email === \"\" || password === \"\" || passwordConfirmation === \"\" || nameToShow === \"\"){\r\n      errorArray.push(\"Aún existen campos sin completar.\")\r\n    }\r\n    if (password !== passwordConfirmation){\r\n      errorArray.push(\"Las contraseñas establecidas no coinciden.\");\r\n    }\r\n    if (password.length < 8){\r\n      errorArray.push(\"La contraseña debe tener una longitud mínima de 8 caracteres.\");\r\n    }\r\n    if (!email.match(VALID_REGEX_EMAIL)){\r\n      errorArray.push(\"El email establecido es inválido.\");\r\n    }\r\n    if(errorArray.length > 0){\r\n      setError(errorArray);\r\n      return false;\r\n    }else{\r\n      setError(undefined);\r\n      return true;\r\n    }\r\n  }\r\n\r\n\r\n  const postSignUp = async () => {\r\n    const fetchUrl = `${API_URL}/users/register`;\r\n    try{\r\n      const APIResponse = await fetch(\r\n        fetchUrl,\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n              \"Content-Type\": \"application/json\"\r\n          },\r\n          body: JSON.stringify({\r\n              \"email\": email,\r\n              \"password\": hash(password),\r\n              \"name_to_show\": nameToShow\r\n          })\r\n        }\r\n      );\r\n      if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        const endMSG = json.detail[0].msg ? json.detail[0].msg : json.detail;\r\n        let error_msg = APIResponse.status + \" - \" + APIResponse.statusText + \" - \" + endMSG;\r\n        throw new Error(error_msg);\r\n      }\r\n      return APIResponse.json();\r\n  }catch(e){\r\n      throw new Error(e);\r\n  }\r\n  }\r\n\r\n\r\n  const submitSignUp = async (event) => {\r\n    event.preventDefault();\r\n    if (!validateFields()){\r\n      return;\r\n    }\r\n    // eslint-disable-next-line\r\n    const res = await postSignUp();\r\n    /*TODO: Mostrar dialog de creado exitoso, y despues mandarlo al login...*/\r\n  }\r\n\r\n\r\n  return (\r\n    <form onSubmit={submitSignUp}>\r\n        <div style={{\r\n            display:\"flex\", \r\n            justifyContent:\"center\", \r\n            alignContent:\"center\", \r\n            flexDirection:\"column\", \r\n            textAlign:\"center\",\r\n            margin: \"auto\",\r\n            marginTop:40,\r\n            padding: 30,\r\n            border: \"2px solid black\",\r\n            borderRadius: 20,\r\n            maxWidth:400\r\n        }}>\r\n            {error && \r\n                <Alert severity=\"error\" style={{textAlign:\"justify\"}} onClose={() => setError(undefined)}>\r\n                    Han ocurrido los siguientes errores:\r\n                    <ul>\r\n                        {error.map((listerror, idx) => <li key={idx}>{listerror}</li>)}\r\n                    </ul>\r\n                </Alert>\r\n            }\r\n            <h1>Crea tu cuenta</h1>\r\n            <div style={{display:\"flex\", justifyContent:\"center\"}}>\r\n                <img src=\"logo_transp.png\" width=\"25%\" alt=\"Driving Simulator Logo\"/>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type=\"text\" \r\n                  onChange={(event) => setEmail(event.target.value)} \r\n                  value={email} \r\n                  name=\"email\"\r\n                  label=\"E-Mail\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type=\"text\" \r\n                  onChange={(event) => setNameToShow(event.target.value)} \r\n                  value={nameToShow} \r\n                  name=\"username\"\r\n                  label=\"Nombre para mostrar\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                  style={{width:\"80%\"}}\r\n                  type={showPassword ? \"text\" : \"password\"}\r\n                  onChange={(event) => setPassword(event.target.value)} \r\n                  value={password} \r\n                  name=\"password\"\r\n                  label=\"Contraseña\"\r\n                  InputProps={{ // <-- This is where the toggle button is added.\r\n                    endAdornment: (\r\n                      <InputAdornment position=\"end\">\r\n                        <IconButton\r\n                          aria-label=\"toggle password visibility\"\r\n                          onClick={handleClickShowPassword}\r\n                        >\r\n                          {showPassword ? <Visibility /> : <VisibilityOff />}\r\n                        </IconButton>\r\n                      </InputAdornment>\r\n                    )\r\n                  }}\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    style={{width:\"80%\"}}\r\n                    type={showPassword ? \"text\" : \"password\"}\r\n                    onChange={(event) => setPasswordConfirmation(event.target.value)} \r\n                    value={passwordConfirmation} \r\n                    name=\"passwordConfirmation\"\r\n                    label=\"Repetir Contraseña\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                {/*TODO: CONSIDERAR EL SPINNER CUANDO ESTA CARGANDO*/}\r\n                <Button variant=\"contained\" type=\"submit\">CREAR CUENTA</Button>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Link to={\"/login\"}>¿Ya poses una cuenta? Inicia sesión...</Link>\r\n            </div>\r\n        </div>\r\n    </form>\r\n  )\r\n}\r\n","import { SessionContext } from \"./SessionContext\";\r\nimport { useState } from 'react'\r\nimport { GoogleOAuthProvider } from '@react-oauth/google';\r\n\r\nexport const SessionProvider = ( {childElement} ) => {\r\n  \r\n    const [session, setSession] = useState({\r\n        user: undefined,\r\n        jwt: undefined\r\n    });\r\n\r\n    return (\r\n        <GoogleOAuthProvider clientId=\"18785041157-s9ga39r0i6up45radtj3soo6je1pneon.apps.googleusercontent.com\">\r\n            <SessionContext.Provider value={{session, setSession}}>\r\n                {childElement}\r\n            </SessionContext.Provider>\r\n        </GoogleOAuthProvider>\r\n    )\r\n}\r\n","import React from 'react'\r\n\r\nexport const CardContentHover = () => {\r\n  return (\r\n    <div>CardContentHover</div>\r\n  )\r\n}\r\n","import { CardContent, CardHeader, CardMedia } from '@mui/material'\r\nimport React from 'react'\r\n\r\nexport const CardContentNotHover = ({level}) => {\r\n  return (\r\n    <CardContent>\r\n        <CardMedia\r\n         component=\"img\"\r\n         height={200}\r\n         width={\"100%\"}\r\n         image={`/levels/images/${level.image}`}\r\n         title={level.title}\r\n         sx={{ objectFit: \"contain\", justifyContent: \"center\", display: \"flex\" }}\r\n        />\r\n        <CardHeader\r\n            title={level.title}\r\n            subheader={level.description}\r\n        />\r\n    </CardContent>\r\n  );\r\n}\r\n","import React from 'react'\r\nimport { Card, CardActions, Grid } from '@mui/material';\r\nimport { CardContentHover } from './CardLevel/CardContentHover';\r\nimport { CardContentNotHover } from './CardLevel/CardContentNotHover';\r\n\r\nexport const LevelsSelectionGrid = () => {\r\n\r\n  const [levels, setLevels] = React.useState([]);\r\n  const [cardHovers, setCardHovers] = React.useState([]);\r\n\r\n  React.useEffect(() => {\r\n    const levelsEffect = [];\r\n    fetch(\"./levels/basics.json\")\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      levelsEffect.push(data);\r\n      fetch(\"./levels/reversa.json\")\r\n        .then((response) => response.json())\r\n        .then((data) => {\r\n            levelsEffect.push(data);\r\n            fetch(\"./levels/adelanto.json\")\r\n            .then((response) => response.json())\r\n            .then((data) => {\r\n                levelsEffect.push(data);\r\n                fetch(\"./levels/giro_en_u.json\")\r\n                .then((response) => response.json())\r\n                .then((data) => {\r\n                    levelsEffect.push(data);\r\n                    fetch(\"./levels/estacionamiento.json\")\r\n                    .then((response) => response.json())\r\n                    .then((data) => {\r\n                        levelsEffect.push(data);\r\n                        fetch(\"./levels/manejo_libre.json\")\r\n                        .then((response) => response.json())\r\n                        .then((data) => {\r\n                            levelsEffect.push(data);\r\n                            const hovers = {};\r\n                            for (let i=0; i<levelsEffect.length; i++){\r\n                                hovers[levelsEffect[i].title] = false;\r\n                            }\r\n                            setLevels(levelsEffect);\r\n                            setCardHovers(hovers);\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    });\r\n    \r\n    \r\n    \r\n    \r\n  }, []);\r\n\r\n  return (\r\n    <Grid container spacing={4} rowSpacing={4} alignContent=\"center\" justifyContent=\"space-around\" sx={{padding:\"2rem\"}}>\r\n        {levels.map(level => \r\n            <Grid item xs={12} md={6} lg={4} key={level.title}>\r\n                <Card sx={{height:400}}>\r\n                    <CardActions  \r\n                        onMouseOver={ () => setCardHovers({...cardHovers, [level.title]:true}) }\r\n                        onMouseOut={ () => setCardHovers({...cardHovers, [level.title]:false}) }\r\n                    >\r\n                        {cardHovers[level.title] ?\r\n                            <CardContentHover level={level}/>\r\n                        :\r\n                            <CardContentNotHover level={level}/>\r\n                        }\r\n                    </CardActions>\r\n                </Card>\r\n            </Grid>\r\n        )}\r\n    </Grid>\r\n  );\r\n}\r\n","import React from 'react'\r\nimport { Grid } from '@mui/material'\r\nimport { LevelsSelectionGrid } from './Components/LevelsSelectionGrid'\r\n\r\nexport const LevelsList = () => {\r\n  return (\r\n    <Grid container spacing={2} rowSpacing={2}>\r\n        <Grid item xs={12} style={{textAlign:\"center\"}}>\r\n            <h1>Driving Simulator - Seleccionar Nivel</h1>\r\n        </Grid>\r\n        <Grid item xs={12} alignContent=\"center\" justifyContent=\"center\" style={{textAlign:\"center\"}}>\r\n            <img src=\"logo_transp.png\" width=\"150\" alt=\"Driving Simulator Logo\"/>\r\n        </Grid>\r\n        <Grid item xs={12}>\r\n            <LevelsSelectionGrid />\r\n        </Grid>\r\n    </Grid>\r\n  )\r\n}\r\n","import ThreeScene from \"./Scene/ThreeScene\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { MainMenu } from \"./Menus/MainMenu\";\r\nimport { LevelEditor } from \"./Menus/LevelEditor\";\r\nimport {\r\n  HashRouter as Router,\r\n  Routes as Switch,\r\n  Route,\r\n} from \"react-router-dom\";\r\nimport { LoginForm } from \"./Menus/Components/LoginForm\";\r\nimport { SignUpForm } from \"./Menus/Components/SignUpForm\";\r\nimport { SessionProvider } from \"./Menus/Sessions/SessionProvider\";\r\nimport { LevelsList } from \"./Menus/LevelsList\";\r\n\r\nfunction App() {\r\n  const [json, setJson] = useState(null);\r\n\r\n  useEffect(() => {\r\n    document.title = \"Driving Simulator\";\r\n    fetch(\"./levels/estacionamiento.json\")\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        setJson(data);\r\n      });\r\n  }, []);\r\n\r\n  return (\r\n    <SessionProvider\r\n      childElement={\r\n        <Router>\r\n          <Switch>\r\n            <Route exact path=\"/levels\" element={<LevelsList/>} />\r\n            <Route exact path=\"/scene\" element={json && <ThreeScene jsonLevel={json} />} />\r\n            <Route exact path=\"/\" element={<MainMenu />} />\r\n            <Route exact path=\"/level-editor\" element={<LevelEditor />} />\r\n            <Route exact path=\"/login\" element={<LoginForm />} />\r\n            <Route exact path=\"/signup\" element={<SignUpForm />} />\r\n          </Switch>\r\n        </Router>\r\n      }\r\n    />\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById('root'));\r\nroot.render(\r\n  <App />\r\n);\r\n\r\n"],"sourceRoot":""}