{"version":3,"sources":["ObserverPattern/Observer.js","Camera/Camera.js","Camera/CarOffsetCamera.js","Camera/OribtalCamera.js","3DModels/VisualEntity.js","addons/Reflector.js","3DModels/CarModel.js","LogicModel/ControllerMapping/LogitechG29Controller.js","LogicModel/ControllerMapping/XboxController.js","ObserverPattern/Observable.js","LogicModel/Physics/AmmoInstance.js","LogicModel/Physics/PhysicsTypes/CarPhysics.js","LogicModel/CarLogic/CarEngineStates/AbstractEngineState.js","LogicModel/CarLogic/CarEngineStates/TurnedOffEngine.js","LogicModel/CarLogic/CarEngineStates/TurnedOnEngine.js","LogicModel/CarLogic/CarEngine.js","LogicModel/CarLogic/ShiftBox.js","LogicModel/CarLogic/ShiftBoxTypes/ManualBox.js","LogicModel/CarLogic/ShiftBoxTypes/SemiAutomaticBox.js","LogicModel/CarLogic/Car.js","LogicModel/Physics/PhysicsTypes/GeneralPhysics.js","LogicModel/Physics/PhysicsTypes/CylinderPhysics.js","3DModels/TrafficCone.js","LogicModel/Physics/PhysicsTypes/BoxPhysics.js","Levels/LevelsFactory.js","addons/VRbutton.js","Scene/ThreeScene.jsx","Menus/MainMenu.jsx","Menus/Components/ConfigDrawer.jsx","Menus/LevelEditorContext/ItemsContext.jsx","Menus/Components/ItemsDrawer.jsx","Menus/Components/InputsGrid.jsx","Menus/Components/LevelGrid.jsx","Menus/LevelEditor.jsx","Menus/Constants/Constants.js","Menus/Sessions/SessionContext.jsx","Menus/Components/LoginForm.jsx","Menus/Sessions/SessionHooks.jsx","Menus/Components/SignUpForm.jsx","Menus/Sessions/SessionProvider.jsx","App.jsx","index.jsx","LogicModel/ControllerMapping/GlobalControllerHandling.js"],"names":["Observer","this","observedState","newState","Camera","renderer","camera","THREE","window","innerWidth","innerHeight","group","group180Rot","add","aspect","updateProjectionMatrix","cameraOffset","Vector3","applyQuaternion","rotation","position","copy","localStorage","getItem","offsetVectorCamera","setRotationFromQuaternion","setRotationFromAxisAngle","Math","PI","lookAt","rotationQuat","x","y","z","w","normalize","quaternion","scene","CarOffsetCamera","positionCamera","cameraOffsetRotated","positionToLookAt","OrbitalCamera","controls","OrbitControls","domElement","enableDamping","dampingFactor","enableZoom","set","update","VisualEntity","pathToTexture","fbxLoader","FBXLoader","gltfLoader","GLTFLoader","threeDModel","loadAsync","threeDObject","result","objectName","scale","loadFBX","modelVariable","loadGLTF","name","Reflector","geometry","options","isReflector","type","PerspectiveCamera","scope","color","undefined","Color","textureWidth","textureHeight","clipBias","shader","ReflectorShader","multisample","reflectorPlane","Plane","normal","reflectorWorldPosition","cameraWorldPosition","rotationMatrix","Matrix4","lookAtPosition","clipPlane","Vector4","view","target","q","textureMatrix","virtualCamera","renderTarget","WebGLRenderTarget","samples","HalfFloatType","material","ShaderMaterial","uniforms","UniformsUtils","clone","fragmentShader","vertexShader","value","texture","onBeforeRender","setFromMatrixPosition","matrixWorld","extractRotation","applyMatrix4","subVectors","dot","reflect","negate","up","far","updateMatrixWorld","projectionMatrix","multiply","matrixWorldInverse","setFromNormalAndCoplanarPoint","constant","sign","elements","multiplyScalar","visible","currentRenderTarget","getRenderTarget","currentXrEnabled","xr","enabled","currentShadowAutoUpdate","shadowMap","autoUpdate","currentOutputColorSpace","outputColorSpace","currentToneMapping","toneMapping","LinearSRGBColorSpace","NoToneMapping","setRenderTarget","state","buffers","depth","setMask","autoClear","clear","render","viewport","dispose","Mesh","SCALE","POSITION","MAX_TIRE_TURN_IN_RADS","FACTOR_KMH_TO_MS","CarModel","carModel","carLogic","lastValueRotation","currentSpeedRotation","currentWheelRotation","lastSteeringRotation","lastVelocityRotation","lastRPMRotation","path","absellipse","ellipseGeometry","retrovisor","rotateX","rotateY","leftMirrorGeometry","leftMirror","container","Object3D","rightMirrorGeometry","rightMirror","generateRetrovisor","generateLeftMirror","generateRightMirror","generateMirrors","moveCar","physicsShape","Geometry","PHYSICSSQUARE","GeometryRueda","rotateZ","textureRueda","wheelMesh1","wheelMesh2","wheelMesh3","wheelMesh4","wheelsData","userData","physicsBody","rotateWheels","rotateSteeringWheel","rotateVelocityAndRPM","steeringWheel","children","find","o","vectorRotation","applyAxisAngle","rotateOnAxis","velocityIndicator","rpmIndicator","newVelRotation","abs","newRPMRotation","wheelFrontRight","wheelFrontLeft","wheelBackRight","wheelBackLeft","rotationYVectorTwo","rotationYVectorOne","GlobalControllerHandling","require","default","LogitechG29Controller","gamepads","navigator","getGamepads","webkitGetGamepads","gamepad","i","length","id","startsWith","buttonX","buttonSquare","buttonCircle","buttonTriangle","bumperRight","bumperLeft","buttonR2","buttonL2","shareButton","optionsButton","buttonR3","buttonL3","firstShift","secondShift","thirdShift","fourthShift","fifthShift","sixthShift","reverseShift","buttonPlus","buttonMinus","wheelInEnterRight","wheelInEnterLeft","enter","psButton","buttonsPressed","push","wheelAxes","clutch","accelerator","brake","DPad","valueDpadUP","valueDpadDOWN","valueDpadLEFT","valueDpadRIGHT","dpadPressed","globalControllerHandler","checkGamepadChanges","doActionByMapping","updateCar","axes","handleAccelerate","handleBrake","turnDirection","buttons","pressed","turnOnCar","changeShift","doActionsPedals","doActionsWheel","doActionsDPad","doActionsButtons","doActionsShifter","LogitechG29ControllerSingleton","Error","instance","STICK_LIMIT","XboxController","auto","buttonA","buttonB","buttonY","buttonL1","buttonR1","optionButton","padUp","padDown","padLeft","padRight","buttomHome","buttonPressed","actualShift","xLeftAxe","yLeftAxe","xRightAxe","yRightAxe","axe","changeShiftBox","doActionHotKeys","doActionsAxes","doActionsTriggers","XboxControllerSingleton","Observable","observers","observer","index","indexOf","splice","stateToSend","AmmoInstance","AmmoInstanceToReturn","Ammo","CarPhysics","inertia","mass","shape","physicsWorld","friction","getInstance","btVector3","transform","btTransform","setIdentity","setOrigin","setRotation","btQuaternion","tempTransform","motionState","btDefaultMotionState","btBoxShape","calculateLocalInertia","rigidBodyInfo","btRigidBodyConstructionInfo","rigidBody","btRigidBody","setFriction","setRollingFriction","addRigidBody","tuning","btVehicleTuning","rayCaster","btDefaultVehicleRaycaster","vehicle","btRaycastVehicle","setCoordinateSystem","addAction","addWheel","setActivationState","isFront","pos","radius","width","side","wheelDirectionCS0","wheelAxleCS","wheelInfo","set_m_suspensionStiffness","set_m_wheelsDampingRelaxation","set_m_wheelsDampingCompression","set_m_frictionSlip","set_m_rollInfluence","returnValue","getNumWheels","updateWheelTransform","transfMatrix","getWheelTransformWS","getOrigin","getRotation","wheels","worldTransformChassis","getChassisWorldTransform","chassis","engineForce","applyEngineForce","valueBrake","speedKMH","getCurrentSpeedKmHour","frictionBrake","setBrake","setSteeringValue","MAX_RPM","EXPONENTIAL_COEF_TO_RPM","AbstractEngineState","valuePedal","accelerating","currentRPM","currentXInRPMCurve","sumToValueInCurve","exp","TurnedOffEngine","valueAccelerator","changeValueInRPMCurve","TurnedOnEngine","CarEngine","engineState","valueClutch","shiftBox","shutDownEngine","clutchIsPressed","rpmReturn","accelerate","handleEngineShutdown","RPMModification","log","ShiftBox","carEngine","NEUTRAL","REVERSE","FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH","validShifts","currentShift","minimumVelocityOnShift","maximumVelocityOnShift","shift","newShift","oldVelocity","getCurrentRPM","normalFactorRPM","calculateNormalFactorRPM","XValue","currentVelocity","valueClutchNormalized","minVelocityBasedOnClutch","normalFactorToDecrement","normalFactor","ManualBox","isValidShift","changeRPM","getValueForNewRPM","SemiAutomaticBox","Car","currentDirectionTurn","currentTireRotation","rotationQuaternion","carPhysics","buildAmmoPhysics","engineCanApplyForce","setEngineForce","getEngineForce","getVelocity","turnOn","wheelAxesValue","setSteeringRotation","positionAndRotation","updatePhysics","getDataToAnimate","mode","getCurrentShift","GeneralPhysics","generateShape","setMargin","getMotionState","getWorldTransform","notifyObservers","velocityVector","velVectorBT","applyForce","CylinderPhysics","btCylinderShape","TrafficCone","RADIUS_TOP","RADIUS_BOTTOM","HEIGHT","load","map","materialBox","geometryPlane","box","cone","BoxPhysics","LevelFactory","level","physicsToUpdate","objectsToAnimate","createLevel0","forEach","phys","object","animate","height","pathTexture","normalMapPath","wrapS","wrapT","repeat","floorMaterial","normalTexture","normalMap","normalScale","rampa","quaternionRamp","setFromAxisAngle","rampPhysics","ramp","addToScene","conePhysics","attachObserver","createRectangle","createCone","VRButton","button","document","createElement","disableButton","style","display","cursor","left","onmouseenter","onmouseleave","onclick","stylizeElement","element","bottom","padding","border","borderRadius","background","font","textAlign","opacity","outline","zIndex","isSessionSupported","then","supported","currentSession","onSessionStarted","session","addEventListener","onSessionEnded","setSession","textContent","removeEventListener","requestSession","optionalFeatures","setItem","end","showEnterVR","xrSessionIsGranted","click","catch","exception","console","warn","message","isSecureContext","href","location","replace","innerHTML","textDecoration","test","userAgent","registerSessionGrantedListener","ThreeScene","gotAnyEvent","alpha","setSize","setClearColor","outputEncoding","addContainerToScene","clock","createAmmo","ambientLight","sunLight","animation","bind","handleWindowResize","generateEvents","mount","appendChild","body","createButton","e","removeInstance","event","numCamera","key","removeObserver","collisionConfiguratation","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","overlappingPairCache","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","setGravity","handleResize","getCameraInstance","deltaTime","getDelta","setAnimationLoop","stepSimulation","setPositionRelativeToObject","checkEvents","setState","getSpeed","top","fontWeight","parseInt","ref","Component","styleMenu","backgroundImage","backgroundSize","backgroundRepeat","MainMenu","navigate","useNavigate","right","className","fontSize","onClick","ConfigDrawer","openConfigs","handleDrawerClose","React","useState","open","setOpen","useEffect","DrawerHeader","styled","theme","alignItems","spacing","mixins","toolbar","justifyContent","Grid","Drawer","sx","flexShrink","boxSizing","variant","anchor","paddingRight","Divider","ItemsContext","createContext","allUnselected","ItemsDrawer","openItems","useContext","setLastSelectedItem","lastSelectedItem","itemSelected","setItemSelected","paddingLeft","flexDirection","Object","entries","nameItem","isSelected","alt","src","item","dictSelection","selectedItem","positionX","positionY","handleSelection","InputsGrid","setGridDimensions","gridDimensions","InputWidth","setInputWidth","InputHeight","setInputHeight","direction","marginLeft","xs","step","onChange","replaceAll","Button","COLORS","LevelGrid","levelGrid","setLevelGrid","setClick","rightClick","setRightClick","finalGrid","currentRow","j","newCell","preventDefault","marginTop","marginRight","onMouseDown","row","idx_row","cell","idx_col","backgroundColor","onMouseMove","col","levelGridCopy","filled","div_color","onEnterHoverWithClickCell","onMouseUp","btn_click","onClickCell","LevelEditor","setOpenItems","setOpenConfigs","itemsInGrid","setItemsInGrid","currentItems","Provider","IconButton","margin","idx","API_URL","SessionContext","LoginForm","email","setEmail","password","setPassword","setSessionWithResponse","loginResponse","user","jwt","getUser","getJWT","SessionHooks","postLogin","fetch","method","headers","JSON","stringify","APIResponse","status","json","detail","submitLogin","postLoginGoogle","token","submitGoogleLogin","responseAPI","onSubmit","alignContent","maxWidth","TextField","label","to","onSuccess","credentialResponse","OAuthToken","credential","onError","SignUpForm","SessionProvider","childElement","clientId","App","title","exact","ReactDOM","createRoot","getElementById","car","valueShift"],"mappings":"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","file":"static/js/main.d3ab8b92.chunk.js","sourcesContent":["//Methods to override. This is an interface but can not be declared as interface in JS.\r\nexport default class Observer{\r\n\r\n    constructor(){\r\n        this.observedState = null;\r\n    }\r\n\r\n    update(newState){\r\n        this.observedState = newState;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\nconst Y_DISTANCE = 0.6;\r\nconst Z_DISTANCE = -0.1;\r\nconst X_DISTANCE = 0.35;\r\nexport default class Camera extends Observer{\r\n\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 85, window.innerWidth / window.innerHeight, 0.1, 200 );\r\n        this.group =  new THREE.Object3D();\r\n        this.group180Rot = new THREE.Object3D().add(this.camera);\r\n        this.group.add(this.group180Rot);\r\n        this.renderer = renderer;\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(X_DISTANCE, Y_DISTANCE, Z_DISTANCE);\r\n        if(this.observedState != null){\r\n            cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.group.position.copy(this.observedState.position).add(cameraOffset);\r\n            \r\n            if (localStorage.getItem(\"VR\") === \"true\"){\r\n                let offsetVectorCamera = new Vector3(0,-1.25,0); //Offset to be in place for driver's seat\r\n                offsetVectorCamera.applyQuaternion(this.observedState.rotation);\r\n                this.group.position.add(offsetVectorCamera);\r\n                this.group.setRotationFromQuaternion(this.observedState.rotation);\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), Math.PI);\r\n                this.camera.lookAt(new Vector3(0,0,5));\r\n            }else{\r\n                const rotationQuat = new THREE.Quaternion(this.observedState.rotation.x, this.observedState.rotation.y, this.observedState.rotation.z, this.observedState.rotation.w).normalize();\r\n                this.group180Rot.setRotationFromAxisAngle(new Vector3(0,1,0), -5*Math.PI/180);\r\n                this.group.quaternion.copy(rotationQuat);\r\n            }\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,5));\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    \r\n    addContainerToScene(scene){\r\n        scene.add(this.group);\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\n\r\nexport default class CarOffsetCamera extends Observer{\r\n\r\n\r\n    constructor(positionCamera){\r\n        super();\r\n        this.positionCamera = positionCamera;\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );\r\n    }\r\n\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n\r\n    setPositionRelativeToObject(){\r\n        const cameraOffset = new Vector3(this.positionCamera.x, this.positionCamera.y, this.positionCamera.z);\r\n        if(this.observedState != null){\r\n            let cameraOffsetRotated = cameraOffset.applyQuaternion(this.observedState.rotation);\r\n            this.camera.position.copy(this.observedState.position).add(cameraOffsetRotated);\r\n            let positionToLookAt = new Vector3(this.observedState.position.x, this.observedState.position.y, this.observedState.position.z);\r\n            this.camera.lookAt(positionToLookAt);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n            this.camera.position.copy(cameraOffset);\r\n        }\r\n    }\r\n\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n}","import * as THREE from 'three';\r\nimport { Vector3 } from 'three';\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\"\r\nimport Observer from '../ObserverPattern/Observer';\r\n\r\n\r\nexport default class OrbitalCamera extends Observer{\r\n\r\n    constructor(renderer){\r\n        super();\r\n        this.camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );\r\n        this.renderer = renderer;\r\n        this.controls = new OrbitControls(this.camera, this.renderer.domElement);\r\n        this.controls.enableDamping = true;\r\n        this.controls.dampingFactor = 0.25;\r\n        this.controls.enableZoom = true;\r\n        this.camera.position.set(0,5.5,0);\r\n    }\r\n\r\n    handleResize(){\r\n        this.camera.aspect = window.innerWidth/window.innerHeight;\r\n        this.camera.updateProjectionMatrix();\r\n    }\r\n\r\n    getCameraInstance(){\r\n        return this.camera;\r\n    }\r\n\r\n    setPositionRelativeToObject(){\r\n        this.controls.update();\r\n        if(this.observedState != null){\r\n            this.camera.lookAt(this.observedState[\"position\"]);\r\n        }else{\r\n            this.camera.lookAt(new Vector3(0,0,0));\r\n        }\r\n    }\r\n}","import { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\r\nimport Observer from \"../ObserverPattern/Observer\"\r\n\r\nexport default class VisualEntity extends Observer{\r\n\r\n    constructor(pathToTexture){\r\n        super();\r\n        this.fbxLoader = new FBXLoader();\r\n        this.gltfLoader = new GLTFLoader()\r\n        this.threeDModel = null;\r\n        this.pathToTexture = pathToTexture;\r\n    }\r\n\r\n    async loadFBX(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.fbxLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n        \r\n    }\r\n\r\n    async loadGLTF(){\r\n        let pathToTexture = this.pathToTexture;\r\n        const result = await this.gltfLoader.loadAsync( \r\n            pathToTexture, \r\n            function ( threeDObject ) {\r\n                return threeDObject;\r\n            }\r\n        );\r\n        return result;\r\n\r\n    }\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            let modelVariable;\r\n            try{\r\n                modelVariable =  await this.loadFBX();\r\n                this.threeDModel = modelVariable;\r\n            }catch(e){\r\n                modelVariable =  await this.loadGLTF();\r\n                this.threeDModel = modelVariable.scene;\r\n            }\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.x = position[0];\r\n            this.threeDModel.position.y = position[1];\r\n            this.threeDModel.position.z = position[2];\r\n            this.threeDModel.scale.x = scale[0];\r\n            this.threeDModel.scale.y = scale[1];\r\n            this.threeDModel.scale.z = scale[2];\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    getModel(){\r\n        return this.threeDModel;\r\n    }\r\n\r\n    //Abstract Method\r\n    animate(){\r\n        return null;\r\n    }\r\n\r\n\r\n}","import {\r\n\tColor,\r\n\tMatrix4,\r\n\tMesh,\r\n\tPerspectiveCamera,\r\n\tPlane,\r\n\tShaderMaterial,\r\n\tUniformsUtils,\r\n\tVector3,\r\n\tVector4,\r\n\tWebGLRenderTarget,\r\n\tHalfFloatType,\r\n\tNoToneMapping,\r\n\tLinearSRGBColorSpace\r\n} from 'three';\r\n\r\nclass Reflector extends Mesh {\r\n\r\n\tconstructor( geometry, options = {} ) {\r\n\r\n\t\tsuper( geometry );\r\n\r\n\t\tthis.isReflector = true;\r\n\r\n\t\tthis.type = 'Reflector';\r\n\t\tthis.camera = new PerspectiveCamera(null, null, 0.1, 10);\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tconst color = ( options.color !== undefined ) ? new Color( options.color ) : new Color( 0x7F7F7F );\r\n\t\tconst textureWidth = options.textureWidth || 512;\r\n\t\tconst textureHeight = options.textureHeight || 512;\r\n\t\tconst clipBias = options.clipBias || 0;\r\n\t\tconst shader = options.shader || Reflector.ReflectorShader;\r\n\t\tconst multisample = ( options.multisample !== undefined ) ? options.multisample : 4;\r\n\r\n\t\t//\r\n\r\n\t\tconst reflectorPlane = new Plane();\r\n\t\tconst normal = new Vector3();\r\n\t\tconst reflectorWorldPosition = new Vector3();\r\n\t\tconst cameraWorldPosition = new Vector3();\r\n\t\tconst rotationMatrix = new Matrix4();\r\n\t\tconst lookAtPosition = new Vector3( 0, 0, - 1 );\r\n\t\tconst clipPlane = new Vector4();\r\n\r\n\t\tconst view = new Vector3();\r\n\t\tconst target = new Vector3();\r\n\t\tconst q = new Vector4();\r\n\r\n\t\tconst textureMatrix = new Matrix4();\r\n\t\tconst virtualCamera = this.camera;\r\n\r\n\t\tconst renderTarget = new WebGLRenderTarget( textureWidth, textureHeight, { samples: multisample, type: HalfFloatType } );\r\n\r\n\t\tconst material = new ShaderMaterial( {\r\n\t\t\tuniforms: UniformsUtils.clone( shader.uniforms ),\r\n\t\t\tfragmentShader: shader.fragmentShader,\r\n\t\t\tvertexShader: shader.vertexShader\r\n\t\t} );\r\n\r\n\t\tmaterial.uniforms[ 'tDiffuse' ].value = renderTarget.texture;\r\n\t\tmaterial.uniforms[ 'color' ].value = color;\r\n\t\tmaterial.uniforms[ 'textureMatrix' ].value = textureMatrix;\r\n\r\n\t\tthis.material = material;\r\n\r\n\t\tthis.onBeforeRender = function ( renderer, scene, camera ) {\r\n\r\n\t\t\treflectorWorldPosition.setFromMatrixPosition( scope.matrixWorld );\r\n\t\t\tcameraWorldPosition.setFromMatrixPosition( camera.matrixWorld );\r\n\r\n\t\t\trotationMatrix.extractRotation( scope.matrixWorld );\r\n\r\n\t\t\tnormal.set( 0, 0, 1 );\r\n\t\t\tnormal.applyMatrix4( rotationMatrix );\r\n\r\n\t\t\tview.subVectors( reflectorWorldPosition, cameraWorldPosition );\r\n\r\n\t\t\t// Avoid rendering when reflector is facing away\r\n\r\n\t\t\tif ( view.dot( normal ) > 0 ) return;\r\n\r\n\t\t\tview.reflect( normal ).negate();\r\n\t\t\tview.add( reflectorWorldPosition );\r\n\r\n\t\t\trotationMatrix.extractRotation( camera.matrixWorld );\r\n\r\n\t\t\tlookAtPosition.set( 0, 0, - 1 );\r\n\t\t\tlookAtPosition.applyMatrix4( rotationMatrix );\r\n\t\t\tlookAtPosition.add( cameraWorldPosition );\r\n\r\n\t\t\ttarget.subVectors( reflectorWorldPosition, lookAtPosition );\r\n\t\t\ttarget.reflect( normal ).negate();\r\n\t\t\ttarget.add( reflectorWorldPosition );\r\n\r\n\t\t\tvirtualCamera.position.copy( view );\r\n\t\t\tvirtualCamera.up.set( 0, 1, 0 );\r\n\t\t\tvirtualCamera.up.applyMatrix4( rotationMatrix );\r\n\t\t\tvirtualCamera.up.reflect( normal );\r\n\t\t\tvirtualCamera.lookAt( target );\r\n\r\n\t\t\tvirtualCamera.far = camera.far; // Used in WebGLBackground\r\n\r\n\t\t\tvirtualCamera.updateMatrixWorld();\r\n\t\t\tvirtualCamera.projectionMatrix.copy( camera.projectionMatrix );\r\n\r\n\t\t\t// Update the texture matrix\r\n\t\t\ttextureMatrix.set(\r\n\t\t\t\t0.5, 0.0, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.5, 0.0, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.5, 0.5,\r\n\t\t\t\t0.0, 0.0, 0.0, 1.0\r\n\t\t\t);\r\n\t\t\ttextureMatrix.multiply( virtualCamera.projectionMatrix );\r\n\t\t\ttextureMatrix.multiply( virtualCamera.matrixWorldInverse );\r\n\t\t\ttextureMatrix.multiply( scope.matrixWorld );\r\n\r\n\t\t\t// Now update projection matrix with new clip plane, implementing code from: http://www.terathon.com/code/oblique.html\r\n\t\t\t// Paper explaining this technique: http://www.terathon.com/lengyel/Lengyel-Oblique.pdf\r\n\t\t\treflectorPlane.setFromNormalAndCoplanarPoint( normal, reflectorWorldPosition );\r\n\t\t\treflectorPlane.applyMatrix4( virtualCamera.matrixWorldInverse );\r\n\r\n\t\t\tclipPlane.set( reflectorPlane.normal.x, reflectorPlane.normal.y, reflectorPlane.normal.z, reflectorPlane.constant );\r\n\r\n\t\t\tconst projectionMatrix = virtualCamera.projectionMatrix;\r\n\r\n\t\t\tq.x = ( Math.sign( clipPlane.x ) + projectionMatrix.elements[ 8 ] ) / projectionMatrix.elements[ 0 ];\r\n\t\t\tq.y = ( Math.sign( clipPlane.y ) + projectionMatrix.elements[ 9 ] ) / projectionMatrix.elements[ 5 ];\r\n\t\t\tq.z = - 1.0;\r\n\t\t\tq.w = ( 1.0 + projectionMatrix.elements[ 10 ] ) / projectionMatrix.elements[ 14 ];\r\n\r\n\t\t\t// Calculate the scaled plane vector\r\n\t\t\tclipPlane.multiplyScalar( 2.0 / clipPlane.dot( q ) );\r\n\r\n\t\t\t// Replacing the third row of the projection matrix\r\n\t\t\tprojectionMatrix.elements[ 2 ] = clipPlane.x;\r\n\t\t\tprojectionMatrix.elements[ 6 ] = clipPlane.y;\r\n\t\t\tprojectionMatrix.elements[ 10 ] = clipPlane.z + 1.0 - clipBias;\r\n\t\t\tprojectionMatrix.elements[ 14 ] = clipPlane.w;\r\n\r\n\t\t\t// Render\r\n\t\t\tscope.visible = false;\r\n\r\n\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\t\tconst currentXrEnabled = renderer.xr.enabled;\r\n\t\t\tconst currentShadowAutoUpdate = renderer.shadowMap.autoUpdate;\r\n\t\t\tconst currentOutputColorSpace = renderer.outputColorSpace;\r\n\t\t\tconst currentToneMapping = renderer.toneMapping;\r\n\r\n\t\t\trenderer.xr.enabled = false; // Avoid camera modification\r\n\t\t\trenderer.shadowMap.autoUpdate = false; // Avoid re-computing shadows\r\n\t\t\trenderer.outputColorSpace = LinearSRGBColorSpace;\r\n\t\t\trenderer.toneMapping = NoToneMapping;\r\n\r\n\t\t\trenderer.setRenderTarget( renderTarget );\r\n\r\n\t\t\trenderer.state.buffers.depth.setMask( true ); // make sure the depth buffer is writable so it can be properly cleared, see #18897\r\n\r\n\t\t\tif ( renderer.autoClear === false ) renderer.clear();\r\n\t\t\trenderer.render( scene, virtualCamera );\r\n\r\n\t\t\trenderer.xr.enabled = currentXrEnabled;\r\n\t\t\trenderer.shadowMap.autoUpdate = currentShadowAutoUpdate;\r\n\t\t\trenderer.outputColorSpace = currentOutputColorSpace;\r\n\t\t\trenderer.toneMapping = currentToneMapping;\r\n\r\n\t\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t\t\t// Restore viewport\r\n\r\n\t\t\tconst viewport = camera.viewport;\r\n\r\n\t\t\tif ( viewport !== undefined ) {\r\n\r\n\t\t\t\trenderer.state.viewport( viewport );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscope.visible = true;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getRenderTarget = function () {\r\n\r\n\t\t\treturn renderTarget;\r\n\r\n\t\t};\r\n\r\n\t\tthis.dispose = function () {\r\n\r\n\t\t\trenderTarget.dispose();\r\n\t\t\tscope.material.dispose();\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nReflector.ReflectorShader = {\r\n\r\n\tuniforms: {\r\n\r\n\t\t'color': {\r\n\t\t\tvalue: null\r\n\t\t},\r\n\r\n\t\t'tDiffuse': {\r\n\t\t\tvalue: null\r\n\t\t},\r\n\r\n\t\t'textureMatrix': {\r\n\t\t\tvalue: null\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tvertexShader: /* glsl */`\r\n\t\tuniform mat4 textureMatrix;\r\n\t\tvarying vec4 vUv;\r\n\r\n\t\t#include <common>\r\n\t\t#include <logdepthbuf_pars_vertex>\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\r\n\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\r\n\t\t\t#include <logdepthbuf_vertex>\r\n\r\n\t\t}`,\r\n\r\n\tfragmentShader: /* glsl */`\r\n\t\tuniform vec3 color;\r\n\t\tuniform sampler2D tDiffuse;\r\n\t\tvarying vec4 vUv;\r\n\r\n\t\t#include <logdepthbuf_pars_fragment>\r\n\r\n\t\tfloat blendOverlay( float base, float blend ) {\r\n\r\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\r\n\r\n\t\t}\r\n\r\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\r\n\r\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\r\n\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\t#include <logdepthbuf_fragment>\r\n\r\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\r\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\r\n\r\n\t\t\t#include <tonemapping_fragment>\r\n\t\t\t#include <encodings_fragment>\r\n\r\n\t\t}`\r\n};\r\n\r\nexport { Reflector };","import { Vector3 } from 'three';\r\nimport * as THREE from 'three';\r\nimport VisualEntity from './VisualEntity';\r\nimport { Reflector } from '../addons/Reflector';\r\nimport { Object3D } from 'three';\r\n\r\nconst SCALE = [1.0, 1.0, 1.0];\r\nconst POSITION = [0,0,0];\r\nconst MAX_TIRE_TURN_IN_RADS = 0.75;\r\nconst FACTOR_KMH_TO_MS = 1/3600;\r\nconst VELOCITY_TO_ANGULAR_VEL = 1/0.25; //Velocity/Radius\r\nconst STEERING_WHEEL_INITIAL_ROTATION_ON_X = -0.35;\r\nconst MAX_VELOCITY_SHOWN = 240;\r\nconst MAX_RPM_SHOWN = 6000;\r\n\r\nexport default class CarModel extends VisualEntity{\r\n    \r\n    \r\n    constructor(){\r\n        super('res/models/source/AutoConInterior.glb');\r\n        this.carModel = null;\r\n        this.carLogic = null;\r\n        this.lastValueRotation = 0;\r\n        this.currentSpeedRotation = 0;\r\n        this.currentWheelRotation = 0;\r\n        this.lastSteeringRotation = 0;\r\n        this.lastVelocityRotation = 0;\r\n        this.lastRPMRotation = 0;\r\n    }\r\n\r\n\r\n    generateRetrovisor(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.15,0.075,0, Math.PI*2, false,0);\r\n        const ellipseGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const retrovisor = new Reflector(\r\n            ellipseGeometry,\r\n            {\r\n                textureWidth: 512,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: 512,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0.35,\r\n                multisample: 2\r\n            }\r\n        );\r\n        retrovisor.rotateX( -Math.PI );\r\n        retrovisor.rotateY( 0.3 );\r\n        retrovisor.position.set(0,0.625,0.375);\r\n        this.threeDModel.add(retrovisor);\r\n    }\r\n\r\n\r\n    generateLeftMirror(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.105,0.075,0, Math.PI*2, false,0);\r\n        const leftMirrorGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const leftMirror = new Reflector(\r\n            leftMirrorGeometry, \r\n            {\r\n                textureWidth: 512,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: 512,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0,\r\n                multisample: 2\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(leftMirror);\r\n        container.position.set(1.148, 0.394, 0.538);\r\n        container.rotateX(-Math.PI+0.03);\r\n        leftMirror.rotateY(-26*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateRightMirror(){\r\n        const path = new THREE.Shape();\r\n        path.absellipse(0,0,0.105,0.075,0, Math.PI*2, false,0);\r\n        const rightMirrorGeometry = new THREE.ShapeBufferGeometry( path );\r\n        const rightMirror = new Reflector(\r\n            rightMirrorGeometry, \r\n            {\r\n                textureWidth: 512,//window.innerWidth * window.devicePixelRatio,\r\n                textureHeight: 512,//window.innerHeight * window.devicePixelRatio,\r\n                clipBias: 0,\r\n                multisample: 2\r\n            }\r\n        );\r\n        let container = new Object3D();\r\n        container.add(rightMirror);\r\n        container.position.set(-1.138, 0.394, 0.53);\r\n        container.rotateX(-Math.PI+2.9*Math.PI/180);\r\n        rightMirror.rotateY(28.2*Math.PI/180);\r\n        this.threeDModel.add(container);\r\n    }\r\n\r\n\r\n    generateMirrors(){\r\n        this.generateRetrovisor();\r\n        this.generateLeftMirror();\r\n        this.generateRightMirror();\r\n    }\r\n\r\n    async addToScene(scene){\r\n        await super.addToScene(scene, \"driverCar\", POSITION, SCALE);\r\n        this.generateMirrors();\r\n        return this;\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.moveCar();\r\n        //this.watchPhysicsColliders();\r\n    }\r\n\r\n\r\n    addPhysicsView(scene){\r\n        this.physicsShape = new Vector3(2,1.35,5);\r\n        \r\n        const Geometry = new THREE.BoxGeometry( this.physicsShape.x, this.physicsShape.y, this.physicsShape.z);\r\n        const texture = new THREE.MeshBasicMaterial( {color: 0x0000ff} );\r\n        this.PHYSICSSQUARE = new THREE.Mesh( Geometry, texture );\r\n        this.PHYSICSSQUARE.position.set (0,0,0);\r\n        scene.add(this.PHYSICSSQUARE);\r\n\r\n        const GeometryRueda = new THREE.CylinderGeometry( 0.35, 0.35, 0.35, 32, 32);\r\n        GeometryRueda.rotateZ(Math.PI / 2);\r\n        const textureRueda = new THREE.MeshBasicMaterial( {color: 0xff0000} );\r\n        this.wheelMesh1 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh1.position.set (0,4,0);\r\n        scene.add(this.wheelMesh1);\r\n\r\n        this.wheelMesh2 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh2.position.set (0,4,0);\r\n        scene.add(this.wheelMesh2);\r\n\r\n        this.wheelMesh3 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh3.position.set (0,4,0);\r\n        scene.add(this.wheelMesh3);\r\n\r\n        this.wheelMesh4 =  new THREE.Mesh( GeometryRueda, textureRueda );\r\n        this.wheelMesh4.position.set (0,4,0);\r\n        scene.add(this.wheelMesh4);\r\n    }\r\n\r\n    //Only for debug purpose2\r\n    watchPhysicsColliders(){\r\n        \r\n        if(this.observedState != null){\r\n            this.PHYSICSSQUARE.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            this.PHYSICSSQUARE.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh1.position.set(\r\n                this.observedState.wheelsData[0][\"position\"].x, \r\n                this.observedState.wheelsData[0][\"position\"].y, \r\n                this.observedState.wheelsData[0][\"position\"].z\r\n            );\r\n            this.wheelMesh1.quaternion.set(\r\n                this.observedState.wheelsData[0][\"rotation\"].x, \r\n                this.observedState.wheelsData[0][\"rotation\"].y, \r\n                this.observedState.wheelsData[0][\"rotation\"].z, \r\n                this.observedState.wheelsData[0][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh2.position.set(\r\n                this.observedState.wheelsData[1][\"position\"].x, \r\n                this.observedState.wheelsData[1][\"position\"].y, \r\n                this.observedState.wheelsData[1][\"position\"].z\r\n            );\r\n            this.wheelMesh2.quaternion.set(\r\n                this.observedState.wheelsData[1][\"rotation\"].x, \r\n                this.observedState.wheelsData[1][\"rotation\"].y, \r\n                this.observedState.wheelsData[1][\"rotation\"].z, \r\n                this.observedState.wheelsData[1][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh3.position.set(\r\n                this.observedState.wheelsData[2][\"position\"].x, \r\n                this.observedState.wheelsData[2][\"position\"].y, \r\n                this.observedState.wheelsData[2][\"position\"].z\r\n            );\r\n            this.wheelMesh3.quaternion.set(\r\n                this.observedState.wheelsData[2][\"rotation\"].x, \r\n                this.observedState.wheelsData[2][\"rotation\"].y, \r\n                this.observedState.wheelsData[2][\"rotation\"].z, \r\n                this.observedState.wheelsData[2][\"rotation\"].w\r\n            );\r\n\r\n            this.wheelMesh4.position.set(\r\n                this.observedState.wheelsData[3][\"position\"].x, \r\n                this.observedState.wheelsData[3][\"position\"].y, \r\n                this.observedState.wheelsData[3][\"position\"].z\r\n            );\r\n            this.wheelMesh4.quaternion.set(\r\n                this.observedState.wheelsData[3][\"rotation\"].x, \r\n                this.observedState.wheelsData[3][\"rotation\"].y, \r\n                this.observedState.wheelsData[3][\"rotation\"].z, \r\n                this.observedState.wheelsData[3][\"rotation\"].w\r\n            );\r\n        }\r\n    }\r\n\r\n\r\n    moveCar(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.userData.physicsBody = this.observedState[\"physicsBody\"];\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n            this.lastValueRotation = this.observedState[\"direction\"];\r\n            this.rotateWheels();\r\n            this.rotateSteeringWheel();\r\n            this.rotateVelocityAndRPM();\r\n        }\r\n    }\r\n\r\n\r\n    rotateSteeringWheel(){\r\n        let steeringWheel = this.threeDModel.children.find(o => o.name === 'Steering_Wheel');\r\n        let vectorRotation = new Vector3(0,0,1).applyAxisAngle(new Vector3(1,0,0), STEERING_WHEEL_INITIAL_ROTATION_ON_X);\r\n        steeringWheel.rotateOnAxis(vectorRotation, -this.lastSteeringRotation);\r\n        steeringWheel.rotateOnAxis(vectorRotation, -this.observedState['lastRotationWheel']*540/360*Math.PI*2);\r\n        this.lastSteeringRotation = -this.observedState['lastRotationWheel']*540/360*Math.PI*2;\r\n    }\r\n\r\n\r\n    rotateVelocityAndRPM(){\r\n        let velocityIndicator = this.threeDModel.children.find(o => o.name === 'Cubo');\r\n        let rpmIndicator = this.threeDModel.children.find(o => o.name === 'Cubo001');\r\n        const newVelRotation = -Math.abs(this.observedState[\"velocity\"])*(240*Math.PI/180)/MAX_VELOCITY_SHOWN;\r\n        const newRPMRotation = -this.observedState[\"rpm\"]*(260*Math.PI/180)/MAX_RPM_SHOWN; //Can surpass a little bit the rpm meter\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastVelocityRotation);\r\n        velocityIndicator.rotateOnAxis(new Vector3(0,1,0), newVelRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), -this.lastRPMRotation);\r\n        rpmIndicator.rotateOnAxis(new Vector3(0,1,0), newRPMRotation);\r\n        this.lastVelocityRotation = newVelRotation;\r\n        this.lastRPMRotation = newRPMRotation;\r\n    }\r\n\r\n\r\n    rotateWheels(){\r\n        let wheelFrontRight = this.threeDModel.children.find(o => o.name === 'wheel002');\r\n        let wheelFrontLeft = this.threeDModel.children.find(o => o.name === 'wheel');\r\n        let wheelBackRight = this.threeDModel.children.find(o => o.name === 'wheel003');\r\n        let wheelBackLeft = this.threeDModel.children.find(o => o.name === 'wheel001');\r\n\r\n        let rotationYVectorTwo = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            this.currentSpeedRotation\r\n        );\r\n        let rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation\r\n        );\r\n\r\n        //Resetting position in direction\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, this.currentWheelRotation);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorTwo, this.currentWheelRotation);\r\n        \r\n        //Moving by rotation caused by speed.\r\n        wheelFrontLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelFrontRight.rotateX(-this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackRight.rotateX(-this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n        wheelBackLeft.rotateX(this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL);\r\n\r\n        rotationYVectorTwo = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            this.currentSpeedRotation + this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL\r\n        );\r\n        rotationYVectorOne = new Vector3(0,1,0).applyAxisAngle(\r\n            new Vector3(1,0,0), \r\n            -this.currentSpeedRotation - this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL\r\n        );\r\n\r\n        //Moving to the sides based on steering wheel value\r\n        wheelFrontLeft.rotateOnAxis(rotationYVectorOne, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        wheelFrontRight.rotateOnAxis(rotationYVectorTwo, -this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS);\r\n        this.currentWheelRotation = this.observedState['lastRotationWheel']*MAX_TIRE_TURN_IN_RADS;\r\n\r\n        this.currentSpeedRotation += this.observedState['velocity'] * FACTOR_KMH_TO_MS * VELOCITY_TO_ANGULAR_VEL;\r\n        if(this.currentSpeedRotation >= Math.PI*2){\r\n            this.currentSpeedRotation -= Math.PI*2;\r\n        }\r\n    }\r\n}","const { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst DPAD_NOT_PRESSED = 1.2857143878936768;\r\nconst DPAD_UP = -1;\r\nconst DPAD_UP_PRESSED = 0;\r\nconst DPAD_DOWN = 0.14285719394683838;\r\nconst DPAD_DOWN_PRESSED = 1;\r\nconst DPAD_LEFT = 0.7142857313156128;\r\nconst DPAD_LEFT_PRESSED = 2;\r\nconst DPAD_RIGHT = -0.4285714030265808;\r\nconst DPAD_RIGHT_PRESSED = 3;\r\n\r\n\r\nclass LogitechG29Controller{\r\n    constructor(carLogic){\r\n        this.carLogic = carLogic;\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonX = 0;\r\n        this.buttonSquare = 1;\r\n        this.buttonCircle = 2;\r\n        this.buttonTriangle = 3;\r\n        this.bumperRight = 4;\r\n        this.bumperLeft = 5;\r\n        this.buttonR2 = 6;\r\n        this.buttonL2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionsButton = 9;\r\n        this.buttonR3 = 10;\r\n        this.buttonL3 = 11;\r\n        this.firstShift = 12;\r\n        this.secondShift = 13;\r\n        this.thirdShift = 14;\r\n        this.fourthShift = 15;\r\n        this.fifthShift = 16;\r\n        this.sixthShift = 17;\r\n        this.reverseShift = 18;\r\n        this.buttonPlus = 19;\r\n        this.buttonMinus = 20;\r\n        this.wheelInEnterRight = 21;\r\n        this.wheelInEnterLeft = 22;\r\n        this.enter = 23;\r\n        this.psButton = 24;\r\n\r\n        this.buttonsPressed = [];\r\n        for(let i=0; i <= 24; i++){\r\n            this.buttonsPressed.push(false);\r\n        }\r\n\r\n        this.wheelAxes = 0;\r\n        this.clutch = 1;\r\n        this.accelerator = 2;\r\n        this.brake = 5;\r\n        this.DPad = 9;\r\n\r\n        //This is conveniently defined by using distances if needed, it is not exact.\r\n        this.valueDpadUP = DPAD_UP;\r\n        this.valueDpadDOWN = DPAD_DOWN;\r\n        this.valueDpadLEFT = DPAD_LEFT;\r\n        this.valueDpadRIGHT = DPAD_RIGHT;\r\n\r\n        this.dpadPressed = [];\r\n        for(let i=0; i <= 3; i++){\r\n            this.dpadPressed.push(false);\r\n        }\r\n        \r\n        this.globalControllerHandler = new GlobalControllerHandling(carLogic);\r\n    }\r\n\r\n    \r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('G29 Driving Force Racing Wheel')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n\r\n    doActionsPedals(){\r\n        let clutch = ((this.gamepad.axes[this.clutch] )**3);\r\n        let brake = ((this.gamepad.axes[this.brake] )**3);\r\n        brake = (1 - (brake + 1) / 2);\r\n        let accelerator = ((this.gamepad.axes[this.accelerator] )**3);\r\n        accelerator = (1 - (accelerator + 1) / 2);\r\n        this.globalControllerHandler.handleAccelerate(clutch, accelerator);\r\n        this.globalControllerHandler.handleBrake(clutch, brake);\r\n    }\r\n\r\n\r\n    doActionsWheel(){\r\n        this.globalControllerHandler.turnDirection(this.gamepad.axes[this.wheelAxes]);\r\n    }\r\n\r\n\r\n    doActionsDPad(){\r\n        if(this.gamepad.axes[this.DPad] !== DPAD_NOT_PRESSED){\r\n            \r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadDOWN && !this.dpadPressed[DPAD_DOWN_PRESSED]){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadDOWN){\r\n                this.dpadPressed[DPAD_DOWN_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadLEFT && !this.dpadPressed[DPAD_LEFT_PRESSED]){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadLEFT){\r\n                this.dpadPressed[DPAD_LEFT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadRIGHT && !this.dpadPressed[DPAD_RIGHT_PRESSED]){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadRIGHT){\r\n                this.dpadPressed[DPAD_RIGHT_PRESSED] = false;\r\n            }\r\n\r\n            if(this.gamepad.axes[this.DPad] === this.valueDpadUP && !this.dpadPressed[DPAD_UP_PRESSED]){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = true;\r\n            }else if (this.gamepad.axes[this.DPad] !== this.valueDpadUP){\r\n                this.dpadPressed[DPAD_UP_PRESSED] = false;\r\n            }\r\n        }else{\r\n            for(let i = 0; i < this.dpadPressed.length; i++){\r\n                this.dpadPressed[i] = false;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    doActionsButtons(){\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonsPressed[this.buttonX]) {\r\n            this.buttonsPressed[this.buttonX] = true\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonsPressed[this.buttonX] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonTriangle].pressed && !this.buttonsPressed[this.buttonTriangle]) {\r\n            this.buttonsPressed[this.buttonTriangle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonTriangle].pressed){\r\n            this.buttonsPressed[this.buttonTriangle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonCircle].pressed && !this.buttonsPressed[this.buttonCircle]) {\r\n            this.buttonsPressed[this.buttonCircle] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonCircle].pressed){\r\n            this.buttonsPressed[this.buttonCircle] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonSquare].pressed && !this.buttonsPressed[this.buttonSquare]) {\r\n            this.buttonsPressed[this.buttonSquare] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonSquare].pressed){\r\n            this.buttonsPressed[this.buttonSquare] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.psButton].pressed && !this.buttonsPressed[this.psButton]) {\r\n            this.buttonsPressed[this.psButton] = true;\r\n        }else if(!this.gamepad.buttons[this.psButton].pressed){\r\n            this.buttonsPressed[this.psButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonPlus].pressed && !this.buttonsPressed[this.buttonPlus]) {\r\n            this.buttonsPressed[this.buttonPlus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonPlus].pressed){\r\n            this.buttonsPressed[this.buttonPlus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonMinus].pressed && !this.buttonsPressed[this.buttonMinus]) {\r\n            this.buttonsPressed[this.buttonMinus] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonMinus].pressed){\r\n            this.buttonsPressed[this.buttonMinus] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed && !this.buttonsPressed[this.buttonL2]) {\r\n            this.buttonsPressed[this.buttonL2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL2].pressed){\r\n            this.buttonsPressed[this.buttonL2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonsPressed[this.buttonL3]) {\r\n            this.buttonsPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonsPressed[this.buttonL3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR2].pressed && !this.buttonsPressed[this.buttonR2]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonsPressed[this.buttonR2] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR2].pressed){\r\n            this.buttonsPressed[this.buttonR2] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonsPressed[this.buttonR3]) {\r\n        this.buttonsPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonsPressed[this.buttonR3] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.enter].pressed && !this.buttonsPressed[this.enter]) {\r\n            this.buttonsPressed[this.enter] = true;\r\n        }else if(!this.gamepad.buttons[this.enter].pressed){\r\n            this.buttonsPressed[this.enter] = false;\r\n        }\r\n        \r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonsPressed[this.shareButton]) {\r\n            this.buttonsPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonsPressed[this.shareButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.optionsButton].pressed && !this.buttonsPressed[this.optionsButton]) {\r\n            this.buttonsPressed[this.optionsButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionsButton].pressed){\r\n            this.buttonsPressed[this.optionsButton] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperLeft].pressed && !this.buttonsPressed[this.bumperLeft]) {\r\n            this.buttonsPressed[this.bumperLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperLeft].pressed){\r\n            this.buttonsPressed[this.bumperLeft] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.bumperRight].pressed && !this.buttonsPressed[this.bumperRight]) {\r\n            this.buttonsPressed[this.bumperRight] = true;\r\n        }else if(!this.gamepad.buttons[this.bumperRight].pressed){\r\n            this.buttonsPressed[this.bumperRight] = false;\r\n        }\r\n\r\n\r\n        if (this.gamepad.buttons[this.wheelInEnterLeft].pressed && !this.buttonsPressed[this.wheelInEnterLeft]) {\r\n            this.buttonsPressed[this.wheelInEnterLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterLeft].pressed){\r\n            this.buttonsPressed[this.wheelInEnterLeft] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.wheelInEnterRight].pressed && !this.buttonsPressed[this.wheelInEnterRight]) {\r\n            this.buttonsPressed[this.wheelInEnterRight] = true;\r\n        }else if(!this.gamepad.buttons[this.wheelInEnterRight].pressed){\r\n            this.buttonsPressed[this.wheelInEnterRight] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionsShifter(){\r\n        if (this.gamepad.buttons[this.firstShift].pressed && !this.buttonsPressed[this.firstShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 1);\r\n            this.buttonsPressed[this.firstShift] = true;\r\n        }else if(!this.gamepad.buttons[this.firstShift].pressed && this.buttonsPressed[this.firstShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.firstShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.secondShift].pressed && !this.buttonsPressed[this.secondShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 2);\r\n            this.buttonsPressed[this.secondShift] = true;\r\n        }else if(!this.gamepad.buttons[this.secondShift].pressed && this.buttonsPressed[this.secondShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.secondShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.thirdShift].pressed && !this.buttonsPressed[this.thirdShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 3);\r\n            this.buttonsPressed[this.thirdShift] = true;\r\n        }else if(!this.gamepad.buttons[this.thirdShift].pressed && this.buttonsPressed[this.thirdShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.thirdShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fourthShift].pressed && !this.buttonsPressed[this.fourthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 4);\r\n            this.buttonsPressed[this.fourthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fourthShift].pressed && this.buttonsPressed[this.fourthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fourthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.fifthShift].pressed && !this.buttonsPressed[this.fifthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 5);\r\n            this.buttonsPressed[this.fifthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.fifthShift].pressed && this.buttonsPressed[this.fifthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.fifthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.sixthShift].pressed && !this.buttonsPressed[this.sixthShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 6);\r\n            this.buttonsPressed[this.sixthShift] = true;\r\n        }else if(!this.gamepad.buttons[this.sixthShift].pressed && this.buttonsPressed[this.sixthShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.sixthShift] = false;\r\n        }\r\n        if (this.gamepad.buttons[this.reverseShift].pressed && !this.buttonsPressed[this.reverseShift]) {\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], -1);\r\n            this.buttonsPressed[this.reverseShift] = true;\r\n        }else if(!this.gamepad.buttons[this.reverseShift].pressed && this.buttonsPressed[this.reverseShift]){\r\n            this.globalControllerHandler.changeShift(this.gamepad.axes[this.clutch], 0);\r\n            this.buttonsPressed[this.reverseShift] = false;\r\n        }\r\n    }\r\n\r\n\r\n    doActionByMapping(){\r\n        this.doActionsPedals();\r\n        this.doActionsWheel();\r\n        this.doActionsDPad();\r\n        this.doActionsButtons();\r\n        this.doActionsShifter();\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport default class LogitechG29ControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(carLogic) {\r\n        if (!LogitechG29ControllerSingleton.instance) {\r\n            LogitechG29ControllerSingleton.instance = new LogitechG29Controller(carLogic);\r\n        }\r\n        return LogitechG29ControllerSingleton.instance;\r\n    }\r\n}\r\n\r\n\r\n//module.exports = LogitechG29ControllerSingleton;","\r\nconst { default: GlobalControllerHandling } = require(\"./GlobalControllerHandling\");\r\n\r\nconst STICK_LIMIT = 0.1;\r\nconst CLUTCH_PRESED = 0;\r\nconst CLUTCH_NOT_PRESED = 1;\r\n\r\nclass XboxController{\r\n    constructor(auto){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        this.gamepad = null;\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n          if (gamepads[i]) {\r\n            if (gamepads[i].id.startsWith('Xbox') || gamepads[i].id.startsWith('xinput')) {\r\n              this.gamepad = gamepads[i];\r\n            }\r\n          }\r\n        }\r\n        this.buttonA = 0;\r\n        this.buttonB = 1;\r\n        this.buttonX = 2;\r\n        this.buttonY = 3;\r\n        this.buttonL1 = 4;\r\n        this.buttonR1 = 5;\r\n        this.buttonL2 = 6;\r\n        this.buttonR2 = 7;\r\n        this.shareButton = 8;\r\n        this.optionButton = 9;\r\n        this.buttonL3 = 10;\r\n        this.buttonR3 = 11;\r\n        this.padUp = 12;\r\n        this.padDown = 13;\r\n        this.padLeft = 14;\r\n        this.padRight = 15;\r\n        this.buttomHome = 16;\r\n        this.buttonPressed = [];\r\n        this.actualShift = 0;\r\n        for(let i = 0; i <= 16; i++){\r\n            this.buttonPressed.push(false);\r\n        }\r\n        \r\n        this.xLeftAxe = 0;\r\n        this.yLeftAxe = 1;\r\n        this.xRightAxe = 2;\r\n        this.yRightAxe = 3;\r\n        this.globalControllerHandler = new GlobalControllerHandling(auto);\r\n    }\r\n\r\n    checkGamepadChanges(){\r\n        const gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads() : []);\r\n        for (let i = 0; i < gamepads.length; i++) {\r\n            if (gamepads[i]) {\r\n              if (gamepads[i].id.startsWith('Xbox')) {\r\n                this.gamepad = gamepads[i];\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n    checkEvents(){\r\n        this.gamepad = null;\r\n        this.checkGamepadChanges();\r\n        if(this.gamepad != null){\r\n            this.doActionByMapping();\r\n        }\r\n        this.globalControllerHandler.updateCar();\r\n    }\r\n\r\n    doActionsAxes(){\r\n        if(Math.abs(this.gamepad.axes[this.yLeftAxe]) >= STICK_LIMIT){    \r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.xLeftAxe]) >= STICK_LIMIT){\r\n            let axe = ((this.gamepad.axes[this.xLeftAxe] )**3)\r\n            this.globalControllerHandler.turnDirection(axe);\r\n        }else{\r\n            this.globalControllerHandler.turnDirection(0);\r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.yRightAxe]) >= STICK_LIMIT){\r\n        }\r\n        if(Math.abs(this.gamepad.axes[this.xRightAxe]) >= STICK_LIMIT){\r\n        }\r\n    }\r\n\r\n    doActionHotKeys(){\r\n        this.globalControllerHandler.handleAccelerate(CLUTCH_NOT_PRESED, this.gamepad.buttons[this.buttonR2].value);\r\n        this.globalControllerHandler.handleBrake(CLUTCH_PRESED, this.gamepad.buttons[this.buttonL2].value);\r\n    }\r\n\r\n    doActionsTriggers(){\r\n        if (this.gamepad.buttons[this.buttonR2].pressed) {\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL2].pressed) {\r\n        }\r\n    }\r\n\r\n\r\n\r\n    doActionsButtons(){\r\n        \r\n        if (this.gamepad.buttons[this.buttonR1].pressed && !this.buttonPressed[this.buttonR1]) {\r\n            if(this.actualShift <= 5){\r\n                this.actualShift += 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonR1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR1].pressed){\r\n            \r\n            this.buttonPressed[this.buttonR1] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL1].pressed && !this.buttonPressed[this.buttonL1]) {\r\n            if(this.actualShift >= 0){\r\n                this.actualShift -= 1;\r\n                this.globalControllerHandler.changeShift(CLUTCH_PRESED, this.actualShift);\r\n            }\r\n            this.buttonPressed[this.buttonL1] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL1].pressed){\r\n            this.buttonPressed[this.buttonL1] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.shareButton].pressed && !this.buttonPressed[this.shareButton]) {\r\n            this.buttonPressed[this.shareButton] = true;\r\n        }else if(!this.gamepad.buttons[this.shareButton].pressed){\r\n            this.buttonPressed[this.shareButton] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padUp].pressed && !this.buttonPressed[this.padUp]) {\r\n            this.buttonPressed[this.padUp] = true;\r\n        }else if(!this.gamepad.buttons[this.padUp].pressed){\r\n            this.buttonPressed[this.padUp] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padDown].pressed && !this.buttonPressed[this.padDown]) {\r\n            this.buttonPressed[this.padDown] = true;\r\n        }else if(!this.gamepad.buttons[this.padDown].pressed){\r\n            this.buttonPressed[this.padDown] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padLeft].pressed && !this.buttonPressed[this.padLeft]) {\r\n            this.buttonPressed[this.padLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.padLeft].pressed){\r\n            this.buttonPressed[this.padLeft] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padRight].pressed && !this.buttonPressed[this.padRight]) {\r\n            this.buttonPressed[this.padRight] = true;\r\n        }else if(!this.gamepad.buttons[this.padRight].pressed){\r\n            this.buttonPressed[this.padRight] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonA].pressed && !this.buttonPressed[this.buttonA]) {\r\n            this.buttonPressed[this.buttonA] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonA].pressed){\r\n            this.buttonPressed[this.buttonA] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonB].pressed && !this.buttonPressed[this.buttonB]) {\r\n            this.buttonPressed[this.buttonB] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonB].pressed){\r\n            this.buttonPressed[this.buttonB] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonY].pressed && !this.buttonPressed[this.buttonY]) {\r\n            this.buttonPressed[this.buttonY] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonY].pressed){\r\n            this.buttonPressed[this.buttonY] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonX].pressed && !this.buttonPressed[this.buttonX]) {\r\n            this.buttonPressed[this.buttonX] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonX].pressed){\r\n            this.buttonPressed[this.buttonX] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonR3].pressed && !this.buttonPressed[this.buttonR3]) {\r\n            this.buttonPressed[this.buttonR3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonR3].pressed){\r\n            this.buttonPressed[this.buttonR3] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.buttonL3].pressed && !this.buttonPressed[this.buttonL3]) {\r\n            this.buttonPressed[this.buttonL3] = true;\r\n        }else if(!this.gamepad.buttons[this.buttonL3].pressed){\r\n            this.buttonPressed[this.buttonL3] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padUp].pressed && !this.buttonPressed[this.padUp]) {\r\n            this.buttonPressed[this.padUp] = true;\r\n        }else if(!this.gamepad.buttons[this.padUp].pressed){\r\n            this.buttonPressed[this.padUp] = false;\r\n        }\r\n\r\n        if (this.gamepad.buttons[this.padDown].pressed && !this.buttonPressed[this.padDown]) {\r\n            this.buttonPressed[this.padDown] = true;\r\n        }else if(!this.gamepad.buttons[this.padDown].pressed){\r\n            this.buttonPressed[this.padDown] = false;\r\n        }\r\n\r\n        \r\n        if (this.gamepad.buttons[this.padLeft].pressed && !this.buttonPressed[this.padLeft]) {\r\n            this.buttonPressed[this.padLeft] = true;\r\n        }else if(!this.gamepad.buttons[this.padLeft].pressed){\r\n            this.buttonPressed[this.padLeft] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.padRight].pressed && !this.buttonPressed[this.padRight]) {\r\n            this.buttonPressed[this.padRight] = true;\r\n        }else if(!this.gamepad.buttons[this.padRight].pressed){\r\n            this.buttonPressed[this.padRight] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.buttomHome].pressed && !this.buttonPressed[this.buttomHome]) {\r\n            this.globalControllerHandler.changeShiftBox(\"semi-auto\");\r\n            this.buttonPressed[this.buttomHome] = true;\r\n        }else if(!this.gamepad.buttons[this.buttomHome].pressed){\r\n            this.buttonPressed[this.buttomHome] = false;\r\n        }\r\n        \r\n        if (this.gamepad.buttons[this.optionButton].pressed && !this.buttonPressed[this.optionButton]) {\r\n            this.globalControllerHandler.turnOnCar();\r\n            this.buttonPressed[this.optionButton] = true;\r\n        }else if(!this.gamepad.buttons[this.optionButton].pressed){\r\n            this.buttonPressed[this.optionButton] = false;\r\n        }\r\n    }\r\n\r\n    doActionByMapping(){\r\n        this.doActionHotKeys();\r\n        this.doActionsAxes();\r\n        this.doActionsTriggers();\r\n        this.doActionsButtons();\r\n    }\r\n}\r\n\r\nexport default class XboxControllerSingleton{\r\n\r\n    static instance;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static getInstance(auto) {\r\n        if (!XboxControllerSingleton.instance) {\r\n            XboxControllerSingleton.instance = new XboxController(auto);\r\n        }\r\n        return XboxControllerSingleton.instance;\r\n    }\r\n}","export default class Observable{\r\n\r\n    constructor(){\r\n        this.observers = [];\r\n    }\r\n\r\n    attachObserver(observer){\r\n        this.observers.push(observer);\r\n    }\r\n\r\n    removeObserver(observer){\r\n        let index = this.observers.indexOf(observer);\r\n        if(index > -1){\r\n            this.observers.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    notifyObservers(stateToSend){\r\n        for (let i = 0; i < this.observers.length; i++){\r\n            this.observers[i].update(stateToSend);\r\n        }\r\n    }\r\n}","import Ammo from 'ammo.js'\r\n\r\nexport default class AmmoInstance{\r\n\r\n    static AmmoInstanceToReturn = null;\r\n\r\n    constructor() {\r\n        throw new Error('Can not construct singleton. Call get instance instead.');\r\n    }\r\n\r\n    static async getInstance(){\r\n        if(!AmmoInstance.AmmoInstanceToReturn){\r\n            AmmoInstance.AmmoInstanceToReturn = await Ammo();\r\n        }\r\n        return AmmoInstance.AmmoInstanceToReturn;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst FRONT_LEFT = 0;\r\nconst FRONT_RIGHT = 1;\r\nconst BACK_LEFT = 2;\r\nconst BACK_RIGHT = 3;\r\n\r\nconst SIDE_RIGHT =-1;\r\nconst SIDE_LEFT = 1;\r\nconst MAX_STEER = -0.5;\r\n\r\nconst MAX_FRICTION_FORCE = 100;\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\nexport default class CarPhysics{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction *10);\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        this.tuning = new this.Ammo.btVehicleTuning();\r\n        var rayCaster = new this.Ammo.btDefaultVehicleRaycaster(this.physicsWorld);\r\n        this.vehicle = new this.Ammo.btRaycastVehicle(this.tuning, this.rigidBody, rayCaster);\r\n        this.vehicle.setCoordinateSystem(0, 1, 2);\r\n        this.physicsWorld.addAction(this.vehicle);\r\n\r\n        let radio_rueda = 0.35;\r\n        let disti_center = 0.85;\r\n        var wheelAxisPositionBack = -1.45;\r\n        var wheelRadiusBack = radio_rueda;\r\n        var wheelWidthBack = 0.35;\r\n        var wheelHalfTrackBack = -disti_center;\r\n        var wheelAxisHeightBack = 0.2;\r\n\r\n        var wheelAxisFrontPosition = 1.65;\r\n        var wheelHalfTrackFront = disti_center;\r\n        var wheelAxisHeightFront = 0.2;\r\n        var wheelRadiusFront = radio_rueda;\r\n        var wheelWidthFront = 0.35;\r\n\r\n\r\n        this.addWheel(true, new this.Ammo.btVector3(wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_LEFT,SIDE_LEFT);\r\n        this.addWheel(true, new this.Ammo.btVector3(-wheelHalfTrackFront, wheelAxisHeightFront, wheelAxisFrontPosition), wheelRadiusFront, wheelWidthFront, FRONT_RIGHT,SIDE_RIGHT);\r\n        this.addWheel(false, new this.Ammo.btVector3(-wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_LEFT,SIDE_LEFT);\r\n        this.addWheel(false, new this.Ammo.btVector3(wheelHalfTrackBack, wheelAxisHeightBack, wheelAxisPositionBack), wheelRadiusBack, wheelWidthBack, BACK_RIGHT,SIDE_RIGHT);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    addWheel(isFront, pos, radius, width, index, side) {\r\n        var wheelDirectionCS0 = new this.Ammo.btVector3(0, -1, 0);\r\n        var wheelAxleCS = new this.Ammo.btVector3(-1, 0, 0);\r\n        var suspensionStiffness = 2.0;\r\n        var suspensionRestLength = 0.6;\r\n        var rollInfluence = 0.2;\r\n        var friction = 1000;\r\n        var suspensionDamping = 3.3;\r\n        var suspensionCompression = 4.4;\r\n        var wheelInfo = this.vehicle.addWheel(\r\n            pos,\r\n            wheelDirectionCS0,\r\n            wheelAxleCS,\r\n            suspensionRestLength,\r\n            radius,\r\n            this.tuning,\r\n            isFront\r\n        );\r\n\r\n        wheelInfo.set_m_suspensionStiffness(suspensionStiffness);\r\n        wheelInfo.set_m_wheelsDampingRelaxation(suspensionDamping);\r\n        wheelInfo.set_m_wheelsDampingCompression(suspensionCompression);\r\n        wheelInfo.set_m_frictionSlip(friction);\r\n        wheelInfo.set_m_rollInfluence(rollInfluence);\r\n\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let returnValue = {\r\n            \"chassis\": {\r\n                \"position\": null,\r\n                \"rotation\": null,\r\n            },\r\n            \"wheels\": []\r\n        }\r\n        for (let i=0; i < this.vehicle.getNumWheels(); i++){\r\n            this.vehicle.updateWheelTransform(i, true);\r\n            let transfMatrix = this.vehicle.getWheelTransformWS(i);\r\n            let position = transfMatrix.getOrigin();\r\n            let rotation = transfMatrix.getRotation();\r\n            returnValue.wheels.push({\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            });\r\n        }\r\n        let worldTransformChassis = this.vehicle.getChassisWorldTransform();\r\n            \r\n        let position = worldTransformChassis.getOrigin();\r\n        let rotation = worldTransformChassis.getRotation();\r\n        returnValue.chassis = {\r\n            \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n            \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n        };\r\n        return returnValue;\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n\r\n    \r\n    setEngineForce( engineForce ){\r\n        this.vehicle.applyEngineForce( engineForce, BACK_LEFT );\r\n        this.vehicle.applyEngineForce( engineForce, BACK_RIGHT );\r\n    }\r\n\r\n\r\n    brake(valueBrake){\r\n        let speedKMH = Math.abs(this.vehicle.getCurrentSpeedKmHour());\r\n        let frictionBrake = MAX_FRICTION_FORCE / ( speedKMH );\r\n        if( speedKMH === 0 ){\r\n            frictionBrake = 0;\r\n        }\r\n        valueBrake += frictionBrake;\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_LEFT);\r\n        this.vehicle.setBrake(valueBrake/2, FRONT_RIGHT);\r\n        this.vehicle.setBrake(valueBrake, BACK_LEFT);\r\n        this.vehicle.setBrake(valueBrake, BACK_RIGHT);\r\n    }\r\n\r\n\r\n    setSteeringRotation( rotation ){\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_LEFT);\r\n        this.vehicle.setSteeringValue(rotation * MAX_STEER, FRONT_RIGHT);\r\n    }\r\n\r\n\r\n    getVelocity(){\r\n        return this.vehicle.getCurrentSpeedKmHour();\r\n    }\r\n}","export const MAX_RPM = 8000;\r\nconst ACCEL_COEF = 2;\r\nconst BRAKE_COEF = 1.5;\r\nexport const EXPONENTIAL_COEF_TO_RPM = 200;\r\n\r\nexport class AbstractEngineState{\r\n    changeValueInRPMCurve(valuePedal, accelerating, currentRPM, currentXInRPMCurve){\r\n\r\n        let sumToValueInCurve;\r\n        let previousRPM = currentRPM;\r\n        if(accelerating){\r\n            let normalizedAccelerator = valuePedal;\r\n            //let normalizedAccelerator = (1 - (valuePedal + 1) / 2);\r\n            let normalizedRPM = previousRPM/MAX_RPM;\r\n            sumToValueInCurve = (normalizedAccelerator - normalizedRPM) * ACCEL_COEF;\r\n        }else{\r\n            sumToValueInCurve = -valuePedal * BRAKE_COEF;\r\n        }\r\n        currentXInRPMCurve = currentXInRPMCurve + sumToValueInCurve;\r\n        if (currentXInRPMCurve > 3 * EXPONENTIAL_COEF_TO_RPM){\r\n            currentXInRPMCurve = 3 * EXPONENTIAL_COEF_TO_RPM;\r\n        }\r\n        else if(currentXInRPMCurve < 0){ //X's value is not able to have negative value in our calculation.\r\n            currentXInRPMCurve = 0;\r\n        }\r\n\r\n        //We'll simulate the RPM's in an equation similar to capacitors in order to not make it linear and make it independent of everything.\r\n        currentRPM = MAX_RPM * (1 - Math.exp(-currentXInRPMCurve/EXPONENTIAL_COEF_TO_RPM));\r\n\r\n        return [currentRPM, currentXInRPMCurve];\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nconst ACCEL_NOT_PRESSED = 0;\r\n\r\nexport default class TurnedOffEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(ACCEL_NOT_PRESSED, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n}","import {AbstractEngineState} from \"./AbstractEngineState\";\r\n\r\nexport default class TurnedOnEngine extends AbstractEngineState{\r\n\r\n    accelerate(valueAccelerator, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueAccelerator, true, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n    brake(valueBrake, currentRPM, currentXInRPMCurve){\r\n        return this.changeValueInRPMCurve(valueBrake, false, currentRPM, currentXInRPMCurve);\r\n    }\r\n\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from './CarEngineStates/AbstractEngineState';\r\nimport TurnedOffEngine from './CarEngineStates/TurnedOffEngine';\r\nimport TurnedOnEngine from './CarEngineStates/TurnedOnEngine';\r\n\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 0;//1000\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = 0.25;\r\n\r\nexport default class CarEngine{\r\n\r\n\r\n    constructor(){\r\n        this.engineState = new TurnedOffEngine();\r\n        this.currentRPM = 0;\r\n        this.currentXInRPMCurve = 0;\r\n    }\r\n\r\n\r\n    turnOn(){\r\n        this.engineState = new TurnedOnEngine();\r\n    }\r\n\r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    handleEngineShutdown(valueClutch,shiftBox){\r\n        //!this.clutchIsPressed(valueClutch) && this.currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN\r\n        if(shiftBox.shutDownEngine(valueClutch,this.currentRPM)){\r\n            if(this.engineState instanceof TurnedOnEngine){\r\n                this.engineState = new TurnedOffEngine();\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n\r\n    isInConditionToAccelerate(valueClutch){\r\n        return ((this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch)) || this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    engineCanApplyForce(valueClutch){\r\n        return (this.currentRPM >= MIN_RPM_TO_AVOID_SHUTDOWN && !this.clutchIsPressed(valueClutch));\r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator, shiftBox){\r\n        let rpmReturn = this.engineState.accelerate(valueAccelerator, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake,shiftBox){\r\n        let rpmReturn = this.engineState.brake(valueBrake, this.currentRPM, this.currentXInRPMCurve);\r\n        this.currentRPM = rpmReturn[0];\r\n        this.currentXInRPMCurve = rpmReturn[1];\r\n        this.handleEngineShutdown(valueClutch,shiftBox);\r\n    }\r\n\r\n\r\n    changeRPM(RPMModification){\r\n        this.currentRPM = RPMModification;\r\n        if( (-this.currentRPM/MAX_RPM + 1) > 0 ){\r\n            this.currentXInRPMCurve = -Math.log( -this.currentRPM/MAX_RPM + 1) * EXPONENTIAL_COEF_TO_RPM;\r\n            if(this.currentXInRPMCurve < 0){\r\n                this.currentXInRPMCurve = 0;\r\n            }\r\n        }else if(this.currentRPM === MAX_RPM){\r\n            this.currentXInRPMCurve = EXPONENTIAL_COEF_TO_RPM * 3;\r\n        }\r\n    }\r\n\r\n\r\n    getCurrentRPM(){\r\n        return this.currentRPM;\r\n    }\r\n}","import { EXPONENTIAL_COEF_TO_RPM, MAX_RPM } from \"./CarEngineStates/AbstractEngineState\";\r\n\r\n\r\nconst QUANTITY_SHIFTS = 6;\r\nconst MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN = -0.75;\r\n\r\nexport default class ShiftBox{\r\n\r\n    constructor(carEngine){\r\n        this.NEUTRAL = 0;\r\n        this.REVERSE = -1;\r\n        this.FIRST = 1;\r\n        this.SECOND = 2;\r\n        this.THIRD = 3;\r\n        this.FOURTH = 4;\r\n        this.FIFTH = 5;\r\n        this.SIXTH = 6;\r\n        this.validShifts = [this.REVERSE, this.NEUTRAL, this.FIRST, this.SECOND, this.THIRD, this.FOURTH, this.FIFTH, this.SIXTH];\r\n\r\n        this.currentShift = this.NEUTRAL;\r\n        this.carEngine = carEngine;\r\n\r\n        this.minimumVelocityOnShift = [0, 10, 20, 35, 60, 90];\r\n        this.maximumVelocityOnShift = [40, 60, 80, 110, 140, 200];\r\n\r\n    }\r\n\r\n    isValidShift(shift){\r\n        if (this.validShifts.indexOf(shift) >= 0){\r\n            return true;\r\n        }else{\r\n            throw new Error(\"Shift \" + shift + \" is not valid.\");\r\n        }\r\n    }\r\n    \r\n\r\n    calculateNormalFactorRPM(newShift,oldVelocity){\r\n        return ((oldVelocity - this.minimumVelocityOnShift[Math.abs(newShift) - 1]) / \r\n            (this.maximumVelocityOnShift[Math.abs(newShift) - 1] - this.minimumVelocityOnShift[Math.abs(newShift) - 1]));\r\n    }\r\n    \r\n\r\n    getValueForNewRPM(newShift, oldVelocity){\r\n        if(newShift === this.NEUTRAL || (Math.abs(newShift) === this.FIRST && Math.abs(oldVelocity) < 5)){\r\n            return this.carEngine.getCurrentRPM();\r\n        }\r\n        if(newShift === this.REVERSE && oldVelocity > 0){\r\n            return 0;\r\n        }\r\n        if(newShift > 0 && oldVelocity < 0){\r\n            return 0;\r\n        }\r\n        let normalFactorRPM = this.calculateNormalFactorRPM(newShift, oldVelocity);\r\n        if ( normalFactorRPM > 1 ){\r\n            return MAX_RPM;\r\n        }else{\r\n            let XValue = normalFactorRPM * EXPONENTIAL_COEF_TO_RPM;\r\n            return (MAX_RPM * (1 - Math.exp(-XValue/EXPONENTIAL_COEF_TO_RPM)));\r\n        }\r\n    }\r\n    \r\n\r\n    clutchIsPressed(valueClutch){\r\n        return valueClutch <= MIN_VALUE_CLUTCH_TO_AVOID_SHUTDOWN\r\n    }\r\n\r\n\r\n    shutDownEngine(){\r\n        return false;\r\n    }\r\n\r\n    //CONSIDERAR EL VALUE DEL ACCELERATOR DE FORMA SIMILAR A COMO SE CONSIDERA EN ABSTRACT ENGINE STATE PARA QUE SI ES NEGATIVO DECREMENTE LA VELOCIDAD Y NO AUMENTE\r\n    getEngineForce(currentVelocity, valueClutch){\r\n        currentVelocity = Math.abs(currentVelocity);\r\n        let currentRPM = this.carEngine.getCurrentRPM();\r\n\r\n        if(this.currentShift === this.NEUTRAL){\r\n            return 0;\r\n        }\r\n\r\n        let valueClutchNormalized = (valueClutch + 1)/2;\r\n        let minVelocityBasedOnClutch = this.minimumVelocityOnShift[Math.abs(this.currentShift) - 1] * (1 - Math.exp(-valueClutchNormalized*3));\r\n        //If there is a next shift and it has ideal velocity we can calculate the Normalized Engine Force based on velocity range\r\n\r\n        let rangeOfVelocities = this.maximumVelocityOnShift[Math.abs(this.currentShift) - 1] - minVelocityBasedOnClutch;\r\n        let normalFactorToDecrement = (currentVelocity - minVelocityBasedOnClutch) / rangeOfVelocities;\r\n        if(currentVelocity < minVelocityBasedOnClutch){\r\n            //Debera dar trompicones\r\n        }\r\n        let normalFactor = (1 - normalFactorToDecrement)**2;\r\n\r\n        if(normalFactor > 1){\r\n            normalFactor = 0;\r\n        }\r\n\r\n        let powerFactor = (QUANTITY_SHIFTS / this.currentShift);\r\n        let finalEngineForce =  powerFactor * currentRPM * normalFactor;\r\n        return finalEngineForce\r\n\r\n    }\r\n\r\n    changeShift(){\r\n        //METHOD TO OVERRIDE\r\n    }\r\n\r\n\r\n    getCurrentShift(){\r\n        return this.currentShift;\r\n    }\r\n\r\n}","import ShiftBox from '../ShiftBox';\r\nconst MIN_RPM_TO_AVOID_SHUTDOWN = 1000;\r\nexport default class ManualBox extends ShiftBox{\r\n\r\n    \r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift) && this.clutchIsPressed(valueClutch)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }else{\r\n            throw new Error(\"Can't change shift if clutch is not pressed\");\r\n        }\r\n    }\r\n\r\n\r\n    shutDownEngine(valueClutch, currentRPM){\r\n        return !this.clutchIsPressed(valueClutch) && currentRPM < MIN_RPM_TO_AVOID_SHUTDOWN;\r\n    }\r\n}","import ShiftBox from '../ShiftBox';\r\n\r\nexport default class SemiAutomaticBox extends ShiftBox{\r\n\r\n    changeShift(valueClutch, newShift, currentVelocity){\r\n        if(this.isValidShift(newShift)){\r\n            this.currentShift = newShift;\r\n            this.carEngine.changeRPM(this.getValueForNewRPM(newShift, currentVelocity, valueClutch));\r\n        }\r\n    }\r\n}","import { Vector3, Vector4 } from 'three';\r\nimport Observable from '../../ObserverPattern/Observable';\r\nimport CarPhysics from '../Physics/PhysicsTypes/CarPhysics';\r\nimport CarEngine from './CarEngine';\r\nimport ManualBox from './ShiftBoxTypes/ManualBox';\r\nimport SemiAutomaticBox from './ShiftBoxTypes/SemiAutomaticBox';\r\n\r\n\r\nconst POSITION = [0,0,0];\r\nconst FACTOR_BRAKE_TO_FORCE = 300;\r\nexport default class Car extends Observable{\r\n\r\n    constructor(physicsWorld){\r\n        super();\r\n        this.carEngine = new CarEngine();\r\n        this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        this.currentDirectionTurn = 0; //in rads\r\n        this.currentTireRotation = 0;\r\n        this.position = new Vector3(POSITION[0], POSITION[1], POSITION[2]);\r\n        this.rotationQuaternion = new Vector4(0,0,0,1);\r\n        this.mass = 1000;\r\n        this.physicsShape = new Vector3(2,1.3,5);\r\n        this.rotation = new Vector4(0,0,0,1);\r\n        this.inertia = new Vector3(1,0,1);\r\n\r\n        this.carPhysics = new CarPhysics(this.position, this.rotationQuaternion, this.inertia, this.mass, this.physicsShape, physicsWorld, 0);\r\n        this.carPhysics.buildAmmoPhysics();\r\n        \r\n    }\r\n\r\n\r\n    accelerate(valueClutch, valueAccelerator){\r\n        this.carEngine.accelerate(valueClutch, valueAccelerator,this.shiftBox);\r\n        if(valueAccelerator > 0.1 && this.carEngine.engineCanApplyForce(valueClutch)){\r\n            this.carPhysics.setEngineForce( this.shiftBox.getEngineForce(this.carPhysics.getVelocity(), valueClutch) );\r\n        }else{\r\n            this.carPhysics.setEngineForce( 0 );\r\n        }\r\n    }\r\n\r\n\r\n    brake(valueClutch, valueBrake){\r\n        this.carEngine.brake(valueClutch, valueBrake,this.shiftBox);\r\n        //Mapping [-1;1] to [0;1]\r\n        this.carPhysics.brake(valueBrake*FACTOR_BRAKE_TO_FORCE);\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, newShift){\r\n        this.shiftBox.changeShift(valueClutch, newShift, this.carPhysics.getVelocity());\r\n    }\r\n\r\n\r\n    turnOnRightLight(){\r\n        //PRENDER EL INTERMITENTE DERECHO\r\n    }\r\n\r\n\r\n    turnOnLeftLight(){\r\n        //PRENDER EL INTERMITENTE DERECHO\r\n    }\r\n\r\n    \r\n    turnOnCar(){\r\n        this.carEngine.turnOn();\r\n    }\r\n\r\n    \r\n    turnDirection(wheelAxesValue){\r\n        this.currentTireRotation = wheelAxesValue;\r\n        this.carPhysics.setSteeringRotation( wheelAxesValue );\r\n    }\r\n\r\n\r\n    update(){\r\n        let positionAndRotation = this.carPhysics.updatePhysics();\r\n        this.position = positionAndRotation[\"chassis\"][\"position\"];\r\n        this.rotation = positionAndRotation[\"chassis\"][\"rotation\"];\r\n        this.wheelsData = positionAndRotation[\"wheels\"];\r\n        super.notifyObservers(this.getDataToAnimate());\r\n    }\r\n\r\n\r\n    getLastRotation(){\r\n        return this.currentTireRotation;\r\n    }\r\n\r\n    \r\n    getDataToAnimate(){\r\n        return {\r\n            \"direction\": this.currentDirectionTurn, \r\n            \"velocity\": this.carPhysics.getVelocity(), \r\n            \"lastRotationWheel\": this.currentTireRotation,\r\n            \"position\": this.position,\r\n            \"rotation\": this.rotation,\r\n            \"physicsBody\": this.carPhysics,\r\n            \"wheelsData\": this.wheelsData,\r\n            \"rpm\": this.getCurrentRPM()\r\n        };\r\n    }\r\n\r\n    getSpeed(){\r\n        return this.carPhysics.getVelocity();\r\n    }\r\n\r\n    getCurrentRPM(){\r\n        return this.carEngine.getCurrentRPM();\r\n    }\r\n\r\n    changeShiftBox(mode){\r\n        if(mode ===  \"semi-auto\"){\r\n            this.shiftBox = new SemiAutomaticBox(this.carEngine);\r\n        }else if(mode === \"manual\"){\r\n            //TODO: asignar boton en volante\r\n            this.shiftBox = new ManualBox(this.carEngine);\r\n        }\r\n    }\r\n\r\n    getCurrentShift(){\r\n        return this.shiftBox.getCurrentShift();\r\n    }\r\n}","import Observable from \"../../../ObserverPattern/Observable\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nimport {Vector3, Vector4} from \"three\";\r\n\r\nconst DISABLE_DEACTIVATION = 4;\r\n\r\nexport default class GeneralPhysics extends Observable{\r\n\r\n\r\n    constructor(position, quaternion, inertia, mass, shape, physicsWorld, friction){\r\n        super();\r\n        this.position = position;\r\n        this.quaternion = quaternion;\r\n        this.inertia = inertia;\r\n        this.mass = mass;\r\n        this.shape = shape;\r\n        this.physicsWorld = physicsWorld;\r\n        if(!friction) friction = 1;\r\n        this.friction = friction;\r\n    }\r\n\r\n\r\n    async generateShape(){\r\n        return null;\r\n    }\r\n\r\n\r\n    async buildAmmoPhysics(){\r\n\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.inertia = new Ammo.btVector3(this.inertia.x, this.inertia.y, this.inertia.z);\r\n        this.Ammo = Ammo;\r\n        let transform = new Ammo.btTransform();\r\n        transform.setIdentity();\r\n        transform.setOrigin(new Ammo.btVector3(this.position.x, this.position.y, this.position.z));\r\n        transform.setRotation(new Ammo.btQuaternion(this.quaternion.x, this.quaternion.y, this.quaternion.z, this.quaternion.w));\r\n\r\n        this.tempTransform = new Ammo.btTransform();\r\n\r\n        let motionState = new Ammo.btDefaultMotionState(transform);\r\n\r\n        let shape = await this.generateShape();\r\n        shape.setMargin(0.05);\r\n        shape.calculateLocalInertia(this.mass, this.inertia);\r\n\r\n        let rigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(this.mass, motionState, shape, this.inertia);\r\n        this.rigidBody = new Ammo.btRigidBody(rigidBodyInfo);\r\n\r\n        this.rigidBody.setFriction(this.friction);\r\n        this.rigidBody.setRollingFriction(this.friction * 2)\r\n\r\n        this.physicsWorld.addRigidBody(this.rigidBody);\r\n\r\n        if( this.mass > 0 ){\r\n            this.rigidBody.setActivationState(DISABLE_DEACTIVATION);\r\n        }\r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        let motionState = this.rigidBody.getMotionState();\r\n        if(motionState){\r\n            motionState.getWorldTransform(this.tempTransform);\r\n            \r\n            let position = this.tempTransform.getOrigin();\r\n            let rotation = this.tempTransform.getRotation();\r\n            const newState = {\r\n                \"position\": new Vector3(position.x(), position.y(), position.z()),\r\n                \"rotation\": new Vector4(rotation.x(), rotation.y(), rotation.z(), rotation.w()),\r\n            }\r\n            this.notifyObservers(newState);\r\n            return newState;\r\n        }else{\r\n            throw new Error(\"No motion state found in rigid body\");\r\n        }\r\n    }\r\n\r\n\r\n    setLinearVelocity(velocityVector){\r\n        let velVectorBT = new this.Ammo.btVector3(this.mass*velocityVector.x, this.mass*velocityVector.y, this.mass*velocityVector.z);\r\n        this.rigidBody.applyForce(velVectorBT);\r\n    }\r\n\r\n\r\n    getRigidBody(){\r\n        return this.rigidBody;\r\n    }\r\n}","import AmmoInstance from \"../AmmoInstance\";\r\nimport GeneralPhysics from \"./GeneralPhysics\";\r\n\r\nexport default class CylinderPhysics extends GeneralPhysics{\r\n    \r\n    // Shape is a Vector3(Radius, HeightCylinder/2, Radius). \r\n    // See: https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=5889\r\n    // It's origin is in the center of the cylinder so calculate position by using height/2.\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        return new Ammo.btCylinderShape(new Ammo.btVector3(this.shape.x, this.shape.y, this.shape.z));\r\n    }\r\n}","import VisualEntity from \"./VisualEntity\";\r\nimport * as THREE from 'three';\r\n\r\nexport default class TrafficCone extends VisualEntity{\r\n\r\n    constructor(pathToTexture){\r\n        super(pathToTexture);\r\n        this.pathToTexture = pathToTexture;\r\n        this.RADIUS_TOP = 0.1;\r\n        this.RADIUS_BOTTOM = 0.8;\r\n        this.HEIGHT = 1.25;\r\n        this.observedState = null;\r\n    }\r\n\r\n    animate(){\r\n        if(this.observedState != null){\r\n            this.threeDModel.position.set(\r\n                this.observedState[\"position\"].x, \r\n                this.observedState[\"position\"].y, \r\n                this.observedState[\"position\"].z\r\n            );\r\n            \r\n            this.threeDModel.quaternion.set(\r\n                this.observedState[\"rotation\"].x, \r\n                this.observedState[\"rotation\"].y, \r\n                this.observedState[\"rotation\"].z, \r\n                this.observedState[\"rotation\"].w\r\n            );\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    async addToScene(scene, objectName, position, scale){\r\n        if(!this.threeDModel){\r\n            const geometry = new THREE.CylinderGeometry( this.RADIUS_TOP, this.RADIUS_BOTTOM, this.HEIGHT, 32, undefined, true );\r\n            const texture = new THREE.TextureLoader().load(this.pathToTexture);\r\n            const material = new THREE.MeshBasicMaterial( { map: texture });\r\n            const materialBox = new THREE.MeshBasicMaterial( { color: 0xd56324 } );\r\n            const geometryPlane = new THREE.BoxGeometry(this.RADIUS_BOTTOM*2, 0.1, this.RADIUS_BOTTOM*2);\r\n            const box = new THREE.Mesh( geometryPlane, materialBox );\r\n            box.position.set(0,-this.HEIGHT/2,0);\r\n            const cone = new THREE.Mesh( geometry, material );\r\n            cone.position.set(0,0,0);\r\n            this.threeDModel = new THREE.Group();\r\n            this.threeDModel.add(cone).add(box);\r\n            this.threeDModel.name = objectName;\r\n            this.threeDModel.position.set(position[0], position[1], position[2]);\r\n            this.threeDModel.scale.set(scale[0], scale[1], scale[2]);\r\n\r\n            this.RADIUS_TOP *= scale[0];\r\n            this.RADIUS_BOTTOM *= scale[0];\r\n            this.HEIGHT *= scale[1];\r\n\r\n            scene.add(this.threeDModel);\r\n        }\r\n        return this;\r\n    }\r\n}","import GeneralPhysics from \"./GeneralPhysics\";\r\nimport AmmoInstance from \"../AmmoInstance\";\r\nexport default class BoxPhysics extends GeneralPhysics{\r\n\r\n\r\n    async generateShape(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        return new Ammo.btBoxShape(new Ammo.btVector3(this.shape.x/2, this.shape.y/2, this.shape.z/2));\r\n    }\r\n}","import * as THREE from 'three';\r\nimport BoxPhysics from '../LogicModel/Physics/PhysicsTypes/BoxPhysics';\r\nimport AmmoInstance from '../LogicModel/Physics/AmmoInstance';\r\nimport TrafficCone from '../3DModels/TrafficCone';\r\n// import ConePhysics from '../LogicModel/Physics/PhysicsTypes/ConePhysics'\r\nimport CylinderPhysics from '../LogicModel/Physics/PhysicsTypes/CylinderPhysics';\r\n\r\nexport default class LevelFactory {\r\n\r\n\r\n    constructor(level, scene,physicsWorld){\r\n        this.scene = scene;\r\n        this.physicsWorld = physicsWorld\r\n        this.physicsToUpdate = [];\r\n        this.objectsToAnimate = [];\r\n        if(level === 0){\r\n            this.createLevel0()\r\n        }\r\n        \r\n    }\r\n\r\n\r\n    updatePhysics(){\r\n        this.physicsToUpdate.forEach(function(phys){\r\n            phys.updatePhysics();\r\n        })\r\n    }\r\n\r\n\r\n    animate(){\r\n        this.objectsToAnimate.forEach(function(object){\r\n            object.animate();\r\n        });\r\n    }\r\n\r\n\r\n    async createRectangle(position,length, width, height ,rotation, pathTexture, Ammo, normalMapPath = null){\r\n        \r\n        const texture = new THREE.TextureLoader().load( pathTexture );\r\n        texture.wrapS = THREE.RepeatWrapping;\r\n        texture.wrapT = THREE.RepeatWrapping;\r\n        texture.repeat.set( length, height );\r\n        const floorMaterial = new THREE.MeshStandardMaterial( {map: texture,  side: THREE.DoubleSide} );\r\n        if( normalMapPath ){\r\n            let normalTexture = new THREE.TextureLoader().load(\r\n                normalMapPath\r\n            );\r\n            normalTexture.repeat.set( length, height );\r\n            normalTexture.wrapS = THREE.RepeatWrapping;\r\n            normalTexture.wrapT = THREE.RepeatWrapping;\r\n            floorMaterial.normalMap = normalTexture;\r\n            floorMaterial.normalScale.set(10, 10);\r\n        }\r\n        const rampa = new THREE.BoxGeometry( length, width, height);\r\n        rampa.rotateX(rotation);\r\n        const quaternionRamp = new THREE.Quaternion();\r\n        quaternionRamp.setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), rotation);\r\n\r\n        let rampPhysics = new BoxPhysics(\r\n            new THREE.Vector3(position[0],position[1],position[2]), //Position\r\n            quaternionRamp ,  //Quaternion2\r\n            new Ammo.btVector3(0,0,0), //Inertia\r\n            0, //Mass\r\n            new THREE.Vector3(length, width, height), //Shape\r\n            this.physicsWorld, //Physics World\r\n            1000 // friction\r\n        ); \r\n        \r\n        await rampPhysics.buildAmmoPhysics();\r\n        this.physicsToUpdate.push(rampPhysics);\r\n        let ramp = new THREE.Mesh( rampa, floorMaterial );\r\n        ramp.position.set(position[0],position[1],position[2]);\r\n        this.scene.add(ramp);\r\n    }\r\n\r\n\r\n    async createCone(position , Ammo){\r\n        let cone = new TrafficCone(\"textures/coneTexture.jpg\");\r\n        cone.addToScene(this.scene, \"trafficCone\", position, [ 0.5, 0.5, 0.5]);\r\n        let conePhysics = new CylinderPhysics(\r\n            new THREE.Vector3(position[0],position[1],position[2]), //Position\r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            10, \r\n            new THREE.Vector3(cone.RADIUS_BOTTOM, cone.HEIGHT/2, cone.RADIUS_BOTTOM), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await conePhysics.buildAmmoPhysics();\r\n        this.physicsToUpdate.push(conePhysics);\r\n        conePhysics.attachObserver(cone);\r\n        this.objectsToAnimate.push(cone);\r\n    }\r\n\r\n\r\n    async createLevel0(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.createRectangle( [ 10, 0, 10 ], 10, 2, 10, -Math.PI/8, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createRectangle( [ -10, 0, 10 ], 10, 2, 10, -Math.PI/4, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createRectangle( [ 0, 0, 0 ], 100, 0.1, 100, 0, 'textures/pavimento.jpg', Ammo, 'textures/pavimento_map.png' );\r\n        this.createCone( [ 0, 0.5, 10 ], Ammo );\r\n        this.createCone( [ 0, 0.5, 30 ], Ammo );\r\n        this.createCone( [ 0, 0.5, 20 ], Ammo );\r\n    }\r\n\r\n}\r\n\r\n","class VRButton {\r\n\r\n\tstatic createButton( renderer ) {\r\n\t\t\r\n\t\tconst button = document.createElement( 'button' );\r\n\r\n\t\tfunction showEnterVR( /*device*/ ) {\r\n\r\n\t\t\tlet currentSession = null;\r\n\r\n\t\t\tasync function onSessionStarted( session ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tawait renderer.xr.setSession( session );\r\n\t\t\t\tbutton.textContent = 'EXIT VR';\r\n\r\n\t\t\t\tcurrentSession = session;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfunction onSessionEnded( /*event*/ ) {\r\n\r\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\r\n\r\n\t\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\t\tcurrentSession = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'pointer';\r\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\r\n\t\t\tbutton.style.width = '100px';\r\n\r\n\t\t\tbutton.textContent = 'ENTER VR';\r\n\r\n\t\t\tbutton.onmouseenter = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '1.0';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onmouseleave = function () {\r\n\r\n\t\t\t\tbutton.style.opacity = '0.5';\r\n\r\n\t\t\t};\r\n\r\n\t\t\tbutton.onclick = function () {\r\n\r\n\t\t\t\tif ( currentSession === null ) {\r\n\r\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\r\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\r\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\r\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\r\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\r\n\t\t\t\t\t// be requested separately.)\r\n\r\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking', 'layers' ] };\r\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\r\n\t\t\t\t\tlocalStorage.setItem(\"VR\", true);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tcurrentSession.end();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction disableButton() {\r\n\r\n\t\t\tbutton.style.display = '';\r\n\r\n\t\t\tbutton.style.cursor = 'auto';\r\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\r\n\t\t\tbutton.style.width = '150px';\r\n\r\n\t\t\tbutton.onmouseenter = null;\r\n\t\t\tbutton.onmouseleave = null;\r\n\r\n\t\t\tbutton.onclick = null;\r\n\r\n\t\t}\r\n\r\n\t\tfunction showWebXRNotFound() {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction showVRNotAllowed( exception ) {\r\n\r\n\t\t\tdisableButton();\r\n\r\n\t\t\tconsole.warn( 'Exception when trying to call xr.isSessionSupported', exception );\r\n\r\n\t\t\tbutton.textContent = 'VR NOT ALLOWED';\r\n\r\n\t\t}\r\n\r\n\t\tfunction stylizeElement( element ) {\r\n\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.bottom = '20px';\r\n\t\t\telement.style.padding = '12px 6px';\r\n\t\t\telement.style.border = '1px solid #fff';\r\n\t\t\telement.style.borderRadius = '4px';\r\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\r\n\t\t\telement.style.color = '#fff';\r\n\t\t\telement.style.font = 'normal 13px sans-serif';\r\n\t\t\telement.style.textAlign = 'center';\r\n\t\t\telement.style.opacity = '0.5';\r\n\t\t\telement.style.outline = 'none';\r\n\t\t\telement.style.zIndex = '999';\r\n\r\n\t\t}\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\tbutton.id = 'VRButton';\r\n\t\t\tbutton.style.display = 'none';\r\n\r\n\t\t\tstylizeElement( button );\r\n\r\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\r\n\r\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\r\n\r\n\t\t\t\tif ( supported && VRButton.xrSessionIsGranted ) {\r\n\r\n\t\t\t\t\tbutton.click();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} ).catch( showVRNotAllowed );\r\n\r\n\t\t\treturn button;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst message = document.createElement( 'a' );\r\n\r\n\t\t\tif ( window.isSecureContext === false ) {\r\n\r\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\r\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\r\n\t\t\tmessage.style.width = '180px';\r\n\t\t\tmessage.style.textDecoration = 'none';\r\n\r\n\t\t\tstylizeElement( message );\r\n\r\n\t\t\treturn message;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstatic xrSessionIsGranted = false;\r\n\r\n\tstatic registerSessionGrantedListener() {\r\n\r\n\t\tif ( 'xr' in navigator ) {\r\n\r\n\t\t\t// WebXRViewer (based on Firefox) has a bug where addEventListener\r\n\t\t\t// throws a silent exception and aborts execution entirely.\r\n\t\t\tif ( /WebXRViewer\\//i.test( navigator.userAgent ) ) return;\r\n\r\n\t\t\tnavigator.xr.addEventListener( 'sessiongranted', () => {\r\n\r\n\t\t\t\tVRButton.xrSessionIsGranted = true;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nVRButton.registerSessionGrantedListener();\r\n\r\nexport { VRButton };","import React, {Component} from 'react';\r\nimport * as THREE from 'three';\r\nimport Camera from '../Camera/Camera';\r\nimport CarOffsetCamera from '../Camera/CarOffsetCamera';\r\nimport OrbitalCamera from '../Camera/OribtalCamera';\r\nimport CarModel from '../3DModels/CarModel';\r\nimport LogitechG29ControllerSingleton from '../LogicModel/ControllerMapping/LogitechG29Controller';\r\nimport XboxControllerSingleton from '../LogicModel/ControllerMapping/XboxController';\r\nimport Car from '../LogicModel/CarLogic/Car';\r\nimport AmmoInstance from '../LogicModel/Physics/AmmoInstance';\r\nimport CylinderPhysics from '../LogicModel/Physics/PhysicsTypes/CylinderPhysics';\r\nimport { Vector3 } from 'three';\r\nimport TrafficCone from '../3DModels/TrafficCone';\r\nimport LevelFactory from '../Levels/LevelsFactory';\r\nimport  {VRButton}  from '../addons/VRbutton';\r\n\r\nexport default class ThreeScene extends Component{\r\n    \r\n    \r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            \"currentRPM\": 0,\r\n            \"velocity\": 0,\r\n            \"currentShift\": 0,\r\n        };\r\n        this.physicsToUpdate = [];\r\n        localStorage.setItem(\"VR\", false);\r\n        this.gotAnyEvent = false;\r\n    }\r\n\r\n\r\n    async componentDidMount(){\r\n        //Generate elements needed to render the scene\r\n        this.objectsToAnimate = [];\r\n        this.scene = new THREE.Scene();\r\n        this.renderer = new THREE.WebGLRenderer({ alpha: true });\r\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\r\n        this.renderer.setClearColor( 0x87cefa, 1 );\r\n        this.renderer.outputEncoding = THREE.sRGBEncoding;\r\n        this.camera = new Camera(this.renderer);\r\n        this.camera.addContainerToScene(this.scene);\r\n        \r\n        this.clock = new THREE.Clock();\r\n\r\n        //Ammo.js\r\n        await this.createAmmo();\r\n\r\n        //Add elements to the scene\r\n        this.ambientLight = new THREE.AmbientLight(0xffffff, 1.0);\r\n        this.scene.add(this.ambientLight);\r\n        this.sunLight = new THREE.DirectionalLight( 0xffffff, 1.0 );\r\n        this.sunLight.position.set( 0, 100, 0 );\r\n        this.scene.add( this.sunLight );\r\n        \r\n        let Ammo = await AmmoInstance.getInstance();\r\n\r\n        this.level = new LevelFactory(0,this.scene, this.physicsWorld);\r\n        this.physicsToUpdate.push(this.level);\r\n        this.objectsToAnimate.push(this.level);\r\n\r\n        this.cone = new TrafficCone(\"textures/coneTexture.jpg\");\r\n        this.cone.addToScene(this.scene, \"trafficCone\", [10,0,0], [1,1,1]);\r\n        this.conePhysics = new CylinderPhysics(\r\n            new THREE.Vector3(10,0,0), \r\n            new THREE.Quaternion().setFromAxisAngle( new THREE.Vector3( 1, 0, 0 ), 0), \r\n            new Ammo.btVector3(0,0,0), \r\n            10, \r\n            new THREE.Vector3(this.cone.RADIUS_BOTTOM, this.cone.HEIGHT/2, this.cone.RADIUS_BOTTOM), \r\n            this.physicsWorld,\r\n            1000\r\n        );\r\n        await this.conePhysics.buildAmmoPhysics();\r\n        this.physicsToUpdate.push(this.conePhysics);\r\n        this.conePhysics.attachObserver(this.cone);\r\n        this.objectsToAnimate.push(this.cone);\r\n\r\n        //Add driver's car to scene\r\n        this.carLogic = new Car(this.physicsWorld);\r\n        let carModel = new CarModel();\r\n        this.carLogic.attachObserver(carModel);\r\n        this.carLogic.attachObserver(this.camera);\r\n        this.objectsToAnimate.push(await carModel.addToScene(this.scene));\r\n        this.carLogic.notifyObservers();\r\n        \r\n        //Bind this to methods of the class\r\n        this.animation = this.animation.bind(this);\r\n        this.handleWindowResize = this.handleWindowResize.bind(this);\r\n        this.generateEvents = this.generateEvents.bind(this);\r\n        \r\n        //Handle resize and gamepad connection on window.\r\n        this.generateEvents();\r\n\r\n        //Append canvas to DOM in HTML and start animating\r\n        this.mount.appendChild(this.renderer.domElement);\r\n        this.animation();\r\n\r\n        document.body.appendChild( VRButton.createButton( this.renderer ) );\r\n        this.renderer.xr.enabled = true;\r\n        \r\n    }\r\n\r\n\r\n    generateEvents(){\r\n        window.addEventListener(\"resize\", this.handleWindowResize);\r\n        window.addEventListener(\"gamepaddisconnected\", function(e){\r\n            LogitechG29ControllerSingleton.removeInstance();  \r\n        });\r\n\r\n        document.addEventListener('keydown', (event) => {\r\n            var numCamera = event.key;\r\n            this.carLogic.removeObserver(this.camera);\r\n            switch(numCamera){\r\n                case \"1\":\r\n                    this.camera = new Camera(this.renderer);\r\n                    this.camera.addContainerToScene(this.scene);\r\n                    break;\r\n                case \"2\":\r\n                    this.camera = new OrbitalCamera(this.renderer);\r\n                    break;\r\n                case \"3\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(-4.35, 0.6, -0.1));\r\n                    break;\r\n                case \"4\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(4.35, 0.6, -0.1));\r\n                    break;\r\n                case \"5\":\r\n                    this.camera = new CarOffsetCamera(new Vector3(0.0, 3.0, -5.0));\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this.carLogic.attachObserver(this.camera);\r\n            this.carLogic.notifyObservers();\r\n\r\n          }, false);\r\n    }\r\n\r\n\r\n    async createAmmo(){\r\n        let Ammo = await AmmoInstance.getInstance();\r\n        this.tempTransform = new Ammo.btTransform();\r\n        let collisionConfiguratation = new Ammo.btDefaultCollisionConfiguration();\r\n        let dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguratation);\r\n        let overlappingPairCache = new Ammo.btDbvtBroadphase();\r\n        let solver = new Ammo.btSequentialImpulseConstraintSolver();\r\n\r\n        this.physicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, overlappingPairCache, solver, collisionConfiguratation);\r\n        this.physicsWorld.setGravity(new Ammo.btVector3(0,-9.8,0));\r\n    }\r\n\r\n\r\n    handleWindowResize(){\r\n        this.camera.handleResize();\r\n        this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n        this.renderer.render( this.scene, this.camera.getCameraInstance() );\r\n    }\r\n\r\n\r\n    animation(){\r\n        let deltaTime = this.clock.getDelta();\r\n        this.renderer.setAnimationLoop(this.animation);\r\n        this.physicsWorld.stepSimulation(deltaTime, 10);\r\n        this.objectsToAnimate.forEach(function(object){\r\n            object.animate();\r\n        });\r\n        this.physicsToUpdate.forEach(function(phys){\r\n            phys.updatePhysics();\r\n        });\r\n        this.camera.setPositionRelativeToObject();\r\n        XboxControllerSingleton.getInstance(this.carLogic).checkEvents();\r\n        this.setState({\"velocity\": this.carLogic.getSpeed(), \"currentRPM\": this.carLogic.getCurrentRPM(), \"currentShift\": this.carLogic.getCurrentShift()});\r\n        this.renderer.render( this.scene, this.camera.getCameraInstance());\r\n        \r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div>\r\n                <div style={{position:\"absolute\", left:\"10px\", top:\"10px\", color:\"red\"}} id=\"Acelerador\">\r\n                    {/*\r\n                    <p style={{ zIndex: 20, display: 'float', fontWeight: \"bold\"}} >\r\n                        Velocidad: {parseInt(this.state.velocity)} km/h\r\n                    </p>\r\n                    <p style={{ zIndex: 20, display: 'float', fontWeight: \"bold\"}} >\r\n                        RPM: {parseInt(this.state.currentRPM)}\r\n                    </p>*/}\r\n                    <p style={{ zIndex: 20, display: 'float', fontWeight: \"bold\"}} >\r\n                        Cambio Actual: {parseInt(this.state.currentShift)}\r\n                    </p>\r\n                </div>\r\n                <div ref={mount => {this.mount = mount;}}></div>\r\n            </div>\r\n            \r\n        );\r\n    }\r\n}","import React from 'react';\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\n\r\nconst styleMenu = {\r\n  width:\"100vw\", \r\n  height:\"100vh\", \r\n  backgroundImage:`url(\"DrivingSimMenuNoTitle.png\")`, \r\n  backgroundSize:\"cover\", \r\n  backgroundRepeat: \"no-repeat\"\r\n}\r\n\r\n\r\nexport const MainMenu = () => {\r\n\r\n  const navigate = useNavigate()\r\n\r\n  return (\r\n    <>\r\n      <div style={styleMenu}>\r\n        <div id=\"button-box\" style={{position:\"absolute\", top:\"5%\", right:\"5%\"}}>\r\n          <div className={\"MainMenuTitle\"}>\r\n            <h1 style={{textAlign:\"center\", fontSize:\"7rem\"}}>\r\n              Driving<br/>Simulator\r\n            </h1>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/scene\")}\r\n            >\r\n              Iniciar\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n          <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/level-editor\")}\r\n            >\r\n              Editor de Niveles\r\n            </button>\r\n          </div>\r\n          <div className={\"buttonWrapperMainMenu\"}>\r\n            <button \r\n              className={\"buttonMainMenu\"}\r\n              onClick={() => navigate(\"/configs\")}\r\n            >\r\n              Configuracin\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronRightIcon from '@mui/icons-material/ChevronRight';\r\n\r\n\r\nexport const ConfigDrawer = ( {openConfigs, handleDrawerClose} ) => {\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openConfigs);\r\n    }, [openConfigs]);\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        width:'100%',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-start',\r\n    }));\r\n\r\n    return (\r\n        <>  \r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"right\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader className='drawer-header' onClick={handleDrawerClose}>\r\n                        <ChevronRightIcon />\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"right\", paddingRight:30}}>Configurations</h3>\r\n                        </div>\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                </Drawer>\r\n            </Grid>\r\n        </>\r\n    );\r\n}","import { createContext } from 'react';\r\n\r\nexport const ItemsContext = createContext();\r\n","import React from 'react';\r\nimport { Grid } from '@mui/material'\r\nimport { styled } from '@mui/material/styles';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport Divider from '@mui/material/Divider';\r\nimport ChevronLeftIcon from '@mui/icons-material/ChevronLeft';\r\nimport { ItemsContext } from '../LevelEditorContext/ItemsContext';\r\n\r\n\r\nconst allUnselected = {\r\n    \"cone\": null,\r\n    \"trapecio\": null,\r\n    \"street\": null\r\n};\r\n\r\n\r\nexport const ItemsDrawer = ( {openItems, handleDrawerClose} ) => {\r\n    \r\n    const [open, setOpen] = React.useState(false);\r\n    const {setLastSelectedItem, lastSelectedItem} = React.useContext(ItemsContext);\r\n\r\n    React.useEffect(() => {\r\n        setOpen(openItems);\r\n    }, [openItems]);\r\n\r\n    //const theme = useTheme();\r\n\r\n    const DrawerHeader = styled('div')(({ theme }) => ({\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        padding: theme.spacing(0, 1),\r\n        // necessary for content to be below app bar\r\n        ...theme.mixins.toolbar,\r\n        justifyContent: 'flex-end',\r\n    }));\r\n\r\n    const [itemSelected, setItemSelected] = React.useState(allUnselected);\r\n\r\n\r\n    const handleSelection = (item) => {\r\n        const dictSelection = {...allUnselected};\r\n        dictSelection[item] = \"selected\";\r\n        setItemSelected(dictSelection);\r\n        setLastSelectedItem({\r\n            selectedItem: item,\r\n            scale: 1.0,\r\n            positionX: 0.0,\r\n            positionY: 0.0,\r\n            zIndex: lastSelectedItem ? lastSelectedItem.zIndex + 1 : 1\r\n        });\r\n    }\r\n\r\n    return (\r\n\r\n        <>\r\n            <Grid>\r\n                <Drawer\r\n                    sx={{\r\n                        width: window.innerWidth/6,\r\n                        flexShrink: 0,\r\n                        '& .MuiDrawer-paper': {\r\n                        width: window.innerWidth/6,\r\n                        boxSizing: 'border-box',\r\n                        },\r\n                    }}\r\n                    variant=\"persistent\"\r\n                    anchor=\"left\"\r\n                    open={open}\r\n                >\r\n                    <DrawerHeader onClick={handleDrawerClose} className='drawer-header'>\r\n                        <div style={{width:\"100%\"}}>\r\n                            <h3 style={{textAlign:\"left\", paddingLeft:10}}>Items</h3>\r\n                        </div>\r\n                        <ChevronLeftIcon />\r\n                    </DrawerHeader>\r\n                    <Divider />\r\n                    <Grid style={{justifyContent: \"center\", display: \"flex\", alignItems:\"center\", flexDirection:\"column\"}}>\r\n                        {\r\n                            Object.entries(itemSelected).map(([nameItem, isSelected]) => {\r\n                                return (\r\n                                    <img \r\n                                        alt={`${nameItem}`}\r\n                                        key={nameItem}\r\n                                        src={`${nameItem}.png`} \r\n                                        width={75}\r\n                                        height={75} \r\n                                        className={`imageLevelEditor ${isSelected}`} \r\n                                        onClick={() => handleSelection(nameItem)}\r\n                                    />\r\n                                );\r\n                            })\r\n                        }\r\n                    </Grid>\r\n                </Drawer>\r\n            </Grid>\r\n            \r\n        </>\r\n\r\n    );\r\n}","import React from 'react'\r\nimport {useState} from 'react';\r\nimport Button from '@mui/material/Button';\r\nimport Grid from '@mui/material/Grid';\r\n\r\nconst MAX_WIDTH_INPUT = 40;\r\nconst MAX_HEIGHT_INPUT = 40;\r\n\r\nexport const InputsGrid = ({setGridDimensions, gridDimensions}) => {\r\n    const [InputWidth, setInputWidth] = useState(gridDimensions.width);\r\n    const [InputHeight, setInputHeight] = useState(gridDimensions.height);\r\n\r\n    const onSubmit = () =>{\r\n      setGridDimensions(\r\n        {\r\n          width: InputWidth, \r\n          height: InputHeight\r\n        }\r\n      );\r\n    }\r\n  return (\r\n    <Grid container  direction=\"row\" width={\"80%\"} marginLeft={'10%'}\r\n    justifyContent=\"space-evenly\"\r\n    alignItems=\"center\" spacing={2}>\r\n        <Grid item xs={2}>\r\n        <p>Ancho:</p>\r\n          <input \r\n            value={InputWidth} \r\n            type=\"number\" \r\n            step=\"1\" \r\n          onChange={\r\n              (event) => {\r\n                let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                setInputWidth(value > MAX_WIDTH_INPUT ? MAX_WIDTH_INPUT : value);\r\n              }\r\n        } \r\n          />\r\n        </Grid>\r\n        \r\n        <Grid item xs={2}>\r\n          <div>\r\n            <p>Alto:</p>\r\n            <input \r\n              value={InputHeight} \r\n              type=\"number\" \r\n              step=\"1\" \r\n              onChange={\r\n                (event) => {\r\n                  let value = parseInt(event.target.value.replaceAll(\",\",\"\").replaceAll(\".\",\"\"));\r\n                  setInputHeight(value > MAX_HEIGHT_INPUT ? MAX_HEIGHT_INPUT : value);\r\n                  \r\n                }\r\n              }\r\n            />\r\n          </div>\r\n        </Grid>\r\n        <Grid item xs={2}>\r\n          <Button variant=\"contained\" onClick={onSubmit}>Actualizar</Button>\r\n        </Grid>\r\n    </Grid>\r\n    \r\n  )\r\n}\r\n","import { useEffect, useState } from 'react';\r\n\r\nconst COLORS = {\r\n  \"FILLED\": \"darkgray\",\r\n  \"EMPTY\": \"white\"\r\n};\r\n\r\nconst WIDTH_GRID_VIEW = 600;\r\nconst HEIGHT_GRID_VIEW = 600;\r\nconst LEFT_CLICK = 0;\r\nconst RIGHT_CLICK = 2;\r\n\r\n\r\nexport const LevelGrid = ({gridDimensions}) => {\r\n\r\n  const [levelGrid, setLevelGrid] = useState([]);\r\n  const [click, setClick] = useState(false);\r\n  const [rightClick, setRightClick] = useState(false);\r\n\r\n  useEffect(() => {\r\n    let finalGrid = [];\r\n    for(let i=0; i<gridDimensions.height; i++){\r\n      let currentRow = [];\r\n      for(let j=0; j<gridDimensions.width; j++){\r\n        let newCell = {\r\n          \"filled\": false,\r\n          \"div_color\": COLORS[\"EMPTY\"]\r\n        }\r\n        currentRow.push(newCell);\r\n      }\r\n      finalGrid.push(currentRow);\r\n    }\r\n    setLevelGrid(finalGrid);\r\n  }, [gridDimensions.width, gridDimensions.height]);\r\n\r\n\r\n  useEffect(() => {\r\n    window.addEventListener(\"mouseup\", (event) => {\r\n      event.preventDefault();\r\n      if(event.button === LEFT_CLICK){\r\n        setClick(false);\r\n      }else if (event.button === RIGHT_CLICK){\r\n        setRightClick(false);\r\n      }\r\n    });\r\n    window.addEventListener(\"contextmenu\", (event) => { event.preventDefault(); });\r\n  }, [])\r\n\r\n  const onEnterHoverWithClickCell = (row, col) => {\r\n    if(click){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(rightClick){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n  const onClickCell = (row, col, btn_click) => {\r\n    if(btn_click === LEFT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = true;\r\n      levelGridCopy[row][col].div_color = COLORS[\"FILLED\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }else if(btn_click === RIGHT_CLICK){\r\n      const levelGridCopy = [...levelGrid];\r\n      levelGridCopy[row][col].filled = false;\r\n      levelGridCopy[row][col].div_color = COLORS[\"EMPTY\"];\r\n      setLevelGrid(levelGridCopy);\r\n    }\r\n  };\r\n\r\n\r\n  return (\r\n    <div \r\n      style={{\r\n        width: WIDTH_GRID_VIEW,\r\n        height: HEIGHT_GRID_VIEW,\r\n        marginTop: 25,\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n      }}\r\n      onMouseDown = {(event) => {\r\n        event.preventDefault();\r\n        if(event.button === LEFT_CLICK){\r\n          setClick(true);\r\n        }else if (event.button === RIGHT_CLICK){\r\n          setRightClick(true);\r\n        }\r\n      }}\r\n    >\r\n      {levelGrid.map((row, idx_row) => {\r\n        return(\r\n          <div \r\n            className=\"row-level-grid\" \r\n            id={`row_${idx_row}`}\r\n            key={`row_${idx_row}`}\r\n            style={{\r\n              width: \"100%\",\r\n              height: HEIGHT_GRID_VIEW/gridDimensions.height,\r\n              display: \"flex\",\r\n              flexDirection: \"row\"\r\n            }}\r\n          >\r\n            {row.map((cell, idx_col) => {\r\n              return (\r\n                <div \r\n                  className=\"cell-level-grid\" \r\n                  key={`cell_${idx_row}_${idx_col}`}\r\n                  id={`cell_${idx_row}_${idx_col}`} \r\n                  style={{\r\n                    backgroundColor: cell[\"div_color\"],\r\n                    width: `${100/gridDimensions.width}%`,\r\n                    height: \"100%\",\r\n                    border: \"1px solid black\"\r\n                  }} \r\n                  //onMouseEnter = {() => onEnterHoverWithClickCell(idx_row, idx_col)}\r\n                  onMouseMove = {(event) => {\r\n                    event.preventDefault();\r\n                    onEnterHoverWithClickCell(idx_row, idx_col);\r\n                  }}\r\n                  onMouseUp = {(event) => {\r\n                    onClickCell(idx_row, idx_col, event.button);\r\n                  }}\r\n                  \r\n                />\r\n              );\r\n            })}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}","import React from 'react'\r\nimport { Button, IconButton } from '@mui/material'\r\nimport { ConfigDrawer } from './Components/ConfigDrawer';\r\nimport { ItemsDrawer } from './Components/ItemsDrawer';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport MemoryIcon from '@mui/icons-material/Memory';\r\nimport AddIcon from '@mui/icons-material/Add';\r\nimport { ItemsContext } from './LevelEditorContext/ItemsContext';\r\nimport { useState } from 'react';\r\nimport { InputsGrid } from './Components/InputsGrid';\r\n\r\nimport { LevelGrid } from './Components/LevelGrid';\r\n\r\nexport const LevelEditor = () => {\r\n\r\n  const [openItems, setOpenItems] = useState(false);\r\n  const [openConfigs, setOpenConfigs] = useState(false);\r\n\r\n  const [itemsInGrid, setItemsInGrid] = useState([]);\r\n\r\n  const [lastSelectedItem, setLastSelectedItem] = useState(null);\r\n\r\n  const [gridDimensions, setGridDimensions] = useState({width:20, height:20});\r\n\r\n  React.useEffect(() => {\r\n    if (lastSelectedItem !== null){\r\n      setItemsInGrid(currentItems => [...currentItems, lastSelectedItem]);\r\n    }\r\n  }, [lastSelectedItem]);\r\n\r\n  return (\r\n    <>\r\n      <ItemsContext.Provider value={{lastSelectedItem, setLastSelectedItem}}>\r\n        <div>\r\n          <div style={{flexDirection:'row',justifyContent:'space-between', display:\"flex\"}}>\r\n            <IconButton onClick={() => setOpenItems(true)} style={{height:40, margin:10}} className='header'>\r\n              <AddIcon/>\r\n            </IconButton>\r\n            <h1>Driving Simulator - Level Editor</h1>\r\n            <IconButton onClick={() => setOpenConfigs(true)} style={{height:40, margin:10}} className='header' >\r\n              <SettingsIcon/>\r\n            </IconButton>\r\n          </div>\r\n          <div>\r\n              <InputsGrid setGridDimensions={setGridDimensions} gridDimensions={gridDimensions}></InputsGrid>\r\n              <LevelGrid gridDimensions = {gridDimensions}/>\r\n              {itemsInGrid.map((item, idx) => {\r\n                return(\r\n                  <span key={idx}></span>\r\n                  /*<img \r\n                    key={idx} \r\n                    src={`${item.selectedItem}.png`} \r\n                    width={item.scale*75} \r\n                    height={item.scale*75} \r\n                    style={{\r\n                      top:item.positionY, \r\n                      left:item.positionX,\r\n                      position: \"absolute\",\r\n                      zIndex: item.zIndex.toString()\r\n                    }}\r\n                    onClick={() => {console.log(`OPEN CONFIGS OF idx: ${idx}, obj: ${JSON.stringify(itemsInGrid[idx])}`)}}\r\n                  />*/\r\n                );\r\n              })}\r\n          </div>\r\n          <div style={{display:\"flex\", justifyContent:\"center\", marginTop:40}}>\r\n            <Button variant=\"contained\" color=\"success\">\r\n              <MemoryIcon/> Procesar nivel...\r\n            </Button>\r\n          </div>\r\n          \r\n        </div>\r\n        <ItemsDrawer openItems={openItems} handleDrawerClose={() => {setOpenItems(false)}}/>\r\n        <ConfigDrawer openConfigs={openConfigs} handleDrawerClose={() => {setOpenConfigs(false)}}/>\r\n      </ItemsContext.Provider>\r\n    </>\r\n  );\r\n}\r\n","export const API_URL = \"http://localhost:8001\";","import { createContext } from \"react\";\r\n\r\nexport const SessionContext  = createContext(undefined);","import React from 'react'\r\nimport {API_URL} from '../Constants/Constants'\r\nimport { SessionHooks } from '../Sessions/SessionHooks';\r\nimport { Button, TextField } from \"@mui/material\"\r\nimport { Link } from 'react-router-dom';\r\nimport { GoogleLogin } from '@react-oauth/google';\r\n\r\nexport const LoginForm = () => {\r\n\r\n  const [email, setEmail] = React.useState(\"\");\r\n  const [password, setPassword] = React.useState(\"\");\r\n  const { setSessionWithResponse } = SessionHooks();\r\n\r\n  const postLogin = async () => {\r\n    const APIResponse = await fetch(\r\n        `${API_URL}/users/login`,\r\n        {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({\r\n                \"email\": email,\r\n                \"password\": password\r\n            })\r\n        }\r\n    );\r\n    if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        throw new Error(json.detail);\r\n    }\r\n    return APIResponse.json();\r\n  }\r\n\r\n\r\n  const submitLogin = async (event) => {\r\n    event.preventDefault();\r\n    try{\r\n        const loginResponse = await postLogin();\r\n        setSessionWithResponse(loginResponse);\r\n    }catch(e){\r\n        console.log(e);\r\n    }\r\n  }\r\n\r\n\r\n  const postLoginGoogle = async (token) => {\r\n    const APIResponse = await fetch(\r\n        `${API_URL}/users/login_google`,\r\n        {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\"\r\n            },\r\n            body: JSON.stringify({\r\n                \"token\": token\r\n            })\r\n        }\r\n    );\r\n    if (APIResponse.status !== 200){\r\n        const json = await APIResponse.json();\r\n        throw new Error(json.detail);\r\n    }\r\n    return APIResponse.json();\r\n  }\r\n\r\n  const submitGoogleLogin = async (token) => {\r\n    try{\r\n        const responseAPI = await postLoginGoogle(token);\r\n        console.log(responseAPI);\r\n        setSessionWithResponse(responseAPI);\r\n    }catch(e){\r\n        console.log(e);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={submitLogin}>\r\n        <div style={{\r\n            display:\"flex\", \r\n            justifyContent:\"center\", \r\n            alignContent:\"center\", \r\n            flexDirection:\"column\", \r\n            textAlign:\"center\",\r\n            margin: \"auto\",\r\n            marginTop:40,\r\n            padding: 30,\r\n            border: \"2px solid black\",\r\n            borderRadius: 20,\r\n            maxWidth:400\r\n        }}>\r\n            <h1>Iniciar Sesin</h1>\r\n            <div style={{display:\"flex\", justifyContent:\"center\"}}>\r\n                <img src=\"logo_transp.png\" width=\"25%\" alt=\"Driving Simulator Logo\"/>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    type=\"text\" \r\n                    onChange={(event) => setEmail(event.target.value)} \r\n                    value={email} \r\n                    name=\"email\"\r\n                    label=\"E-Mail\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <TextField \r\n                    type=\"password\" \r\n                    onChange={(event) => setPassword(event.target.value)} \r\n                    value={password} \r\n                    name=\"password\"\r\n                    label=\"Contrasea\"\r\n                />\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Button variant=\"contained\" onClick={submitLogin}>Iniciar Sesin</Button>\r\n            </div>\r\n            <div style={{marginTop:20}}>\r\n                <Link to={\"/signup\"}>No posees una cuenta? Registrate aqu...</Link>\r\n            </div>\r\n            <div style={{marginTop:20, display:\"flex\", justifyContent:\"center\", textAlign:\"center\", alignContent:\"center\"}}>\r\n                <GoogleLogin\r\n                    onSuccess={credentialResponse => {\r\n                        const OAuthToken = credentialResponse.credential;\r\n                        submitGoogleLogin(OAuthToken);\r\n                    }}\r\n                    onError={() => {\r\n                        console.log('Login Failed');\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    </form>\r\n  )\r\n}\r\n\r\n","import { useContext } from 'react';\r\nimport { SessionContext } from './SessionContext';\r\n\r\nexport const SessionHooks = () => {\r\n  \r\n    const { session, setSession } = useContext(SessionContext);\r\n\r\n\r\n    const setSessionWithResponse = (loginResponse) => {\r\n        setSession({\r\n            user: loginResponse.user,\r\n            jwt: loginResponse.jwt\r\n        });\r\n    }\r\n\r\n    const getUser = () => {\r\n        return session.user ? session.user : undefined;\r\n    }\r\n\r\n    const getJWT = () => {\r\n        return session.jwt ? session.jwt : undefined;\r\n    }\r\n\r\n    return({\r\n        setSessionWithResponse,\r\n        getUser,\r\n        getJWT\r\n    })\r\n}\r\n","import React from 'react'\r\n\r\nexport const SignUpForm = () => {\r\n  return (\r\n    <div>SignUpForm</div>\r\n  )\r\n}\r\n","import { SessionContext } from \"./SessionContext\";\r\nimport { useState } from 'react'\r\nimport { GoogleOAuthProvider } from '@react-oauth/google';\r\n\r\nexport const SessionProvider = ( {childElement} ) => {\r\n  \r\n    const [session, setSession] = useState({\r\n        user: undefined,\r\n        jwt: undefined\r\n    });\r\n\r\n    return (\r\n        <GoogleOAuthProvider clientId=\"18785041157-s9ga39r0i6up45radtj3soo6je1pneon.apps.googleusercontent.com\">\r\n            <SessionContext.Provider value={{session, setSession}}>\r\n                {childElement}\r\n            </SessionContext.Provider>\r\n        </GoogleOAuthProvider>\r\n    )\r\n}\r\n","import ThreeScene from './Scene/ThreeScene';\r\nimport { useEffect } from 'react';\r\nimport { MainMenu } from './Menus/MainMenu';\r\nimport { LevelEditor } from './Menus/LevelEditor';\r\nimport { HashRouter as Router, Routes as Switch, Route } from 'react-router-dom';\r\nimport { LoginForm } from './Menus/Components/LoginForm';\r\nimport { SignUpForm } from './Menus/Components/SignUpForm';\r\nimport { SessionProvider } from './Menus/Sessions/SessionProvider';\r\n\r\n\r\nfunction App() {\r\n\r\n  useEffect(() => {\r\n    document.title = 'Driving Simulator';\r\n  }, []);\r\n\r\n  return (\r\n    <SessionProvider childElement = \r\n      {\r\n        <Router>\r\n          <Switch>\r\n            <Route exact path=\"/scene\" element = {<ThreeScene/>} />\r\n            <Route exact path=\"/\" element = {<MainMenu/>} />\r\n            <Route exact path=\"/level-editor\" element = {<LevelEditor/>} />\r\n            <Route exact path=\"/login\" element = {<LoginForm/>}/>\r\n            <Route exact path=\"/signup\" element = {<SignUpForm/>}/>\r\n          </Switch>\r\n        </Router>\r\n      }\r\n    />\r\n    \r\n  );\r\n\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <App />\n);\n\n","export default class GlobalControllerHandling{\r\n\r\n    \r\n    constructor(car){\r\n        this.car = car;\r\n    }\r\n\r\n\r\n    handleAccelerate(valueClutch, valueAccelerator){\r\n        this.car.accelerate(valueClutch, valueAccelerator);\r\n    }\r\n\r\n\r\n    handleBrake(valueClutch, valueBrake){\r\n        this.car.brake(valueClutch, valueBrake);\r\n    }\r\n\r\n\r\n    changeShift(valueClutch, valueShift){\r\n        this.car.changeShift(valueClutch, valueShift);\r\n    }\r\n\r\n\r\n    turnDirection(wheelAxesValue){\r\n        this.car.turnDirection(wheelAxesValue);\r\n    }\r\n\r\n\r\n    turnOnCar(){\r\n        this.car.turnOnCar();\r\n    }\r\n\r\n\r\n    updateCar(){\r\n        this.car.update();\r\n    }\r\n\r\n\r\n    changeShiftBox(mode){\r\n        this.car.changeShiftBox(mode);\r\n    }\r\n}"],"sourceRoot":""}